<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class LandingController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/landing_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="LandingHelper.html">LandingHelper</a>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-about_us">#about_us</a>
    
    <li><a href="#method-i-activity_category_report">#activity_category_report</a>
    
    <li><a href="#method-i-become_provider">#become_provider</a>
    
    <li><a href="#method-i-blog_content">#blog_content</a>
    
    <li><a href="#method-i-cat_subcategory_row">#cat_subcategory_row</a>
    
    <li><a href="#method-i-category_report_count">#category_report_count</a>
    
    <li><a href="#method-i-change_url">#change_url</a>
    
    <li><a href="#method-i-contact_us">#contact_us</a>
    
    <li><a href="#method-i-contact_us_mail">#contact_us_mail</a>
    
    <li><a href="#method-i-every_mon_wed_fri">#every_mon_wed_fri</a>
    
    <li><a href="#method-i-every_mon_wed_fri_never">#every_mon_wed_fri_never</a>
    
    <li><a href="#method-i-every_tue_thu">#every_tue_thu</a>
    
    <li><a href="#method-i-every_tue_thu_never">#every_tue_thu_never</a>
    
    <li><a href="#method-i-every_week_mon_to_fri">#every_week_mon_to_fri</a>
    
    <li><a href="#method-i-every_week_mon_to_fri_never">#every_week_mon_to_fri_never</a>
    
    <li><a href="#method-i-fam_post_row">#fam_post_row</a>
    
    <li><a href="#method-i-famtivity_user_count">#famtivity_user_count</a>
    
    <li><a href="#method-i-famtivity_user_report">#famtivity_user_report</a>
    
    <li><a href="#method-i-faq">#faq</a>
    
    <li><a href="#method-i-favorite_activity">#favorite_activity</a>
    
    <li><a href="#method-i-featured_activity">#featured_activity</a>
    
    <li><a href="#method-i-featured_activity_2">#featured_activity_2</a>
    
    <li><a href="#method-i-find_us_on_famtivity">#find_us_on_famtivity</a>
    
    <li><a href="#method-i-follow_cities">#follow_cities</a>
    
    <li><a href="#method-i-follow_provider_card">#follow_provider_card</a>
    
    <li><a href="#method-i-free_activity">#free_activity</a>
    
    <li><a href="#method-i-geo_ip_location">#geo_ip_location</a>
    
    <li><a href="#method-i-get_parent_user">#get_parent_user</a>
    
    <li><a href="#method-i-get_provider_user">#get_provider_user</a>
    
    <li><a href="#method-i-get_total_count_free_list">#get_total_count_free_list</a>
    
    <li><a href="#method-i-get_total_count_my_activity_list">#get_total_count_my_activity_list</a>
    
    <li><a href="#method-i-get_total_count_shared_list">#get_total_count_shared_list</a>
    
    <li><a href="#method-i-get_total_count_sub_category_list">#get_total_count_sub_category_list</a>
    
    <li><a href="#method-i-get_total_favorite_count_list">#get_total_favorite_count_list</a>
    
    <li><a href="#method-i-get_total_favorite_list">#get_total_favorite_list</a>
    
    <li><a href="#method-i-get_total_feature_list">#get_total_feature_list</a>
    
    <li><a href="#method-i-get_total_free_list">#get_total_free_list</a>
    
    <li><a href="#method-i-get_total_my_activity_list">#get_total_my_activity_list</a>
    
    <li><a href="#method-i-get_total_provider_list">#get_total_provider_list</a>
    
    <li><a href="#method-i-get_total_shared_list">#get_total_shared_list</a>
    
    <li><a href="#method-i-get_total_sub_category_list">#get_total_sub_category_list</a>
    
    <li><a href="#method-i-get_total_sub_category_list_with_subcat_id">#get_total_sub_category_list_with_subcat_id</a>
    
    <li><a href="#method-i-home_redirect_activity">#home_redirect_activity</a>
    
    <li><a href="#method-i-how_it_works">#how_it_works</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-invite_provider">#invite_provider</a>
    
    <li><a href="#method-i-invite_provider_submit">#invite_provider_submit</a>
    
    <li><a href="#method-i-landing_feature">#landing_feature</a>
    
    <li><a href="#method-i-landing_new">#landing_new</a>
    
    <li><a href="#method-i-landing_new_old">#landing_new_old</a>
    
    <li><a href="#method-i-my_activity">#my_activity</a>
    
    <li><a href="#method-i-newsletter">#newsletter</a>
    
    <li><a href="#method-i-newsletter_subscripe">#newsletter_subscripe</a>
    
    <li><a href="#method-i-parent_privacy_policy">#parent_privacy_policy</a>
    
    <li><a href="#method-i-parent_terms_of_service">#parent_terms_of_service</a>
    
    <li><a href="#method-i-privacy_policy">#privacy_policy</a>
    
    <li><a href="#method-i-provider_names_list">#provider_names_list</a>
    
    <li><a href="#method-i-provider_privacy_policy">#provider_privacy_policy</a>
    
    <li><a href="#method-i-provider_terms_of_service">#provider_terms_of_service</a>
    
    <li><a href="#method-i-register">#register</a>
    
    <li><a href="#method-i-repeat_monthly_date">#repeat_monthly_date</a>
    
    <li><a href="#method-i-repeat_monthly_date_never">#repeat_monthly_date_never</a>
    
    <li><a href="#method-i-repeat_monthly_day">#repeat_monthly_day</a>
    
    <li><a href="#method-i-repeat_monthly_day_never">#repeat_monthly_day_never</a>
    
    <li><a href="#method-i-repeat_schedule">#repeat_schedule</a>
    
    <li><a href="#method-i-repeat_schedule_end">#repeat_schedule_end</a>
    
    <li><a href="#method-i-repeat_schedule_occurance">#repeat_schedule_occurance</a>
    
    <li><a href="#method-i-repeat_weekly">#repeat_weekly</a>
    
    <li><a href="#method-i-repeat_weekly_never">#repeat_weekly_never</a>
    
    <li><a href="#method-i-schedule_repeat_append">#schedule_repeat_append</a>
    
    <li><a href="#method-i-search_activities">#search_activities</a>
    
    <li><a href="#method-i-search_landing_new">#search_landing_new</a>
    
    <li><a href="#method-i-service_discover_more">#service_discover_more</a>
    
    <li><a href="#method-i-service_purchase_more">#service_purchase_more</a>
    
    <li><a href="#method-i-shared_activity">#shared_activity</a>
    
    <li><a href="#method-i-splash">#splash</a>
    
    <li><a href="#method-i-submit">#submit</a>
    
    <li><a href="#method-i-support">#support</a>
    
    <li><a href="#method-i-terms_of_service">#terms_of_service</a>
    
    <li><a href="#method-i-update_parent_provider">#update_parent_provider</a>
    
    <li><a href="#method-i-update_ses_date">#update_ses_date</a>
    
    <li><a href="#method-i-v2_landing_new">#v2_landing_new</a>
    
    <li><a href="#method-i-week_of_month_for_date">#week_of_month_for_date</a>
    
    <li><a href="#method-i-zip_search">#zip_search</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./ActivitiesController.html">ActivitiesController</a>
  
    <li><a href="./ActivitiesHelper.html">ActivitiesHelper</a>
  
    <li><a href="./Activity.html">Activity</a>
  
    <li><a href="./ActivityAttendDetail.html">ActivityAttendDetail</a>
  
    <li><a href="./ActivityAttendDetailsController.html">ActivityAttendDetailsController</a>
  
    <li><a href="./ActivityAttendDetailsHelper.html">ActivityAttendDetailsHelper</a>
  
    <li><a href="./ActivityBid.html">ActivityBid</a>
  
    <li><a href="./ActivityBidsController.html">ActivityBidsController</a>
  
    <li><a href="./ActivityBidsHelper.html">ActivityBidsHelper</a>
  
    <li><a href="./ActivityCategoriesController.html">ActivityCategoriesController</a>
  
    <li><a href="./ActivityCategoriesHelper.html">ActivityCategoriesHelper</a>
  
    <li><a href="./ActivityCategory.html">ActivityCategory</a>
  
    <li><a href="./ActivityClick.html">ActivityClick</a>
  
    <li><a href="./ActivityComment.html">ActivityComment</a>
  
    <li><a href="./ActivityCommentsController.html">ActivityCommentsController</a>
  
    <li><a href="./ActivityCommentsHelper.html">ActivityCommentsHelper</a>
  
    <li><a href="./ActivityCount.html">ActivityCount</a>
  
    <li><a href="./ActivityDetailController.html">ActivityDetailController</a>
  
    <li><a href="./ActivityDetailHelper.html">ActivityDetailHelper</a>
  
    <li><a href="./ActivityDiscountPrice.html">ActivityDiscountPrice</a>
  
    <li><a href="./ActivityFavorite.html">ActivityFavorite</a>
  
    <li><a href="./ActivityFavoritesController.html">ActivityFavoritesController</a>
  
    <li><a href="./ActivityFavoritesHelper.html">ActivityFavoritesHelper</a>
  
    <li><a href="./ActivityForm.html">ActivityForm</a>
  
    <li><a href="./ActivityNetworkController.html">ActivityNetworkController</a>
  
    <li><a href="./ActivityNetworkHelper.html">ActivityNetworkHelper</a>
  
    <li><a href="./ActivityNetworkPermission.html">ActivityNetworkPermission</a>
  
    <li><a href="./ActivityPrice.html">ActivityPrice</a>
  
    <li><a href="./ActivityPricesController.html">ActivityPricesController</a>
  
    <li><a href="./ActivityPricesHelper.html">ActivityPricesHelper</a>
  
    <li><a href="./ActivityRating.html">ActivityRating</a>
  
    <li><a href="./ActivityRatingsController.html">ActivityRatingsController</a>
  
    <li><a href="./ActivityRatingsHelper.html">ActivityRatingsHelper</a>
  
    <li><a href="./ActivityRepeat.html">ActivityRepeat</a>
  
    <li><a href="./ActivityRepeatsController.html">ActivityRepeatsController</a>
  
    <li><a href="./ActivityRepeatsHelper.html">ActivityRepeatsHelper</a>
  
    <li><a href="./ActivityRow.html">ActivityRow</a>
  
    <li><a href="./ActivityRowsController.html">ActivityRowsController</a>
  
    <li><a href="./ActivityRowsHelper.html">ActivityRowsHelper</a>
  
    <li><a href="./ActivitySchedule.html">ActivitySchedule</a>
  
    <li><a href="./ActivitySchedulesController.html">ActivitySchedulesController</a>
  
    <li><a href="./ActivitySchedulesHelper.html">ActivitySchedulesHelper</a>
  
    <li><a href="./ActivitySetting.html">ActivitySetting</a>
  
    <li><a href="./ActivitySettingsDetail.html">ActivitySettingsDetail</a>
  
    <li><a href="./ActivitySettingsType.html">ActivitySettingsType</a>
  
    <li><a href="./ActivityShared.html">ActivityShared</a>
  
    <li><a href="./ActivitySharedsController.html">ActivitySharedsController</a>
  
    <li><a href="./ActivitySharedsHelper.html">ActivitySharedsHelper</a>
  
    <li><a href="./ActivitySubcategoriesController.html">ActivitySubcategoriesController</a>
  
    <li><a href="./ActivitySubcategoriesHelper.html">ActivitySubcategoriesHelper</a>
  
    <li><a href="./ActivitySubcategory.html">ActivitySubcategory</a>
  
    <li><a href="./ActivityTotalCount.html">ActivityTotalCount</a>
  
    <li><a href="./ActivityTrack.html">ActivityTrack</a>
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./AdminDiscountCode.html">AdminDiscountCode</a>
  
    <li><a href="./AdminDiscountCodesController.html">AdminDiscountCodesController</a>
  
    <li><a href="./AdminDiscountCodesHelper.html">AdminDiscountCodesHelper</a>
  
    <li><a href="./AdminHelper.html">AdminHelper</a>
  
    <li><a href="./AgeRangeColorsController.html">AgeRangeColorsController</a>
  
    <li><a href="./AgeRangeColorsHelper.html">AgeRangeColorsHelper</a>
  
    <li><a href="./AgerangeColor.html">AgerangeColor</a>
  
    <li><a href="./AgerangeColorsController.html">AgerangeColorsController</a>
  
    <li><a href="./AgerangeColorsHelper.html">AgerangeColorsHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Authentication.html">Authentication</a>
  
    <li><a href="./AuthenticationsController.html">AuthenticationsController</a>
  
    <li><a href="./BlockUser.html">BlockUser</a>
  
    <li><a href="./CheckoutController.html">CheckoutController</a>
  
    <li><a href="./City.html">City</a>
  
    <li><a href="./CityGroup.html">CityGroup</a>
  
    <li><a href="./ContactGroup.html">ContactGroup</a>
  
    <li><a href="./ContactGroupsController.html">ContactGroupsController</a>
  
    <li><a href="./ContactGroupsHelper.html">ContactGroupsHelper</a>
  
    <li><a href="./ContactUser.html">ContactUser</a>
  
    <li><a href="./ContactUserGroup.html">ContactUserGroup</a>
  
    <li><a href="./ContactUsersController.html">ContactUsersController</a>
  
    <li><a href="./ContactUsersHelper.html">ContactUsersHelper</a>
  
    <li><a href="./Country.html">Country</a>
  
    <li><a href="./DefaultFilter.html">DefaultFilter</a>
  
    <li><a href="./DefaultFiltersController.html">DefaultFiltersController</a>
  
    <li><a href="./DefaultFiltersHelper.html">DefaultFiltersHelper</a>
  
    <li><a href="./DeletedSchedule.html">DeletedSchedule</a>
  
    <li><a href="./DetailPageIdentityHelper.html">DetailPageIdentityHelper</a>
  
    <li><a href="./DetailsPageController.html">DetailsPageController</a>
  
    <li><a href="./DetailsPageHelper.html">DetailsPageHelper</a>
  
    <li><a href="./DiscountDollarsController.html">DiscountDollarsController</a>
  
    <li><a href="./DiscountDollarsHelper.html">DiscountDollarsHelper</a>
  
    <li><a href="./EmbedController.html">EmbedController</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./FamFeeDetail.html">FamFeeDetail</a>
  
    <li><a href="./FamNetwork.html">FamNetwork</a>
  
    <li><a href="./FamNetworkGroup.html">FamNetworkGroup</a>
  
    <li><a href="./FamNetworkGroupsController.html">FamNetworkGroupsController</a>
  
    <li><a href="./FamNetworkGroupsHelper.html">FamNetworkGroupsHelper</a>
  
    <li><a href="./FamNetworkPost.html">FamNetworkPost</a>
  
    <li><a href="./FamNetworkPostsController.html">FamNetworkPostsController</a>
  
    <li><a href="./FamNetworkPostsHelper.html">FamNetworkPostsHelper</a>
  
    <li><a href="./FamNetworkRow.html">FamNetworkRow</a>
  
    <li><a href="./FamNetworksController.html">FamNetworksController</a>
  
    <li><a href="./FamNetworksHelper.html">FamNetworksHelper</a>
  
    <li><a href="./FamPost.html">FamPost</a>
  
    <li><a href="./FamPostsController.html">FamPostsController</a>
  
    <li><a href="./FamPostsHelper.html">FamPostsHelper</a>
  
    <li><a href="./FampassDetail.html">FampassDetail</a>
  
    <li><a href="./FamtivityNetworkMailer.html">FamtivityNetworkMailer</a>
  
    <li><a href="./FeaturedAuditLog.html">FeaturedAuditLog</a>
  
    <li><a href="./FeaturedAuditLogsController.html">FeaturedAuditLogsController</a>
  
    <li><a href="./FeaturedAuditLogsHelper.html">FeaturedAuditLogsHelper</a>
  
    <li><a href="./FollowingUser.html">FollowingUser</a>
  
    <li><a href="./Form.html">Form</a>
  
    <li><a href="./FormQuestion.html">FormQuestion</a>
  
    <li><a href="./FormResult.html">FormResult</a>
  
    <li><a href="./FormResultAnswer.html">FormResultAnswer</a>
  
    <li><a href="./FormsController.html">FormsController</a>
  
    <li><a href="./FormsHelper.html">FormsHelper</a>
  
    <li><a href="./GeneralTag.html">GeneralTag</a>
  
    <li><a href="./GuestDetail.html">GuestDetail</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./InviteAttendees.html">InviteAttendees</a>
  
    <li><a href="./InvitesHelper.html">InvitesHelper</a>
  
    <li><a href="./InvitorList.html">InvitorList</a>
  
    <li><a href="./InvitorListHelper.html">InvitorListHelper</a>
  
    <li><a href="./LandingController.html">LandingController</a>
  
    <li><a href="./LandingHelper.html">LandingHelper</a>
  
    <li><a href="./LeadTransaction.html">LeadTransaction</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LogoutController.html">LogoutController</a>
  
    <li><a href="./Manager.html">Manager</a>
  
    <li><a href="./Message.html">Message</a>
  
    <li><a href="./MessageFile.html">MessageFile</a>
  
    <li><a href="./MessageMailer.html">MessageMailer</a>
  
    <li><a href="./MessageThread.html">MessageThread</a>
  
    <li><a href="./MessageThreadViewer.html">MessageThreadViewer</a>
  
    <li><a href="./MessagesController.html">MessagesController</a>
  
    <li><a href="./MessagesHelper.html">MessagesHelper</a>
  
    <li><a href="./MonthlyBudget.html">MonthlyBudget</a>
  
    <li><a href="./MonthlyBudgetsController.html">MonthlyBudgetsController</a>
  
    <li><a href="./MonthlyBudgetsHelper.html">MonthlyBudgetsHelper</a>
  
    <li><a href="./NewsletterMailer.html">NewsletterMailer</a>
  
    <li><a href="./NewslettersController.html">NewslettersController</a>
  
    <li><a href="./NotificationDetail.html">NotificationDetail</a>
  
    <li><a href="./ParentNotification.html">ParentNotification</a>
  
    <li><a href="./ParentNotificationDetail.html">ParentNotificationDetail</a>
  
    <li><a href="./ParentSetting.html">ParentSetting</a>
  
    <li><a href="./ParentSettingDetail.html">ParentSettingDetail</a>
  
    <li><a href="./ParentSettingsController.html">ParentSettingsController</a>
  
    <li><a href="./Participant.html">Participant</a>
  
    <li><a href="./ParticipantsController.html">ParticipantsController</a>
  
    <li><a href="./ParticipantsHelper.html">ParticipantsHelper</a>
  
    <li><a href="./PaymentDetail.html">PaymentDetail</a>
  
    <li><a href="./PaymentDetailsController.html">PaymentDetailsController</a>
  
    <li><a href="./PaymentDetailsHelper.html">PaymentDetailsHelper</a>
  
    <li><a href="./PoliciesController.html">PoliciesController</a>
  
    <li><a href="./PoliciesHelper.html">PoliciesHelper</a>
  
    <li><a href="./Policy.html">Policy</a>
  
    <li><a href="./PolicyFile.html">PolicyFile</a>
  
    <li><a href="./PolicyType.html">PolicyType</a>
  
    <li><a href="./ProviderActivityFee.html">ProviderActivityFee</a>
  
    <li><a href="./ProviderActivityFeeType.html">ProviderActivityFeeType</a>
  
    <li><a href="./ProviderCount.html">ProviderCount</a>
  
    <li><a href="./ProviderDiscountCode.html">ProviderDiscountCode</a>
  
    <li><a href="./ProviderDiscountCodeType.html">ProviderDiscountCodeType</a>
  
    <li><a href="./ProviderDiscountType.html">ProviderDiscountType</a>
  
    <li><a href="./ProviderLead.html">ProviderLead</a>
  
    <li><a href="./ProviderListController.html">ProviderListController</a>
  
    <li><a href="./ProviderNotification.html">ProviderNotification</a>
  
    <li><a href="./ProviderNotificationDetail.html">ProviderNotificationDetail</a>
  
    <li><a href="./ProviderSetting.html">ProviderSetting</a>
  
    <li><a href="./ProviderSettingDetail.html">ProviderSettingDetail</a>
  
    <li><a href="./ProviderSettingsController.html">ProviderSettingsController</a>
  
    <li><a href="./ProviderSettingsHelper.html">ProviderSettingsHelper</a>
  
    <li><a href="./ProviderTransaction.html">ProviderTransaction</a>
  
    <li><a href="./ProviderTransactionLog.html">ProviderTransactionLog</a>
  
    <li><a href="./ProviderWebsiteTrack.html">ProviderWebsiteTrack</a>
  
    <li><a href="./Question.html">Question</a>
  
    <li><a href="./QuestionType.html">QuestionType</a>
  
    <li><a href="./QuestionValue.html">QuestionValue</a>
  
    <li><a href="./QuickLinksController.html">QuickLinksController</a>
  
    <li><a href="./QuickLinksHelper.html">QuickLinksHelper</a>
  
    <li><a href="./SchoolRepresentative.html">SchoolRepresentative</a>
  
    <li><a href="./SchoolRepresentativesController.html">SchoolRepresentativesController</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SendSMS.html">SendSMS</a>
  
    <li><a href="./Setting.html">Setting</a>
  
    <li><a href="./SettingsController.html">SettingsController</a>
  
    <li><a href="./SettingsHelper.html">SettingsHelper</a>
  
    <li><a href="./SmsStatus.html">SmsStatus</a>
  
    <li><a href="./SocialType.html">SocialType</a>
  
    <li><a href="./SponsorShip.html">SponsorShip</a>
  
    <li><a href="./SponsorShipsController.html">SponsorShipsController</a>
  
    <li><a href="./SponsorShipsHelper.html">SponsorShipsHelper</a>
  
    <li><a href="./State.html">State</a>
  
    <li><a href="./StaticController.html">StaticController</a>
  
    <li><a href="./Support.html">Support</a>
  
    <li><a href="./SupportsController.html">SupportsController</a>
  
    <li><a href="./SupportsHelper.html">SupportsHelper</a>
  
    <li><a href="./Ticket.html">Ticket</a>
  
    <li><a href="./TicketsController.html">TicketsController</a>
  
    <li><a href="./TicketsHelper.html">TicketsHelper</a>
  
    <li><a href="./TransactionDetail.html">TransactionDetail</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserBankDetail.html">UserBankDetail</a>
  
    <li><a href="./UserCalender.html">UserCalender</a>
  
    <li><a href="./UserCard.html">UserCard</a>
  
    <li><a href="./UserChild.html">UserChild</a>
  
    <li><a href="./UserChildrenController.html">UserChildrenController</a>
  
    <li><a href="./UserCredit.html">UserCredit</a>
  
    <li><a href="./UserDeactivateLog.html">UserDeactivateLog</a>
  
    <li><a href="./UserDebit.html">UserDebit</a>
  
    <li><a href="./UserDeletedAccount.html">UserDeletedAccount</a>
  
    <li><a href="./UserEmailChangeLog.html">UserEmailChangeLog</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserNotification.html">UserNotification</a>
  
    <li><a href="./UserProfile.html">UserProfile</a>
  
    <li><a href="./UserProfilesController.html">UserProfilesController</a>
  
    <li><a href="./UserProfilesHelper.html">UserProfilesHelper</a>
  
    <li><a href="./UserRow.html">UserRow</a>
  
    <li><a href="./UserSettingsHelper.html">UserSettingsHelper</a>
  
    <li><a href="./UserTransaction.html">UserTransaction</a>
  
    <li><a href="./UserTransactionsController.html">UserTransactionsController</a>
  
    <li><a href="./UserTransactionsHelper.html">UserTransactionsHelper</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WeekendActivity.html">WeekendActivity</a>
  
    <li><a href="./WeekendMailer.html">WeekendMailer</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class LandingController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-about_us" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">about_us</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="about_us-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">about_us</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- about_us-source -->
          
        </div>

        

        
      </div><!-- about_us-method -->

    
      <div id="method-i-activity_category_report" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_category_report</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activity_category_report-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1771</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_category_report</span>

  <span class="ruby-ivar">@fam_city</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">all</span>
  <span class="ruby-ivar">@city</span> = <span class="ruby-ivar">@fam_city</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-ivar">@category</span> = <span class="ruby-ivar">@fam_city</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category</span>).<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">render</span> <span class="ruby-value">:layout=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_category_report-source -->
          
        </div>

        

        
      </div><!-- activity_category_report-method -->

    
      <div id="method-i-become_provider" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">become_provider</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="become_provider-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">become_provider</span>
  <span class="ruby-ivar">@s_user_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:s_user_id</span>]
  <span class="ruby-ivar">@s_user_email</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:s_user_email</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- become_provider-source -->
          
        </div>

        

        
      </div><!-- become_provider-method -->

    
      <div id="method-i-blog_content" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">blog_content</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>get the bloag article from rss feed</p>
          

          
          <div class="method-source-code" id="blog_content-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 923</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">blog_content</span>
  <span class="ruby-ivar">@blog_value</span>  = []
  <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-string">&quot;https://www.famtivity.com/blog?feed=rss2&quot;</span>)
  <span class="ruby-comment">#req = Net::HTTP.new(url.host, url.port)</span>

   <span class="ruby-comment"># res = req.request_head(url.path)</span>
    <span class="ruby-comment">#if res.code != &quot;404&quot; &amp;&amp; res.code !=&quot;500&quot;</span>
      <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>))
      <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">doc</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">present?</span>
        (<span class="ruby-identifier">doc</span><span class="ruby-operator">/</span><span class="ruby-string">'item'</span>)[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">title</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'title'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">desc</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'description'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">link</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'link'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">img_srcs</span> = <span class="ruby-identifier">desc</span>[<span class="ruby-regexp">/img.*?src=&quot;(.*?)&quot;/</span>,<span class="ruby-value">1</span>]
          <span class="ruby-identifier">decs</span> = <span class="ruby-identifier">desc</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">decs</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;Read More&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">title</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">dec</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">&quot;Continue reading &amp;#8594;&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">dec1</span> = <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">unescapeHTML</span>(<span class="ruby-identifier">dec</span>)
          <span class="ruby-identifier">title1</span> = <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">unescapeHTML</span>(<span class="ruby-identifier">title</span>)
          <span class="ruby-ivar">@blog_value</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;title&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title1</span>.<span class="ruby-identifier">html_safe</span>, <span class="ruby-string">&quot;description&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">dec1</span>.<span class="ruby-identifier">html_safe</span>,<span class="ruby-string">&quot;img&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">img_srcs</span>,<span class="ruby-string">&quot;link&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">link</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exc</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Message for the log file #{exc.message}&quot;</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&quot;Store error message&quot;</span>
  <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#end</span>
 
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- blog_content-source -->
          
        </div>

        

        
      </div><!-- blog_content-method -->

    
      <div id="method-i-cat_subcategory_row" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cat_subcategory_row</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="cat_subcategory_row-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1654</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cat_subcategory_row</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_#{params[:cat]}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_#{params[:cat]}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_#{params[:cat]}&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_#{params[:cat]}&quot;</span>] = <span class="ruby-value">2</span>
      <span class="ruby-identifier">get_total_sub_category_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_#{params[:cat]}&quot;</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_#{params[:cat]}&quot;</span>] = <span class="ruby-value">2</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>].<span class="ruby-identifier">to_i</span>
      <span class="ruby-identifier">get_total_sub_category_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">get_total_sub_category_list_with_subcat_id</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_#{params[:cat]}&quot;</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>], <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:subct_id</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">free</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">free</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">8</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_#{params[:cat]}&quot;</span>] = <span class="ruby-value">2</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">get_total_sub_category_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_page_#{params[:cat]}&quot;</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;provider_category_row&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;provider_category_row&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- cat_subcategory_row-source -->
          
        </div>

        

        
      </div><!-- cat_subcategory_row-method -->

    
      <div id="method-i-category_report_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">category_report_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>filter categories and city based on the user selection by rajkumar 2013-9-2</p>
          

          
          <div class="method-source-code" id="category_report_count-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1739</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">category_report_count</span>
    <span class="ruby-identifier">city_category</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-comment">#all citities and all categories</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;all cities&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;all categories&quot;</span>
      <span class="ruby-identifier">city_category</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-comment">#selected city with all categories</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;all cities&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;all categories&quot;</span>)
      <span class="ruby-identifier">city_category</span> = <span class="ruby-node">&quot;and lower(city) = '#{params[:city_name].downcase}'&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#selected category with all cities</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;all cities&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;all categories&quot;</span>)
      <span class="ruby-identifier">city_category</span> = <span class="ruby-node">&quot;and lower(category) = '#{params[:cat].downcase}'&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#selected category and selected city</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;all cities&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;all categories&quot;</span>)
      <span class="ruby-identifier">city_category</span> = <span class="ruby-node">&quot;and lower(category) = '#{params[:cat].downcase}' and lower(city) = '#{params[:city_name].downcase}'&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#new changes</span>
    <span class="ruby-ivar">@act_row_page</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;SELECT * FROM activities where lower(active_status)='active' and cleaned =true #{city_category} order by activity_id desc&quot;</span>).<span class="ruby-identifier">uniq</span>
    <span class="ruby-ivar">@total</span> = <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_row_page</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#~ #provider count list</span>
    <span class="ruby-comment">#~ @act_provider_act = @act_row_page.map(&amp;:user_id).uniq</span>
    <span class="ruby-comment">#~ @total_provider = @act_provider_act.length if !@act_provider_act.nil? &amp;&amp; @act_provider_act!=&quot;&quot; &amp;&amp; @act_provider_act.present?</span>
    
    <span class="ruby-comment">#provider count - city and category fromusers</span>
    <span class="ruby-ivar">@provider_count</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from users u left join user_profiles p on u.user_id=p.user_id where lower(u.user_type) = 'p' and lower(u.user_plan)='sell' and
u.account_active_status=true #{city_category} order by u.user_id desc&quot;</span>)
    <span class="ruby-ivar">@act_provider_act</span> = <span class="ruby-ivar">@provider_count</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:user_id</span>).<span class="ruby-identifier">uniq</span>
    <span class="ruby-ivar">@total_provider</span> = <span class="ruby-ivar">@act_provider_act</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_provider_act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_provider_act</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_provider_act</span>.<span class="ruby-identifier">present?</span>
        
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;category_report_count&quot;</span>

  <span class="ruby-keyword">end</span></pre>
          </div><!-- category_report_count-source -->
          
        </div>

        

        
      </div><!-- category_report_count-method -->

    
      <div id="method-i-contact_us" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_us</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_us-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_us</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_us-source -->
          
        </div>

        

        
      </div><!-- contact_us-method -->

    
      <div id="method-i-contact_us_mail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_us_mail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_us_mail-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_us_mail</span>
  <span class="ruby-ivar">@phone_value</span> = <span class="ruby-node">&quot;#{params[:phone1]}-&quot;</span> <span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone2]}-&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone3]}&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:usertype</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@phone_value</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:msg</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:usertype</span>]
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Contact&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">5</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">contact_us</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>],<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-ivar">@phone_value</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:msg</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:usertype</span>])
    <span class="ruby-comment">#@result = UserMailer.contact_us(params[:email],params[:name],@get_current_url,params[:phone],params[:msg]).deliver</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;$('.success_update_info').css('display', 'block').fadeOut(4000);&quot;</span>} 
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_us_mail-source -->
          
        </div>

        

        
      </div><!-- contact_us_mail-method -->

    
      <div id="method-i-every_mon_wed_fri" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_mon_wed_fri</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_mon_wed_fri-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 783</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_mon_wed_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">1</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_mon_wed_fri-source -->
          
        </div>

        

        
      </div><!-- every_mon_wed_fri-method -->

    
      <div id="method-i-every_mon_wed_fri_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_mon_wed_fri_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_mon_wed_fri_never-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 767</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_mon_wed_fri_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">1</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>

      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_mon_wed_fri_never-source -->
          
        </div>

        

        
      </div><!-- every_mon_wed_fri_never-method -->

    
      <div id="method-i-every_tue_thu" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_tue_thu</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_tue_thu-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 815</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_tue_thu</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">2</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_tue_thu-source -->
          
        </div>

        

        
      </div><!-- every_tue_thu-method -->

    
      <div id="method-i-every_tue_thu_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_tue_thu_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_tue_thu_never-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 800</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_tue_thu_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">2</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#         events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_tue_thu_never-source -->
          
        </div>

        

        
      </div><!-- every_tue_thu_never-method -->

    
      <div id="method-i-every_week_mon_to_fri" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_week_mon_to_fri</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_week_mon_to_fri-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 750</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_week_mon_to_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">6</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_week_mon_to_fri-source -->
          
        </div>

        

        
      </div><!-- every_week_mon_to_fri-method -->

    
      <div id="method-i-every_week_mon_to_fri_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_week_mon_to_fri_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_week_mon_to_fri_never-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 733</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_week_mon_to_fri_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)


  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">6</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_week_mon_to_fri_never-source -->
          
        </div>

        

        
      </div><!-- every_week_mon_to_fri_never-method -->

    
      <div id="method-i-fam_post_row" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fam_post_row</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="fam_post_row-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1689</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fam_post_row</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@fam_network</span> =  <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;group_id=#{params[:id]}&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">fam_post</span> = <span class="ruby-constant">Message</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from messages as m left join message_threads as mt on m.message_id=mt.message_id and m.contact_group_id = #{params[:id]}
                         left join message_thread_viewers as mv on mt.thread_id=mv.message_thread_id where ((mt.posted_by=#{current_user.user_id} and mt.msg_flag=true )
                          or (mv.user_id=#{current_user.user_id} and mv.msg_thread_flag=true)) order by m.message_id desc&quot;</span>).<span class="ruby-identifier">uniq</span>
    <span class="ruby-ivar">@fam_post</span> = <span class="ruby-identifier">fam_post</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)

    <span class="ruby-ivar">@contact</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;contact_group_id =#{params[:id]}&quot;</span>)
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;fam_post_row&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- fam_post_row-source -->
          
        </div>

        

        
      </div><!-- fam_post_row-method -->

    
      <div id="method-i-famtivity_user_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">famtivity_user_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>display the list of famtivity users count</p>
          

          
          <div class="method-source-code" id="famtivity_user_count-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1792</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">famtivity_user_count</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;famtivity_user_count&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- famtivity_user_count-source -->
          
        </div>

        

        
      </div><!-- famtivity_user_count-method -->

    
      <div id="method-i-famtivity_user_report" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">famtivity_user_report</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>famtivity user report for list of users</p>
          

          
          <div class="method-source-code" id="famtivity_user_report-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1781</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">famtivity_user_report</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">:layout=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>
        
<span class="ruby-keyword">end</span></pre>
          </div><!-- famtivity_user_report-source -->
          
        </div>

        

        
      </div><!-- famtivity_user_report-method -->

    
      <div id="method-i-faq" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">faq</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="faq-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">faq</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- faq-source -->
          
        </div>

        

        
      </div><!-- faq-method -->

    
      <div id="method-i-favorite_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">favorite_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="favorite_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1547</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">favorite_activity</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:favor_page</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:favor_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:favor_page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">arr_favorite</span> = []
  <span class="ruby-identifier">arr_favorite</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_total_favorite_list</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr_favorite</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">arr_favorite</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span><span class="ruby-value">8</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:favor_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:favor_page</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">arr_favorite</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_total_favorite_list</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_saved_favorites</span> = <span class="ruby-identifier">arr_favorite</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_saved_favorites&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_saved_favorites&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- favorite_activity-source -->
          
        </div>

        

        
      </div><!-- favorite_activity-method -->

    
      <div id="method-i-featured_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">featured_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="featured_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1339</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">featured_activity</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">ip_location</span> = <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>]
      <span class="ruby-comment"># ip_location = ActiveSupport::JSON.decode(ip_loc)</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">ip_location</span> = {<span class="ruby-string">'latitude'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">'37.9100783'</span>,<span class="ruby-string">'longitude'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">'-122.0651819'</span>, <span class="ruby-string">'city'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Walnut Creek'</span>}
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>]
    <span class="ruby-comment">#session[:city] = &quot;Walnut Creek&quot; if session[:city].nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>] = <span class="ruby-value">1</span>
      <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value">:other_city_page</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">re_time</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">arr</span> = []
    <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>])
    <span class="ruby-identifier">featured</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
    <span class="ruby-keyword">while</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">8</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">re_time</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">5</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>].<span class="ruby-identifier">to_i</span>
      <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>])
      <span class="ruby-identifier">re_time</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;featured_row&quot;</span>
  <span class="ruby-keyword">end</span></pre>
          </div><!-- featured_activity-source -->
          
        </div>

        

        
      </div><!-- featured_activity-method -->

    
      <div id="method-i-featured_activity_2" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">featured_activity_2</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="featured_activity_2-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1313</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">featured_activity_2</span>
  <span class="ruby-identifier">city</span> = <span class="ruby-string">&quot;walnut creek&quot;</span>
  <span class="ruby-comment">#@user = User.includes(:user_profile,:activities).where(&quot;lower(user_profiles.city)=? and lower(user_plan)=? and show_card=? and account_active_status=?&quot;,&quot;#{city.downcase if !city.nil?}&quot;,'sell',true,true).order(&quot;user_plan desc&quot;)</span>
  <span class="ruby-identifier">re_times</span> = <span class="ruby-value">5</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">a_coord</span> = <span class="ruby-constant">Geocoder</span>.<span class="ruby-identifier">coordinates</span>(<span class="ruby-node">&quot;#{city.titlecase},ca&quot;</span>)
    <span class="ruby-identifier">radius</span> = <span class="ruby-value">1500</span>
    <span class="ruby-identifier">nearby_cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">near</span>(<span class="ruby-identifier">a_coord</span>, <span class="ruby-identifier">radius</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:distance</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">re_times</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">re_times</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">nearby_cities</span> = [<span class="ruby-node">&quot;#{city.titlecase}&quot;</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">nearby_cities</span> =  <span class="ruby-constant">City</span>.<span class="ruby-identifier">format_gsub</span>(<span class="ruby-identifier">nearby_cities</span>)
  <span class="ruby-comment">#@user = User.near(params[:search], 50, :order =&gt; :distance)</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">includes</span>(<span class="ruby-value">:user_profile</span>,<span class="ruby-value">:activities</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(user_profiles.city) in #{nearby_cities.downcase} and lower(user_plan)=? and show_card=? and account_active_status=?&quot;</span>,<span class="ruby-string">'sell'</span>,<span class="ruby-keyword">true</span>,<span class="ruby-keyword">true</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;user_plan desc&quot;</span>)
  <span class="ruby-comment">#@activity_count = Activity.preload(:activity_schedule,:activity_total_count,:user).where(&quot;active_status = 'Active'&quot;)</span>

  <span class="ruby-comment">#@user = ActivityTotalCount.includes(:activities).where(&quot;activities.active_status = 'Active'&quot;).order(&quot;activity_display_count desc&quot;)</span>

  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;activity/activity_short_desc&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- featured_activity_2-source -->
          
        </div>

        

        
      </div><!-- featured_activity_2-method -->

    
      <div id="method-i-find_us_on_famtivity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_us_on_famtivity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="find_us_on_famtivity-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1785</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_us_on_famtivity</span>
        <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-identifier">render</span> <span class="ruby-value">:layout=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_us_on_famtivity-source -->
          
        </div>

        

        
      </div><!-- find_us_on_famtivity-method -->

    
      <div id="method-i-follow_cities" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">follow_cities</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Hierachial - Follow Cities  (SEO)</p>
          

          
          <div class="method-source-code" id="follow_cities-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1800</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">follow_cities</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-comment">#activity card display here</span>
  <span class="ruby-ivar">@qlinks</span> = [<span class="ruby-string">&quot;Specials&quot;</span>,<span class="ruby-string">&quot;Discount Dollars&quot;</span>, <span class="ruby-string">&quot;Free&quot;</span>, <span class="ruby-string">&quot;Camps&quot;</span>, <span class="ruby-string">&quot;Special Needs&quot;</span>] <span class="ruby-comment">#qlink displays</span>
  <span class="ruby-ivar">@fam_city</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:city_name</span>)
  <span class="ruby-ivar">@mode</span> =<span class="ruby-string">&quot;parent&quot;</span>
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT trim(category) as category&quot;</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;lower(category)!=?&quot;</span>,<span class="ruby-string">'default'</span>])

  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:busi_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_name</span>])
    <span class="ruby-comment"># if city bname categ and subcateg will work this</span>
    <span class="ruby-ivar">@user_profile_act</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">getuserdetails</span>(<span class="ruby-string">''</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_profile_act</span> <span class="ruby-comment">#if cate as businessname</span>
      <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">getdetails</span>(<span class="ruby-ivar">@user_profile_act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_act</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity</span> =  (<span class="ruby-ivar">@user_profile_act</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_act</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_det</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_name</span>],<span class="ruby-ivar">@user_profile_act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
      <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>])
      <span class="ruby-ivar">@actsubcatname</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">getsubcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@user_profile</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">getuserdetails</span>(<span class="ruby-string">''</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:busi_name</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:busi_name</span>]
      <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">getdetails</span>(<span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity</span> =  (<span class="ruby-ivar">@user_profile</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_det</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_name</span>],<span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#activity details display here</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
      <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;expiration_date &gt;= ?&quot;</span>,<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:busi_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>])
    <span class="ruby-comment"># if city bname categ and subcateg will work this</span>
    <span class="ruby-ivar">@user_profile_sub</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">getuserdetails</span>(<span class="ruby-string">''</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">getdetails</span>(<span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_profile_sub</span> <span class="ruby-comment">#if cate as businessname</span>
      <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>])
      <span class="ruby-ivar">@actsubcatname</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">getsubcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:busi_name</span>])
      <span class="ruby-ivar">@footcity</span> =  (<span class="ruby-ivar">@user_profile_sub</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actsubcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@user_profile</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">getuserdetails</span>(<span class="ruby-string">''</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:busi_name</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:busi_name</span>]
      <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">getdetails</span>(<span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>])
      <span class="ruby-ivar">@actsubcatname</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">getsubcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>])
      <span class="ruby-ivar">@footcity</span> =  (<span class="ruby-ivar">@user_profile</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actsubcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>])
    <span class="ruby-ivar">@user_profile_cat</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">getuserdetails</span>(<span class="ruby-string">''</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]
    <span class="ruby-comment"># if city bname and category</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_profile_cat</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_profile_cat</span>.<span class="ruby-identifier">present?</span> <span class="ruby-comment">#if cate as businessname</span>
      <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>]) <span class="ruby-comment">#get the params of category values</span>
      <span class="ruby-ivar">@footcity</span> =  (<span class="ruby-ivar">@user_profile_cat</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_cat</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_cat</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-string">''</span>,<span class="ruby-ivar">@user_profile_cat</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
    <span class="ruby-keyword">else</span> <span class="ruby-comment">#if city category subcategory will work this</span>
      <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>])
      <span class="ruby-ivar">@actsubcatname</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">getsubcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_categ</span>])
      <span class="ruby-identifier">user_ids</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actsubcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-string">''</span>)
      <span class="ruby-ivar">@footcity</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:user</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;users.user_id in (?)&quot;</span>,<span class="ruby-identifier">user_ids</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;lower(business_name) asc&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>])
    <span class="ruby-comment">#if city or businame</span>
    <span class="ruby-ivar">@user_profile_sub</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">getuserdetails</span>(<span class="ruby-string">''</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">getdetails</span>(<span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#business name came</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_profile_sub</span> <span class="ruby-comment">#if cate as businessname</span>
      <span class="ruby-comment">#display browse category,category,subcategory</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:ctyv</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:categv</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:sub_categv</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:categv</span>])
        <span class="ruby-ivar">@actsubcatname</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">getsubcategname</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:sub_categv</span>])
        <span class="ruby-ivar">@footcity</span> =  (<span class="ruby-ivar">@user_profile_sub</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:ctyv</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actsubcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:categv</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:sub_categv</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:categv</span>])
        <span class="ruby-ivar">@actsubcatname</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">getsubcategname</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:sub_categv</span>])
        <span class="ruby-ivar">@footcity</span> =  (<span class="ruby-ivar">@user_profile_sub</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-string">''</span>,<span class="ruby-ivar">@actcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actsubcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@footcity</span> =  (<span class="ruby-ivar">@user_profile_sub</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-string">''</span>,<span class="ruby-string">''</span>,<span class="ruby-string">''</span>,<span class="ruby-ivar">@user_profile_sub</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-operator">:</span> []
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#categ came</span>
      <span class="ruby-ivar">@actcatname</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">getcategname</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>])
      <span class="ruby-ivar">@footcity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-ivar">@actcatname</span>.<span class="ruby-identifier">downcase</span>,<span class="ruby-string">''</span>,<span class="ruby-string">''</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:categ</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>])
    <span class="ruby-ivar">@footcity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_vals</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-string">''</span>,<span class="ruby-string">''</span>,<span class="ruby-string">''</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]
    <span class="ruby-ivar">@prov_list</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">getuserdetails</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'-'</span>,<span class="ruby-string">' '</span>).<span class="ruby-identifier">downcase</span>,<span class="ruby-string">''</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@is_search_key</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:test_cook</span>] <span class="ruby-comment">#for search autocomplete</span>
  <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value">:test_cook</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'main_layout'</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- follow_cities-source -->
          
        </div>

        

        
      </div><!-- follow_cities-method -->

    
      <div id="method-i-follow_provider_card" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">follow_provider_card</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Hierarchical - Follow Provider (SEO)</p>
          

          
          <div class="method-source-code" id="follow_provider_card-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1890</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">follow_provider_card</span>
  <span class="ruby-identifier">city_name</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">' '</span>,<span class="ruby-string">'-'</span>).<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:det_user_id</span>].<span class="ruby-identifier">nil?</span>)
    <span class="ruby-ivar">@user_profile</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_id</span>])
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-ivar">@activities</span> = (<span class="ruby-ivar">@user_profile</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=? and lower(city)='#{params[:city].gsub('-',' ').downcase}' and cleaned=? and lower(active_status)=?&quot;</span>,<span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-keyword">true</span>,<span class="ruby-string">'active'</span>).<span class="ruby-identifier">uniq</span>  <span class="ruby-operator">:</span> []
    <span class="ruby-identifier">cat</span> =  <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">category</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">' '</span>,<span class="ruby-string">'-'</span>).<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activities</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">category</span>
    <span class="ruby-identifier">sub_cat</span> =  <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">sub_category</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">' '</span>,<span class="ruby-string">'-'</span>).<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activities</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">sub_category</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/#{city_name}-ca/#{@user_profile.slug}&quot;</span>,  <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">301</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/#{city_name}-ca&quot;</span>,  <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">301</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- follow_provider_card-source -->
          
        </div>

        

        
      </div><!-- follow_provider_card-method -->

    
      <div id="method-i-free_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">free_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="free_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1612</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">free_activity</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:free_page</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:free_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:free_page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-identifier">get_total_free_list</span>(<span class="ruby-identifier">arr</span>)
  <span class="ruby-identifier">free</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">free</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">free</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span><span class="ruby-value">6</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:free_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:free_page</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">get_total_free_list</span>(<span class="ruby-identifier">arr</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-ivar">@free</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;free_row&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;free_row&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- free_activity-source -->
          
        </div>

        

        
      </div><!-- free_activity-method -->

    
      <div id="method-i-get_parent_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_parent_user</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_parent_user-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_parent_user</span>
  <span class="ruby-ivar">@act_row_parent_page</span> = []
  <span class="ruby-identifier">s</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_parent#{s}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_parent#{s}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_parent#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@check</span> =<span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@attend_check</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@fav_check</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@parent_setting_notify</span>=<span class="ruby-constant">ParentSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from parent_setting_details s left join parent_settings p on s.parent_setting_id=p.parent_setting_id  where  p.user_id=#{s}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@parent_setting_notify</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@parent_setting_notify</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@parent_setting_notify</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@parent_setting_notify</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">parent_notify</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;purchased&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@attend_check</span> = <span class="ruby-keyword">true</span>   
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;purchased&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;purchased&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@attend_famtivity_contact</span>=<span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@attend_famtivity_contact</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;#{current_user.user_id}&quot;</span>)
            <span class="ruby-ivar">@attend_check</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;purchased&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;purchased&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">==</span><span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@attend_check</span> = <span class="ruby-keyword">true</span>   
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;favorites&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@fav_check</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;favorites&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;favorites&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@favorite_famtivity_contact</span>=<span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@favorite_famtivity_contact</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;#{current_user.user_id}&quot;</span>)
            <span class="ruby-ivar">@fav_check</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;favorites&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;favorites&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">==</span><span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@fav_check</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@check</span> =<span class="ruby-keyword">true</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">==</span><span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@check</span> =<span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@famtivity_contact_parent</span>=<span class="ruby-identifier">parent_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@famtivity_contact_parent</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;#{current_user.user_id}&quot;</span>)
            <span class="ruby-ivar">@check</span> =<span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@check</span> =<span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@check</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@parent_page</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_parent_activity_row_values_repeat</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-identifier">s</span>)
    <span class="ruby-ivar">@act_row_parent_page</span> = <span class="ruby-ivar">@parent_page</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_parent#{s}&quot;</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@attend_check</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@attend</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">setting_attend_activity</span>(<span class="ruby-identifier">s</span>)
    <span class="ruby-ivar">@setting_attend</span> = <span class="ruby-ivar">@attend</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_parent#{s}&quot;</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@fav_check</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@fav_check</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">setting_favorite_activity</span>(<span class="ruby-identifier">s</span>)
    <span class="ruby-ivar">@setting_fav</span> = <span class="ruby-ivar">@fav_check</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;page_parent#{s}&quot;</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_activity_follow_row&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_activity_follow_row&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_parent_user-source -->
          
        </div>

        

        
      </div><!-- get_parent_user-method -->

    
      <div id="method-i-get_provider_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_provider_user</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_provider_user-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1261</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_provider_user</span>
  <span class="ruby-ivar">@act_row_provider_page</span> =[]
  <span class="ruby-identifier">s</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#~ cookies[:&quot;page_provider#{s}&quot;] = 1 if !params[:page].nil?</span>
  <span class="ruby-comment">#~ cookies[:&quot;page_provider#{s}&quot;] = 1 + cookies[:&quot;page_provider#{s}&quot;].to_i if params[:page].nil?</span>
  <span class="ruby-ivar">@check</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@provider_setting_notify</span>=<span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where  p.user_id=#{s}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_setting_notify</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_setting_notify</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_setting_notify</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@provider_setting_notify</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">provider_notify</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@check</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span> 
            <span class="ruby-keyword">if</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">==</span><span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span>)
              <span class="ruby-ivar">@check</span> = <span class="ruby-keyword">true</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;created&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@famtivity_contact</span>=<span class="ruby-identifier">provider_notify</span>.<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
          <span class="ruby-keyword">if</span> (<span class="ruby-identifier">current_user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@famtivity_contact</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;#{current_user.user_id}&quot;</span>))
            <span class="ruby-ivar">@check</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@check</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@check</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@provider_page</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_provider_activity_row_values_repeat</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-identifier">s</span>)
    <span class="ruby-ivar">@all_act</span>=[]
    <span class="ruby-ivar">@act_free</span>=[]
    <span class="ruby-identifier">upcoming_provider</span>=<span class="ruby-identifier">get_upcoming_activities</span>(<span class="ruby-ivar">@provider_page</span>)
    <span class="ruby-comment">#~ @act_row_provider_page = @provider_page.paginate(:page =&gt; cookies[:&quot;page_provider#{s}&quot;], :per_page =&gt;20)</span>
    <span class="ruby-ivar">@act_row_provider_page</span> = <span class="ruby-identifier">upcoming_provider</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
    <span class="ruby-ivar">@act_row_total_pages</span> = <span class="ruby-ivar">@act_row_provider_page</span>.<span class="ruby-identifier">total_pages</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;provider_activity_follow_row&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;provider_activity_follow_row&quot;</span>
  <span class="ruby-keyword">end</span>
 
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_provider_user-source -->
          
        </div>

        

        
      </div><!-- get_provider_user-method -->

    
      <div id="method-i-get_total_count_free_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_count_free_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_count_free_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1643</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_count_free_list</span>
  <span class="ruby-ivar">@admin_activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activities_repeat</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-value">3</span>)
  <span class="ruby-identifier">arr</span> =[]
  <span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">schedule_feature_list</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">event</span>,<span class="ruby-identifier">arr</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">length</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_count_free_list-source -->
          
        </div>

        

        
      </div><!-- get_total_count_free_list-method -->

    
      <div id="method-i-get_total_count_my_activity_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_count_my_activity_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_count_my_activity_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1606</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_count_my_activity_list</span>
  <span class="ruby-identifier">act_created_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_created_activities</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-identifier">created_activities</span> = <span class="ruby-identifier">act_created_fav</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">created_activities</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_count_my_activity_list-source -->
          
        </div>

        

        
      </div><!-- get_total_count_my_activity_list-method -->

    
      <div id="method-i-get_total_count_shared_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_count_shared_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_count_shared_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1540</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_count_shared_list</span>
  <span class="ruby-identifier">act_provider</span> =  <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_shared_activities</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">shared</span> = <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">length</span>

  <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">shared</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_count_shared_list-source -->
          
        </div>

        

        
      </div><!-- get_total_count_shared_list-method -->

    
      <div id="method-i-get_total_count_sub_category_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_count_sub_category_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_count_sub_category_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1725</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_count_sub_category_list</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">arr</span> =[]
  <span class="ruby-ivar">@act_row_page</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_row_values_repeat_category</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-string">&quot;&quot;</span>)

  <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">schedule_feature_list</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">event</span>,<span class="ruby-identifier">arr</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}.<span class="ruby-identifier">length</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_count_sub_category_list-source -->
          
        </div>

        

        
      </div><!-- get_total_count_sub_category_list-method -->

    
      <div id="method-i-get_total_favorite_count_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_favorite_count_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_favorite_count_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1575</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_favorite_count_list</span>
  <span class="ruby-identifier">act_saved_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_favorites</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-identifier">saved_favorites</span> = <span class="ruby-identifier">act_saved_fav</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">saved_favorites</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_favorite_count_list-source -->
          
        </div>

        

        
      </div><!-- get_total_favorite_count_list-method -->

    
      <div id="method-i-get_total_favorite_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_favorite_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_favorite_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1566</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_favorite_list</span>
  <span class="ruby-identifier">act_saved_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_favorites</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-identifier">saved_favorites</span> = <span class="ruby-identifier">act_saved_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:favor_page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-comment">#@all_act=[]</span>
  <span class="ruby-comment">#@act_free=[]</span>
  <span class="ruby-comment">#upcoming_favorites=get_upcoming_activities(saved_favorites)</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">saved_favorites</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_favorite_list-source -->
          
        </div>

        

        
      </div><!-- get_total_favorite_list-method -->

    
      <div id="method-i-get_total_feature_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_feature_list</span><span
            class="method-args">(arr,lat,long)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_feature_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1367</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">lat</span>,<span class="ruby-identifier">long</span>)
  <span class="ruby-identifier">featured</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">nearby_city_activities</span>(<span class="ruby-identifier">lat</span>,<span class="ruby-identifier">long</span>,<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>])
  <span class="ruby-comment">#~ @admin_activity=[]</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">featured</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span>  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#cookies[:other_city_page] = ((cookies[:other_city_page].nil?)  ? 1 : (cookies[:other_city_page].to_i+1))</span>
    <span class="ruby-ivar">@admin_activity</span> = <span class="ruby-identifier">featured</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@admin_activity</span> = <span class="ruby-identifier">featured</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">==</span><span class="ruby-string">'Activity'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">==</span><span class="ruby-string">'Array'</span>
      <span class="ruby-identifier">activity</span> = (<span class="ruby-identifier">actv</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">==</span><span class="ruby-string">'Activity'</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">actv</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">actv</span>[<span class="ruby-value">0</span>]
      <span class="ruby-identifier">mod_mode</span> = (<span class="ruby-identifier">actv</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">==</span><span class="ruby-string">'Activity'</span>) <span class="ruby-operator">?</span> <span class="ruby-string">'activity'</span> <span class="ruby-operator">:</span> <span class="ruby-string">'weekend'</span>
            <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
            <span class="ruby-comment">#Activity.schedule_feature_list(session[:date],event,arr) if !event.nil?</span>
      <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:model_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">mod_mode</span>, <span class="ruby-value">:discount_eligible=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">discount_eligible</span>, <span class="ruby-value">:schedule</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>, <span class="ruby-value">:activity=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:leader=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">leader</span>, <span class="ruby-value">:skill_level=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">skill_level</span>, <span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">schedule_mode</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:min_age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:purchase_url=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">purchase_url</span>,<span class="ruby-value">:slug=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">slug</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:model_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">'user'</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-ivar">@total_pages</span> = <span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">total_pages</span>
  <span class="ruby-ivar">@current_page</span> = (<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:other_city_page</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">arr</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_feature_list-source -->
          
        </div>

        

        
      </div><!-- get_total_feature_list-method -->

    
      <div id="method-i-get_total_free_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_free_list</span><span
            class="method-args">(arr)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_free_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1633</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_free_list</span>(<span class="ruby-identifier">arr</span>)
  <span class="ruby-identifier">featured</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activities_repeat</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-value">3</span>)
  <span class="ruby-ivar">@admin_activity</span> = <span class="ruby-identifier">featured</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:free_page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">schedule_feature_list</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">event</span>,<span class="ruby-identifier">arr</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@admin_activity</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">arr</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_free_list-source -->
          
        </div>

        

        
      </div><!-- get_total_free_list-method -->

    
      <div id="method-i-get_total_my_activity_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_my_activity_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_my_activity_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1600</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_my_activity_list</span>
  <span class="ruby-identifier">act_created_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_created_activities</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-identifier">created_activities</span> = <span class="ruby-identifier">act_created_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:my_page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">created_activities</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_my_activity_list-source -->
          
        </div>

        

        
      </div><!-- get_total_my_activity_list-method -->

    
      <div id="method-i-get_total_provider_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_provider_list</span><span
            class="method-args">(prov_arr,prov_arr1)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_provider_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1458</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_provider_list</span>(<span class="ruby-identifier">prov_arr</span>,<span class="ruby-identifier">prov_arr1</span>)
  <span class="ruby-comment">#prov_user = UserProfile.joins(:user).where(&quot;lower(users.user_type)=?&quot;,'p').uniq</span>
  <span class="ruby-identifier">prov_user</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-string">&quot;select distinct * from user_profiles u left join users s on u.user_id = s.user_id where lower(s.user_type) = 'p' and s.account_active_status=TRUE and lower(s.user_plan)='sell' and s.show_card = true and (lower(s.user_status) != 'deactivate' or s.user_status is null)&quot;</span>)
  <span class="ruby-comment">#a = prov_user.collect{|user| user.user_plan == 'sell' ? user : nil}</span>
  <span class="ruby-comment">#b = prov_user.collect{|user| user.user_plan == 'free' ? user : nil}</span>
  <span class="ruby-comment">#c = prov_user.collect{|user| user.user_plan == 'curator' ? user : nil}</span>
  <span class="ruby-comment">#prov_user_list = a.compact + b.compact + c.compact</span>
  <span class="ruby-identifier">prov_user</span> = <span class="ruby-identifier">prov_user</span>.<span class="ruby-identifier">compact</span>
  <span class="ruby-identifier">prov_user_list</span> = <span class="ruby-identifier">prov_user</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">user_id</span> }
  <span class="ruby-identifier">prov_user_list1</span> = <span class="ruby-identifier">prov_user_list</span>.<span class="ruby-identifier">reverse</span>
  <span class="ruby-identifier">prov_list</span> = <span class="ruby-identifier">prov_user_list1</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@page</span>, <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">30</span>)
  <span class="ruby-identifier">prov_list_new</span> = <span class="ruby-identifier">prov_list</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_created_date</span>).<span class="ruby-identifier">utc</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">3</span>.<span class="ruby-identifier">days</span>.<span class="ruby-identifier">ago</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>}
  <span class="ruby-identifier">prov_list_remain</span> = <span class="ruby-identifier">prov_list</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_created_date</span>).<span class="ruby-identifier">utc</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">3</span>.<span class="ruby-identifier">days</span>.<span class="ruby-identifier">ago</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>}
  <span class="ruby-identifier">prov_list_new</span> = <span class="ruby-identifier">prov_list_new</span>.<span class="ruby-identifier">compact</span>
  <span class="ruby-identifier">prov_list_remain</span> = <span class="ruby-identifier">prov_list_remain</span>.<span class="ruby-identifier">compact</span>
  <span class="ruby-ivar">@prov_list_count</span> = <span class="ruby-identifier">prov_list</span>.<span class="ruby-identifier">total_pages</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">prov_list</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:provider_count</span>] = <span class="ruby-ivar">@prov_list_count</span>
  <span class="ruby-identifier">prov_list_new</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">prov_list_new</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">provider</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">prov_arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:business_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">business_name</span>, <span class="ruby-value">:business_logo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-value">:user_created_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">user_created_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">user_created_date</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">prov_list_remain</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">prov_list_remain</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">provider</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">prov_arr1</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:business_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">business_name</span>, <span class="ruby-value">:business_logo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-value">:user_created_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">provider</span>.<span class="ruby-identifier">user_created_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">provider</span>.<span class="ruby-identifier">user_created_date</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_provider_list-source -->
          
        </div>

        

        
      </div><!-- get_total_provider_list-method -->

    
      <div id="method-i-get_total_shared_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_shared_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_shared_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1531</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_shared_list</span>
  <span class="ruby-identifier">act_provider</span> =  <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_shared_activities</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">shared</span> = <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:shared_page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@all_act</span>=[]
  <span class="ruby-ivar">@act_free</span>=[]
  <span class="ruby-identifier">upcoming_shared</span>=<span class="ruby-identifier">get_upcoming_activities</span>(<span class="ruby-identifier">shared</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">upcoming_shared</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_shared_list-source -->
          
        </div>

        

        
      </div><!-- get_total_shared_list-method -->

    
      <div id="method-i-get_total_sub_category_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_sub_category_list</span><span
            class="method-args">(arr,page,cat)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_sub_category_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1702</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_sub_category_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">page</span>,<span class="ruby-identifier">cat</span>) 
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_#{cat}&quot;</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_#{cat}&quot;</span>].<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">act_row</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_near_by_activity_row_values_repeat_category</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cat</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-identifier">page</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:&quot;other_#{cat}&quot;</span>])
  <span class="ruby-ivar">@act_row_page</span> = <span class="ruby-identifier">act_row</span>
  <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">schedule_feature_list</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">event</span>,<span class="ruby-identifier">arr</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">arr</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_sub_category_list-source -->
          
        </div>

        

        
      </div><!-- get_total_sub_category_list-method -->

    
      <div id="method-i-get_total_sub_category_list_with_subcat_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_sub_category_list_with_subcat_id</span><span
            class="method-args">(arr,page,cat,sub_cat)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_sub_category_list_with_subcat_id-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1714</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_sub_category_list_with_subcat_id</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">page</span>,<span class="ruby-identifier">cat</span>,<span class="ruby-identifier">sub_cat</span>)
  <span class="ruby-identifier">act_row</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activity_row_values_repeat_category</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cat</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-identifier">sub_cat</span>)
  <span class="ruby-ivar">@act_row_page</span> = <span class="ruby-identifier">act_row</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">page</span>, <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)

  <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">schedule_feature_list</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">event</span>,<span class="ruby-identifier">arr</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_row_page</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">arr</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_sub_category_list_with_subcat_id-source -->
          
        </div>

        

        
      </div><!-- get_total_sub_category_list_with_subcat_id-method -->

    
      <div id="method-i-home_redirect_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">home_redirect_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="home_redirect_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">home_redirect_activity</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mview</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mview</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
                <span class="ruby-identifier">activity</span>=<span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:mview</span>])
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">city</span> = (<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">city!</span>=<span class="ruby-string">''</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">city</span> <span class="ruby-operator">:</span> <span class="ruby-string">'anywhere'</span>
                <span class="ruby-identifier">act_city</span> = <span class="ruby-identifier">city</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">' '</span>,<span class="ruby-string">'-'</span>).<span class="ruby-identifier">downcase</span>
                <span class="ruby-identifier">user</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">user_id</span>)
                <span class="ruby-identifier">bus_name</span> = <span class="ruby-identifier">user</span>.<span class="ruby-identifier">slug</span>
                
                <span class="ruby-ivar">@category_slug</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-ivar">@sub_categ_slug</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-ivar">@categ</span>= <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">find_by_category_name</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">category</span>)
                <span class="ruby-ivar">@sub_categ</span>= <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">find_by_subcateg_name</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">sub_category</span>)
                <span class="ruby-ivar">@category_slug</span> = <span class="ruby-ivar">@categ</span>.<span class="ruby-identifier">slug</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@categ</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@sub_categ</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@sub_categ_slug</span> = <span class="ruby-ivar">@sub_categ</span>.<span class="ruby-identifier">slug</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@sub_categ</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@sub_categ</span>.<span class="ruby-identifier">present?</span>  
                <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/#{act_city}-ca/#{bus_name}/#{@category_slug}/#{@sub_categ_slug}/#{activity.slug}&quot;</span>
                <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/&quot;</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/&quot;</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- home_redirect_activity-source -->
          
        </div>

        

        
      </div><!-- home_redirect_activity-method -->

    
      <div id="method-i-how_it_works" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">how_it_works</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="how_it_works-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">how_it_works</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- how_it_works-source -->
          
        </div>

        

        
      </div><!-- how_it_works-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Rendering Landing Page</p>
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 11</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-ivar">@cities</span> = [<span class="ruby-string">&quot;Chicago&quot;</span>,<span class="ruby-string">&quot;Dallas&quot;</span>,<span class="ruby-string">&quot;Detroit&quot;</span>,<span class="ruby-string">&quot;Houston&quot;</span>,<span class="ruby-string">&quot;Las Vegas&quot;</span>,<span class="ruby-string">&quot;Los Angeles&quot;</span>,<span class="ruby-string">&quot;New York&quot;</span>,<span class="ruby-string">&quot;Philadelphia&quot;</span>,<span class="ruby-string">&quot;San Antonio&quot;</span>,<span class="ruby-string">&quot;San Francisco&quot;</span>,<span class="ruby-string">&quot;San Jose&quot;</span>,<span class="ruby-string">&quot;Seattle&quot;</span>,<span class="ruby-string">&quot;Walnut Creek&quot;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
    <span class="ruby-ivar">@city_new_usr</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-string">&quot;action&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;index&quot;</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@default_city</span> = <span class="ruby-string">&quot;San Francisco&quot;</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-string">&quot;action&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;index&quot;</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-invite_provider" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invite_provider</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="invite_provider-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 94</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invite_provider</span>
        <span class="ruby-ivar">@aclick</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:aclick</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- invite_provider-source -->
          
        </div>

        

        
      </div><!-- invite_provider-method -->

    
      <div id="method-i-invite_provider_submit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invite_provider_submit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>send a mail while invite the provider by the user.</p>
          

          
          <div class="method-source-code" id="invite_provider_submit-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invite_provider_submit</span>
  <span class="ruby-ivar">@provider_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_business_name</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_business_name</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-ivar">@parent_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#sending a mail to the provider</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>]
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>])
    <span class="ruby-ivar">@invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;invited_email=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>]).<span class="ruby-identifier">first</span>
    
    <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-ivar">@user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@invitor_user</span>)
      <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">invitor_list</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">'provider'</span>)
    <span class="ruby-keyword">elsif</span>(<span class="ruby-operator">!</span><span class="ruby-ivar">@user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@invitor_user</span>)
      <span class="ruby-ivar">@invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">modified_date</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
    <span class="ruby-keyword">end</span>
    
    
    <span class="ruby-ivar">@type_parent</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
                              <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>[<span class="ruby-string">&quot;user_type&quot;</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;u&quot;</span> 
                                      <span class="ruby-ivar">@type_parent</span> = <span class="ruby-keyword">true</span>
                                      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Invite&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">invite_provider_mail</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>],<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:p_business_name</span>],<span class="ruby-ivar">@type_parent</span>,<span class="ruby-identifier">current_user</span>)
                                      <span class="ruby-ivar">@msg_flag</span> = <span class="ruby-string">&quot;Your invitation has been sent successfully!&quot;</span>
                              <span class="ruby-keyword">else</span>
                                      <span class="ruby-ivar">@msg_flag</span> = <span class="ruby-string">&quot;This Provider Already Registered!&quot;</span>
                              <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
                              <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Invite&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">invite_provider_mail</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:p_email</span>],<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:p_business_name</span>],<span class="ruby-ivar">@type_parent</span>,<span class="ruby-identifier">current_user</span>)
      <span class="ruby-ivar">@msg_flag</span> = <span class="ruby-string">&quot;Your invitation has been sent successfully!&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#@result = UserMailer.invite_provider_mail(params[:p_email],@get_current_url,params[:subject],@parent_name,@provider_name).deliver</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- invite_provider_submit-source -->
          
        </div>

        

        
      </div><!-- invite_provider_submit-method -->

    
      <div id="method-i-landing_feature" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">landing_feature</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="landing_feature-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 912</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">landing_feature</span>
  <span class="ruby-identifier">landing_feature_activity</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'featured_row'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- landing_feature-source -->
          
        </div>

        

        
      </div><!-- landing_feature-method -->

    
      <div id="method-i-landing_new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">landing_new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="landing_new-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 903</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">landing_new</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-ivar">@blog_value</span> = []
  <span class="ruby-ivar">@fam_city</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:city_name</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_v</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_v</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-ivar">@footcity</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(city_name) like '#{params[:city_v].downcase}%'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>).<span class="ruby-identifier">sort</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- landing_new-source -->
          
        </div>

        

        
      </div><!-- landing_new-method -->

    
      <div id="method-i-landing_new_old" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">landing_new_old</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="landing_new_old-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 229</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">landing_new_old</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#~ @activity_featured = Activity.find_by_sql(&quot;select * from activities INNER JOIN activity_schedules ON activity_schedules.activity_id = activities.activity_id where activities.activity_id in (select activity_id from activity_bids where lower(bid_status) = 'active' and cleaned = true order by bid_amount asc) and lower(active_status)='active' or (featured_flag = true and lower(active_status)='active' and cleaned = true) order by featured_flag asc limit 60&quot;).uniq</span>
  <span class="ruby-ivar">@activity_featured</span> = []
  <span class="ruby-ivar">@cdate</span> = (<span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@sdate</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@edate</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
 
  <span class="ruby-comment">#~ @budget = MonthlyBudget.order(&quot;bid_amount desc&quot;).joins(&quot;left join users on monthly_budgets.user_id=users.user_id&quot;).where(&quot;monthly_budgets.bid_start_date='#{@sdate}' and monthly_budgets.bid_end_date='#{@edate}' and (lower(users.user_plan)='sponsor' or lower(users.user_plan)='sell')&quot;)</span>
  <span class="ruby-comment">#~ @str = ''</span>
  <span class="ruby-comment">#~ @budget.each do |buser|</span>
  <span class="ruby-comment">#~ if buser[&quot;monthly_budget&quot;].to_i &gt; buser[&quot;attempt_amount&quot;].to_i</span>
  <span class="ruby-comment">#~ if @str!='' &amp;&amp; !@str.nil?</span>
  <span class="ruby-comment">#~ @str.concat(&quot;,#{buser[&quot;user_id&quot;]}&quot;)</span>
  <span class="ruby-comment">#~ else</span>
  <span class="ruby-comment">#~ @str.concat(&quot;#{buser[&quot;user_id&quot;]}&quot;)</span>
  <span class="ruby-comment">#~ end</span>
  <span class="ruby-comment">#~ end</span>
  <span class="ruby-comment">#~ end if !@budget.nil? &amp;&amp; @budget!='' &amp;&amp; @budget.present?    </span>
  <span class="ruby-comment">#~ @activity = Activity.where(&quot;user_id in (#{@str})&quot;).where(&quot;cleaned=? and lower(active_status)=? and lower(created_by)=?&quot;,true,'active','provider').limit(100) if !@str.nil? &amp;&amp; @str!=''</span>
 
  <span class="ruby-comment">#~ @admin_curr = []</span>
  <span class="ruby-comment">#~ @admin_curr = Activity.order(&quot;activities.activity_id desc&quot;).select(&quot;activities.*,activity_schedules.*&quot;).joins(:activity_schedule).where(&quot;lower(active_status)='active' And (start_date &lt;= '#{@cdate}' and featured_flag=true and lower(created_by)='provider' and cleaned=true) or (lower(activities.schedule_mode)='any time' And lower(active_status)='active' and featured_flag=true and cleaned = true and lower(created_by)='provider') or (lower(activities.schedule_mode)='by appointment' And lower(active_status)='active' and featured_flag=true and cleaned = true and lower(created_by)='provider')&quot;).uniq</span>
  <span class="ruby-comment">#~ @admin_feature = []</span>
  <span class="ruby-comment">#~ @admin_feature = Activity.order(&quot;activities.activity_id desc&quot;).select(&quot;activities.*,activity_schedules.*&quot;).joins(:activity_schedule).where(&quot;lower(active_status)='active' And start_date &gt; '#{@cdate}' and featured_flag=true and cleaned = true and lower(created_by)='provider'&quot;).uniq</span>
  <span class="ruby-ivar">@str</span> = <span class="ruby-string">''</span>
  <span class="ruby-ivar">@budget</span> = <span class="ruby-constant">MonthlyBudget</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;bid_amount desc&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;bid_start_date='#{@sdate}' and bid_end_date='#{@edate}'&quot;</span>)   <span class="ruby-comment">#.uniq.collect(&amp;:user_id)</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@budget</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@budget</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@budget</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@budget</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">buser</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">buser</span>[<span class="ruby-string">&quot;monthly_budget&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">buser</span>[<span class="ruby-string">&quot;attempt_amount&quot;</span>].<span class="ruby-identifier">to_i</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@str</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@str</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@str</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;,#{buser[&quot;user_id&quot;]}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">buser</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@str</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;#{buser[&quot;user_id&quot;]}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">buser</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@budget</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@budget</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@str</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@str</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id in (#{@str})&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;cleaned=? and lower(active_status)=? and lower(created_by)=?&quot;</span>,<span class="ruby-keyword">true</span>,<span class="ruby-string">'active'</span>,<span class="ruby-string">'provider'</span>).<span class="ruby-identifier">uniq</span>   <span class="ruby-comment">#.collect(&amp;:activity_id)</span>
    <span class="ruby-comment">#@click_activity = ActivityClick.where(:activity_id=&gt;@activity).select(&quot;sum(click_amount) as click_amount, activity_id&quot;).where(&quot;click_amount &gt; 0 and click_date between '#{@sdate}' and '#{@edate}'&quot;).group(&quot;activity_id&quot;).order(&quot;click_amount desc&quot;)</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@admin_activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activities.activity_id desc&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;lower(active_status)='active' and cleaned=true and  featured_flag=true and lower(created_by)='provider'&quot;</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-value">60</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-comment">#~ Activity.schedule_feature_list(session[:date],event,arr) if !event.nil?</span>
  <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activities_repeat</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-value">3</span>)
  <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-comment">#~ schedule_repeat_append(event,events,&quot;created&quot;) if !@schedule.nil?</span>
    <span class="ruby-comment">#current and future date activities</span>
    <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">schedule_feature_list</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">event</span>,<span class="ruby-identifier">arr</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_free</span> = []
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
  
  <span class="ruby-ivar">@activity_share_provider</span> = []
  <span class="ruby-ivar">@activity_saved_favorites</span> = []
  <span class="ruby-ivar">@activity_created_activities</span> = []
  <span class="ruby-ivar">@provider_activites</span> = []
  <span class="ruby-ivar">@follow_parent_user</span> = []
  <span class="ruby-ivar">@follow_provider_user</span> = []
  <span class="ruby-ivar">@category</span> = []
  <span class="ruby-ivar">@sub_category</span> = []
  <span class="ruby-ivar">@checck</span>  = []
  <span class="ruby-ivar">@jump_to_act</span> =[]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">act_provider</span> =  <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_shared_activities</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>)
    <span class="ruby-ivar">@activity_share_provider</span> = <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
    <span class="ruby-identifier">act_saved_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_favorites</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
    <span class="ruby-ivar">@activity_saved_favorites</span> = <span class="ruby-identifier">act_saved_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
    <span class="ruby-identifier">act_created_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_created_activities</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
    <span class="ruby-ivar">@activity_created_activities</span> = <span class="ruby-identifier">act_created_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>)
    <span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@provider_activites_selected</span> = []
    <span class="ruby-ivar">@provider_activites_combined</span> = []
    <span class="ruby-ivar">@provider_activites_selected</span> =  <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;Distinct(activities.category)&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activities.category Asc&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;left join activities on lower(activities.sub_category)=lower(activity_rows.row_type)&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_rows.user_id = ?&quot;</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;activities.category&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category</span>)
    <span class="ruby-comment">#user selected activities </span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_activites_selected</span>
      <span class="ruby-ivar">@provider_activites_combined</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-ivar">@provider_activites_selected</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#users default category sports,dance,music</span>
    <span class="ruby-comment">#~ @default = ActivitySubcategory.where(:category_id=&gt;[8,4,12] ).map(&amp;:subcateg_id)</span>
    <span class="ruby-comment">#~ @category_default =  ActivitySubcategory.where(:subcateg_id=&gt;@default).map(&amp;:category_id)</span>
    <span class="ruby-comment">#~ @provider_activites_default = []</span>
    <span class="ruby-comment">#~ @provider_activites_default = ActivityCategory.where(:category_id=&gt;@category_default).map(&amp;:category_name)</span>
    <span class="ruby-comment">#push to the array</span>
    <span class="ruby-comment">#~ if @provider_activites_default</span>
    <span class="ruby-comment">#~ @provider_activites_combined &lt;&lt; @provider_activites_default</span>
    <span class="ruby-comment">#~ end</span>
    <span class="ruby-comment">#make all the category to single array</span>
    <span class="ruby-ivar">@provider_activites_get</span> = <span class="ruby-ivar">@provider_activites_combined</span>.<span class="ruby-identifier">flatten</span>
    <span class="ruby-ivar">@provider_activites</span> = <span class="ruby-ivar">@provider_activites_get</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>}
    <span class="ruby-comment">#provider activities based on the user selection row with default row added</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-ivar">@provider_activites</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_activites</span>.<span class="ruby-identifier">present?</span>)
      <span class="ruby-identifier">cat1</span>=<span class="ruby-string">&quot;Dance&quot;</span>
      <span class="ruby-identifier">cat2</span>=<span class="ruby-string">&quot;Music&quot;</span>
      <span class="ruby-identifier">cat3</span>=<span class="ruby-string">&quot;Sports&quot;</span>
      <span class="ruby-identifier">c1</span>=<span class="ruby-keyword">false</span>
      <span class="ruby-identifier">c2</span>=<span class="ruby-keyword">false</span>
      <span class="ruby-identifier">c3</span>=<span class="ruby-keyword">false</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_activites</span>.<span class="ruby-identifier">include?</span><span class="ruby-identifier">cat1</span>
        <span class="ruby-identifier">c1</span>=<span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_activites</span>.<span class="ruby-identifier">include?</span><span class="ruby-identifier">cat2</span>
        <span class="ruby-identifier">c2</span>=<span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_activites</span>.<span class="ruby-identifier">include?</span><span class="ruby-identifier">cat3</span>
        <span class="ruby-identifier">c3</span>=<span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">c1</span><span class="ruby-operator">==</span><span class="ruby-keyword">false</span>
        <span class="ruby-ivar">@provider_activites</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Dance&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">c2</span><span class="ruby-operator">==</span><span class="ruby-keyword">false</span>
        <span class="ruby-ivar">@provider_activites</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Music&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">c3</span><span class="ruby-operator">==</span><span class="ruby-keyword">false</span>
        <span class="ruby-ivar">@provider_activites</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Sports&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@provider_activites</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@provider_activites</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@provider_activites</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-ivar">@default</span>=<span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@default</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>,<span class="ruby-value">12</span>] ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_id</span>)
      <span class="ruby-ivar">@category_default</span> =  <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subcateg_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@default</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category_id</span>)
      <span class="ruby-ivar">@provider_activites</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@category_default</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category_name</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@follow_parent_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{user_id} and user_type='U'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
    <span class="ruby-ivar">@follow_provider_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{user_id} and user_type='P'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
    <span class="ruby-ivar">@category</span> =  <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_id</span>)
    <span class="ruby-ivar">@sub_category</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subcateg_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@category</span> ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_name</span>)
    <span class="ruby-comment">#@provider_activites = ActivityCategory.where(:category_id=&gt;@category ).map(&amp;:category_name)</span>
    <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>,<span class="ruby-identifier">user_id</span>],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@provider_activites_check</span> =[]
    <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>] = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>,<span class="ruby-value">12</span>] ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>] = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>,<span class="ruby-value">12</span>] ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_id</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@category</span> =  <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subcateg_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>] ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category_id</span>)
    <span class="ruby-ivar">@sub_category</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subcateg_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>] ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_name</span>)
    <span class="ruby-ivar">@provider_activites</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@category</span> ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category_name</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@blog_value</span> = []
  <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-string">&quot;http://blog.famtivity.com/?feed=rss2&quot;</span>)
  <span class="ruby-identifier">req</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">url</span>.<span class="ruby-identifier">port</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">request_head</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;404&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;500&quot;</span>
      <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">doc</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">present?</span>
        (<span class="ruby-identifier">doc</span><span class="ruby-operator">/</span><span class="ruby-string">'item'</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">title</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'title'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">desc</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'description'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">link</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'link'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">img_srcs</span> = <span class="ruby-identifier">desc</span>[<span class="ruby-regexp">/img.*?src=&quot;(.*?)&quot;/</span>,<span class="ruby-value">1</span>]
          <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">desc</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">title</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">dec</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">&quot;Continue reading &amp;#8594;&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">dec1</span> = <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">unescapeHTML</span>(<span class="ruby-identifier">dec</span>)
          <span class="ruby-identifier">title1</span> = <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">unescapeHTML</span>(<span class="ruby-identifier">title</span>)
          <span class="ruby-ivar">@blog_value</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;title&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title1</span>, <span class="ruby-string">&quot;description&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">dec1</span>,<span class="ruby-string">&quot;img&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">img_srcs</span>,<span class="ruby-string">&quot;link&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">link</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exc</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Message for the log file #{exc.message}&quot;</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&quot;Store error message&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- landing_new_old-source -->
          
        </div>

        

        
      </div><!-- landing_new_old-method -->

    
      <div id="method-i-my_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">my_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="my_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1581</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">my_activity</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:my_page</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:my_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:my_page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">arr_create</span> = []
  <span class="ruby-identifier">arr_create</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_total_my_activity_list</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr_create</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">arr_create</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span><span class="ruby-value">8</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:my_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:my_page</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">arr_create</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_total_my_activity_list</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_created_activities</span> = <span class="ruby-identifier">arr_create</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_created_activities&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_created_activities&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- my_activity-source -->
          
        </div>

        

        
      </div><!-- my_activity-method -->

    
      <div id="method-i-newsletter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">newsletter</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="newsletter-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">newsletter</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- newsletter-source -->
          
        </div>

        

        
      </div><!-- newsletter-method -->

    
      <div id="method-i-newsletter_subscripe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">newsletter_subscripe</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>call newsletter API to COTC</p>
          

          
          <div class="method-source-code" id="newsletter_subscripe-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 883</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">newsletter_subscripe</span>       
  <span class="ruby-comment">#url = URI.parse(&quot;http://showontherun.com/application/JsonApi/subScribeNewsLetter?email=#{params[:email]}&amp;location=#{URI::encode(params[:banner_location])}&quot;)</span>
  <span class="ruby-identifier">url</span>=<span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;http://campaignonthecloud.com/Update_Registration_Status.aspx?name=&amp;mobile=&amp;email_id=#{params[:email]}&amp;country=&amp;address=&amp;city=#{URI::encode(params[:banner_location])}&amp;zipcode=&amp;domain_name=famtivitydev&amp;planname=&amp;groupname=Weekend%20Newsletter&amp;subscription=1&quot;</span>)
  <span class="ruby-identifier">req</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">url</span>.<span class="ruby-identifier">port</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">request_head</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">path</span>)      
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;404&quot;</span>
      <span class="ruby-identifier">request</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span><span class="ruby-operator">::</span><span class="ruby-constant">Get</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">request_uri</span>)   
      <span class="ruby-identifier">response</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">request</span>(<span class="ruby-identifier">request</span>) 
      <span class="ruby-comment">#@news_response=JSON.parse(response.body)</span>
      <span class="ruby-ivar">@news_response</span>=<span class="ruby-identifier">response</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">html_safe</span>
      <span class="ruby-comment">#render :text =&gt; @news_response[&quot;results&quot;]</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@news_response</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exc</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Problem on API&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- newsletter_subscripe-source -->
          
        </div>

        

        
      </div><!-- newsletter_subscripe-method -->

    
      <div id="method-i-parent_privacy_policy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parent_privacy_policy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="parent_privacy_policy-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parent_privacy_policy</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- parent_privacy_policy-source -->
          
        </div>

        

        
      </div><!-- parent_privacy_policy-method -->

    
      <div id="method-i-parent_terms_of_service" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parent_terms_of_service</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="parent_terms_of_service-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 190</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parent_terms_of_service</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- parent_terms_of_service-source -->
          
        </div>

        

        
      </div><!-- parent_terms_of_service-method -->

    
      <div id="method-i-privacy_policy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">privacy_policy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="privacy_policy-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">privacy_policy</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- privacy_policy-source -->
          
        </div>

        

        
      </div><!-- privacy_policy-method -->

    
      <div id="method-i-provider_names_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_names_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>~ def get_total_feature_list_detail(arr,lat,long) ~ featured = <a
href="City.html#method-c-nearby_city_activities_detail">City.nearby_city_activities_detail</a>,<a
href="http://:feature_page">cookies</a>) @admin_activity=[] ~ if <a
href="http://1">featured</a> ~ <a
href="http://:other_city_page">cookies</a> = 1 +  <a
href="http://:other_city_page">cookies</a>.to_i if !<a
href="http://:other_city_page">cookies</a>.nil? ~ <a
href="http://:other_city_page">cookies</a> = 1 if <a
href="http://:other_city_page">cookies</a>.nil? ~ cookies[:other_city_page]
= ((<a href="http://:other_city_page">cookies</a>.nil?)  ? 1 : (<a
href="http://:other_city_page">cookies</a>.to_i+1)) ~ @admin_activity = <a
href="http://0">featured</a>.paginate(:page =&gt; <a
href="http://:other_city_page">cookies</a>, :per_page =&gt;12) ~ else ~
@admin_activity = <a href="http://0">featured</a>.paginate(:page =&gt; <a
href="http://:feature_page">cookies</a>, :per_page =&gt;12) ~ end ~ arr
&lt;&lt; @admin_activity ~ arr.compact.flatten ~ return arr ~ end</p>
          

          
          <div class="method-source-code" id="provider_names_list-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1440</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_names_list</span>
  <span class="ruby-comment"># cookies[:provider_page] = 1 if !params[:page].nil?</span>
  <span class="ruby-comment"># cookies[:provider_page] = 1 + cookies[:provider_page].to_i if params[:page].nil?</span>
  <span class="ruby-ivar">@page</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">:</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">prov_arr</span> = []
  <span class="ruby-identifier">prov_arr1</span> = []
  <span class="ruby-identifier">get_total_provider_list</span>(<span class="ruby-identifier">prov_arr</span>,<span class="ruby-identifier">prov_arr1</span>)
  <span class="ruby-comment">#~ prov_list = prov_arr.uniq{|x| x[:id]}</span>
  <span class="ruby-comment">#~ if prov_list.length != 0 &amp;&amp; prov_list.length &lt; 5</span>
        <span class="ruby-comment">#~ # cookies[:provider_page] = 1 + cookies[:provider_page].to_i</span>
        <span class="ruby-comment">#~ @page = @page.to_i + 1</span>
        <span class="ruby-comment">#~ get_total_provider_list(prov_arr)</span>
  <span class="ruby-comment">#~ end</span>
  <span class="ruby-ivar">@prov_list_new</span> = <span class="ruby-identifier">prov_arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-ivar">@prov_list_remain</span> = <span class="ruby-identifier">prov_arr1</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;provider_list&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_names_list-source -->
          
        </div>

        

        
      </div><!-- provider_names_list-method -->

    
      <div id="method-i-provider_privacy_policy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_privacy_policy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_privacy_policy-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_privacy_policy</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_privacy_policy-source -->
          
        </div>

        

        
      </div><!-- provider_privacy_policy-method -->

    
      <div id="method-i-provider_terms_of_service" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_terms_of_service</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_terms_of_service-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 194</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_terms_of_service</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_terms_of_service-source -->
          
        </div>

        

        
      </div><!-- provider_terms_of_service-method -->

    
      <div id="method-i-register" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>calling register method for phone friendly</p>
          

          
          <div class="method-source-code" id="register-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">register</span>
        <span class="ruby-comment">#new register method added for non-members</span>
        <span class="ruby-comment">#~ redirect_to &quot;/?parent_reg=#{params[:parent_reg]}&amp;sent_user=#{params[:sent_user]}&amp;sent_user_email=#{params[:sent_user_email]}&amp;attend_track=#{params[:attend_track]}&quot;</span>
        <span class="ruby-identifier">render</span> <span class="ruby-value">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">:landing_new</span><span class="ruby-comment">#?parent_reg=#{params[:parent_reg]}&amp;sent_user=#{params[:sent_user]}&amp;sent_user_email=#{params[:sent_user_email]}&amp;attend_track=#{params[:attend_track]}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- register-source -->
          
        </div>

        

        
      </div><!-- register-method -->

    
      <div id="method-i-repeat_monthly_date" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_date</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="repeat_monthly_date-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 715</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_date</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_date</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w_date</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_date-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_date-method -->

    
      <div id="method-i-repeat_monthly_date_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_date_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date,running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_monthly_date_never-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 698</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_date_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>,<span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_date</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w_date</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_date_never-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_date_never-method -->

    
      <div id="method-i-repeat_monthly_day" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_day</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_monthly_day-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 661</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_day</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_day</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">se</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:&quot;#{w_day.downcase}&quot;</span> , <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_day-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_day-method -->

    
      <div id="method-i-repeat_monthly_day_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_day_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date,running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_monthly_day_never-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 681</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_day_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>,<span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_day</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">se</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:&quot;#{w_day.downcase}&quot;</span> , <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_day_never-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_day_never-method -->

    
      <div id="method-i-repeat_schedule" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_schedule</span><span
            class="method-args">(event, events, js_end_date, js_start_date,running_date,type,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_schedule-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 860</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_schedule</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>,<span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">type</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">days</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'daily'</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">years</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'yearly'</span>

    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rep</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span>  <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_schedule-source -->
          
        </div>

        

        
      </div><!-- repeat_schedule-method -->

    
      <div id="method-i-repeat_schedule_end" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_schedule_end</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,type,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_schedule_end-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 842</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">type</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">##          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">days</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'daily'</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">years</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'yearly'</span>

    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rep</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_schedule_end-source -->
          
        </div>

        

        
      </div><!-- repeat_schedule_end-method -->

    
      <div id="method-i-repeat_schedule_occurance" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_schedule_occurance</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,type,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_schedule_occurance-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 826</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_schedule_occurance</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">type</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">days</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'daily'</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">years</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'yearly'</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rep</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_schedule_occurance-source -->
          
        </div>

        

        
      </div><!-- repeat_schedule_occurance-method -->

    
      <div id="method-i-repeat_weekly" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_weekly</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="repeat_weekly-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 616</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_weekly</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">date_un</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">js_end_date</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_un</span>,<span class="ruby-value">:interval=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_un</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)

          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#            events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_weekly-source -->
          
        </div>

        

        
      </div><!-- repeat_weekly-method -->

    
      <div id="method-i-repeat_weekly_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_weekly_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_weekly_never-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 640</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_weekly_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">date_js</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">js_end_date</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_js</span>,<span class="ruby-value">:interval=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_js</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_weekly_never-source -->
          
        </div>

        

        
      </div><!-- repeat_weekly_never-method -->

    
      <div id="method-i-schedule_repeat_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">schedule_repeat_append</span><span
            class="method-args">(event,events,type_icon)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="schedule_repeat_append-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 442</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">schedule_repeat_append</span>(<span class="ruby-identifier">event</span>,<span class="ruby-identifier">events</span>,<span class="ruby-identifier">type_icon</span>)
  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.start_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">end_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.end_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_schedule_id =?&quot;</span>,<span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">info</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">js_start_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>])
    <span class="ruby-identifier">js_end_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>])
    <span class="ruby-ivar">@type_icon</span> = <span class="ruby-identifier">type_icon</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">repeat_schedule</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'daily'</span>,<span class="ruby-identifier">info</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'daily'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">repeat_schedule_occurance</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'daily'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yearly&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">repeat_schedule</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'yearly'</span>,<span class="ruby-identifier">info</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'yearly'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'yearly'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>) <span class="ruby-operator">||</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Every week (Monday to Friday)&quot;</span>) <span class="ruby-operator">||</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Every Tuesday and Thursday&quot;</span>) <span class="ruby-operator">||</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Every Monday,Wednesday and Friday&quot;</span>)
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-ivar">@wek</span> =[]
        <span class="ruby-ivar">@ss</span> =[]
        <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_on</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-identifier">rep</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Mon&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">1</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:monday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Tue&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">2</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:tuesday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Wed&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">3</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:wednesday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Thu&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">4</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:thursday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Fri&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">5</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:friday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Sat&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">6</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:saturday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Sun&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">0</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:sunday</span>)
          <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">repeat_weekly_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">repeat_weekly</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">repeat_weekly</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">s</span> = <span class="ruby-identifier">week_of_month_for_date</span>(<span class="ruby-identifier">running_date</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:first</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">2</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:second</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">3</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:third</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">&gt;=</span><span class="ruby-value">4</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:last</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
            <span class="ruby-identifier">repeat_monthly_day_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
              <span class="ruby-identifier">repeat_monthly_day</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
              <span class="ruby-identifier">repeat_monthly_day</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
            <span class="ruby-identifier">repeat_monthly_date_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
              <span class="ruby-identifier">repeat_monthly_date</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
              <span class="ruby-identifier">repeat_monthly_date</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">start_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.start_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">end_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.end_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{start_date}&quot;</span>, <span class="ruby-value">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{end_date}&quot;</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.start_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">end_date</span> = <span class="ruby-node">&quot;#{@schedule.end_date} #{@schedule.end_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">nil?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span><span class="ruby-operator">==</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_date</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{start_date}&quot;</span>, <span class="ruby-value">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{end_date}&quot;</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{start_date}&quot;</span>, <span class="ruby-value">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{end_date}&quot;</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
    <span class="ruby-identifier">any_time</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>)

    <span class="ruby-identifier">any_time</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;mon&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:monday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>

          } }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;tue&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:tuesday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>       <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;wed&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:wednesday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>       <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;thu&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:thursday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}

        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;fri&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:friday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span> <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}  }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sat&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:saturday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}   }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sun&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:sunday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span> <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}   }
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours!</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>


  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- schedule_repeat_append-source -->
          
        </div>

        

        
      </div><!-- schedule_repeat_append-method -->

    
      <div id="method-i-search_activities" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_activities</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>before login home and logo click goto search page</p>
          

          
          <div class="method-source-code" id="search_activities-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 918</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_activities</span>
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT trim(category) as category&quot;</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;lower(category)!=?&quot;</span>,<span class="ruby-string">'default'</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_activities-source -->
          
        </div>

        

        
      </div><!-- search_activities-method -->

    
      <div id="method-i-search_landing_new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_landing_new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_landing_new-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 959</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_landing_new</span>          
  <span class="ruby-ivar">@blog_value</span> = []
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_landing_new-source -->
          
        </div>

        

        
      </div><!-- search_landing_new-method -->

    
      <div id="method-i-service_discover_more" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">service_discover_more</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="service_discover_more-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">service_discover_more</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- service_discover_more-source -->
          
        </div>

        

        
      </div><!-- service_discover_more-method -->

    
      <div id="method-i-service_purchase_more" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">service_purchase_more</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="service_purchase_more-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">service_purchase_more</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- service_purchase_more-source -->
          
        </div>

        

        
      </div><!-- service_purchase_more-method -->

    
      <div id="method-i-shared_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shared_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Can be used if count is needed in landing page for each rows ~ def
get_total_count_feature_list ~ if !<a
href="http://'ip_location'">session</a>.nil? ~ ip_location = <a
href="http://'ip_location'">session</a> ~ ip_location =
ActiveSupport::JSON.decode(ip_loc) ~ else ~ ip_location =
{latitude=&gt;37.9100783,longitude=&gt;-122.0651819, city =&gt;
Walnut Creek} ~ end ~ if (<a
href="http://:selected_city">cookies</a>.nil?) ~ <a
href="http://:city_new_usr">cookies</a> = <a
href="http://'city'">ip_location</a>.titlecase  if(ip_location &amp;&amp;
!ip_location.nil? &amp;&amp; !<a href="http://'city'">ip_location</a>.nil?)
~ else ~ <a href="http://:city_new_usr">cookies</a> = <a
href="http://:selected_city">cookies</a> ~ end ~ if (<a
href="http://'latitude'">ip_location</a>!= &amp;&amp; <a
href="http://'longitude'">ip_location</a>!= &amp;&amp; !<a
href="http://'latitude'">ip_location</a>.nil? &amp;&amp; !<a
href="http://'longitude'">ip_location</a>.nil?) ~ featured = <a
href="City.html#method-c-nearby_city_activities">City.nearby_city_activities</a>,<a
href="http://'longitude'">ip_location</a>,<a
href="http://:city">session</a>) ~ else ~ featured
=Activity.find_by_sql(select act.* from activities act left join users u
on act.user_id=u.user_id where lower(u.user_plan)=sell and
lower(active_status)=active and cleaned=true and
lower(created_by)=provider order by activity_id desc) ~ featured =
Activity.joins(:user,:activity_schedule).where(city=Walnut Creek and
lower(user_plan)=sell and lower(active_status)=active and cleaned=true
and lower(created_by)=provider and expiration_date &gt;=
#{Date.today}).order(activity_id DESC) ~ end ~ @admin_activity =
featured ~ arr = [] ~ @admin_activity.each do |event| ~ @schedule =
ActivitySchedule.where(activity_id = ?,event.activity_id).last ~ <a
href="Activity.html#method-c-schedule_feature_list">Activity.schedule_feature_list</a>,event,arr)
if !event.nil? ~ end if !@admin_activity.nil? &amp;&amp;
@admin_activity.length &gt; 0 ~ arr_count = arr.uniq{|x| <a
href="http://:id">x</a>} ~ render :text=&gt; arr_count.length ~ end</p>
          

          
          <div class="method-source-code" id="shared_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1512</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shared_activity</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:shared_page</span>] = <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:shared_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:shared_page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">arr_shared</span> = []
  <span class="ruby-identifier">arr_shared</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_total_shared_list</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr_shared</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">arr_shared</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span><span class="ruby-value">8</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:shared_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:shared_page</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">arr_shared</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_total_shared_list</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_share_provider</span> = <span class="ruby-identifier">arr_shared</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_shared&quot;</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;parent_shared&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- shared_activity-source -->
          
        </div>

        

        
      </div><!-- shared_activity-method -->

    
      <div id="method-i-splash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">splash</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="splash-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1796</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">splash</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- splash-source -->
          
        </div>

        

        
      </div><!-- splash-method -->

    
      <div id="method-i-submit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">submit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Confirming <a href="User.html">User</a> <a href="City.html">City</a></p>
          

          
          <div class="method-source-code" id="submit-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">submit</span>
  <span class="ruby-identifier">city_new_usr</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_new_usr_val</span>]
  <span class="ruby-identifier">action_new_usr</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:action_new_usr</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] = <span class="ruby-identifier">city_new_usr</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_new_usr</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_new_usr</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:sub_category_new_usr</span>] = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:login_usr</span>] = <span class="ruby-string">&quot;off&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">action_new_usr</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;login&quot;</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_registered_usr</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;login&quot;</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;index&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">action_new_usr</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;parent&quot;</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_registered_usr</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;user_usrs&quot;</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;user_register&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">action_new_usr</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;provider&quot;</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_registered_usr</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:controller</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;user_usrs&quot;</span>, <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;provider_register&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- submit-source -->
          
        </div>

        

        
      </div><!-- submit-method -->

    
      <div id="method-i-support" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">support</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="support-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">support</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- support-source -->
          
        </div>

        

        
      </div><!-- support-method -->

    
      <div id="method-i-terms_of_service" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">terms_of_service</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="terms_of_service-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 181</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">terms_of_service</span>
      <span class="ruby-ivar">@meta_alt</span> = <span class="ruby-keyword">true</span> <span class="ruby-comment">#dont remove, this for sitemap usage</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">session</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- terms_of_service-source -->
          
        </div>

        

        
      </div><!-- terms_of_service-method -->

    
      <div id="method-i-update_parent_provider" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_parent_provider</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_parent_provider-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 429</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_parent_provider</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;p&quot;</span>
    <span class="ruby-ivar">@provider_user</span> =  <span class="ruby-constant">User</span>.<span class="ruby-identifier">search_provider</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@user_row</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and user_type='P'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;activity_subcategories/accordion_provider_user&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@parent_user</span> =  <span class="ruby-constant">User</span>.<span class="ruby-identifier">search_parent</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@parent_follow_search</span> = <span class="ruby-string">'followsearch'</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;activity_subcategories/accordion_parent_user&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_parent_provider-source -->
          
        </div>

        

        
      </div><!-- update_parent_provider-method -->

    
      <div id="method-i-update_ses_date" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_ses_date</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_ses_date-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 413</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_ses_date</span>
  <span class="ruby-ivar">@loc_flag</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#~ cookies[:city_new_usr] = params[:state] if !params[:state].nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:selected_city</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>]=<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:selected_city</span>] 
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page_a</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page_a</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'landing_new'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page_a</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'v2_landing_new'</span>
    <span class="ruby-ivar">@loc_flag</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_ses_date-source -->
          
        </div>

        

        
      </div><!-- update_ses_date-method -->

    
      <div id="method-i-v2_landing_new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">v2_landing_new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="v2_landing_new-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 963</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">v2_landing_new</span>
  <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value">:feature_page</span> <span class="ruby-comment">#to avoid duplicate - delete cookies for first time page load</span>
  <span class="ruby-ivar">@sent_user</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">y</span> = <span class="ruby-identifier">rand</span>(<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">3</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">y</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>)
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]=<span class="ruby-string">'parent'</span>  <span class="ruby-comment">#dont remove this</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">ip_location</span> = <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">ip_location</span> = {<span class="ruby-string">'latitude'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">'37.9100783'</span>,<span class="ruby-string">'longitude'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">'-122.0651819'</span>, <span class="ruby-string">'city'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Walnut Creek'</span>}
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:selected_city</span>].<span class="ruby-identifier">nil?</span>)
      <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'city'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'city'</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'city'</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> )
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] = <span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'city'</span>].<span class="ruby-identifier">titlecase</span>  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'city'</span>].<span class="ruby-identifier">nil?</span>)
      <span class="ruby-keyword">else</span> <span class="ruby-comment">#default values</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] = <span class="ruby-string">'Walnut Creek'</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@city_value</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&quot;=&quot;</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@city_value</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&quot;?&quot;</span>)
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] = <span class="ruby-string">'Walnut Creek'</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] = <span class="ruby-ivar">@city_value</span>.<span class="ruby-identifier">titleize</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] = <span class="ruby-string">'Walnut Creek'</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span> <span class="ruby-comment">#city selected values</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:selected_city</span>]
    <span class="ruby-keyword">end</span>
  
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#    @blog_value = []</span>
    <span class="ruby-comment">#    url = URI.parse(&quot;http://blog.famtivity.com/?feed=rss2&quot;)</span>
    <span class="ruby-comment">#    req = Net::HTTP.new(url.host, url.port)</span>
    <span class="ruby-comment">#    begin</span>
    <span class="ruby-comment">#      res = req.request_head(url.path)</span>
    <span class="ruby-comment">#      if res.code != &quot;404&quot; &amp;&amp; res.code !=&quot;500&quot;</span>
    <span class="ruby-comment">#        doc = Nokogiri::XML(open(url))</span>
    <span class="ruby-comment">#        if !doc.nil? &amp;&amp; doc!='' &amp;&amp; doc.present?</span>
    <span class="ruby-comment">#          (doc/'item').each do|node|</span>
    <span class="ruby-comment">#            title = (node/'title').inner_html</span>
    <span class="ruby-comment">#            desc = (node/'description').inner_html</span>
    <span class="ruby-comment">#            link = (node/'link').inner_html</span>
    <span class="ruby-comment">#            img_srcs = desc[/img.*?src=&quot;(.*?)&quot;/i,1]</span>
    <span class="ruby-comment">#            dec = desc.gsub(/&lt;\/?[^&gt;]*&gt;/,&quot;&quot;)</span>
    <span class="ruby-comment">#            title = title.gsub(/&lt;\/?[^&gt;]*&gt;/,&quot;&quot;)</span>
    <span class="ruby-comment">#            dec = dec.sub(&quot;Continue reading &amp;#8594;&quot;,&quot;&quot;)</span>
    <span class="ruby-comment">#            dec1 = CGI::unescapeHTML(dec)</span>
    <span class="ruby-comment">#            title1 = CGI::unescapeHTML(title)</span>
    <span class="ruby-comment">#            @blog_value &lt;&lt; {&quot;title&quot; =&gt; title1, &quot;description&quot;=&gt;dec1,&quot;img&quot;=&gt;img_srcs,&quot;link&quot;=&gt;link}</span>
    <span class="ruby-comment">#          end</span>
    <span class="ruby-comment">#        end</span>
    <span class="ruby-comment">#      end</span>
    <span class="ruby-comment">#    rescue Exception =&gt; exc</span>
    <span class="ruby-comment">#      logger.error(&quot;Message for the log file #{exc.message}&quot;)</span>
    <span class="ruby-comment">#      flash[:notice] = &quot;Store error message&quot;</span>
    <span class="ruby-comment">#    end</span>
    <span class="ruby-ivar">@provider_activites</span> = []
    <span class="ruby-ivar">@follow_parent_user</span> = []
    <span class="ruby-ivar">@follow_provider_user</span> = []
    <span class="ruby-ivar">@category</span> = []
    <span class="ruby-ivar">@sub_category</span> = []
    <span class="ruby-ivar">@checck</span>  = []
    <span class="ruby-ivar">@jump_to_act</span> =[]
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
      <span class="ruby-ivar">@provider_activites_selected</span> = []
      <span class="ruby-ivar">@provider_activites_combined</span> = []
      <span class="ruby-ivar">@provider_activites_selected</span> =  <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;Distinct(activities.category)&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activities.category Asc&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;left join activities on lower(activities.sub_category)=lower(activity_rows.row_type)&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_rows.user_id = ?&quot;</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;activities.category&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category</span>)
      <span class="ruby-comment">#user selected activities</span>
      <span class="ruby-ivar">@provider_activites_combined</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-ivar">@provider_activites_selected</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_activites_selected</span>
      <span class="ruby-comment">#make all the category to single array</span>
      <span class="ruby-ivar">@provider_activites_get</span> = <span class="ruby-ivar">@provider_activites_combined</span>.<span class="ruby-identifier">flatten</span>
      <span class="ruby-ivar">@provider_activites</span> = <span class="ruby-ivar">@provider_activites_get</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>}
      <span class="ruby-comment">#provider activities based on the user selection row with default row added</span>
      <span class="ruby-comment">#if (!@provider_activites.nil? &amp;&amp; @provider_activites.present?)</span>
      <span class="ruby-comment">#cat1=&quot;Dance&quot;</span>
      <span class="ruby-comment">#cat2=&quot;Music&quot;</span>
      <span class="ruby-comment">#cat3=&quot;Sports&quot;</span>
      <span class="ruby-comment">#c1=false</span>
      <span class="ruby-comment">#c2=false</span>
      <span class="ruby-comment">#c3=false</span>
      <span class="ruby-comment">#c1=true if @provider_activites.include?cat1</span>
      <span class="ruby-comment">#c2=true if @provider_activites.include?cat2</span>
      <span class="ruby-comment">#c3=true if @provider_activites.include?cat3</span>
      <span class="ruby-comment">#@provider_activites &lt;&lt; &quot;Dance&quot; if c1==false</span>
      <span class="ruby-comment">#@provider_activites &lt;&lt; &quot;Music&quot; if c2==false</span>
      <span class="ruby-comment">#@provider_activites &lt;&lt; &quot;Sports&quot; if c3==false</span>
      <span class="ruby-comment">#@provider_activites</span>
      <span class="ruby-comment">#elsif @provider_activites.empty? || @provider_activites.blank?</span>
      <span class="ruby-comment">#@default=&quot;&quot;</span>
      <span class="ruby-comment">#@default = ActivitySubcategory.where(:category_id=&gt;[8,4,12] ).map(&amp;:subcateg_id)</span>
      <span class="ruby-comment">#@category_default =  ActivitySubcategory.where(:subcateg_id=&gt;@default).map(&amp;:category_id)</span>
      <span class="ruby-comment">#@provider_activites = ActivityCategory.where(:category_id=&gt;@category_default).map(&amp;:category_name)</span>
      <span class="ruby-comment">#end</span>
      <span class="ruby-ivar">@follow_parent_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{user_id} and user_type='U'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
      <span class="ruby-ivar">@follow_provider_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{user_id} and user_type='P'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
      <span class="ruby-ivar">@category</span> =  <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_id</span>)
      <span class="ruby-ivar">@sub_category</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subcateg_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@category</span> ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_name</span>)
      <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>,<span class="ruby-identifier">user_id</span>],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:subct_id</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:before_cat</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:before_prov</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-value">:provider_row</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@provider_activites_check</span> =[]
      <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span> }
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#~ if session[:category_row]!=&quot;&quot;</span>
      <span class="ruby-comment">#~ session[:category_row] = ActivitySubcategory.where(:category_id=&gt;[8,4,12] ).map(&amp;:subcateg_id)</span>
      <span class="ruby-comment">#~ else</span>
      <span class="ruby-comment">#~ session[:category_row] = ActivitySubcategory.where(:category_id=&gt;[8,4,12] ).map(&amp;:subcateg_id)</span>
      <span class="ruby-comment">#~ end</span>
      <span class="ruby-comment">#~ @category =  ActivitySubcategory.where(:subcateg_id=&gt;session[:category_row] ).map(&amp;:category_id)</span>
      <span class="ruby-comment">#~ @sub_category = ActivitySubcategory.where(:subcateg_id=&gt;session[:category_row] ).map(&amp;:subcateg_name)</span>
      <span class="ruby-comment">#~ @provider_activites = ActivityCategory.where(:category_id=&gt;@category ).map(&amp;:category_name)</span>
    
      <span class="ruby-comment">#before login display the category row start</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@cv</span>=<span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>]
        <span class="ruby-ivar">@category</span> =  <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subcateg_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@cv</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@cv</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:subct_id</span>]= <span class="ruby-ivar">@cv</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@cv</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@cv</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@sub_category</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:subcateg_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@cv</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:subcateg_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@cv</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@cat_val</span>= <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@category</span> ).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:category_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@category</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">session</span>[<span class="ruby-value">:before_cat</span>] = <span class="ruby-ivar">@cat_val</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@cat_val</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@cat_val</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@provider_activites</span> =  <span class="ruby-identifier">session</span>[<span class="ruby-value">:before_cat</span>]
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">session</span>[<span class="ruby-value">:category_row</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat_add_row</span>]
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#before login display the category row end</span>
      <span class="ruby-comment">#display provider follow row</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:provider_row</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-comment">#~ session[:provider_row] = params[:provider_add_row]</span>
        <span class="ruby-ivar">@pv</span>=<span class="ruby-identifier">session</span>[<span class="ruby-value">:provider_row</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:provider_row</span>]
        <span class="ruby-identifier">session</span>[<span class="ruby-value">:before_prov</span>] = <span class="ruby-ivar">@pv</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pv</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pv</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@follow_provider_user</span> = <span class="ruby-identifier">session</span>[<span class="ruby-value">:before_prov</span>]
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">session</span>[<span class="ruby-value">:provider_row</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_add_row</span>]
      <span class="ruby-keyword">end</span>
      
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#current user end</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>] = <span class="ruby-value">1</span>
    <span class="ruby-identifier">arr</span> = []
    <span class="ruby-comment">#~ get_total_feature_list(arr)</span>
    <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'latitude'</span>],<span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'longitude'</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'latitude'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'longitude'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'latitude'</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'longitude'</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-identifier">featured</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">featured</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">featured</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span><span class="ruby-value">8</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>].<span class="ruby-identifier">to_i</span>
      <span class="ruby-comment">#~ get_total_feature_list(arr)</span>
      <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'latitude'</span>],<span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'longitude'</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'latitude'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'longitude'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'latitude'</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ip_location</span>[<span class="ruby-string">'longitude'</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-keyword">end</span>
  
    <span class="ruby-comment"># Provider fetch with scrolling start #</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:provider_page</span>] = <span class="ruby-value">1</span>
    <span class="ruby-identifier">prov_arr</span> = []
    <span class="ruby-identifier">get_total_provider_list</span>(<span class="ruby-identifier">prov_arr</span>)
    <span class="ruby-identifier">prov_list</span> = <span class="ruby-identifier">prov_arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">prov_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">prov_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">5</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:provider_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:provider_page</span>].<span class="ruby-identifier">to_i</span>
      <span class="ruby-identifier">get_total_provider_list</span>(<span class="ruby-identifier">prov_arr</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@prov_list</span> = <span class="ruby-identifier">prov_arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
    <span class="ruby-comment"># end #</span>
    <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
    <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT trim(category) as category&quot;</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;lower(category)!=?&quot;</span>,<span class="ruby-string">'default'</span>])
    <span class="ruby-ivar">@blog_value</span> = []
    <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-string">&quot;http://blog.famtivity.com/?feed=rss2&quot;</span>)
    <span class="ruby-identifier">req</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">url</span>.<span class="ruby-identifier">port</span>)
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">res</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">request_head</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">path</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;404&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;500&quot;</span>
        <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>))
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">doc</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">present?</span>
          (<span class="ruby-identifier">doc</span><span class="ruby-operator">/</span><span class="ruby-string">'item'</span>)[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">title</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'title'</span>).<span class="ruby-identifier">inner_html</span>
            <span class="ruby-identifier">desc</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'description'</span>).<span class="ruby-identifier">inner_html</span>
            <span class="ruby-identifier">link</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'link'</span>).<span class="ruby-identifier">inner_html</span>
            <span class="ruby-identifier">img_srcs</span> = <span class="ruby-identifier">desc</span>[<span class="ruby-regexp">/img.*?src=&quot;(.*?)&quot;/</span>,<span class="ruby-value">1</span>]
            <span class="ruby-identifier">decs</span> = <span class="ruby-identifier">desc</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
            <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">decs</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;Read More&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
            <span class="ruby-identifier">title</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
            <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">dec</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">&quot;Continue reading &amp;#8594;&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
            <span class="ruby-identifier">dec1</span> = <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">unescapeHTML</span>(<span class="ruby-identifier">dec</span>)
            <span class="ruby-identifier">title1</span> = <span class="ruby-constant">CGI</span><span class="ruby-operator">::</span><span class="ruby-identifier">unescapeHTML</span>(<span class="ruby-identifier">title</span>)
            <span class="ruby-ivar">@blog_value</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;title&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title1</span>, <span class="ruby-string">&quot;description&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">dec1</span>,<span class="ruby-string">&quot;img&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">img_srcs</span>,<span class="ruby-string">&quot;link&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">link</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exc</span>
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Message for the log file #{exc.message}&quot;</span>)
      <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&quot;Store error message&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mview</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mview</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/home?mview=#{params[:mview]}&quot;</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user_email</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user_email</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/home?sent_user_email=#{params[:sent_user_email]}&amp;sent_user=#{params[:sent_user]}&quot;</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:findus</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:findus</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/home?findus=view&quot;</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:newsletter</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:newsletter</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/home?newsletter=view&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/home&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- v2_landing_new-source -->
          
        </div>

        

        
      </div><!-- v2_landing_new-method -->

    
      <div id="method-i-week_of_month_for_date" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">week_of_month_for_date</span><span
            class="method-args">(date)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="week_of_month_for_date-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 875</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">week_of_month_for_date</span>(<span class="ruby-identifier">date</span>)
  <span class="ruby-identifier">my_date</span> = <span class="ruby-identifier">date</span>
  <span class="ruby-identifier">week_of_target_date</span> = <span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%U&quot;</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">week_of_beginning_of_month</span> = <span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%U&quot;</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">week_of_target_date</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">week_of_beginning_of_month</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- week_of_month_for_date-source -->
          
        </div>

        

        
      </div><!-- week_of_month_for_date-method -->

    
      <div id="method-i-zip_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">zip_search</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="zip_search-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1904</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">zip_search</span>
  <span class="ruby-identifier">re_times</span> = <span class="ruby-value">5</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">location</span> = <span class="ruby-constant">Geocoder</span>.<span class="ruby-identifier">search</span>(<span class="ruby-node">&quot;#{params[:zip_value]}&quot;</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">latitude</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">longitude</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">city</span>
    <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0.0</span>) <span class="ruby-operator">||</span>(<span class="ruby-identifier">location</span>.<span class="ruby-identifier">country</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;India&quot;</span>))
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-value">37.9100783</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-value">-122.0651819</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">re_times</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">re_times</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-value">37.9100783</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-value">-122.0651819</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>


<span class="ruby-keyword">end</span></pre>
          </div><!-- zip_search-source -->
          
        </div>

        

        
      </div><!-- zip_search-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-change_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">change_url</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="change_url-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1948</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">change_url</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">'/'</span>
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- change_url-source -->
          
        </div>

        

        
      </div><!-- change_url-method -->

    
      <div id="method-i-geo_ip_location" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">geo_ip_location</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="geo_ip_location-source">
            <pre><span class="ruby-comment"># File app/controllers/landing_controller.rb, line 1933</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">geo_ip_location</span>
  <span class="ruby-comment">#~ session['ip_location'] = Activity.ip_city_name(@i_addr).to_json if session['ip_location'].nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@i_addr</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
    <span class="ruby-identifier">ip_location</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">ip_city_name</span>(<span class="ruby-ivar">@i_addr</span>).<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>] = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>.<span class="ruby-identifier">decode</span>(<span class="ruby-identifier">ip_location</span>)
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>][<span class="ruby-string">'city'</span>].<span class="ruby-identifier">capitalize</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>][<span class="ruby-string">'city'</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>][<span class="ruby-string">'latitude'</span>]
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>]= <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>][<span class="ruby-string">'longitude'</span>]
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>][<span class="ruby-string">'latitude'</span>]<span class="ruby-operator">==</span><span class="ruby-string">'0'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>][<span class="ruby-string">'longitude'</span>]<span class="ruby-operator">==</span><span class="ruby-string">'0'</span> )
      <span class="ruby-identifier">session</span>[<span class="ruby-string">'ip_location'</span>] = {<span class="ruby-string">'latitude'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">'37.9100783'</span>,<span class="ruby-string">'longitude'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">'-122.0651819'</span>, <span class="ruby-string">'city'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Walnut Creek'</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- geo_ip_location-source -->
          
        </div>

        

        
      </div><!-- geo_ip_location-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

