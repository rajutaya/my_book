<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class ContactUsersController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/contact_users_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="ActivitiesHelper.html">ActivitiesHelper</a>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-add_contact_success">#add_contact_success</a>
    
    <li><a href="#method-i-add_files_to_temp">#add_files_to_temp</a>
    
    <li><a href="#method-i-check_contact_exist">#check_contact_exist</a>
    
    <li><a href="#method-i-check_contact_invite">#check_contact_invite</a>
    
    <li><a href="#method-i-check_repeated_users">#check_repeated_users</a>
    
    <li><a href="#method-i-check_same_users">#check_same_users</a>
    
    <li><a href="#method-i-contact_activate">#contact_activate</a>
    
    <li><a href="#method-i-contact_create">#contact_create</a>
    
    <li><a href="#method-i-contact_create_message">#contact_create_message</a>
    
    <li><a href="#method-i-contact_detail">#contact_detail</a>
    
    <li><a href="#method-i-contact_edit">#contact_edit</a>
    
    <li><a href="#method-i-contact_fail">#contact_fail</a>
    
    <li><a href="#method-i-contact_import">#contact_import</a>
    
    <li><a href="#method-i-contact_index">#contact_index</a>
    
    <li><a href="#method-i-contact_invite">#contact_invite</a>
    
    <li><a href="#method-i-contact_list">#contact_list</a>
    
    <li><a href="#method-i-contact_send_message">#contact_send_message</a>
    
    <li><a href="#method-i-contact_store">#contact_store</a>
    
    <li><a href="#method-i-contact_type_filter">#contact_type_filter</a>
    
    <li><a href="#method-i-contact_update">#contact_update</a>
    
    <li><a href="#method-i-create">#create</a>
    
    <li><a href="#method-i-csv_contacts">#csv_contacts</a>
    
    <li><a href="#method-i-delete">#delete</a>
    
    <li><a href="#method-i-delete_empty">#delete_empty</a>
    
    <li><a href="#method-i-destroy">#destroy</a>
    
    <li><a href="#method-i-edit">#edit</a>
    
    <li><a href="#method-i-facebook_contact_list">#facebook_contact_list</a>
    
    <li><a href="#method-i-facebook_contact_success">#facebook_contact_success</a>
    
    <li><a href="#method-i-fam_member_activate">#fam_member_activate</a>
    
    <li><a href="#method-i-fb_invite">#fb_invite</a>
    
    <li><a href="#method-i-file_import">#file_import</a>
    
    <li><a href="#method-i-gmail_import">#gmail_import</a>
    
    <li><a href="#method-i-import_contact">#import_contact</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-invite_friend">#invite_friend</a>
    
    <li><a href="#method-i-invite_friend_famtivity">#invite_friend_famtivity</a>
    
    <li><a href="#method-i-invite_mail">#invite_mail</a>
    
    <li><a href="#method-i-invite_success_page">#invite_success_page</a>
    
    <li><a href="#method-i-multi_email">#multi_email</a>
    
    <li><a href="#method-i-multi_email_old">#multi_email_old</a>
    
    <li><a href="#method-i-new">#new</a>
    
    <li><a href="#method-i-new_import">#new_import</a>
    
    <li><a href="#method-i-newslertter_fam_network">#newslertter_fam_network</a>
    
    <li><a href="#method-i-newslertter_invite">#newslertter_invite</a>
    
    <li><a href="#method-i-populate_email">#populate_email</a>
    
    <li><a href="#method-i-req_multi_email">#req_multi_email</a>
    
    <li><a href="#method-i-search_contact_user">#search_contact_user</a>
    
    <li><a href="#method-i-search_famtivity_members">#search_famtivity_members</a>
    
    <li><a href="#method-i-select_mail">#select_mail</a>
    
    <li><a href="#method-i-select_mail_empty">#select_mail_empty</a>
    
    <li><a href="#method-i-send_friend_request">#send_friend_request</a>
    
    <li><a href="#method-i-send_message">#send_message</a>
    
    <li><a href="#method-i-yahoo_contact_list">#yahoo_contact_list</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./ActivitiesController.html">ActivitiesController</a>
  
    <li><a href="./ActivitiesHelper.html">ActivitiesHelper</a>
  
    <li><a href="./Activity.html">Activity</a>
  
    <li><a href="./ActivityAttendDetail.html">ActivityAttendDetail</a>
  
    <li><a href="./ActivityAttendDetailsController.html">ActivityAttendDetailsController</a>
  
    <li><a href="./ActivityAttendDetailsHelper.html">ActivityAttendDetailsHelper</a>
  
    <li><a href="./ActivityBid.html">ActivityBid</a>
  
    <li><a href="./ActivityBidsController.html">ActivityBidsController</a>
  
    <li><a href="./ActivityBidsHelper.html">ActivityBidsHelper</a>
  
    <li><a href="./ActivityCategoriesController.html">ActivityCategoriesController</a>
  
    <li><a href="./ActivityCategoriesHelper.html">ActivityCategoriesHelper</a>
  
    <li><a href="./ActivityCategory.html">ActivityCategory</a>
  
    <li><a href="./ActivityClick.html">ActivityClick</a>
  
    <li><a href="./ActivityComment.html">ActivityComment</a>
  
    <li><a href="./ActivityCommentsController.html">ActivityCommentsController</a>
  
    <li><a href="./ActivityCommentsHelper.html">ActivityCommentsHelper</a>
  
    <li><a href="./ActivityCount.html">ActivityCount</a>
  
    <li><a href="./ActivityDetailController.html">ActivityDetailController</a>
  
    <li><a href="./ActivityDetailHelper.html">ActivityDetailHelper</a>
  
    <li><a href="./ActivityDiscountPrice.html">ActivityDiscountPrice</a>
  
    <li><a href="./ActivityFavorite.html">ActivityFavorite</a>
  
    <li><a href="./ActivityFavoritesController.html">ActivityFavoritesController</a>
  
    <li><a href="./ActivityFavoritesHelper.html">ActivityFavoritesHelper</a>
  
    <li><a href="./ActivityForm.html">ActivityForm</a>
  
    <li><a href="./ActivityNetworkController.html">ActivityNetworkController</a>
  
    <li><a href="./ActivityNetworkHelper.html">ActivityNetworkHelper</a>
  
    <li><a href="./ActivityNetworkPermission.html">ActivityNetworkPermission</a>
  
    <li><a href="./ActivityPrice.html">ActivityPrice</a>
  
    <li><a href="./ActivityPricesController.html">ActivityPricesController</a>
  
    <li><a href="./ActivityPricesHelper.html">ActivityPricesHelper</a>
  
    <li><a href="./ActivityRating.html">ActivityRating</a>
  
    <li><a href="./ActivityRatingsController.html">ActivityRatingsController</a>
  
    <li><a href="./ActivityRatingsHelper.html">ActivityRatingsHelper</a>
  
    <li><a href="./ActivityRepeat.html">ActivityRepeat</a>
  
    <li><a href="./ActivityRepeatsController.html">ActivityRepeatsController</a>
  
    <li><a href="./ActivityRepeatsHelper.html">ActivityRepeatsHelper</a>
  
    <li><a href="./ActivityRow.html">ActivityRow</a>
  
    <li><a href="./ActivityRowsController.html">ActivityRowsController</a>
  
    <li><a href="./ActivityRowsHelper.html">ActivityRowsHelper</a>
  
    <li><a href="./ActivitySchedule.html">ActivitySchedule</a>
  
    <li><a href="./ActivitySchedulesController.html">ActivitySchedulesController</a>
  
    <li><a href="./ActivitySchedulesHelper.html">ActivitySchedulesHelper</a>
  
    <li><a href="./ActivitySetting.html">ActivitySetting</a>
  
    <li><a href="./ActivitySettingsDetail.html">ActivitySettingsDetail</a>
  
    <li><a href="./ActivitySettingsType.html">ActivitySettingsType</a>
  
    <li><a href="./ActivityShared.html">ActivityShared</a>
  
    <li><a href="./ActivitySharedsController.html">ActivitySharedsController</a>
  
    <li><a href="./ActivitySharedsHelper.html">ActivitySharedsHelper</a>
  
    <li><a href="./ActivitySubcategoriesController.html">ActivitySubcategoriesController</a>
  
    <li><a href="./ActivitySubcategoriesHelper.html">ActivitySubcategoriesHelper</a>
  
    <li><a href="./ActivitySubcategory.html">ActivitySubcategory</a>
  
    <li><a href="./ActivityTotalCount.html">ActivityTotalCount</a>
  
    <li><a href="./ActivityTrack.html">ActivityTrack</a>
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./AdminDiscountCode.html">AdminDiscountCode</a>
  
    <li><a href="./AdminDiscountCodesController.html">AdminDiscountCodesController</a>
  
    <li><a href="./AdminDiscountCodesHelper.html">AdminDiscountCodesHelper</a>
  
    <li><a href="./AdminHelper.html">AdminHelper</a>
  
    <li><a href="./AgeRangeColorsController.html">AgeRangeColorsController</a>
  
    <li><a href="./AgeRangeColorsHelper.html">AgeRangeColorsHelper</a>
  
    <li><a href="./AgerangeColor.html">AgerangeColor</a>
  
    <li><a href="./AgerangeColorsController.html">AgerangeColorsController</a>
  
    <li><a href="./AgerangeColorsHelper.html">AgerangeColorsHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Authentication.html">Authentication</a>
  
    <li><a href="./AuthenticationsController.html">AuthenticationsController</a>
  
    <li><a href="./BlockUser.html">BlockUser</a>
  
    <li><a href="./CheckoutController.html">CheckoutController</a>
  
    <li><a href="./City.html">City</a>
  
    <li><a href="./CityGroup.html">CityGroup</a>
  
    <li><a href="./ContactGroup.html">ContactGroup</a>
  
    <li><a href="./ContactGroupsController.html">ContactGroupsController</a>
  
    <li><a href="./ContactGroupsHelper.html">ContactGroupsHelper</a>
  
    <li><a href="./ContactUser.html">ContactUser</a>
  
    <li><a href="./ContactUserGroup.html">ContactUserGroup</a>
  
    <li><a href="./ContactUsersController.html">ContactUsersController</a>
  
    <li><a href="./ContactUsersHelper.html">ContactUsersHelper</a>
  
    <li><a href="./Country.html">Country</a>
  
    <li><a href="./DefaultFilter.html">DefaultFilter</a>
  
    <li><a href="./DefaultFiltersController.html">DefaultFiltersController</a>
  
    <li><a href="./DefaultFiltersHelper.html">DefaultFiltersHelper</a>
  
    <li><a href="./DeletedSchedule.html">DeletedSchedule</a>
  
    <li><a href="./DetailPageIdentityHelper.html">DetailPageIdentityHelper</a>
  
    <li><a href="./DetailsPageController.html">DetailsPageController</a>
  
    <li><a href="./DetailsPageHelper.html">DetailsPageHelper</a>
  
    <li><a href="./DiscountDollarsController.html">DiscountDollarsController</a>
  
    <li><a href="./DiscountDollarsHelper.html">DiscountDollarsHelper</a>
  
    <li><a href="./EmbedController.html">EmbedController</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./FamFeeDetail.html">FamFeeDetail</a>
  
    <li><a href="./FamNetwork.html">FamNetwork</a>
  
    <li><a href="./FamNetworkGroup.html">FamNetworkGroup</a>
  
    <li><a href="./FamNetworkGroupsController.html">FamNetworkGroupsController</a>
  
    <li><a href="./FamNetworkGroupsHelper.html">FamNetworkGroupsHelper</a>
  
    <li><a href="./FamNetworkPost.html">FamNetworkPost</a>
  
    <li><a href="./FamNetworkPostsController.html">FamNetworkPostsController</a>
  
    <li><a href="./FamNetworkPostsHelper.html">FamNetworkPostsHelper</a>
  
    <li><a href="./FamNetworkRow.html">FamNetworkRow</a>
  
    <li><a href="./FamNetworksController.html">FamNetworksController</a>
  
    <li><a href="./FamNetworksHelper.html">FamNetworksHelper</a>
  
    <li><a href="./FamPost.html">FamPost</a>
  
    <li><a href="./FamPostsController.html">FamPostsController</a>
  
    <li><a href="./FamPostsHelper.html">FamPostsHelper</a>
  
    <li><a href="./FampassDetail.html">FampassDetail</a>
  
    <li><a href="./FamtivityNetworkMailer.html">FamtivityNetworkMailer</a>
  
    <li><a href="./FeaturedAuditLog.html">FeaturedAuditLog</a>
  
    <li><a href="./FeaturedAuditLogsController.html">FeaturedAuditLogsController</a>
  
    <li><a href="./FeaturedAuditLogsHelper.html">FeaturedAuditLogsHelper</a>
  
    <li><a href="./FollowingUser.html">FollowingUser</a>
  
    <li><a href="./Form.html">Form</a>
  
    <li><a href="./FormQuestion.html">FormQuestion</a>
  
    <li><a href="./FormResult.html">FormResult</a>
  
    <li><a href="./FormResultAnswer.html">FormResultAnswer</a>
  
    <li><a href="./FormsController.html">FormsController</a>
  
    <li><a href="./FormsHelper.html">FormsHelper</a>
  
    <li><a href="./GeneralTag.html">GeneralTag</a>
  
    <li><a href="./GuestDetail.html">GuestDetail</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./InviteAttendees.html">InviteAttendees</a>
  
    <li><a href="./InvitesHelper.html">InvitesHelper</a>
  
    <li><a href="./InvitorList.html">InvitorList</a>
  
    <li><a href="./InvitorListHelper.html">InvitorListHelper</a>
  
    <li><a href="./LandingController.html">LandingController</a>
  
    <li><a href="./LandingHelper.html">LandingHelper</a>
  
    <li><a href="./LeadTransaction.html">LeadTransaction</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LogoutController.html">LogoutController</a>
  
    <li><a href="./Manager.html">Manager</a>
  
    <li><a href="./Message.html">Message</a>
  
    <li><a href="./MessageFile.html">MessageFile</a>
  
    <li><a href="./MessageMailer.html">MessageMailer</a>
  
    <li><a href="./MessageThread.html">MessageThread</a>
  
    <li><a href="./MessageThreadViewer.html">MessageThreadViewer</a>
  
    <li><a href="./MessagesController.html">MessagesController</a>
  
    <li><a href="./MessagesHelper.html">MessagesHelper</a>
  
    <li><a href="./MonthlyBudget.html">MonthlyBudget</a>
  
    <li><a href="./MonthlyBudgetsController.html">MonthlyBudgetsController</a>
  
    <li><a href="./MonthlyBudgetsHelper.html">MonthlyBudgetsHelper</a>
  
    <li><a href="./NewsletterMailer.html">NewsletterMailer</a>
  
    <li><a href="./NewslettersController.html">NewslettersController</a>
  
    <li><a href="./NotificationDetail.html">NotificationDetail</a>
  
    <li><a href="./ParentNotification.html">ParentNotification</a>
  
    <li><a href="./ParentNotificationDetail.html">ParentNotificationDetail</a>
  
    <li><a href="./ParentSetting.html">ParentSetting</a>
  
    <li><a href="./ParentSettingDetail.html">ParentSettingDetail</a>
  
    <li><a href="./ParentSettingsController.html">ParentSettingsController</a>
  
    <li><a href="./Participant.html">Participant</a>
  
    <li><a href="./ParticipantsController.html">ParticipantsController</a>
  
    <li><a href="./ParticipantsHelper.html">ParticipantsHelper</a>
  
    <li><a href="./PaymentDetail.html">PaymentDetail</a>
  
    <li><a href="./PaymentDetailsController.html">PaymentDetailsController</a>
  
    <li><a href="./PaymentDetailsHelper.html">PaymentDetailsHelper</a>
  
    <li><a href="./PoliciesController.html">PoliciesController</a>
  
    <li><a href="./PoliciesHelper.html">PoliciesHelper</a>
  
    <li><a href="./Policy.html">Policy</a>
  
    <li><a href="./PolicyFile.html">PolicyFile</a>
  
    <li><a href="./PolicyType.html">PolicyType</a>
  
    <li><a href="./ProviderActivityFee.html">ProviderActivityFee</a>
  
    <li><a href="./ProviderActivityFeeType.html">ProviderActivityFeeType</a>
  
    <li><a href="./ProviderCount.html">ProviderCount</a>
  
    <li><a href="./ProviderDiscountCode.html">ProviderDiscountCode</a>
  
    <li><a href="./ProviderDiscountCodeType.html">ProviderDiscountCodeType</a>
  
    <li><a href="./ProviderDiscountType.html">ProviderDiscountType</a>
  
    <li><a href="./ProviderLead.html">ProviderLead</a>
  
    <li><a href="./ProviderListController.html">ProviderListController</a>
  
    <li><a href="./ProviderNotification.html">ProviderNotification</a>
  
    <li><a href="./ProviderNotificationDetail.html">ProviderNotificationDetail</a>
  
    <li><a href="./ProviderSetting.html">ProviderSetting</a>
  
    <li><a href="./ProviderSettingDetail.html">ProviderSettingDetail</a>
  
    <li><a href="./ProviderSettingsController.html">ProviderSettingsController</a>
  
    <li><a href="./ProviderSettingsHelper.html">ProviderSettingsHelper</a>
  
    <li><a href="./ProviderTransaction.html">ProviderTransaction</a>
  
    <li><a href="./ProviderTransactionLog.html">ProviderTransactionLog</a>
  
    <li><a href="./ProviderWebsiteTrack.html">ProviderWebsiteTrack</a>
  
    <li><a href="./Question.html">Question</a>
  
    <li><a href="./QuestionType.html">QuestionType</a>
  
    <li><a href="./QuestionValue.html">QuestionValue</a>
  
    <li><a href="./QuickLinksController.html">QuickLinksController</a>
  
    <li><a href="./QuickLinksHelper.html">QuickLinksHelper</a>
  
    <li><a href="./SchoolRepresentative.html">SchoolRepresentative</a>
  
    <li><a href="./SchoolRepresentativesController.html">SchoolRepresentativesController</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SendSMS.html">SendSMS</a>
  
    <li><a href="./Setting.html">Setting</a>
  
    <li><a href="./SettingsController.html">SettingsController</a>
  
    <li><a href="./SettingsHelper.html">SettingsHelper</a>
  
    <li><a href="./SmsStatus.html">SmsStatus</a>
  
    <li><a href="./SocialType.html">SocialType</a>
  
    <li><a href="./SponsorShip.html">SponsorShip</a>
  
    <li><a href="./SponsorShipsController.html">SponsorShipsController</a>
  
    <li><a href="./SponsorShipsHelper.html">SponsorShipsHelper</a>
  
    <li><a href="./State.html">State</a>
  
    <li><a href="./StaticController.html">StaticController</a>
  
    <li><a href="./Support.html">Support</a>
  
    <li><a href="./SupportsController.html">SupportsController</a>
  
    <li><a href="./SupportsHelper.html">SupportsHelper</a>
  
    <li><a href="./Ticket.html">Ticket</a>
  
    <li><a href="./TicketsController.html">TicketsController</a>
  
    <li><a href="./TicketsHelper.html">TicketsHelper</a>
  
    <li><a href="./TransactionDetail.html">TransactionDetail</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserBankDetail.html">UserBankDetail</a>
  
    <li><a href="./UserCalender.html">UserCalender</a>
  
    <li><a href="./UserCard.html">UserCard</a>
  
    <li><a href="./UserChild.html">UserChild</a>
  
    <li><a href="./UserChildrenController.html">UserChildrenController</a>
  
    <li><a href="./UserCredit.html">UserCredit</a>
  
    <li><a href="./UserDeactivateLog.html">UserDeactivateLog</a>
  
    <li><a href="./UserDebit.html">UserDebit</a>
  
    <li><a href="./UserDeletedAccount.html">UserDeletedAccount</a>
  
    <li><a href="./UserEmailChangeLog.html">UserEmailChangeLog</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserNotification.html">UserNotification</a>
  
    <li><a href="./UserProfile.html">UserProfile</a>
  
    <li><a href="./UserProfilesController.html">UserProfilesController</a>
  
    <li><a href="./UserProfilesHelper.html">UserProfilesHelper</a>
  
    <li><a href="./UserRow.html">UserRow</a>
  
    <li><a href="./UserSettingsHelper.html">UserSettingsHelper</a>
  
    <li><a href="./UserTransaction.html">UserTransaction</a>
  
    <li><a href="./UserTransactionsController.html">UserTransactionsController</a>
  
    <li><a href="./UserTransactionsHelper.html">UserTransactionsHelper</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WeekendActivity.html">WeekendActivity</a>
  
    <li><a href="./WeekendMailer.html">WeekendMailer</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ContactUsersController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-add_contact_success" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_contact_success</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="add_contact_success-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 694</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_contact_success</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">contact_type</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:from</span>]
    <span class="ruby-ivar">@c_old</span> =[]
    <span class="ruby-ivar">@c_id</span> =[]
    <span class="ruby-ivar">@sublist</span> = []
    <span class="ruby-ivar">@sublist</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>]
    <span class="ruby-ivar">@s_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>].<span class="ruby-identifier">count</span>
    <span class="ruby-ivar">@pre_con</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">co</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@val</span> = <span class="ruby-identifier">co</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;^&quot;</span>)
      <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-ivar">@val</span>[<span class="ruby-value">0</span>])
      <span class="ruby-ivar">@old_contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-ivar">@val</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-ivar">@sameuser</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span><span class="ruby-operator">==</span><span class="ruby-ivar">@val</span>[<span class="ruby-value">0</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_contact</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@sameuser</span>
        <span class="ruby-ivar">@friend</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:contact_email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@val</span>[<span class="ruby-value">0</span>], <span class="ruby-value">:contact_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@val</span>[<span class="ruby-value">1</span>],  <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:contact_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">contact_type</span>, <span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>, <span class="ruby-value">:modified_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
        <span class="ruby-ivar">@friend</span>.<span class="ruby-identifier">contact_user_type</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">choose_contact_type</span>(<span class="ruby-ivar">@val</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-ivar">@friend</span>.<span class="ruby-identifier">fam_user_id</span> = <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@friend</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@c_old</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@old_contact</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#group_old_email= @c_old.collect{|f|f[&quot;contact_email&quot;]}.join(',')</span>
      <span class="ruby-ivar">@g1</span> =<span class="ruby-ivar">@c_old</span>.<span class="ruby-identifier">count</span>
      <span class="ruby-ivar">@group</span> = <span class="ruby-ivar">@s_value</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@g1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@cur_con</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])
    <span class="ruby-ivar">@rm_con</span>=<span class="ruby-ivar">@cur_con</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@pre_con</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@cur_con</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pre_con</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@contact</span>=<span class="ruby-ivar">@rm_con</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@c_old</span>
    <span class="ruby-ivar">@contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@c_id</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">contact_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>]=<span class="ruby-ivar">@c_id</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:invite</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])
        <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'contact_users/add_contact_success'</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'contact_users/gmail_contact_success'</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_contact_success-source -->
          
        </div>

        

        
      </div><!-- add_contact_success-method -->

    
      <div id="method-i-add_files_to_temp" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_files_to_temp</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>To add the multiple uploaded files to temp folder</p>
          

          
          <div class="method-source-code" id="add_files_to_temp-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1774</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_files_to_temp</span>
  <span class="ruby-identifier">orig_dir</span> = <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-node">&quot;#{Rails.root}/public/contact_users_upload&quot;</span>, <span class="ruby-value">:mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0770</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{Rails.root}/public/contact_users_upload&quot;</span>)
  <span class="ruby-identifier">dir</span> = <span class="ruby-node">&quot;#{Rails.root}/public/contact_users_upload/#{current_user.user_id}&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">original_filename</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">original_filename!</span>=<span class="ruby-string">''</span>
    <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">dir</span>,<span class="ruby-value">0755</span>)  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">dir</span>)
    <span class="ruby-identifier">f_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'.'</span>)
    <span class="ruby-identifier">renamed_file_path</span>=<span class="ruby-node">&quot;#{dir}/#{f_name[0]}_#{Time.now.strftime('%y%m%d%H%M%S')}.#{f_name[1]}&quot;</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:my_file</span>].<span class="ruby-identifier">tempfile</span>, <span class="ruby-identifier">renamed_file_path</span>)
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_files_to_temp-source -->
          
        </div>

        

        
      </div><!-- add_files_to_temp-method -->

    
      <div id="method-i-check_contact_exist" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_contact_exist</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="check_contact_exist-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 385</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_contact_exist</span>
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
  <span class="ruby-comment">#@user = User.find_by_email_address(params[:email])</span>
  <span class="ruby-ivar">@user</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>
    <span class="ruby-ivar">@contact_exist</span> =<span class="ruby-string">&quot;same_user&quot;</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">to_json</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@contact_user</span>
    <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-string">&quot;failed&quot;</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">to_json</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-string">&quot;success&quot;</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">to_json</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- check_contact_exist-source -->
          
        </div>

        

        
      </div><!-- check_contact_exist-method -->

    
      <div id="method-i-check_contact_invite" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_contact_invite</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="check_contact_invite-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 373</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_contact_invite</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>
    <span class="ruby-ivar">@user_exist</span> = <span class="ruby-string">&quot;failed&quot;</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user_exist</span>.<span class="ruby-identifier">to_json</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@user_exist</span> = <span class="ruby-string">&quot;success&quot;</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user_exist</span>.<span class="ruby-identifier">to_json</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- check_contact_invite-source -->
          
        </div>

        

        
      </div><!-- check_contact_invite-method -->

    
      <div id="method-i-check_repeated_users" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_repeated_users</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="check_repeated_users-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_repeated_users</span>
  <span class="ruby-identifier">contactss</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\&quot;&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-string">''</span>)
  <span class="ruby-identifier">contact</span>= <span class="ruby-identifier">contactss</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@rep_users</span> = <span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:check_fam_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:check_fam_id</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:check_fam_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
   <span class="ruby-ivar">@fam_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * FROM contact_users
                                      INNER JOIN contact_user_groups as fam
                                      ON contact_users.contact_id = fam.contact_user_id and fam.contact_group_id='#{params[:check_fam_id]}'&quot;</span>)
    <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">con</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">same_email</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span><span class="ruby-operator">==</span><span class="ruby-identifier">con</span>
    <span class="ruby-identifier">user_id</span>=<span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;group_id=?&quot;</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>]).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">present?</span> 
    <span class="ruby-identifier">email</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id=?&quot;</span>,<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:email_address</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">owner</span>=(<span class="ruby-identifier">email</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">==</span><span class="ruby-identifier">con</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">owner</span>
      <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-string">&quot;owner&quot;</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">same_email</span>
          <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-string">&quot;your&quot;</span>)
    <span class="ruby-keyword">else</span> 
     <span class="ruby-ivar">@fam_users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
     <span class="ruby-identifier">old_fam_net</span>=((<span class="ruby-identifier">user</span>.<span class="ruby-identifier">fam_accept_status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;t&quot;</span>)<span class="ruby-operator">&amp;&amp;</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">contact_email</span><span class="ruby-operator">==</span><span class="ruby-identifier">con</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">old_fam_net</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">empty?</span>
            <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;#{user.contact_email}&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rep_users</span><span class="ruby-operator">!=</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">contact_email</span>
              <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;,#{user.contact_email}&quot;</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">end</span>
     <span class="ruby-keyword">end</span>
     <span class="ruby-keyword">end</span><span class="ruby-comment">#same_email end</span>
     <span class="ruby-keyword">end</span><span class="ruby-comment">#do end</span>
  <span class="ruby-comment">#  elsif !cookies[:fam_network].nil? &amp;&amp; cookies[:fam_network]!=&quot;&quot;</span>
  <span class="ruby-comment">#     p &quot;22222222&quot;</span>
  <span class="ruby-comment">#  contact.each do |user|</span>
  <span class="ruby-comment">#    con_d = ContactUser.where(&quot;contact_email = ? and user_id = ?&quot;,user,current_user.user_id).last</span>
  <span class="ruby-comment">#    if con_d.present?</span>
  <span class="ruby-comment">#      chk_user = ContactUserGroup.where(&quot;contact_user_id = ? and contact_group_id =? and fam_accept_status =? &quot;,con_d.contact_id,cookies[:fam_network],true).last</span>
  <span class="ruby-comment">#      if chk_user.present?</span>
  <span class="ruby-comment">#        if @rep_users.empty?</span>
  <span class="ruby-comment">#          @rep_users.concat(&quot;#{user}&quot;)</span>
  <span class="ruby-comment">#        else</span>
  <span class="ruby-comment">#          @rep_users.concat(&quot;,#{user}&quot;)</span>
  <span class="ruby-comment">#        end</span>
  <span class="ruby-comment">#      end</span>
  <span class="ruby-comment">#    end</span>
  <span class="ruby-comment">#  end</span>
  <span class="ruby-comment"># end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;inv_provider&quot;</span>)
        <span class="ruby-identifier">chk_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_type = ? and email_address = ?&quot;</span>, <span class="ruby-string">'P'</span>,<span class="ruby-identifier">user</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">chk_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>, <span class="ruby-identifier">user</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">chk_user</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;#{user}&quot;</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@rep_users</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;,#{user}&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@rep_users</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- check_repeated_users-source -->
          
        </div>

        

        
      </div><!-- check_repeated_users-method -->

    
      <div id="method-i-check_same_users" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_same_users</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="check_same_users-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1281</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_same_users</span>
  <span class="ruby-identifier">contactss</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\&quot;&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; &quot;</span>, <span class="ruby-string">''</span>)
  <span class="ruby-identifier">contact</span>= <span class="ruby-identifier">contactss</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@same_users</span> = []
  <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
   <span class="ruby-ivar">@same_users</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;your&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span><span class="ruby-operator">==</span><span class="ruby-identifier">user</span> 
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@same_users</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- check_same_users-source -->
          
        </div>

        

        
      </div><!-- check_same_users-method -->

    
      <div id="method-i-contact_activate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_activate</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_activate-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1506</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_activate</span>
  <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cid</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:cid_m</span>] = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cid</span>])
    <span class="ruby-ivar">@invit_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email!</span>=<span class="ruby-string">''</span>
    
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-ivar">@email</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@uname</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#@user.collect{|c|c.user_name }</span>
    <span class="ruby-ivar">@cname</span> = <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_name</span>
    <span class="ruby-comment">#@old_email = User.find_by_email_address(@email)</span>

    <span class="ruby-ivar">@cont_uid</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_users</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>

    <span class="ruby-comment">#update status to invitor_list</span>
    <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">find_by_invited_email_and_user_id</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>,<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Accepted'</span>, <span class="ruby-value">:accepted_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#while accepting the request add invitor as friend to contact user</span>
    <span class="ruby-ivar">@chk_contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@chk_contact</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@create_contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:contact_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_name</span>, <span class="ruby-value">:contact_email=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>, <span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@cont_uid</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;famtivity&quot;</span>,  <span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:contact_user_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;friend&quot;</span>, <span class="ruby-value">:fam_user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:inserted_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>, <span class="ruby-value">:modified_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@cont_uid</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@chk_contact</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:contact_user_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'friend'</span>, <span class="ruby-value">:fam_user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:modified_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:login_usr</span>] = <span class="ruby-string">&quot;on&quot;</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:role_usr</span>]= <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_type</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:logged_in</span>] = <span class="ruby-string">&quot;yes&quot;</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:uid_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:username_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_name</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:email_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">email_address</span>
    <span class="ruby-ivar">@sent_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_users</span>
    <span class="ruby-comment"># sent_user_email = Base64.encode64(&quot;#{@sent_user.email_address}&quot;)</span>
    


    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:group</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">accept_status</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">true</span>
        <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:contact_user_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'friend'</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@fam</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">find_by_contact_group_id_and_contact_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:group</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:cid</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@fam</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">contact</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cid</span>])
        <span class="ruby-ivar">@fam_con</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_all_by_contact_email</span>(<span class="ruby-identifier">contact</span>.<span class="ruby-identifier">contact_email</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@fam</span>.<span class="ruby-identifier">fam_accept_status</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">true</span>
          <span class="ruby-comment">#@fam.fam_accept_status = true</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@fam_con</span>.<span class="ruby-identifier">nil?</span>
             <span class="ruby-ivar">@fam_con</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f_con</span><span class="ruby-operator">|</span>
             <span class="ruby-identifier">con_group</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">find_by_contact_user_id_and_contact_group_id</span>(<span class="ruby-identifier">f_con</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:group</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">f_con</span>.<span class="ruby-identifier">nil?</span>
                 <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">con_group</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">con_group</span>.<span class="ruby-identifier">fam_accept_status</span> = <span class="ruby-keyword">true</span>
                  <span class="ruby-identifier">con_group</span>.<span class="ruby-identifier">save!</span>
                 <span class="ruby-keyword">end</span>
             <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">user_usr</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>)
          <span class="ruby-ivar">@user_u</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@fam</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-identifier">url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
          <span class="ruby-ivar">@con</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;group_id=#{params[:group]}&quot;</span>).<span class="ruby-identifier">last</span>
          <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Accepted Invitation&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">contact_success_mail</span>(<span class="ruby-ivar">@user_u</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-ivar">@con</span>,<span class="ruby-ivar">@contact_users</span>,<span class="ruby-identifier">url</span>)
          <span class="ruby-ivar">@fam_row</span> = <span class="ruby-constant">FamNetworkRow</span>.<span class="ruby-identifier">find_by_contact_group_id_and_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:group</span>],<span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">user_id</span>)
      
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@fam</span>.<span class="ruby-identifier">fam_accept_user_id</span> = <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">user_id</span>
            <span class="ruby-ivar">@row</span> = <span class="ruby-constant">FamNetworkRow</span>.<span class="ruby-identifier">new</span>
            <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">contact_group_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:group</span>]
            <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">user_id</span>
            <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">save!</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-ivar">@fam</span>.<span class="ruby-identifier">save!</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_usr</span>
            <span class="ruby-identifier">add_sign_count</span> = <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">sign_in_count</span>
            <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">sign_in_count</span> = (<span class="ruby-identifier">add_sign_count</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">add_sign_count</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>) <span class="ruby-operator">?</span>  <span class="ruby-value">1</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">add_sign_count</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)
            <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">last_sign_in</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:follow_cat_val</span>]=<span class="ruby-ivar">@con</span>.<span class="ruby-identifier">group_name</span>
          <span class="ruby-ivar">@thank_msg</span> = <span class="ruby-string">&quot;Accept successfully!&quot;</span>
          <span class="ruby-comment">#flash[:notice]= &quot;Accept successfully!&quot;</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:follow_cat_val</span>]=<span class="ruby-ivar">@con</span>.<span class="ruby-identifier">group_name</span>
          <span class="ruby-comment">#redirect_to &quot;/?net_m=#{params[:cid_m]}&amp;fam_status=true&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">user_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">user_type</span> = <span class="ruby-string">&quot;P&quot;</span> 
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/contact_users&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/contact_users?mode=parent&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@thank_msg</span> = <span class="ruby-string">&quot;Your Already in Network!&quot;</span>
          <span class="ruby-comment">#flash[:notice]= &quot;Your Already in Network!&quot;</span>
          <span class="ruby-comment">#redirect_to &quot;/?fam_status=true&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">user_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_usr</span>.<span class="ruby-identifier">user_type</span> = <span class="ruby-string">&quot;P&quot;</span> 
              <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/contact_users&quot;</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/contact_users?mode=parent&quot;</span>
            <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#@con = ContactGroup.where(&quot;group_id=#{params[:group]}&quot;).last</span>
      <span class="ruby-comment">#cookies[:follow_cat_val]=@con.group_name</span>
      <span class="ruby-comment">#redirect_to &quot;/?net_m=#{params[:cid_m]}&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@invit_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email!</span>=<span class="ruby-string">''</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">accept_status</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:contact_user_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'friend'</span>)
          <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>]= <span class="ruby-string">&quot;Accept successfully!&quot;</span>
          <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-ivar">@email</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@uname</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-comment">#@user.collect{|c|c.user_name }</span>
          <span class="ruby-ivar">@cname</span> = <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_name</span>
          <span class="ruby-comment">#@old_email = User.find_by_email_address(@email)</span>

          <span class="ruby-ivar">@cont_uid</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_users</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>
      
          <span class="ruby-comment">#update status to invitor_list</span>
          <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">find_by_invited_email_and_user_id</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">contact_email</span>,<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Accepted'</span>, <span class="ruby-value">:accepted_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
          <span class="ruby-keyword">end</span>
          <span class="ruby-comment">#while accepting the request add invitor as friend to contact user</span>
          <span class="ruby-ivar">@chk_contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@chk_contact</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@create_contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:contact_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_name</span>, <span class="ruby-value">:contact_email=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>, <span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@cont_uid</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;famtivity&quot;</span>,  <span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:contact_user_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;friend&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@cont_uid</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@chk_contact</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:contact_user_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'friend'</span>)
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-keyword">true</span>
              <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Accept Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">accept_email</span>(<span class="ruby-ivar">@email</span>, <span class="ruby-ivar">@uname</span>, <span class="ruby-ivar">@cname</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>].<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:login_usr</span>] = <span class="ruby-string">&quot;on&quot;</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:role_usr</span>]= <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_type</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:logged_in</span>] = <span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
            <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:uid_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
            <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:username_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_name</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:email_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">email_address</span>
            <span class="ruby-ivar">@sent_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_users</span>
            <span class="ruby-identifier">sent_user_email</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-node">&quot;#{@sent_user.email_address}&quot;</span>)
            <span class="ruby-ivar">@thank_msg</span> = <span class="ruby-node">&quot;You are now friends with #{@sent_user.email_address}&quot;</span>
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/contact_users?mode=parent&amp;cid_m=#{Base64.encode64(params[:cid])}&amp;cont_msg=#{Base64.encode64(@thank_msg )}&quot;</span>

          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_url</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>]= <span class="ruby-string">&quot;Please contact the administaror!&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>].<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:login_usr</span>] = <span class="ruby-string">&quot;on&quot;</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:role_usr</span>]= <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_type</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:logged_in</span>] = <span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
            <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:uid_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
            <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:username_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_name</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:email_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">email_address</span>
            <span class="ruby-ivar">@thank_msg</span> = <span class="ruby-string">&quot;Please contact the administaror!&quot;</span>
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/contact_users?mode=parent&amp;cid_m=#{Base64.encode64(params[:cid])}&amp;cont_msg=#{Base64.encode64(@thank_msg )}&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/contact_users?mode=parent&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>]= <span class="ruby-string">&quot;You have already Accept successfully!&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:date_registered_usr</span>].<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:login_usr</span>] = <span class="ruby-string">&quot;on&quot;</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:role_usr</span>]= <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_type</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:logged_in</span>] = <span class="ruby-string">&quot;yes&quot;</span>
          <span class="ruby-identifier">session</span>[<span class="ruby-value">:user_id</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
          <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:uid_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_id</span>
          <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">permanent</span>[<span class="ruby-value">:username_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">user_name</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:email_usr</span>] = <span class="ruby-ivar">@invit_user</span>.<span class="ruby-identifier">email_address</span>
          <span class="ruby-ivar">@thank_msg</span> = <span class="ruby-string">&quot;You have already accept friend request!&quot;</span>
          <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/contact_users?mode=parent&amp;cid_m=#{Base64.encode64(params[:cid])}&amp;cont_msg=#{Base64.encode64(@thank_msg )}&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/contact_users?mode=parent&quot;</span>
        <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>]= <span class="ruby-string">&quot;Email Doesn't Exist!&quot;</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">root_url</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_activate-source -->
          
        </div>

        

        
      </div><!-- contact_activate-method -->

    
      <div id="method-i-contact_create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_create-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 449</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_create</span>
  <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>])
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo1</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#if params[:activity_image][:photo] !=&quot;&quot; &amp;&amp; params[:activity_image][:datafile] !=&quot;&quot;</span>
    <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_image</span>][<span class="ruby-value">:datafile</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_image</span>][<span class="ruby-value">:datafile</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_image</span>][<span class="ruby-value">:datafile</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_name</span>]
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>]
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">fam_user_id</span> = <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:select_invite</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:select_invite</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">invite_status</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]=<span class="ruby-string">&quot;create_invite&quot;</span>
    <span class="ruby-ivar">@success_message</span>=<span class="ruby-string">&quot;You've successfully added a contact in Famtivity! An email has been sent to the contact with the invite.&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]=<span class="ruby-string">&quot;create&quot;</span>
    <span class="ruby-ivar">@success_message</span>=<span class="ruby-string">&quot;You've successfully added a contact in Famtivity!&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_phone_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_phone_1</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_phone_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_phone_2</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span><span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_phone_3</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:profile_phone_3</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@contact_mobile</span> = <span class="ruby-node">&quot;#{params[:profile_phone_1]}-&quot;</span> <span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:profile_phone_2]}-&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:profile_phone_3]}&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_mobile</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;xxx-xxx-xxxx&quot;</span>
      <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_mobile</span> = <span class="ruby-ivar">@contact_mobile</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_user_type</span>= <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">choose_contact_type</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>], <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
  <span class="ruby-comment">#@contact_user.contact_mobile = params[:contact_mobile]</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_type</span> = <span class="ruby-string">&quot;famtivity&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-ivar">@contact_id</span> = <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_id</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
    <span class="ruby-comment"># add multiple grops for creat</span>
    <span class="ruby-ivar">@to</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>]
    <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_name</span>]
    <span class="ruby-identifier">message</span> =<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-identifier">old_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>,<span class="ruby-ivar">@to</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;invited_email = ?&quot;</span>,<span class="ruby-ivar">@to</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_group_ids</span>].<span class="ruby-identifier">blank?</span>)
      <span class="ruby-identifier">checked_group</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_group_ids</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
      <span class="ruby-identifier">checked_group</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">g_id</span><span class="ruby-operator">|</span>
        <span class="ruby-comment">#Assign this new contact to selected group</span>
        <span class="ruby-ivar">@group</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;group_id = ? and user_id = ?&quot;</span>,<span class="ruby-identifier">g_id</span>, <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">g_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">g_id!</span>=<span class="ruby-string">&quot;&quot;</span>

        <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-ivar">@group</span>.<span class="ruby-identifier">blank?</span>)
          <span class="ruby-ivar">@group_user</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_id</span>, <span class="ruby-value">:contact_group_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">group_id</span>)
          <span class="ruby-ivar">@group_user</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-ivar">@group_user</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@group_user</span>.<span class="ruby-identifier">fam_accept_user_id</span> = <span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">user_id</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-ivar">@group_user</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Non Friend&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_member_invite_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@group</span>,<span class="ruby-ivar">@to</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">old_user</span>,<span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-identifier">message</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Invite to join&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_to_join_famtivity</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@group</span>,<span class="ruby-ivar">@to</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-ivar">@contact_user</span>,<span class="ruby-identifier">message</span>)
          <span class="ruby-keyword">end</span> 
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">invitor_user</span>
          <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">invitor_list</span>(<span class="ruby-ivar">@to</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">'friend'</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">modified_date</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">invite_to_join_famtivity</span>(<span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@user</span>, <span class="ruby-identifier">message</span>, <span class="ruby-ivar">@get_current_url</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#UserMailer.delay(queue: &quot;Contact Create&quot;, priority: 2, run_at: 10.seconds.from_now).contact_register(@user, @get_current_url, @to, @contact_id, @name)</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:select_invite</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:select_invite</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Friend Request&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">friend_request</span>(<span class="ruby-ivar">@contact_user</span>,<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@get_current_url</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>  
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">'create_contact_success'</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_create-source -->
          
        </div>

        

        
      </div><!-- contact_create-method -->

    
      <div id="method-i-contact_create_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_create_message</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_create_message-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 870</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_create_message</span>
  <span class="ruby-ivar">@arr</span> = []
  <span class="ruby-ivar">@s_mail</span> = []
  <span class="ruby-comment">#@mails = params[:mail]</span>
  <span class="ruby-comment">#@contacts = @mails.split(&quot;,&quot;)</span>
  <span class="ruby-comment">#@smail = []</span>
  <span class="ruby-comment">#@arrs = ContactUser.find(@contacts)</span>
  <span class="ruby-comment">#@arrs.each do |a|</span>
  <span class="ruby-comment"># @tt =a.profile_id</span>
  <span class="ruby-comment">#  @smail &lt;&lt; @tt if !@tt.nil?</span>
  <span class="ruby-comment">#end</span>
  <span class="ruby-comment">#p @smail if !@smail.nil?</span>
  <span class="ruby-comment">#p &quot;1111111&quot;</span>
  <span class="ruby-comment">#finding contact users</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;undefined&quot;</span>)
    <span class="ruby-ivar">@mail</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>]
    <span class="ruby-ivar">@contact</span> = <span class="ruby-ivar">@mail</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
    <span class="ruby-ivar">@arr</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_id IN (?)&quot;</span>,<span class="ruby-ivar">@contact</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#finding group users</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:group_mail</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_mail</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;undefined&quot;</span>)
    <span class="ruby-identifier">group</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_mail</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
    <span class="ruby-ivar">@group</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;group_id IN (?)&quot;</span>,<span class="ruby-identifier">group</span>)
    <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">contact_users</span>}.<span class="ruby-identifier">flatten</span>
    <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@s_mail</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">user</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@s_mail</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@arr_list</span> = []
  <span class="ruby-comment">#finding activity group users</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:act_mail</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act_mail</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;undefined&quot;</span>)
    <span class="ruby-identifier">act</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:act_mail</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
    <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">act</span>).<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:activity_id</span>).<span class="ruby-identifier">to_a</span>
    <span class="ruby-ivar">@users</span> = []
    <span class="ruby-ivar">@activity_groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">activity</span> = <span class="ruby-identifier">find_activity_record</span>(<span class="ruby-identifier">group</span>[<span class="ruby-value">0</span>])
      <span class="ruby-ivar">@users</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">find_parents</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@users</span> = <span class="ruby-operator">!</span><span class="ruby-ivar">@users</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">flatten</span> <span class="ruby-operator">:</span> []
    <span class="ruby-ivar">@users</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@arr_list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">user</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@email</span>= <span class="ruby-ivar">@s_mail</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span><span class="ruby-identifier">f</span>[<span class="ruby-string">&quot;contact_email&quot;</span>]}
  <span class="ruby-ivar">@p_ids</span>= <span class="ruby-ivar">@s_mail</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span><span class="ruby-identifier">f</span>[<span class="ruby-string">&quot;profile_id&quot;</span>]}
  <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:act_mail</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act_mail</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;undefined&quot;</span>)
    <span class="ruby-ivar">@arr_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@email</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">user</span>[<span class="ruby-string">&quot;email_address&quot;</span>]
      <span class="ruby-ivar">@p_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">user</span>[<span class="ruby-string">&quot;fb_id&quot;</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@fb</span> = <span class="ruby-ivar">@p_ids</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; nil,&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/nil/</span>, <span class="ruby-string">''</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@fb</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;, &quot;</span>
    <span class="ruby-ivar">@fb_id</span>=<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@fb_id</span>=<span class="ruby-ivar">@fb</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@email_str</span>= <span class="ruby-ivar">@email</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-ivar">@email_split</span>=<span class="ruby-ivar">@email_str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; nil,&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&quot;/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/nil/</span>, <span class="ruby-string">''</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@email_split</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;, &quot;</span>
    <span class="ruby-ivar">@email_value</span>=<span class="ruby-ivar">@email_split</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;, &quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-ivar">@facebook</span>=<span class="ruby-string">&quot;empty&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@email_value</span> = <span class="ruby-ivar">@email_split</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#@email_value</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_create_message-source -->
          
        </div>

        

        
      </div><!-- contact_create_message-method -->

    
      <div id="method-i-contact_detail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_detail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /contact_users/1 GET /contact_users/1.json</p>
          

          
          <div class="method-source-code" id="contact_detail-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 404</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_detail</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;contacts&quot;</span>)
    <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
    <span class="ruby-ivar">@group_names</span> = <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:group_name</span>)
  <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;network&quot;</span>)
    <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
    <span class="ruby-ivar">@group_names</span> = <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:group_name</span>)
    <span class="ruby-ivar">@show_detail</span>=<span class="ruby-string">&quot;true&quot;</span>
  <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;network_owner&quot;</span>)
    <span class="ruby-ivar">@show_detail</span>=<span class="ruby-string">&quot;true&quot;</span>
    <span class="ruby-ivar">@fam_group</span>=<span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:group_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:network_owner_id</span>]).<span class="ruby-identifier">last</span>
    <span class="ruby-ivar">@fam_owner</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@fam_group</span>.<span class="ruby-identifier">user_id</span>)
  <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;users&quot;</span>)
    <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_detail-source -->
          
        </div>

        

        
      </div><!-- contact_detail-method -->

    
      <div id="method-i-contact_edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_edit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_edit-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 421</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_edit</span>
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">user_id</span>)
  <span class="ruby-ivar">@group_names</span> = <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:group_name</span>)
  <span class="ruby-ivar">@group_ids</span> = <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_groups</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:group_id</span>)
  <span class="ruby-ivar">@u_groups</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">contact_groups</span>
  <span class="ruby-ivar">@u_group_name</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">group_id</span>).<span class="ruby-identifier">group_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">group_id</span>.<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_edit-source -->
          
        </div>

        

        
      </div><!-- contact_edit-method -->

    
      <div id="method-i-contact_fail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_fail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_fail-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 738</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_fail</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_fail-source -->
          
        </div>

        

        
      </div><!-- contact_fail-method -->

    
      <div id="method-i-contact_import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_import</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_import-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 677</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_import</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_import-source -->
          
        </div>

        

        
      </div><!-- contact_import-method -->

    
      <div id="method-i-contact_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_index-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_index</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;delete&quot;</span>
      <span class="ruby-ivar">@del</span>=<span class="ruby-keyword">true</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;group&quot;</span>
      <span class="ruby-ivar">@grp</span>=<span class="ruby-keyword">true</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;group_create&quot;</span>
      <span class="ruby-ivar">@net</span>=<span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:friend_mode</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@click_mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
  <span class="ruby-ivar">@all_users</span> = <span class="ruby-ivar">@contact_users</span>
  <span class="ruby-ivar">@contact_groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ?&quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;group_name ASC&quot;</span>)
  
  <span class="ruby-comment"># Finding Activity Groups</span>
  <span class="ruby-comment"># @arr = []</span>
  <span class="ruby-comment"># activity_groups = ActivityAttendDetail.where(:user_id=&gt;current_user.user_id)</span>
  <span class="ruby-comment"># @activity_groups = activity_groups.group_by(&amp;:activity_id).to_a</span>
  <span class="ruby-comment"># @arr = activity_groups.map(&amp;:user_id)</span>
  <span class="ruby-comment"># @activity_users = User.where(&quot;user_id IN (?)&quot;,@arr)</span>
  <span class="ruby-identifier">activity_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:active_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Active&quot;</span>)
  <span class="ruby-identifier">act_ids</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">activity_list</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">activity_list</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>) <span class="ruby-operator">:</span> []
  <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">act_ids</span>).<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:activity_id</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-ivar">@users</span> = []
  <span class="ruby-identifier">activity_ids</span> = []
  <span class="ruby-ivar">@activity_groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity</span> = <span class="ruby-identifier">find_activity_record</span>(<span class="ruby-identifier">group</span>[<span class="ruby-value">0</span>])
    <span class="ruby-identifier">activity_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-ivar">@users</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">find_parents</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-identifier">activity_ids</span> = <span class="ruby-identifier">activity_ids</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-ivar">@activity_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id IN (?)&quot;</span>,<span class="ruby-ivar">@users</span>)
  <span class="ruby-identifier">activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">activity_ids</span>)
  <span class="ruby-comment"># Auto complete</span>
  <span class="ruby-ivar">@groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find_all_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:group_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@friends</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_all_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@activity_users</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">activities</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:activity_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@fam_post</span> = <span class="ruby-constant">FamNetworkRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:contact_group_id</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-ivar">@fusers</span>=[]
  <span class="ruby-ivar">@fam_post</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fam</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@f_name</span>=<span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;group_id=?&quot;</span>,<span class="ruby-identifier">fam</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-ivar">@fusers</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@f_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@f_name</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@fusers</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@fusers</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@famnetwork</span>=<span class="ruby-ivar">@fusers</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@contact_groups</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_groups</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@famnetwork</span>=<span class="ruby-ivar">@fusers</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_groups</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@famnetwork</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@total_groups</span> = <span class="ruby-ivar">@contact_groups</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@famnetwork</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_groups</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@total_groups</span> = <span class="ruby-ivar">@contact_groups</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@famnetwork</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@total_groups</span> = <span class="ruby-ivar">@famnetwork</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@all_users</span> = <span class="ruby-ivar">@contact_users</span>
  <span class="ruby-ivar">@non_members</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and contact_user_type = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">&quot;non_member&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@non_members</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@non_members</span><span class="ruby-operator">!=</span>[] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@non_members</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@non_mem</span> = <span class="ruby-ivar">@non_members</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@non_mem</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@members_l</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and contact_user_type = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">&quot;member&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@members_l</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@members_l</span><span class="ruby-operator">!=</span>[] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@members_l</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@mem_l</span> = <span class="ruby-ivar">@members_l</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@mem_l</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@friends_l</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and contact_user_type = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">&quot;friend&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@friends_l</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@friends_l</span><span class="ruby-operator">!=</span>[] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@friends_l</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@frd_l</span> = <span class="ruby-ivar">@friends_l</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@frd_l</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]=<span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] 
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]=<span class="ruby-string">&quot;provider&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@file</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:checked</span>]
  <span class="ruby-ivar">@test</span> =<span class="ruby-string">&quot;index&quot;</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]=<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">csv</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">xls</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_index-source -->
          
        </div>

        

        
      </div><!-- contact_index-method -->

    
      <div id="method-i-contact_invite" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_invite</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_invite-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1077</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_invite</span>
  <span class="ruby-ivar">@contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@contact_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-ivar">@user</span>= <span class="ruby-identifier">current_user</span>
  <span class="ruby-ivar">@to</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>]
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]

  <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>])

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-keyword">if</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">contact_invite</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@get_current_url</span>, <span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@contact_id</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">contact_invite</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@get_current_url</span>, <span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@contact_id</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_invite-source -->
          
        </div>

        

        
      </div><!-- contact_invite-method -->

    
      <div id="method-i-contact_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_list-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 798</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_list</span>
  <span class="ruby-ivar">@contacts</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'omnicontacts.contacts'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_list-source -->
          
        </div>

        

        
      </div><!-- contact_list-method -->

    
      <div id="method-i-contact_send_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_send_message</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_send_message-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 944</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_send_message</span>
  <span class="ruby-ivar">@mail</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mail</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;@&quot;</span>)
    <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span>]
    <span class="ruby-ivar">@message</span> = <span class="ruby-node">&quot;Hi #{@name.titlecase+&quot;\n\n&quot;}Please join me on famtivity, the family activity network! #{&quot;\n&quot;}I think you'll really enjoy it.#{&quot;\n\n&quot;+current_user.user_name.titlecase} &quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_send_message-source -->
          
        </div>

        

        
      </div><!-- contact_send_message-method -->

    
      <div id="method-i-contact_store" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_store</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_store-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 681</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_store</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)

  <span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">co</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">val</span> = <span class="ruby-identifier">co</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>)
    <span class="ruby-ivar">@friend</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:contact_email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>], <span class="ruby-value">:contact_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>[<span class="ruby-value">1</span>],  <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span> )
    <span class="ruby-ivar">@friend</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#redirect_to contact_users_path</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;contact_store&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_store-source -->
          
        </div>

        

        
      </div><!-- contact_store-method -->

    
      <div id="method-i-contact_type_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_type_filter</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_type_filter-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1702</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_type_filter</span>
  <span class="ruby-identifier">mode</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@key_word</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:key_word</span>]
  <span class="ruby-ivar">@refresh</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:refresh</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">''</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:refresh</span>]
  <span class="ruby-comment"># Finding Activity Groups</span>
  <span class="ruby-comment"># @arr = []</span>
  <span class="ruby-comment"># activity_groups = ActivityAttendDetail.where(:user_id=&gt;current_user.user_id)</span>
  <span class="ruby-comment"># @activity_groups = activity_groups.group_by(&amp;:activity_id).to_a</span>
  <span class="ruby-comment"># @arr = activity_groups.map(&amp;:user_id)</span>
  <span class="ruby-comment"># @activity_users = User.where(&quot;user_id IN (?)&quot;,@arr)</span>
  <span class="ruby-identifier">activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:active_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Active&quot;</span>)
  <span class="ruby-identifier">act_ids</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">activities</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">activities</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>) <span class="ruby-operator">:</span> []
  <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">act_ids</span>).<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:activity_id</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-ivar">@users</span> = []
  <span class="ruby-ivar">@activity_groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity</span> = <span class="ruby-identifier">find_activity_record</span>(<span class="ruby-identifier">group</span>[<span class="ruby-value">0</span>])
    <span class="ruby-ivar">@users</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">find_parents</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-comment">#end</span>

  <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@key_word</span> <span class="ruby-operator">==</span> <span class="ruby-string">'all'</span>)
    <span class="ruby-ivar">@gbox</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:gbox</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gbox</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;contact_name ASC&quot;</span>)
    <span class="ruby-ivar">@activity_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id IN (?)&quot;</span>,<span class="ruby-ivar">@users</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id=? and contact_user_type = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>,<span class="ruby-ivar">@key_word</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;contact_name ASC&quot;</span>)
    <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@all_users</span> = <span class="ruby-ivar">@contact_users</span>
  <span class="ruby-ivar">@non_members</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and contact_user_type = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">&quot;non_member&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@non_members</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@non_members</span><span class="ruby-operator">!=</span>[] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@non_members</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@non_mem</span> = <span class="ruby-ivar">@non_members</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@non_mem</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@members_l</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and contact_user_type = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">&quot;member&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@members_l</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@members_l</span><span class="ruby-operator">!=</span>[] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@members_l</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@mem_l</span> = <span class="ruby-ivar">@members_l</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@mem_l</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@friends_l</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and contact_user_type = ?&quot;</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">&quot;friend&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@friends_l</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@friends_l</span><span class="ruby-operator">!=</span>[] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@friends_l</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@frd_l</span> = <span class="ruby-ivar">@friends_l</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@frd_l</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@contact_groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ?&quot;</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;group_name ASC&quot;</span>)

  <span class="ruby-ivar">@fam_post</span> = <span class="ruby-constant">FamNetworkRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:contact_group_id</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-ivar">@fusers</span>=[]
  <span class="ruby-ivar">@fam_post</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fam</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@f_name</span>=<span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;group_id=?&quot;</span>,<span class="ruby-identifier">fam</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-ivar">@fusers</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@f_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@f_name</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@fusers</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@fusers</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@famnetwork</span>=<span class="ruby-ivar">@fusers</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@contact_groups</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_groups</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@famnetwork</span>=<span class="ruby-ivar">@fusers</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_type_filter-source -->
          
        </div>

        

        
      </div><!-- contact_type_filter-method -->

    
      <div id="method-i-contact_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>PUT /contact_users/1 PUT /contact_users/1.json</p>
          

          
          <div class="method-source-code" id="contact_update-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 554</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_update</span>
  <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>][<span class="ruby-value">:contact_email</span>])
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>][<span class="ruby-value">:contact</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>][<span class="ruby-value">:contact</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>][<span class="ruby-value">:contact</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>][<span class="ruby-value">:contact_name</span>]
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>][<span class="ruby-value">:contact_email</span>]
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">fam_user_id</span> = <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@mobile_value</span> = <span class="ruby-node">&quot;#{params[:contact_user][:profile_phone_1]}-&quot;</span> <span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:contact_user][:profile_phone_2]}-&quot;</span> <span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:contact_user][:profile_phone_3]}&quot;</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_mobile</span> = <span class="ruby-ivar">@mobile_value</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_user_type</span>= <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">choose_contact_type</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>][<span class="ruby-value">:contact_email</span>], <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
  <span class="ruby-comment">#finding groups</span>
  <span class="ruby-ivar">@group_ids</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_group_ids</span>]
  <span class="ruby-ivar">@group</span> = <span class="ruby-ivar">@group_ids</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;user_id=? and group_id IN (?)&quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>], <span class="ruby-ivar">@group</span>])
  <span class="ruby-comment">#assign contacts to groups</span>
  <span class="ruby-comment"># msg = &quot;#{@contact_user.contact_name.capitalize} is already assigned to &quot;</span>
  <span class="ruby-comment"># @error_arr = []</span>
  <span class="ruby-comment"># @groups.each do |group|</span>
  <span class="ruby-comment"># @group_user = ContactUserGroup.where(&quot;user_id = ? and contact_group_id = ? and contact_user_id = ?&quot;, cookies[:uid_usr], group.group_id , @contact_user.contact_id)</span>
  <span class="ruby-comment"># if(@group_user.blank?)</span>
  <span class="ruby-comment"># @group_user = ContactUserGroup.new(:user_id =&gt; cookies[:uid_usr], :contact_user_id =&gt; @contact_user.contact_id, :contact_group_id =&gt; group.group_id)</span>
  <span class="ruby-comment"># @group_user.inserted_date = Time.now</span>
  <span class="ruby-comment"># @group_user.modified_date = Time.now</span>
  <span class="ruby-comment"># @group_user.save</span>
  <span class="ruby-comment"># else</span>
  <span class="ruby-comment"># @error_arr &lt;&lt; &quot;#{group.group_name}&quot;</span>
  <span class="ruby-comment"># end</span>
  <span class="ruby-comment"># end</span>
  <span class="ruby-comment">#@error_msg = msg + @error_arr.join(&quot;,&quot;) if !@error_arr.blank?</span>
  <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-ivar">@error_arr</span> = []
  <span class="ruby-ivar">@error_msg</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:update_group_ids</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span>
    <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_user_groups</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span> <span class="ruby-identifier">g</span>.<span class="ruby-identifier">delete</span>}
    <span class="ruby-operator">!</span><span class="ruby-ivar">@groups</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@group_user</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>], <span class="ruby-value">:contact_user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_id</span>, <span class="ruby-value">:contact_group_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">group</span>.<span class="ruby-identifier">group_id</span>)
      <span class="ruby-ivar">@group_user</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@group_user</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@group_user</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">'edit_contact_success'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_update-source -->
          
        </div>

        

        
      </div><!-- contact_update-method -->

    
      <div id="method-i-create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>POST /contact_users POST /contact_users.json</p>
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 536</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>])

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-ivar">@contact_user</span>, <span class="ruby-value">:notice</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Contact user was successfully created.'</span> }
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-value">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_user</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:created</span>, <span class="ruby-value">:location</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_user</span> }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> { <span class="ruby-identifier">render</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;new&quot;</span> }
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> { <span class="ruby-identifier">render</span> <span class="ruby-value">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">errors</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:unprocessable_entity</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create-source -->
          
        </div>

        

        
      </div><!-- create-method -->

    
      <div id="method-i-csv_contacts" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">csv_contacts</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>export csv contacts</p>
          

          
          <div class="method-source-code" id="csv_contacts-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 237</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">csv_contacts</span>
  <span class="ruby-ivar">@click_mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
  <span class="ruby-ivar">@file</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:checked</span>]
  <span class="ruby-ivar">@test</span> =<span class="ruby-string">&quot;index&quot;</span>
  <span class="ruby-ivar">@con_group</span>=[]
  <span class="ruby-ivar">@contact_users</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">con</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_name</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">c_name</span> = <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_name</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">name</span>= <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'@'</span>)
      <span class="ruby-identifier">c_name</span>=<span class="ruby-identifier">name</span>[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">c_name</span> = <span class="ruby-string">&quot;-&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">c_email</span> = <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_email</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">c_email</span> = <span class="ruby-string">&quot;-&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_mobile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_mobile</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">c_mobie</span> = <span class="ruby-identifier">con</span>.<span class="ruby-identifier">contact_mobile</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">c_mobie</span> = <span class="ruby-string">&quot;-&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">row</span> = [<span class="ruby-identifier">c_name</span>,<span class="ruby-identifier">c_email</span>, <span class="ruby-identifier">c_mobie</span>]
    <span class="ruby-ivar">@con_group</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">row</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">csv</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- csv_contacts-source -->
          
        </div>

        

        
      </div><!-- csv_contacts-method -->

    
      <div id="method-i-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 650</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>
  <span class="ruby-ivar">@to_delete</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-ivar">@group_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:groupid</span>]
  <span class="ruby-ivar">@contact</span>= <span class="ruby-ivar">@to_delete</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@group_delete</span>=<span class="ruby-ivar">@group_id</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete-source -->
          
        </div>

        

        
      </div><!-- delete-method -->

    
      <div id="method-i-delete_empty" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_empty</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="delete_empty-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 657</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_empty</span>
  <span class="ruby-ivar">@type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>]
  <span class="ruby-ivar">@to_delete</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_empty-source -->
          
        </div>

        

        
      </div><!-- delete_empty-method -->

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>DELETE /contact_users/1 DELETE /contact_users/1.json</p>
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 600</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@contact_flag</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@group_flag</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">contact</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:con_act</span>]=<span class="ruby-string">&quot;delete&quot;</span>
  <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">c!</span>=<span class="ruby-string">''</span>
      <span class="ruby-ivar">@contact_flag</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>)
      <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]], <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
  <span class="ruby-ivar">@all_users</span> = <span class="ruby-ivar">@contact_users</span>
  <span class="ruby-comment">#group delete</span>
  <span class="ruby-identifier">groupid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:groupid</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:groupid</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:groupid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-identifier">groupid</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gval</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">gval!</span>=<span class="ruby-string">''</span>
      <span class="ruby-ivar">@group_flag</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@group</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">gval</span>)
<span class="ruby-ivar">@bef_del</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_group_id=? and fam_accept_status=?&quot;</span>,<span class="ruby-ivar">@group</span>.<span class="ruby-identifier">group_id</span>,<span class="ruby-keyword">true</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:contact_user_id</span>)
<span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Delete&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">fam_network_delete_to_owner</span>(<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@group</span>.<span class="ruby-identifier">group_name</span>,<span class="ruby-ivar">@get_current_url</span>)
      <span class="ruby-comment">#Notification after deleting the Fam Network</span>
<span class="ruby-constant">MessageThread</span>.<span class="ruby-identifier">send_notification_network</span>(<span class="ruby-ivar">@bef_del</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@group</span>,<span class="ruby-ivar">@get_current_url</span>)
      <span class="ruby-comment">#Notification after deleting the Fam Network</span>
      <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">groupid</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">groupid</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-ivar">@contact_groups</span>= <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>,  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]], <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;group_name ASC&quot;</span>)
  <span class="ruby-comment"># Finding Activity Groups</span>
  <span class="ruby-identifier">activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:active_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Active&quot;</span>)
  <span class="ruby-identifier">act_ids</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">activities</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">activities</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>) <span class="ruby-operator">:</span> []
  <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">act_ids</span>).<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:activity_id</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-ivar">@users</span> = []
  <span class="ruby-ivar">@activity_groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity</span> = <span class="ruby-identifier">find_activity_record</span>(<span class="ruby-identifier">group</span>[<span class="ruby-value">0</span>])
    <span class="ruby-ivar">@users</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">find_parents</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-ivar">@activity_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id IN (?)&quot;</span>,<span class="ruby-ivar">@users</span>)
  <span class="ruby-comment">#end</span>
  <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-string">&quot;failed&quot;</span>
  <span class="ruby-comment">#render :text=&gt; @contact_users.to_json</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy-source -->
          
        </div>

        

        
      </div><!-- destroy-method -->

    
      <div id="method-i-edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /contact_users/1/edit</p>
          

          
          <div class="method-source-code" id="edit-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 530</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit</span>
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit-source -->
          
        </div>

        

        
      </div><!-- edit-method -->

    
      <div id="method-i-facebook_contact_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">facebook_contact_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="facebook_contact_list-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 789</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">facebook_contact_list</span>
  <span class="ruby-ivar">@contacts</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'omnicontacts.contacts'</span>]
  <span class="ruby-ivar">@user_contacts</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'omnicontacts.user'</span>]
  <span class="ruby-comment">#code= request.env['omnicontacts.access_token']</span>
  <span class="ruby-comment">#@code= request.env[&quot;QUERY_STRING&quot;]</span>
  <span class="ruby-comment">#@code= request.env['omniauth.auth']</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- facebook_contact_list-source -->
          
        </div>

        

        
      </div><!-- facebook_contact_list-method -->

    
      <div id="method-i-facebook_contact_success" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">facebook_contact_success</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="facebook_contact_success-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 807</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">facebook_contact_success</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@c_old</span> =[]
    <span class="ruby-ivar">@sublist</span> = []
    <span class="ruby-ivar">@sublist</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>]
    <span class="ruby-ivar">@s_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>].<span class="ruby-identifier">count</span>
    <span class="ruby-ivar">@c_id</span> =[]
    <span class="ruby-ivar">@pre_con</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:subList</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">co</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">val</span> = <span class="ruby-identifier">co</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;^&quot;</span>)
      <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_fb_id</span>(<span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>])
      <span class="ruby-ivar">@old_contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_profile_id_and_user_id</span>(<span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_contact</span>
        <span class="ruby-ivar">@friend</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:profile_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>], <span class="ruby-value">:contact_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">val</span>[<span class="ruby-value">1</span>] , <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:contact_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;facebook&quot;</span>, <span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>, <span class="ruby-value">:modified_date</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
        <span class="ruby-ivar">@friend</span>.<span class="ruby-identifier">contact_user_type</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">fb_choose_contact_type</span>(<span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-ivar">@friend</span>.<span class="ruby-identifier">fam_user_id</span> = <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@friend</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@c_old</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@old_contact</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@g1</span> =<span class="ruby-ivar">@c_old</span>.<span class="ruby-identifier">count</span>
      <span class="ruby-ivar">@group</span> = <span class="ruby-ivar">@s_value</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@g1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@cur_con</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])

    <span class="ruby-ivar">@rm_con</span>=<span class="ruby-ivar">@cur_con</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@pre_con</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@cur_con</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pre_con</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@contact</span>=<span class="ruby-ivar">@rm_con</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@c_old</span>
    <span class="ruby-ivar">@contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@c_id</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">contact_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>]=<span class="ruby-ivar">@c_id</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'contact_users/facebook_contact_success'</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
    <span class="ruby-comment">#format.xml {render :xml =&gt; @contacts.to_xml} #access_token</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- facebook_contact_success-source -->
          
        </div>

        

        
      </div><!-- facebook_contact_success-method -->

    
      <div id="method-i-fam_member_activate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fam_member_activate</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="fam_member_activate-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fam_member_activate</span>
  <span class="ruby-identifier">sent_user_id</span> = <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">decode64</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">sent_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">sent_user_id</span>)
  <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:c_email</span>]).<span class="ruby-identifier">first</span>
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_email = ? and user_id = ?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:c_email</span>],<span class="ruby-identifier">sent_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_user</span>
    <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:contact_user_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'friend'</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:contact_email</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>, <span class="ruby-value">:contact_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span>,  <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sent_user</span>.<span class="ruby-identifier">id</span>,<span class="ruby-value">:accept_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_user_type</span> = <span class="ruby-string">'friend'</span>
    <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>]= <span class="ruby-string">&quot;Accept successfully!&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sent_user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-keyword">true</span>
    <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Accept Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">accept_email</span>(<span class="ruby-identifier">sent_user</span>.<span class="ruby-identifier">email_address</span>, <span class="ruby-identifier">sent_user</span>.<span class="ruby-identifier">user_name</span>, <span class="ruby-ivar">@contact_user</span>.<span class="ruby-identifier">contact_name</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#redirect_to root_url</span>
  <span class="ruby-identifier">invitedid</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:sent_user</span>]
  <span class="ruby-identifier">user_email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:c_email</span>]
  <span class="ruby-identifier">parent_reg</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/?sent_user=#{invitedid}&amp;sent_user_email=#{user_email}&amp;parent_reg=#{parent_reg}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- fam_member_activate-source -->
          
        </div>

        

        
      </div><!-- fam_member_activate-method -->

    
      <div id="method-i-fb_invite" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fb_invite</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="fb_invite-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 845</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fb_invite</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:reciver_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:reciver_id</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:reciver_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@fb_reciver</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:reciver_id</span>])
    <span class="ruby-ivar">@fb_reciver</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>);
    <span class="ruby-ivar">@c_page</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:c_page</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:c_page</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:reciver_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@reld</span>=<span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@fb_val</span>=<span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@con</span>=[]
    <span class="ruby-ivar">@all_con</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@all_con</span>=<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@sp_con</span>=<span class="ruby-ivar">@all_con</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'&amp;'</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@sp_con</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_id=?&quot;</span>,<span class="ruby-identifier">d</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-ivar">@con</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@contact</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@sp_con</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
    <span class="ruby-ivar">@contacts</span> = <span class="ruby-ivar">@con</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@con</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- fb_invite-source -->
          
        </div>

        

        
      </div><!-- fb_invite-method -->

    
      <div id="method-i-file_import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_import</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>import csv contacts</p>
          

          
          <div class="method-source-code" id="file_import-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 271</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_import</span>
  <span class="ruby-ivar">@before_import</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] )
  <span class="ruby-ivar">@before</span>= <span class="ruby-ivar">@before_import</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">userid</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
  <span class="ruby-identifier">file</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:csvfile</span>]
  <span class="ruby-ivar">@test</span>=[]
  <span class="ruby-ivar">@csvlist</span> = []
  <span class="ruby-ivar">@c_id</span>=[]
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment">#numrows = CSV.read(file.path)#.size</span>
    <span class="ruby-constant">CSV</span>.<span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">headers</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">contact</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">to_hash</span> <span class="ruby-comment"># exclude the price field</span>
      <span class="ruby-identifier">contact_user</span> =<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_name=? and user_id=?&quot;</span>,<span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
      <span class="ruby-ivar">@old_contact</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>],<span class="ruby-identifier">userid</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>].<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@test</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>]
      <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@test</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>]
      <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@test</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>]
      <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@csvlist</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@old_contact</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@old_contact</span>
        <span class="ruby-ivar">@csvlist</span>.<span class="ruby-identifier">count</span>
      <span class="ruby-comment">#if contact_user.count == 1</span>
      <span class="ruby-comment">#  contact_user.first.update_attributes(contact)</span>
      <span class="ruby-comment">#else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_contact</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;friend_email&quot;</span>
          <span class="ruby-ivar">@olduser</span>= <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>,<span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>])
          <span class="ruby-ivar">@oldcontact</span>= <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_email = ? and user_id = ?&quot;</span>,<span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>],<span class="ruby-identifier">userid</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@olduser</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@oldcontact</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-ivar">@contact_user_type</span> = <span class="ruby-string">&quot;friend&quot;</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@olduser</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-ivar">@contact_user_type</span> = <span class="ruby-string">&quot;member&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@contact_user_type</span> = <span class="ruby-string">&quot;non_member&quot;</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">c_user</span>= <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_name</span>= <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>]  <span class="ruby-keyword">if</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;friend_name&quot;</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_email</span>= <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>]
          <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">10</span>)
            <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_mobile</span>= <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>]
          <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">12</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">3</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;-&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">7</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;-&quot;</span>)
            <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_mobile</span>= <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>]
          <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">12</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">3</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;.&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">7</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;.&quot;</span>)
            <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_mobile</span>= <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>]
          <span class="ruby-keyword">elsif</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">16</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">0</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;(&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">4</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;)&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">5</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;(&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">9</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;)&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">10</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;(&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>].<span class="ruby-identifier">at</span>(<span class="ruby-value">15</span>)<span class="ruby-operator">==</span><span class="ruby-string">&quot;)&quot;</span>)
            <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_mobile</span>= <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Mobile Number&quot;</span>]
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_user_type</span>= <span class="ruby-ivar">@contact_user_type</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">user_id</span>= <span class="ruby-identifier">userid</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">inserted_date</span>= <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">modified_date</span>= <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-ivar">@csvlist</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c_user</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">c_user</span>
          <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
          <span class="ruby-ivar">@contact_id</span> = <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_id</span>
          <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
          <span class="ruby-ivar">@to</span> = <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>]
          <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Name&quot;</span>]
          <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">contact</span>[<span class="ruby-string">&quot;Email&quot;</span>])
          <span class="ruby-identifier">message</span> =<span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-comment">#  if @old_email.nil?</span>
          <span class="ruby-comment">#     UserMailer.delay(queue: &quot;Contact Create&quot;, priority: 2, run_at: 10.seconds.from_now).contact_register(@user, @get_current_url, @to, @contact_id, @name)</span>
          <span class="ruby-comment"># end</span>
          <span class="ruby-identifier">old_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>,<span class="ruby-ivar">@to</span>).<span class="ruby-identifier">first</span>
          <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;invited_email = ?&quot;</span>,<span class="ruby-ivar">@to</span>).<span class="ruby-identifier">first</span>
          <span class="ruby-comment">#if !old_user.present?</span>
          <span class="ruby-comment">#  if !invitor_user</span>
          <span class="ruby-comment">#    InvitorList.invitor_list(@to,current_user.user_id,'friend')</span>
          <span class="ruby-comment">#  else</span>
          <span class="ruby-comment">#    invitor_user.update_attributes(modified_date: Time.now)</span>
          <span class="ruby-comment">#  end</span>
          <span class="ruby-comment">#  UserMailer.delay(queue: &quot;invite Message&quot;, priority: 2, run_at: 10.seconds.from_now).invite_to_join_famtivity(@to, @user, message, @get_current_url)</span>
          <span class="ruby-comment">#else</span>
          <span class="ruby-comment">#  UserMailer.delay(queue: &quot;Contact Create&quot;, priority: 2, run_at: 10.seconds.from_now).contact_register(@user, @get_current_url, @to, @contact_id, @name)</span>
          <span class="ruby-comment">#end</span>
        <span class="ruby-keyword">end</span>
     <span class="ruby-comment"># end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@csvlist</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@c_id</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">contact_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>]=<span class="ruby-ivar">@c_id</span>
    <span class="ruby-ivar">@test</span>.<span class="ruby-identifier">count</span>
    <span class="ruby-ivar">@full_value</span>=<span class="ruby-ivar">@test</span>.<span class="ruby-identifier">count</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@test</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@after_import</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] )
    <span class="ruby-ivar">@after</span>=<span class="ruby-ivar">@after_import</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-ivar">@now</span>=<span class="ruby-ivar">@after</span><span class="ruby-operator">-</span><span class="ruby-ivar">@before</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@after</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@before</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@fail</span>=<span class="ruby-ivar">@full_value</span><span class="ruby-operator">-</span><span class="ruby-ivar">@now</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@test</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-ivar">@after_import</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] )
    <span class="ruby-ivar">@after</span>=<span class="ruby-ivar">@after_import</span>.<span class="ruby-identifier">length</span>      
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- file_import-source -->
          
        </div>

        

        
      </div><!-- file_import-method -->

    
      <div id="method-i-gmail_import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">gmail_import</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="gmail_import-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1375</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">gmail_import</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- gmail_import-source -->
          
        </div>

        

        
      </div><!-- gmail_import-method -->

    
      <div id="method-i-import_contact" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">import_contact</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="import_contact-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1346</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">import_contact</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:login</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:login</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>].<span class="ruby-identifier">blank?</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-ivar">@sites</span> = {<span class="ruby-string">&quot;hotmail&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Contacts</span><span class="ruby-operator">::</span><span class="ruby-constant">Hotmail</span>, <span class="ruby-string">&quot;gmail&quot;</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Contacts</span><span class="ruby-operator">::</span><span class="ruby-constant">Gmail</span>, <span class="ruby-string">&quot;yahoo&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Contacts</span><span class="ruby-operator">::</span><span class="ruby-constant">Yahoo</span> }
      <span class="ruby-identifier">authenticated_user</span> = <span class="ruby-ivar">@sites</span>[<span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>]].<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:login</span>], <span class="ruby-identifier">params</span>[<span class="ruby-value">:password</span>])
      <span class="ruby-ivar">@contacts</span> = <span class="ruby-identifier">authenticated_user</span>.<span class="ruby-identifier">contacts</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">authenticated_user</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:from</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>]
      <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'contact_users/_contact_list'</span>, <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-comment">#flash.now[:error] = &quot;Password and mail id mismatch&quot;</span>
      <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:from</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>]
        <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:template</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'contact_users/_new_import'</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#flash.now[:error]=&quot;Please enter all fields&quot;</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:from</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:from</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;new_import&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- import_contact-source -->
          
        </div>

        

        
      </div><!-- import_contact-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /contact_users GET /contact_users.json</p>
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-ivar">@click_mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
  <span class="ruby-ivar">@all_users</span> = <span class="ruby-ivar">@contact_users</span>
  <span class="ruby-ivar">@test</span> =<span class="ruby-string">&quot;index&quot;</span>
  <span class="ruby-ivar">@contact_groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ?&quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;group_name ASC&quot;</span>)
  <span class="ruby-comment"># Finding Activity Groups</span>
  <span class="ruby-comment"># @arr = []</span>
  <span class="ruby-comment"># activity_groups = ActivityAttendDetail.where(:user_id=&gt;current_user.user_id)</span>
  <span class="ruby-comment"># @activity_groups = activity_groups.group_by(&amp;:activity_id).to_a</span>
  <span class="ruby-comment"># @arr = activity_groups.map(&amp;:user_id)</span>
  <span class="ruby-comment"># @activity_users = User.where(&quot;user_id IN (?)&quot;,@arr)</span>
  <span class="ruby-identifier">activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:active_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Active&quot;</span>)
  <span class="ruby-identifier">act_ids</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">activities</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">activities</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>) <span class="ruby-operator">:</span> []
  <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">act_ids</span>).<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:activity_id</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-ivar">@users</span> = []
  <span class="ruby-ivar">@activity_groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity</span> = <span class="ruby-identifier">find_activity_record</span>(<span class="ruby-identifier">group</span>[<span class="ruby-value">0</span>])
    <span class="ruby-ivar">@users</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">find_parents</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-ivar">@activity_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id IN (?)&quot;</span>,<span class="ruby-ivar">@users</span>)
  <span class="ruby-comment">#end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-invite_friend" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invite_friend</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="invite_friend-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1023</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invite_friend</span>
  <span class="ruby-ivar">@to</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>, <span class="ruby-value">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:user</span>, <span class="ruby-value">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&quot;contact_users.contact_email = users.email_address&quot;</span>])
  <span class="ruby-identifier">gmail</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span> [<span class="ruby-string">'contact_type LIKE ? AND user_id = ?'</span>, <span class="ruby-string">'gmail%'</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>])                            <span class="ruby-comment"># field2 LIKE '%roger%'</span>
  <span class="ruby-ivar">@gmail_contacts</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span> [<span class="ruby-string">'contact_type LIKE ? AND user_id = ?'</span>, <span class="ruby-string">'gmail%'</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>], <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_id DESC&quot;</span>)
  <span class="ruby-ivar">@yahoo_contacts</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span> [<span class="ruby-string">'contact_type LIKE ? AND user_id = ?'</span>, <span class="ruby-string">'yahoo%'</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>])
  <span class="ruby-ivar">@hotmail_contacts</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span> [<span class="ruby-string">'contact_type LIKE ? AND user_id = ?'</span>, <span class="ruby-string">'hotmail%'</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>])
  <span class="ruby-ivar">@facebook_contacts</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span> [<span class="ruby-string">'contact_type LIKE ? AND user_id = ?'</span>, <span class="ruby-string">'facebook%'</span>, <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>], <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_id DESC&quot;</span>)
  <span class="ruby-comment">#@famtivity_contacts = ContactUser.find(:all,:conditions=&gt; ['contact_type LIKE ? AND user_id = ?', 'famtivity%', current_user.user_id]) .order(&quot;id DESC&quot;)</span>
  <span class="ruby-ivar">@famtivity_contacts</span>= <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>)
  <span class="ruby-ivar">@user</span>= <span class="ruby-identifier">current_user</span>
  <span class="ruby-ivar">@to</span> =<span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>]
  <span class="ruby-ivar">@subject</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:subject_cre</span>]
  <span class="ruby-ivar">@message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>]
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;@&quot;</span>)
    <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:create_message</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">file_data</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:create_message</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">file_data</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:read</span>)
        <span class="ruby-identifier">str_to_encode</span> = <span class="ruby-identifier">file_data</span>.<span class="ruby-identifier">read</span>
        <span class="ruby-ivar">@image</span> = <span class="ruby-identifier">str_to_encode</span>
      <span class="ruby-keyword">else</span> <span class="ruby-identifier">file_data</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:path</span>)
        <span class="ruby-identifier">str_to_encode</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file_data</span>.<span class="ruby-identifier">path</span>)
        <span class="ruby-ivar">@image</span> = <span class="ruby-identifier">str_to_encode</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>])

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
        <span class="ruby-keyword">if</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_image_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@image</span>, <span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@get_current_url</span>, <span class="ruby-ivar">@name</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_image_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@image</span>, <span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@get_current_url</span>, <span class="ruby-ivar">@name</span>)
      <span class="ruby-keyword">end</span>


    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>])

    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
      <span class="ruby-keyword">if</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@to</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@to</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#redirect_to :back</span>
    <span class="ruby-comment">#redirect_to contact_users_path</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- invite_friend-source -->
          
        </div>

        

        
      </div><!-- invite_friend-method -->

    
      <div id="method-i-invite_friend_famtivity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invite_friend_famtivity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="invite_friend_famtivity-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 742</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invite_friend_famtivity</span>
  <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value">:f_invited_user</span>
  <span class="ruby-ivar">@click_mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:friend_mode</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:fam_net_id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fam_net_id</span>]
    <span class="ruby-ivar">@con</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;group_id=?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:fam_net_id</span>]).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:follow_cat_val</span>]=<span class="ruby-ivar">@con</span>.<span class="ruby-identifier">group_name</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>] = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@fam_last</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:fam_last</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:fam_last</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@con</span>=[]
  <span class="ruby-ivar">@all_con</span>=<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-ivar">@all_con</span>=<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@sp_con</span>=<span class="ruby-ivar">@all_con</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'&amp;'</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:all_con</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@sp_con</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_id=?&quot;</span>,<span class="ruby-identifier">d</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-ivar">@con</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@contact_users</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@sp_con</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@contacts</span> = <span class="ruby-ivar">@con</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@con</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@check</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:check_invite</span>]
  <span class="ruby-ivar">@reld</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:reld</span>]
  <span class="ruby-ivar">@fb_val</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fb_val</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:fb_val</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@all_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;email_address,user_name&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_flag=? and account_active_status=?&quot;</span>,<span class="ruby-keyword">true</span>,<span class="ruby-keyword">true</span>)
  <span class="ruby-comment">#.map(&amp;:email_address)</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'invite_friend'</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:check</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@check</span>, <span class="ruby-value">:all_users</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@all_users</span>, <span class="ruby-value">:reld</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@reld</span> ,<span class="ruby-value">:fb_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@fb_val</span>}
<span class="ruby-keyword">end</span></pre>
          </div><!-- invite_friend_famtivity-source -->
          
        </div>

        

        
      </div><!-- invite_friend_famtivity-method -->

    
      <div id="method-i-invite_mail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invite_mail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>invite mail</p>
          

          
          <div class="method-source-code" id="invite_mail-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 26</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invite_mail</span>
  <span class="ruby-identifier">contactss</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:toemailaddress</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; &quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-identifier">contact</span> =<span class="ruby-identifier">contactss</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-identifier">user</span>= <span class="ruby-identifier">current_user</span>
  <span class="ruby-identifier">con_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:con_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:con_id</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">grp_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:grp_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:grp_id</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">fam_group</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;group_id ='#{params[:grp_id]}'&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:grp_id</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">con_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_id=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:con_id</span>]).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:con_id</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\r\n&quot;</span>, <span class="ruby-string">&quot;&lt;br&gt;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&quot;/</span>, <span class="ruby-string">''</span>)
    <span class="ruby-identifier">invited_user</span> = <span class="ruby-identifier">c</span>
    <span class="ruby-ivar">@con_email</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;@&quot;</span>)
    <span class="ruby-identifier">old_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>,<span class="ruby-identifier">c</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-identifier">c</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:contact_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@con_email</span>[<span class="ruby-value">0</span>], <span class="ruby-value">:contact_email=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>, <span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;famtivity&quot;</span>, <span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>, <span class="ruby-value">:contact_user_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;non_member&quot;</span> , <span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-identifier">c</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">user_photo</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">img</span>=<span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">user_photo</span> 
            <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:contact=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">img</span>, <span class="ruby-value">:contact_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@con_email</span>[<span class="ruby-value">0</span>], <span class="ruby-value">:contact_email=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>, <span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;famtivity&quot;</span>, <span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>, <span class="ruby-value">:contact_user_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;member&quot;</span> , <span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:contact_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@con_email</span>[<span class="ruby-value">0</span>], <span class="ruby-value">:contact_email=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>, <span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;famtivity&quot;</span>, <span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>, <span class="ruby-value">:contact_user_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;member&quot;</span> , <span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
          <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;invited_email = ?&quot;</span>,<span class="ruby-identifier">c</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">invitor_user</span>
        <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">invitor_list</span>(<span class="ruby-identifier">c</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">'friend'</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">modified_date</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">fam_group</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">con_user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@msg</span>=<span class="ruby-node">&quot;#{fam_group.group_name} Invitation&quot;</span>
          <span class="ruby-constant">MessageMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_to_famnetwork</span>(<span class="ruby-identifier">invited_user</span>,<span class="ruby-ivar">@msg</span>,<span class="ruby-identifier">user</span>,<span class="ruby-identifier">get_current_url</span>,<span class="ruby-identifier">con_id</span>,<span class="ruby-identifier">fam_group</span>.<span class="ruby-identifier">group_id</span>,<span class="ruby-identifier">con_user</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">invite_to_join_famtivity</span>(<span class="ruby-identifier">invited_user</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">message</span>,<span class="ruby-identifier">get_current_url</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">fam_net_group</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;group_id ='#{cookies[:fam_network]}'&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-ivar">@old_user</span> = <span class="ruby-string">&quot;raja&quot;</span>  
      <span class="ruby-ivar">@fam_net</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;contact_group_id ='#{cookies[:fam_network]}' and contact_user_id='#{@contact_exist.contact_id}'&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@fam_net</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">c_user</span>= <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_user_id</span> = <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>
        <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_group_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>]
        <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">user_id</span>= <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
        <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">fam_accept_user_id</span> = <span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">user_id</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">save!</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@msg</span>=<span class="ruby-string">&quot;message&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_user_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;friend&quot;</span>
          <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Friend&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_friend_invite_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-identifier">fam_net_group</span>,<span class="ruby-identifier">c</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">old_user</span>,<span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-identifier">message</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Non Friend&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_member_invite_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-identifier">fam_net_group</span>,<span class="ruby-identifier">c</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">old_user</span>,<span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-identifier">message</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Invite to join&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_to_join_famtivity</span>(<span class="ruby-identifier">user</span>,<span class="ruby-identifier">fam_net_group</span>,<span class="ruby-identifier">c</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-ivar">@contact_exist</span>,<span class="ruby-identifier">message</span>)
      <span class="ruby-keyword">end</span>      
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- invite_mail-source -->
          
        </div>

        

        
      </div><!-- invite_mail-method -->

    
      <div id="method-i-invite_success_page" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invite_success_page</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>success popup for invite</p>
          

          
          <div class="method-source-code" id="invite_success_page-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 19</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invite_success_page</span>
  <span class="ruby-ivar">@reld</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:reld</span>]
  <span class="ruby-comment"># Added for analytics</span>
  <span class="ruby-ivar">@click_mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>].<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- invite_success_page-source -->
          
        </div>

        

        
      </div><!-- invite_success_page-method -->

    
      <div id="method-i-multi_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">multi_email</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="multi_email-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1097</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">multi_email</span>
  <span class="ruby-comment">#contactss= params[:subList].to_a</span>
  <span class="ruby-identifier">contactss</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">''</span>)
  <span class="ruby-identifier">contact</span> =<span class="ruby-identifier">contactss</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-identifier">user</span>= <span class="ruby-identifier">current_user</span>
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\r\n&quot;</span>, <span class="ruby-string">&quot;&lt;br&gt;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&quot;/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">strip</span>
    <span class="ruby-identifier">invited_user</span> = <span class="ruby-identifier">c</span>
    <span class="ruby-ivar">@contact_exist</span>=<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;contact_email = ? and user_id=?&quot;</span>,<span class="ruby-identifier">c</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:invite_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-identifier">old_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>,<span class="ruby-identifier">c</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;invited_email = ?&quot;</span>,<span class="ruby-identifier">c</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">invitor_user</span>
        <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">invitor_list</span>(<span class="ruby-identifier">c</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">'friend'</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">modified_date</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> 
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">invite_to_join_famtivity</span>(<span class="ruby-identifier">invited_user</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">message</span>,<span class="ruby-identifier">get_current_url</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#~ check_user = false</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> 
        <span class="ruby-comment">#UserMailer.delay(queue: &quot;Send Friend Request&quot;, priority: 2, run_at: 10.seconds.from_now).friend_request_fam_member(old_user,user,get_current_url)</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Friend Request&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">friend_request</span>(<span class="ruby-ivar">@contact_exist</span>,<span class="ruby-identifier">user</span>,<span class="ruby-identifier">get_current_url</span>) 
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-identifier">c</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@fam</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;group_id ='#{cookies[:fam_network]}'&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-ivar">@old_user</span> = <span class="ruby-string">&quot;raja&quot;</span>
        <span class="ruby-ivar">@fam_net</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;contact_group_id ='#{cookies[:fam_network]}' and contact_user_id='#{@contact_exist.contact_id}'&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@fam_net</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">c_user</span>= <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">new</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_user_id</span> = <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_group_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>]
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">user_id</span>= <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">fam_accept_user_id</span> = <span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">user_id</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">save!</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_user_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;friend&quot;</span>
            <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Friend&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_friend_invite_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@fam</span>,<span class="ruby-identifier">c</span>,<span class="ruby-identifier">get_current_url</span>,<span class="ruby-identifier">old_user</span>,<span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-identifier">message</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Non Friend&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_member_invite_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@fam</span>,<span class="ruby-identifier">c</span>,<span class="ruby-identifier">get_current_url</span>,<span class="ruby-identifier">old_user</span>,<span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-identifier">message</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Invite to join&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_to_join_famtivity</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@fam</span>,<span class="ruby-identifier">c</span>,<span class="ruby-identifier">get_current_url</span>,<span class="ruby-ivar">@contact_exist</span>,<span class="ruby-identifier">message</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#render :action=&gt;&quot;invite_success_page&quot;</span>
  <span class="ruby-comment">#  respond_to do |format|</span>
  <span class="ruby-comment">#       format.html {render :action=&gt;&quot;invite_success_page&quot;, :layout =&gt; false}</span>
  <span class="ruby-comment">#   end</span>
  <span class="ruby-comment"># render :partial =&gt;'invite_friend_succ'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- multi_email-source -->
          
        </div>

        

        
      </div><!-- multi_email-method -->

    
      <div id="method-i-multi_email_old" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">multi_email_old</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="multi_email_old-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">multi_email_old</span>
  <span class="ruby-ivar">@mail</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>]
  <span class="ruby-ivar">@contact</span>= <span class="ruby-ivar">@mail</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@s_mail</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@contact</span>)
  <span class="ruby-ivar">@email</span>= <span class="ruby-ivar">@s_mail</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span><span class="ruby-identifier">f</span>[<span class="ruby-string">&quot;contact_email&quot;</span>]}
  <span class="ruby-ivar">@invite_email</span>= <span class="ruby-ivar">@email</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; nil,&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;nil&quot;</span>, <span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&quot;/</span>, <span class="ruby-string">''</span>)
  <span class="ruby-ivar">@p_ids</span>= <span class="ruby-ivar">@s_mail</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span><span class="ruby-identifier">f</span>[<span class="ruby-string">&quot;profile_id&quot;</span>]}
  <span class="ruby-ivar">@fb_split</span> = <span class="ruby-ivar">@p_ids</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot; nil,&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/nil/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&quot;/</span>, <span class="ruby-string">''</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@fb_split</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;[]&quot;</span>
    <span class="ruby-ivar">@fb</span>=<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@fb</span>=<span class="ruby-ivar">@fb_split</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#contactss= params[:subList].to_a</span>
  <span class="ruby-identifier">contactss</span>= <span class="ruby-ivar">@invite_email</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">''</span>)
  <span class="ruby-identifier">contact</span> =<span class="ruby-identifier">contactss</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-identifier">user</span>= <span class="ruby-identifier">current_user</span>
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\r\n&quot;</span>, <span class="ruby-string">&quot;&lt;br&gt;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&quot;/</span>, <span class="ruby-string">''</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">c!</span>=<span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">invited_user</span> = <span class="ruby-identifier">c</span>
      <span class="ruby-identifier">old_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>,<span class="ruby-identifier">c</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;invited_email = ?&quot;</span>,<span class="ruby-identifier">c</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">invitor_user</span>
          <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">invitor_list</span>(<span class="ruby-identifier">c</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">'friend'</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">modified_date</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">invite_to_join_famtivity</span>(<span class="ruby-identifier">invited_user</span>, <span class="ruby-identifier">user</span>, <span class="ruby-identifier">message</span>,<span class="ruby-identifier">get_current_url</span>)
        <span class="ruby-comment">#~ check_user = false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">'invite_friend_succ'</span>}
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#render :partial =&gt;'invite_friend_succ'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- multi_email_old-source -->
          
        </div>

        

        
      </div><!-- multi_email_old-method -->

    
      <div id="method-i-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>GET /contact_users/new GET /contact_users/new.json</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 442</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">id</span>)
  <span class="ruby-ivar">@u_groups</span> = <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">contact_groups</span>
  <span class="ruby-ivar">@fam_last</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fam_last</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:fam_last</span>].<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-i-new_import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_import</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new_import-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1371</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_import</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- new_import-source -->
          
        </div>

        

        
      </div><!-- new_import-method -->

    
      <div id="method-i-newslertter_fam_network" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">newslertter_fam_network</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Newsletter fam_network</p>
          

          
          <div class="method-source-code" id="newslertter_fam_network-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 15</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">newslertter_fam_network</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- newslertter_fam_network-source -->
          
        </div>

        

        
      </div><!-- newslertter_fam_network-method -->

    
      <div id="method-i-newslertter_invite" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">newslertter_invite</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Newsletter Invite</p>
          

          
          <div class="method-source-code" id="newslertter_invite-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 11</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">newslertter_invite</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- newslertter_invite-source -->
          
        </div>

        

        
      </div><!-- newslertter_invite-method -->

    
      <div id="method-i-populate_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">populate_email</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Auto Populating email to invite friends</p>
          

          
          <div class="method-source-code" id="populate_email-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 773</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">populate_email</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>]
  <span class="ruby-ivar">@user_email</span>=[]
  <span class="ruby-ivar">@email</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_all_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">uniq</span><span class="ruby-comment">#.map(&amp;:contact_email)</span>
  <span class="ruby-ivar">@email</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">email</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email</span>.<span class="ruby-identifier">contact_email</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>].<span class="ruby-identifier">downcase</span>).<span class="ruby-identifier">blank?</span>)
        <span class="ruby-ivar">@user_email</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;id&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">email</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-string">&quot;label&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{email.contact_name}, #{email.contact_email}&quot;</span>,<span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">email</span>.<span class="ruby-identifier">contact_email</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-identifier">render</span> <span class="ruby-value">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@user_email</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- populate_email-source -->
          
        </div>

        

        
      </div><!-- populate_email-method -->

    
      <div id="method-i-req_multi_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">req_multi_email</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="req_multi_email-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1291</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">req_multi_email</span>
  <span class="ruby-ivar">@to_delete</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ids</span>]
  <span class="ruby-ivar">@curr_user</span> = <span class="ruby-identifier">current_user</span>
  <span class="ruby-identifier">contact</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:ids</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-identifier">get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cont</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">contact_user</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cont</span>)
    <span class="ruby-identifier">old_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address=?&quot;</span>,<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">contact_email</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;invited_email=?&quot;</span>,<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">contact_email</span>).<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:request</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;new_invite&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_user</span>)
      <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">invitor_user</span>)
        <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">invitor_list</span>(<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">contact_email</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">'friend'</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">modified_date</span><span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">message</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-comment">#invite_status == true</span>
      <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;invite Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">invite_to_join_famtivity</span>(<span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">contact_email</span>, <span class="ruby-ivar">@curr_user</span>, <span class="ruby-identifier">message</span>,<span class="ruby-identifier">get_current_url</span>)
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:request</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;friend_invite&quot;</span>)
      <span class="ruby-identifier">contact_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Friend Request&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">friend_request</span>(<span class="ruby-identifier">contact_user</span>,<span class="ruby-ivar">@curr_user</span>,<span class="ruby-identifier">get_current_url</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:active_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Active&quot;</span>)
  <span class="ruby-identifier">act_ids</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">activities</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">activities</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>) <span class="ruby-operator">:</span> []
  <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">act_ids</span>).<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:activity_id</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
  <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-ivar">@users</span> = []
  <span class="ruby-identifier">activity_ids</span> = []
  <span class="ruby-ivar">@activity_groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity</span> = <span class="ruby-identifier">find_activity_record</span>(<span class="ruby-identifier">group</span>[<span class="ruby-value">0</span>])
    <span class="ruby-identifier">activity_ids</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-ivar">@users</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">find_parents</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-identifier">activity_ids</span> = <span class="ruby-identifier">activity_ids</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-ivar">@activity_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id IN (?)&quot;</span>,<span class="ruby-ivar">@users</span>)
  <span class="ruby-identifier">activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">activity_ids</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>].<span class="ruby-identifier">present?</span>
      <span class="ruby-ivar">@status_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:group_id</span>] 
      <span class="ruby-ivar">@fam_group</span>=<span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:group_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@status_id</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-ivar">@fam_owner</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@fam_group</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-ivar">@fam</span> =<span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * FROM contact_users INNER JOIN contact_user_groups as fam ON 
        contact_users.contact_id = fam.contact_user_id and fam.contact_group_id='#{@status_id}'&quot;</span>)
   <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- req_multi_email-source -->
          
        </div>

        

        
      </div><!-- req_multi_email-method -->

    
      <div id="method-i-search_contact_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_contact_user</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>searching the contact user.</p>
          

          
          <div class="method-source-code" id="search_contact_user-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1381</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_contact_user</span>
  <span class="ruby-comment">#params[:contact_user] = params[:contact_user]!=&quot;&quot; ? params[:contact_user] : &quot;Search for Friend&quot;</span>
  <span class="ruby-ivar">@con</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@con_name</span>=<span class="ruby-ivar">@con</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_user</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@con_name</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_name</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_key</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_key</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-ivar">@search</span> =<span class="ruby-string">&quot;search&quot;</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]], <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;group_name ASC&quot;</span>)
  <span class="ruby-ivar">@all_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_name</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@contact_groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">search_contactgroup</span>(<span class="ruby-ivar">@con_name</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:represented</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_name</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">search_contactuser</span>(<span class="ruby-ivar">@con_name</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:search_key</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_name</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">search_activitygroup</span>(<span class="ruby-ivar">@con_name</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:represented</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_name</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@activity_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">search_activityuser</span>(<span class="ruby-ivar">@con_name</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:represented</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_name</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@contact_groups</span> = []
    <span class="ruby-ivar">@contact_users</span> = []
    <span class="ruby-ivar">@activity_groups</span> = []
    <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_contact_user-source -->
          
        </div>

        

        
      </div><!-- search_contact_user-method -->

    
      <div id="method-i-search_famtivity_members" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_famtivity_members</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>To find famtivity members in contact drop down</p>
          

          
          <div class="method-source-code" id="search_famtivity_members-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1406</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_famtivity_members</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:key_word</span>]
    <span class="ruby-ivar">@key_word</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:key_word</span>]
    <span class="ruby-ivar">@fam_mem</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address LIKE ? and user_flag=?&quot;</span>,<span class="ruby-node">&quot;%#{params[:key_word]}%&quot;</span>,<span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;famtivity_members_list&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_famtivity_members-source -->
          
        </div>

        

        
      </div><!-- search_famtivity_members-method -->

    
      <div id="method-i-select_mail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_mail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="select_mail-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 663</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">select_mail</span>
  <span class="ruby-ivar">@to_delete</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-ivar">@contact</span>= <span class="ruby-ivar">@to_delete</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@s_mail</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@contact</span>)
  <span class="ruby-ivar">@group</span>= <span class="ruby-ivar">@s_mail</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span><span class="ruby-identifier">f</span>[<span class="ruby-string">&quot;contact_email&quot;</span>]}.<span class="ruby-identifier">join</span>(<span class="ruby-string">','</span>)
  <span class="ruby-ivar">@group1</span> = <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;,&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-ivar">@group_email</span> = <span class="ruby-ivar">@group1</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;.com&quot;</span>,<span class="ruby-string">&quot;.com,&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;.in&quot;</span>,<span class="ruby-string">&quot;.in,&quot;</span>)

<span class="ruby-keyword">end</span></pre>
          </div><!-- select_mail-source -->
          
        </div>

        

        
      </div><!-- select_mail-method -->

    
      <div id="method-i-select_mail_empty" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_mail_empty</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="select_mail_empty-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 673</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">select_mail_empty</span>
  <span class="ruby-ivar">@to_delete</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- select_mail_empty-source -->
          
        </div>

        

        
      </div><!-- select_mail_empty-method -->

    
      <div id="method-i-send_friend_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_friend_request</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>To send friend request in the famtivity members</p>
          

          
          <div class="method-source-code" id="send_friend_request-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 1414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_friend_request</span>
  <span class="ruby-ivar">@user_mem</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address = ?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>]).<span class="ruby-identifier">first</span>
  <span class="ruby-ivar">@curr_user</span> = <span class="ruby-identifier">current_user</span>
  
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_by_contact_email_and_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">user_photo</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">img</span>=<span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">user_photo</span> 
      <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:contact=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">img</span>, <span class="ruby-value">:contact_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_name</span>, <span class="ruby-value">:contact_email=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">email_address</span>, <span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;famtivity&quot;</span>, <span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>, <span class="ruby-value">:contact_user_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;member&quot;</span> , <span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>, <span class="ruby-value">:fam_user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@contact_exist</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:contact_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_name</span>, <span class="ruby-value">:contact_email=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">email_address</span>, <span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:contact_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;famtivity&quot;</span>, <span class="ruby-value">:invite_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:accept_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>, <span class="ruby-value">:contact_user_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;member&quot;</span> , <span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>, <span class="ruby-value">:fam_user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:invite_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>,<span class="ruby-value">:fam_user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#add to invitor list</span>
  <span class="ruby-identifier">invitor_user</span> = <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">find_by_invited_email_and_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-constant">InvitorList</span>.<span class="ruby-identifier">invitor_list</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">'friend'</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">invitor_user</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:modified_date</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@fam</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;group_id ='#{cookies[:fam_network]}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-ivar">@old_user</span> = <span class="ruby-string">&quot;raja&quot;</span>
    <span class="ruby-ivar">@fam_net</span> = <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;contact_group_id ='#{cookies[:fam_network]}' and contact_user_id='#{@contact_exist.contact_id}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@fam_net</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">c_user</span>= <span class="ruby-constant">ContactUserGroup</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_user_id</span> = <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>
      <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">contact_group_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:fam_network</span>]
      <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">fam_accept_user_id</span> = <span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_id</span>
      <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">user_id</span>= <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
      <span class="ruby-identifier">c_user</span>.<span class="ruby-identifier">save!</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_user_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;friend&quot;</span>
        <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Friend&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_friend_invite_mail</span>(<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@fam</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>],<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-ivar">@user_mem</span>,<span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-keyword">nil</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Non Friend&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_member_invite_mail</span>(<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@fam</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>],<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-ivar">@user_mem</span>,<span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">contact_id</span>,<span class="ruby-keyword">nil</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">FamtivityNetworkMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Fam Network Invite to join&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">network_to_join_famtivity</span>(<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@fam</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_email</span>],<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-ivar">@contact_exist</span>,<span class="ruby-string">&quot;Famtivity&quot;</span>)
    <span class="ruby-keyword">end</span> 
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mem</span>.<span class="ruby-identifier">user_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-comment">#~ UserMailer.delay(queue: &quot;Send Friend Request&quot;, priority: 2, run_at: 10.seconds.from_now).friend_request_fam_member(@contact_user,@curr_user,@get_current_url)</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Friend Request&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">friend_request</span>(<span class="ruby-ivar">@contact_exist</span>,<span class="ruby-ivar">@curr_user</span>,<span class="ruby-ivar">@get_current_url</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Friend Request&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">friend_request</span>(<span class="ruby-ivar">@contact_exist</span>,<span class="ruby-ivar">@curr_user</span>,<span class="ruby-ivar">@get_current_url</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@contact_exist</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:key_val</span>]
      <span class="ruby-ivar">@fam_mem</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;email_address iLIKE ? and user_flag=?&quot;</span>,<span class="ruby-node">&quot;%#{params[:key_val]}%&quot;</span>,<span class="ruby-keyword">true</span>)
      <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;famtivity_members_list&quot;</span>
      <span class="ruby-comment">#render :text =&gt; true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- send_friend_request-source -->
          
        </div>

        

        
      </div><!-- send_friend_request-method -->

    
      <div id="method-i-send_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_message</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="send_message-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 953</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_message</span>
  <span class="ruby-ivar">@fb</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:fb_ids</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:fb_ids</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:fb_ids</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@fb_ids</span>=<span class="ruby-ivar">@fb</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&quot;/</span>, <span class="ruby-string">''</span>)
  <span class="ruby-identifier">p</span> <span class="ruby-ivar">@fb_ids</span>
  <span class="ruby-ivar">@user</span>= <span class="ruby-identifier">current_user</span>
  <span class="ruby-ivar">@to</span> =<span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>]
  <span class="ruby-ivar">@subject</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:subject_cre</span>]
  <span class="ruby-ivar">@message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;br&gt;&lt;br&gt;/</span>, <span class="ruby-string">' '</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;br&gt;/</span>, <span class="ruby-string">' '</span>)
  <span class="ruby-comment">#@image = params[:create_message]</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;@&quot;</span>)
    <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">name</span>[<span class="ruby-value">0</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@message_vaule</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:pass_msg</span>]
  <span class="ruby-ivar">@contact_groups</span> = <span class="ruby-constant">ContactGroup</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ?&quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]] , <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;group_name ASC&quot;</span>)
  <span class="ruby-comment"># Finding Activity Groups</span>
  <span class="ruby-comment"># @arr = []</span>
  <span class="ruby-comment"># activity_groups = ActivityAttendDetail.where(:user_id=&gt;current_user.user_id)</span>
  <span class="ruby-comment"># @activity_groups = activity_groups.group_by(&amp;:activity_id).to_a</span>
  <span class="ruby-comment"># @arr = activity_groups.map(&amp;:user_id)</span>
  <span class="ruby-comment"># @activity_users = User.where(&quot;user_id IN (?)&quot;,@arr)</span>
  <span class="ruby-identifier">activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:active_status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Active&quot;</span>)
  <span class="ruby-identifier">act_ids</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">activities</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">activities</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>) <span class="ruby-operator">:</span> []
  <span class="ruby-ivar">@activity_groups</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id IN (?)&quot;</span>,<span class="ruby-identifier">act_ids</span>).<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:activity_id</span>).<span class="ruby-identifier">to_a</span>
  <span class="ruby-ivar">@activity_users</span> = []
  <span class="ruby-ivar">@users</span> = []
  <span class="ruby-ivar">@activity_groups</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">group</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity</span> = <span class="ruby-identifier">find_activity_record</span>(<span class="ruby-identifier">group</span>[<span class="ruby-value">0</span>])
    <span class="ruby-ivar">@users</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">find_parents</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:id</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@users</span> = <span class="ruby-ivar">@users</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-ivar">@activity_users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id IN (?)&quot;</span>,<span class="ruby-ivar">@users</span>)
  <span class="ruby-comment">#end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@files</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{Rails.root}/public/contact_users_upload/#{current_user.user_id}/*&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@files</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@files</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>])

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
        <span class="ruby-keyword">if</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_image_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@files</span>, <span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@get_current_url</span>, <span class="ruby-ivar">@name</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_image_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@files</span>, <span class="ruby-ivar">@to</span>, <span class="ruby-ivar">@get_current_url</span>, <span class="ruby-ivar">@name</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment">#redirect_to contact_users_path</span>
      <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]])
      <span class="ruby-ivar">@all_users</span> = <span class="ruby-ivar">@contact_users</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@old_email</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:cre_to_msg</span>])

      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@old_email</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
        <span class="ruby-keyword">if</span><span class="ruby-ivar">@old_email</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@to</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send Message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">send_message</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@subject</span>, <span class="ruby-ivar">@message</span>, <span class="ruby-ivar">@to</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@contact_users</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]], <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;contact_name ASC&quot;</span>)
      <span class="ruby-ivar">@all_users</span> = <span class="ruby-ivar">@contact_users</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
      <span class="ruby-comment"># redirect_to contact_users_path</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- send_message-source -->
          
        </div>

        

        
      </div><!-- send_message-method -->

    
      <div id="method-i-yahoo_contact_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">yahoo_contact_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="yahoo_contact_list-source">
            <pre><span class="ruby-comment"># File app/controllers/contact_users_controller.rb, line 802</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">yahoo_contact_list</span>
  <span class="ruby-ivar">@contacts</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'omnicontacts.contacts'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- yahoo_contact_list-source -->
          
        </div>

        

        
      </div><!-- yahoo_contact_list-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

