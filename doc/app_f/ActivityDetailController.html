<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class ActivityDetailController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/activity_detail_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">ActionView::Helpers::TextHelper</span>
  
  
  
    <li><a class="include" href="ActivitiesHelper.html">ActivitiesHelper</a>
  
  
  
    <li><a class="include" href="ActivityDetailHelper.html">ActivityDetailHelper</a>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-activities">#activities</a>
    
    <li><a href="#method-i-activity_detail_iframe">#activity_detail_iframe</a>
    
    <li><a href="#method-i-activity_detail_old">#activity_detail_old</a>
    
    <li><a href="#method-i-activity_detail_page_old">#activity_detail_page_old</a>
    
    <li><a href="#method-i-activity_email_link">#activity_email_link</a>
    
    <li><a href="#method-i-activitydetail_new">#activitydetail_new</a>
    
    <li><a href="#method-i-activitydetailpage_jax">#activitydetailpage_jax</a>
    
    <li><a href="#method-i-contact_provider_info">#contact_provider_info</a>
    
    <li><a href="#method-i-contact_provider_success">#contact_provider_success</a>
    
    <li><a href="#method-i-create_discount_type">#create_discount_type</a>
    
    <li><a href="#method-i-create_first_discount_type">#create_first_discount_type</a>
    
    <li><a href="#method-i-create_thank">#create_thank</a>
    
    <li><a href="#method-i-delete_discount">#delete_discount</a>
    
    <li><a href="#method-i-delete_provider_discount_fee">#delete_provider_discount_fee</a>
    
    <li><a href="#method-i-delete_provider_fee">#delete_provider_fee</a>
    
    <li><a href="#method-i-discount_destroy">#discount_destroy</a>
    
    <li><a href="#method-i-edit_acitivity_thank">#edit_acitivity_thank</a>
    
    <li><a href="#method-i-edit_activity">#edit_activity</a>
    
    <li><a href="#method-i-edit_activity_parent">#edit_activity_parent</a>
    
    <li><a href="#method-i-edit_discount_type">#edit_discount_type</a>
    
    <li><a href="#method-i-edit_provider_discount_fee">#edit_provider_discount_fee</a>
    
    <li><a href="#method-i-edit_provider_fee">#edit_provider_fee</a>
    
    <li><a href="#method-i-embed_popup">#embed_popup</a>
    
    <li><a href="#method-i-embedded_link">#embedded_link</a>
    
    <li><a href="#method-i-find_us_on_famtivity_popup">#find_us_on_famtivity_popup</a>
    
    <li><a href="#method-i-get_total_feature_list">#get_total_feature_list</a>
    
    <li><a href="#method-i-googleCalAdd">#googleCalAdd</a>
    
    <li><a href="#method-i-link_clicked">#link_clicked</a>
    
    <li><a href="#method-i-msg_to_provider_curator">#msg_to_provider_curator</a>
    
    <li><a href="#method-i-parent_acitivity_thank">#parent_acitivity_thank</a>
    
    <li><a href="#method-i-parent_activity_update">#parent_activity_update</a>
    
    <li><a href="#method-i-preview_embed_popup">#preview_embed_popup</a>
    
    <li><a href="#method-i-provider_activity_discount">#provider_activity_discount</a>
    
    <li><a href="#method-i-provider_activity_success">#provider_activity_success</a>
    
    <li><a href="#method-i-provider_detail_iframe">#provider_detail_iframe</a>
    
    <li><a href="#method-i-provider_discount_fee">#provider_discount_fee</a>
    
    <li><a href="#method-i-provider_discount_type">#provider_discount_type</a>
    
    <li><a href="#method-i-provider_edit">#provider_edit</a>
    
    <li><a href="#method-i-provider_edit_activity">#provider_edit_activity</a>
    
    <li><a href="#method-i-provider_edit_new_changes">#provider_edit_new_changes</a>
    
    <li><a href="#method-i-provider_edit_old">#provider_edit_old</a>
    
    <li><a href="#method-i-provider_embedded_link">#provider_embedded_link</a>
    
    <li><a href="#method-i-provider_fee">#provider_fee</a>
    
    <li><a href="#method-i-provider_info">#provider_info</a>
    
    <li><a href="#method-i-provider_information">#provider_information</a>
    
    <li><a href="#method-i-schedule_price">#schedule_price</a>
    
    <li><a href="#method-i-send_edit_mail">#send_edit_mail</a>
    
    <li><a href="#method-i-sendmsgtoprver">#sendmsgtoprver</a>
    
    <li><a href="#method-i-sendmsgtoprver_old">#sendmsgtoprver_old</a>
    
    <li><a href="#method-i-share_activity">#share_activity</a>
    
    <li><a href="#method-i-share_activity_favthank">#share_activity_favthank</a>
    
    <li><a href="#method-i-share_activity_success">#share_activity_success</a>
    
    <li><a href="#method-i-share_activity_thank">#share_activity_thank</a>
    
    <li><a href="#method-i-ticket">#ticket</a>
    
    <li><a href="#method-i-update_discount_type">#update_discount_type</a>
    
    <li><a href="#method-i-update_provider_discount_fee">#update_provider_discount_fee</a>
    
    <li><a href="#method-i-update_provider_fee">#update_provider_fee</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./ActivitiesController.html">ActivitiesController</a>
  
    <li><a href="./ActivitiesHelper.html">ActivitiesHelper</a>
  
    <li><a href="./Activity.html">Activity</a>
  
    <li><a href="./ActivityAttendDetail.html">ActivityAttendDetail</a>
  
    <li><a href="./ActivityAttendDetailsController.html">ActivityAttendDetailsController</a>
  
    <li><a href="./ActivityAttendDetailsHelper.html">ActivityAttendDetailsHelper</a>
  
    <li><a href="./ActivityBid.html">ActivityBid</a>
  
    <li><a href="./ActivityBidsController.html">ActivityBidsController</a>
  
    <li><a href="./ActivityBidsHelper.html">ActivityBidsHelper</a>
  
    <li><a href="./ActivityCategoriesController.html">ActivityCategoriesController</a>
  
    <li><a href="./ActivityCategoriesHelper.html">ActivityCategoriesHelper</a>
  
    <li><a href="./ActivityCategory.html">ActivityCategory</a>
  
    <li><a href="./ActivityClick.html">ActivityClick</a>
  
    <li><a href="./ActivityComment.html">ActivityComment</a>
  
    <li><a href="./ActivityCommentsController.html">ActivityCommentsController</a>
  
    <li><a href="./ActivityCommentsHelper.html">ActivityCommentsHelper</a>
  
    <li><a href="./ActivityCount.html">ActivityCount</a>
  
    <li><a href="./ActivityDetailController.html">ActivityDetailController</a>
  
    <li><a href="./ActivityDetailHelper.html">ActivityDetailHelper</a>
  
    <li><a href="./ActivityDiscountPrice.html">ActivityDiscountPrice</a>
  
    <li><a href="./ActivityFavorite.html">ActivityFavorite</a>
  
    <li><a href="./ActivityFavoritesController.html">ActivityFavoritesController</a>
  
    <li><a href="./ActivityFavoritesHelper.html">ActivityFavoritesHelper</a>
  
    <li><a href="./ActivityForm.html">ActivityForm</a>
  
    <li><a href="./ActivityNetworkController.html">ActivityNetworkController</a>
  
    <li><a href="./ActivityNetworkHelper.html">ActivityNetworkHelper</a>
  
    <li><a href="./ActivityNetworkPermission.html">ActivityNetworkPermission</a>
  
    <li><a href="./ActivityPrice.html">ActivityPrice</a>
  
    <li><a href="./ActivityPricesController.html">ActivityPricesController</a>
  
    <li><a href="./ActivityPricesHelper.html">ActivityPricesHelper</a>
  
    <li><a href="./ActivityRating.html">ActivityRating</a>
  
    <li><a href="./ActivityRatingsController.html">ActivityRatingsController</a>
  
    <li><a href="./ActivityRatingsHelper.html">ActivityRatingsHelper</a>
  
    <li><a href="./ActivityRepeat.html">ActivityRepeat</a>
  
    <li><a href="./ActivityRepeatsController.html">ActivityRepeatsController</a>
  
    <li><a href="./ActivityRepeatsHelper.html">ActivityRepeatsHelper</a>
  
    <li><a href="./ActivityRow.html">ActivityRow</a>
  
    <li><a href="./ActivityRowsController.html">ActivityRowsController</a>
  
    <li><a href="./ActivityRowsHelper.html">ActivityRowsHelper</a>
  
    <li><a href="./ActivitySchedule.html">ActivitySchedule</a>
  
    <li><a href="./ActivitySchedulesController.html">ActivitySchedulesController</a>
  
    <li><a href="./ActivitySchedulesHelper.html">ActivitySchedulesHelper</a>
  
    <li><a href="./ActivitySetting.html">ActivitySetting</a>
  
    <li><a href="./ActivitySettingsDetail.html">ActivitySettingsDetail</a>
  
    <li><a href="./ActivitySettingsType.html">ActivitySettingsType</a>
  
    <li><a href="./ActivityShared.html">ActivityShared</a>
  
    <li><a href="./ActivitySharedsController.html">ActivitySharedsController</a>
  
    <li><a href="./ActivitySharedsHelper.html">ActivitySharedsHelper</a>
  
    <li><a href="./ActivitySubcategoriesController.html">ActivitySubcategoriesController</a>
  
    <li><a href="./ActivitySubcategoriesHelper.html">ActivitySubcategoriesHelper</a>
  
    <li><a href="./ActivitySubcategory.html">ActivitySubcategory</a>
  
    <li><a href="./ActivityTotalCount.html">ActivityTotalCount</a>
  
    <li><a href="./ActivityTrack.html">ActivityTrack</a>
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./AdminDiscountCode.html">AdminDiscountCode</a>
  
    <li><a href="./AdminDiscountCodesController.html">AdminDiscountCodesController</a>
  
    <li><a href="./AdminDiscountCodesHelper.html">AdminDiscountCodesHelper</a>
  
    <li><a href="./AdminHelper.html">AdminHelper</a>
  
    <li><a href="./AgeRangeColorsController.html">AgeRangeColorsController</a>
  
    <li><a href="./AgeRangeColorsHelper.html">AgeRangeColorsHelper</a>
  
    <li><a href="./AgerangeColor.html">AgerangeColor</a>
  
    <li><a href="./AgerangeColorsController.html">AgerangeColorsController</a>
  
    <li><a href="./AgerangeColorsHelper.html">AgerangeColorsHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Authentication.html">Authentication</a>
  
    <li><a href="./AuthenticationsController.html">AuthenticationsController</a>
  
    <li><a href="./BlockUser.html">BlockUser</a>
  
    <li><a href="./CheckoutController.html">CheckoutController</a>
  
    <li><a href="./City.html">City</a>
  
    <li><a href="./CityGroup.html">CityGroup</a>
  
    <li><a href="./ContactGroup.html">ContactGroup</a>
  
    <li><a href="./ContactGroupsController.html">ContactGroupsController</a>
  
    <li><a href="./ContactGroupsHelper.html">ContactGroupsHelper</a>
  
    <li><a href="./ContactUser.html">ContactUser</a>
  
    <li><a href="./ContactUserGroup.html">ContactUserGroup</a>
  
    <li><a href="./ContactUsersController.html">ContactUsersController</a>
  
    <li><a href="./ContactUsersHelper.html">ContactUsersHelper</a>
  
    <li><a href="./Country.html">Country</a>
  
    <li><a href="./DefaultFilter.html">DefaultFilter</a>
  
    <li><a href="./DefaultFiltersController.html">DefaultFiltersController</a>
  
    <li><a href="./DefaultFiltersHelper.html">DefaultFiltersHelper</a>
  
    <li><a href="./DeletedSchedule.html">DeletedSchedule</a>
  
    <li><a href="./DetailPageIdentityHelper.html">DetailPageIdentityHelper</a>
  
    <li><a href="./DetailsPageController.html">DetailsPageController</a>
  
    <li><a href="./DetailsPageHelper.html">DetailsPageHelper</a>
  
    <li><a href="./DiscountDollarsController.html">DiscountDollarsController</a>
  
    <li><a href="./DiscountDollarsHelper.html">DiscountDollarsHelper</a>
  
    <li><a href="./EmbedController.html">EmbedController</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./FamFeeDetail.html">FamFeeDetail</a>
  
    <li><a href="./FamNetwork.html">FamNetwork</a>
  
    <li><a href="./FamNetworkGroup.html">FamNetworkGroup</a>
  
    <li><a href="./FamNetworkGroupsController.html">FamNetworkGroupsController</a>
  
    <li><a href="./FamNetworkGroupsHelper.html">FamNetworkGroupsHelper</a>
  
    <li><a href="./FamNetworkPost.html">FamNetworkPost</a>
  
    <li><a href="./FamNetworkPostsController.html">FamNetworkPostsController</a>
  
    <li><a href="./FamNetworkPostsHelper.html">FamNetworkPostsHelper</a>
  
    <li><a href="./FamNetworkRow.html">FamNetworkRow</a>
  
    <li><a href="./FamNetworksController.html">FamNetworksController</a>
  
    <li><a href="./FamNetworksHelper.html">FamNetworksHelper</a>
  
    <li><a href="./FamPost.html">FamPost</a>
  
    <li><a href="./FamPostsController.html">FamPostsController</a>
  
    <li><a href="./FamPostsHelper.html">FamPostsHelper</a>
  
    <li><a href="./FampassDetail.html">FampassDetail</a>
  
    <li><a href="./FamtivityNetworkMailer.html">FamtivityNetworkMailer</a>
  
    <li><a href="./FeaturedAuditLog.html">FeaturedAuditLog</a>
  
    <li><a href="./FeaturedAuditLogsController.html">FeaturedAuditLogsController</a>
  
    <li><a href="./FeaturedAuditLogsHelper.html">FeaturedAuditLogsHelper</a>
  
    <li><a href="./FollowingUser.html">FollowingUser</a>
  
    <li><a href="./Form.html">Form</a>
  
    <li><a href="./FormQuestion.html">FormQuestion</a>
  
    <li><a href="./FormResult.html">FormResult</a>
  
    <li><a href="./FormResultAnswer.html">FormResultAnswer</a>
  
    <li><a href="./FormsController.html">FormsController</a>
  
    <li><a href="./FormsHelper.html">FormsHelper</a>
  
    <li><a href="./GeneralTag.html">GeneralTag</a>
  
    <li><a href="./GuestDetail.html">GuestDetail</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./InviteAttendees.html">InviteAttendees</a>
  
    <li><a href="./InvitesHelper.html">InvitesHelper</a>
  
    <li><a href="./InvitorList.html">InvitorList</a>
  
    <li><a href="./InvitorListHelper.html">InvitorListHelper</a>
  
    <li><a href="./LandingController.html">LandingController</a>
  
    <li><a href="./LandingHelper.html">LandingHelper</a>
  
    <li><a href="./LeadTransaction.html">LeadTransaction</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LogoutController.html">LogoutController</a>
  
    <li><a href="./Manager.html">Manager</a>
  
    <li><a href="./Message.html">Message</a>
  
    <li><a href="./MessageFile.html">MessageFile</a>
  
    <li><a href="./MessageMailer.html">MessageMailer</a>
  
    <li><a href="./MessageThread.html">MessageThread</a>
  
    <li><a href="./MessageThreadViewer.html">MessageThreadViewer</a>
  
    <li><a href="./MessagesController.html">MessagesController</a>
  
    <li><a href="./MessagesHelper.html">MessagesHelper</a>
  
    <li><a href="./MonthlyBudget.html">MonthlyBudget</a>
  
    <li><a href="./MonthlyBudgetsController.html">MonthlyBudgetsController</a>
  
    <li><a href="./MonthlyBudgetsHelper.html">MonthlyBudgetsHelper</a>
  
    <li><a href="./NewsletterMailer.html">NewsletterMailer</a>
  
    <li><a href="./NewslettersController.html">NewslettersController</a>
  
    <li><a href="./NotificationDetail.html">NotificationDetail</a>
  
    <li><a href="./ParentNotification.html">ParentNotification</a>
  
    <li><a href="./ParentNotificationDetail.html">ParentNotificationDetail</a>
  
    <li><a href="./ParentSetting.html">ParentSetting</a>
  
    <li><a href="./ParentSettingDetail.html">ParentSettingDetail</a>
  
    <li><a href="./ParentSettingsController.html">ParentSettingsController</a>
  
    <li><a href="./Participant.html">Participant</a>
  
    <li><a href="./ParticipantsController.html">ParticipantsController</a>
  
    <li><a href="./ParticipantsHelper.html">ParticipantsHelper</a>
  
    <li><a href="./PaymentDetail.html">PaymentDetail</a>
  
    <li><a href="./PaymentDetailsController.html">PaymentDetailsController</a>
  
    <li><a href="./PaymentDetailsHelper.html">PaymentDetailsHelper</a>
  
    <li><a href="./PoliciesController.html">PoliciesController</a>
  
    <li><a href="./PoliciesHelper.html">PoliciesHelper</a>
  
    <li><a href="./Policy.html">Policy</a>
  
    <li><a href="./PolicyFile.html">PolicyFile</a>
  
    <li><a href="./PolicyType.html">PolicyType</a>
  
    <li><a href="./ProviderActivityFee.html">ProviderActivityFee</a>
  
    <li><a href="./ProviderActivityFeeType.html">ProviderActivityFeeType</a>
  
    <li><a href="./ProviderCount.html">ProviderCount</a>
  
    <li><a href="./ProviderDiscountCode.html">ProviderDiscountCode</a>
  
    <li><a href="./ProviderDiscountCodeType.html">ProviderDiscountCodeType</a>
  
    <li><a href="./ProviderDiscountType.html">ProviderDiscountType</a>
  
    <li><a href="./ProviderLead.html">ProviderLead</a>
  
    <li><a href="./ProviderListController.html">ProviderListController</a>
  
    <li><a href="./ProviderNotification.html">ProviderNotification</a>
  
    <li><a href="./ProviderNotificationDetail.html">ProviderNotificationDetail</a>
  
    <li><a href="./ProviderSetting.html">ProviderSetting</a>
  
    <li><a href="./ProviderSettingDetail.html">ProviderSettingDetail</a>
  
    <li><a href="./ProviderSettingsController.html">ProviderSettingsController</a>
  
    <li><a href="./ProviderSettingsHelper.html">ProviderSettingsHelper</a>
  
    <li><a href="./ProviderTransaction.html">ProviderTransaction</a>
  
    <li><a href="./ProviderTransactionLog.html">ProviderTransactionLog</a>
  
    <li><a href="./ProviderWebsiteTrack.html">ProviderWebsiteTrack</a>
  
    <li><a href="./Question.html">Question</a>
  
    <li><a href="./QuestionType.html">QuestionType</a>
  
    <li><a href="./QuestionValue.html">QuestionValue</a>
  
    <li><a href="./QuickLinksController.html">QuickLinksController</a>
  
    <li><a href="./QuickLinksHelper.html">QuickLinksHelper</a>
  
    <li><a href="./SchoolRepresentative.html">SchoolRepresentative</a>
  
    <li><a href="./SchoolRepresentativesController.html">SchoolRepresentativesController</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SendSMS.html">SendSMS</a>
  
    <li><a href="./Setting.html">Setting</a>
  
    <li><a href="./SettingsController.html">SettingsController</a>
  
    <li><a href="./SettingsHelper.html">SettingsHelper</a>
  
    <li><a href="./SmsStatus.html">SmsStatus</a>
  
    <li><a href="./SocialType.html">SocialType</a>
  
    <li><a href="./SponsorShip.html">SponsorShip</a>
  
    <li><a href="./SponsorShipsController.html">SponsorShipsController</a>
  
    <li><a href="./SponsorShipsHelper.html">SponsorShipsHelper</a>
  
    <li><a href="./State.html">State</a>
  
    <li><a href="./StaticController.html">StaticController</a>
  
    <li><a href="./Support.html">Support</a>
  
    <li><a href="./SupportsController.html">SupportsController</a>
  
    <li><a href="./SupportsHelper.html">SupportsHelper</a>
  
    <li><a href="./Ticket.html">Ticket</a>
  
    <li><a href="./TicketsController.html">TicketsController</a>
  
    <li><a href="./TicketsHelper.html">TicketsHelper</a>
  
    <li><a href="./TransactionDetail.html">TransactionDetail</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserBankDetail.html">UserBankDetail</a>
  
    <li><a href="./UserCalender.html">UserCalender</a>
  
    <li><a href="./UserCard.html">UserCard</a>
  
    <li><a href="./UserChild.html">UserChild</a>
  
    <li><a href="./UserChildrenController.html">UserChildrenController</a>
  
    <li><a href="./UserCredit.html">UserCredit</a>
  
    <li><a href="./UserDeactivateLog.html">UserDeactivateLog</a>
  
    <li><a href="./UserDebit.html">UserDebit</a>
  
    <li><a href="./UserDeletedAccount.html">UserDeletedAccount</a>
  
    <li><a href="./UserEmailChangeLog.html">UserEmailChangeLog</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserNotification.html">UserNotification</a>
  
    <li><a href="./UserProfile.html">UserProfile</a>
  
    <li><a href="./UserProfilesController.html">UserProfilesController</a>
  
    <li><a href="./UserProfilesHelper.html">UserProfilesHelper</a>
  
    <li><a href="./UserRow.html">UserRow</a>
  
    <li><a href="./UserSettingsHelper.html">UserSettingsHelper</a>
  
    <li><a href="./UserTransaction.html">UserTransaction</a>
  
    <li><a href="./UserTransactionsController.html">UserTransactionsController</a>
  
    <li><a href="./UserTransactionsHelper.html">UserTransactionsHelper</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WeekendActivity.html">WeekendActivity</a>
  
    <li><a href="./WeekendMailer.html">WeekendMailer</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ActivityDetailController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-activities" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activities</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>changed <a
href="ActivityDetailController.html#method-i-activity_detail_iframe">#activity_detail_iframe</a>
to activities SEO</p>
          

          
          <div class="method-source-code" id="activities-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activities</span>
  <span class="ruby-comment">#~ @act_id = params[:act_view]</span>
  <span class="ruby-comment">#~ @mode = params[:det].split('/')[2] if !params[:det].nil? </span>
  <span class="ruby-comment"># SEO 301 redirections starts</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">fullpath</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;/activities&quot;</span>)
    <span class="ruby-ivar">@act_id</span> =<span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@act_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">'-'</span>)[<span class="ruby-value">0</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@act_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@act_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@user_profile</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id = #{@activity.user_id}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-ivar">@bus_name</span> = <span class="ruby-ivar">@user_profile</span>.<span class="ruby-identifier">slug</span>
  <span class="ruby-ivar">@city</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]
  <span class="ruby-ivar">@categ</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:category</span>]
  <span class="ruby-ivar">@sub_categ</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_category</span>]
  <span class="ruby-identifier">cat</span>=<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">category</span>
  <span class="ruby-identifier">sub_cat</span>=<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">sub_category</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:category</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:sub_category</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/#{@city}-ca/#{@bus_name}/#{@categ}/#{@sub_categ}/#{@activity.slug}&quot;</span>, <span class="ruby-value">:status=</span><span class="ruby-operator">&gt;</span> <span class="ruby-value">301</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/#{@city}-ca/#{@bus_name}/#{cat}/#{sub_cat}/#{@activity.slug}&quot;</span>, <span class="ruby-value">:status=</span><span class="ruby-operator">&gt;</span> <span class="ruby-value">301</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># end</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-string">&quot;parent&quot;</span>
  <span class="ruby-ivar">@mode_act</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]
          <span class="ruby-ivar">@act_id</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@act_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@act_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@act_id</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_slug</span>(<span class="ruby-ivar">@act_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@act_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#~ @country_code = Country.where(&quot;country_id = ?&quot;,1)</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;expiration_date &gt;= ?&quot;</span>,<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>)  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#To store views count in activity count table</span>
  <span class="ruby-constant">ActivityCount</span>.<span class="ruby-identifier">updateViewCount</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:click</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;clicked&quot;</span>
    <span class="ruby-identifier">ip_address</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ip</span>
    <span class="ruby-identifier">user_add</span> = <span class="ruby-string">&quot;anonymous&quot;</span>
    <span class="ruby-identifier">user_add</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{@activity.activity_id} and device_id='#{ip_address}' and click_date='#{Date.today}' and user_type='#{user_add}'&quot;</span>).<span class="ruby-identifier">last</span>  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@click_count</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">no_of_clicks</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-ivar">@click_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
      <span class="ruby-ivar">@update</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:no_of_attempts</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>,<span class="ruby-value">:user_type</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">user_add</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">sdate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
      <span class="ruby-identifier">edate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
      <span class="ruby-ivar">@mon</span> = <span class="ruby-constant">MonthlyBudget</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{@activity.user_id} and bid_start_date='#{sdate}' and bid_end_date='#{edate}'&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#@mon = MonthlyBudget.find_by_user_id(@activity.user_id)</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-comment">#update balance amount to monthly budget table</span>
        <span class="ruby-ivar">@monthly</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;monthly_budget&quot;</span>]
        <span class="ruby-ivar">@attempt</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;attempt_amount&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;bid_amount&quot;</span>].<span class="ruby-identifier">to_i</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
          <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:attempt_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@attempt</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-comment">#if click amount reached to  monthly amount send notification to provider</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
              <span class="ruby-comment">#UserMailer.delay(queue: &quot;Monthly Budget&quot;, priority: 2, run_at: 10.seconds.from_now).monthly_budget_provider(@user)</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@add_click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_id</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">device_id</span> = <span class="ruby-identifier">ip_address</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_attempts</span> =  <span class="ruby-value">1</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_amount</span> = <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">bid_amount</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_clicks</span> = <span class="ruby-value">1</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_type</span> = <span class="ruby-identifier">user_add</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@event_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:list_details</span>]
  <span class="ruby-ivar">@provider_mode</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_mode</span>]
  <span class="ruby-ivar">@free_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:getinfo</span>]
  <span class="ruby-ivar">@contact_pro</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_provider</span>]
  <span class="ruby-comment">#render :partial =&gt; 'activity_detail'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activities-source -->
          
        </div>

        

        
      </div><!-- activities-method -->

    
      <div id="method-i-activity_detail_iframe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_detail_iframe</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>~ def <a
href="ActivityDetailController.html#method-i-activity_detail_iframe">#activity_detail_iframe</a>
~ @det = <a href="http://:det">params</a>.split(‘/’) if <a
href="http://:det">params</a> &amp;&amp; <a
href="http://:det">params</a>!=” ~ redirect_to “/<a
href="http://0">activities/#{@det</a>}-#{@<a href="http://5">det</a>}/#{@<a
href="http://1">det</a>}/#{@<a href="http://2">det</a>}/#{@<a
href="http://3">det</a>}/#{@<a href="http://4">det</a>}” ~ end old activity
detail iframe</p>
          

          
          <div class="method-source-code" id="activity_detail_iframe-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2303</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_detail_iframe</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
                <span class="ruby-ivar">@det</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-ivar">@det</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">'/'</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
       <span class="ruby-keyword">end</span>
       <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]
                <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/activity_share/#{params[:det]}/#{ params[:mode]}/#{params[:act]}&quot;</span>  
      <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@det</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@det</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;parent&quot;</span>
           <span class="ruby-ivar">@mode</span>=<span class="ruby-string">&quot;p&quot;</span>
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/activities/#{@mode}/#{@det[1]}/#{@det[3]}/#{@det[4]}/#{@det[0]}-#{@det[5]}&quot;</span>, <span class="ruby-value">:status=</span><span class="ruby-operator">&gt;</span> <span class="ruby-value">301</span>
       <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@det</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@det</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;provider&quot;</span>
           <span class="ruby-ivar">@mode</span>=<span class="ruby-string">&quot;pr&quot;</span>
            <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/activities/#{@mode}/#{@det[1]}/#{@det[3]}/#{@det[4]}/#{@det[0]}-#{@det[5]}&quot;</span>, <span class="ruby-value">:status=</span><span class="ruby-operator">&gt;</span> <span class="ruby-value">301</span>
       <span class="ruby-keyword">end</span>
       <span class="ruby-comment">#~ @det = params[:det].split('/') if params[:det] &amp;&amp; params[:det]!=''</span>
       <span class="ruby-comment">#~ if @det &amp;&amp; @det[2] == &quot;parent&quot;</span>
           <span class="ruby-comment">#~ @mode=&quot;p&quot;</span>
       <span class="ruby-comment">#~ elsif @det &amp;&amp; @det[2] == &quot;provider&quot;</span>
           <span class="ruby-comment">#~ @mode=&quot;pr&quot;</span>
       <span class="ruby-comment">#~ end</span>
       <span class="ruby-comment">#~ redirect_to &quot;/activities/#{@mode}/#{@det[1]}/#{@det[3]}/#{@det[4]}/#{@det[0]}-#{@det[5]}&quot;, :status=&gt; 301</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_detail_iframe-source -->
          
        </div>

        

        
      </div><!-- activity_detail_iframe-method -->

    
      <div id="method-i-activity_detail_old" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_detail_old</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activity_detail_old-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2327</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_detail_old</span>
  <span class="ruby-ivar">@before_login_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>])
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:click</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;clicked&quot;</span>
    <span class="ruby-identifier">ip_address</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ip</span>
    <span class="ruby-identifier">user_add</span> = <span class="ruby-string">&quot;anonymous&quot;</span>
    <span class="ruby-identifier">user_add</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:det]} and device_id='#{ip_address}' and click_date='#{Date.today}' and user_type='#{user_add}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@click_count</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">no_of_clicks</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-ivar">@click_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
      <span class="ruby-ivar">@update</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:no_of_attempts</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>,<span class="ruby-value">:user_type</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">user_add</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">sdate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
      <span class="ruby-identifier">edate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
      <span class="ruby-ivar">@mon</span> = <span class="ruby-constant">MonthlyBudget</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{@activity.user_id} and bid_start_date='#{sdate}' and bid_end_date='#{edate}'&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-comment">#@mon = MonthlyBudget.find_by_user_id(@activity.user_id)</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-comment">#update balance amount to monthly budget table</span>
        <span class="ruby-ivar">@monthly</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;monthly_budget&quot;</span>]
        <span class="ruby-ivar">@attempt</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;attempt_amount&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;bid_amount&quot;</span>].<span class="ruby-identifier">to_i</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
          <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:attempt_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@attempt</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-comment">#if click amount reached to  monthly amount send notification to provider</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
              <span class="ruby-comment">#UserMailer.delay(queue: &quot;Monthly Budget&quot;, priority: 2, run_at: 10.seconds.from_now).monthly_budget_provider(@user)</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@add_click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">device_id</span> = <span class="ruby-identifier">ip_address</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_attempts</span> =  <span class="ruby-value">1</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_amount</span> = <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">bid_amount</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_clicks</span> = <span class="ruby-value">1</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_type</span> = <span class="ruby-identifier">user_add</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@event_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:list_details</span>]
  <span class="ruby-ivar">@provider_mode</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_mode</span>]
  <span class="ruby-ivar">@free_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:getinfo</span>]
  <span class="ruby-ivar">@contact_pro</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_provider</span>]
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'activity_detail'</span>
        
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_detail_old-source -->
          
        </div>

        

        
      </div><!-- activity_detail_old-method -->

    
      <div id="method-i-activity_detail_page_old" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_detail_page_old</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activity_detail_page_old-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2145</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_detail_page_old</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>])
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:click</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;clicked&quot;</span>
    <span class="ruby-identifier">ip_address</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ip</span>
    <span class="ruby-identifier">user_add</span> = <span class="ruby-string">&quot;anonymous&quot;</span>
    <span class="ruby-identifier">user_add</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:det]} and device_id='#{ip_address}' and click_date='#{Date.today}' and user_type='#{user_add}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@click_count</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">no_of_clicks</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-ivar">@click_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
      <span class="ruby-ivar">@update</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:no_of_attempts</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>,<span class="ruby-value">:user_type</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">user_add</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">sdate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
      <span class="ruby-identifier">edate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
      <span class="ruby-ivar">@mon</span> = <span class="ruby-constant">MonthlyBudget</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{@activity.user_id} and bid_start_date='#{sdate}' and bid_end_date='#{edate}'&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-comment">#@mon = MonthlyBudget.find_by_user_id(@activity.user_id)</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-comment">#update balance amount to monthly budget table</span>
        <span class="ruby-ivar">@monthly</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;monthly_budget&quot;</span>]
        <span class="ruby-ivar">@attempt</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;attempt_amount&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;bid_amount&quot;</span>].<span class="ruby-identifier">to_i</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
          <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:attempt_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@attempt</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-comment">#if click amount reached to  monthly amount send notification to provider</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
              <span class="ruby-comment">#UserMailer.delay(queue: &quot;Monthly Budget&quot;, priority: 2, run_at: 10.seconds.from_now).monthly_budget_provider(@user)</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@add_click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">device_id</span> = <span class="ruby-identifier">ip_address</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_attempts</span> =  <span class="ruby-value">1</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_amount</span> = <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">bid_amount</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_clicks</span> = <span class="ruby-value">1</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_type</span> = <span class="ruby-identifier">user_add</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>
        <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@event_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:list_details</span>]
  <span class="ruby-ivar">@provider_mode</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_mode</span>]
  <span class="ruby-ivar">@free_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:getinfo</span>]
  <span class="ruby-ivar">@contact_pro</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_provider</span>]
  <span class="ruby-comment">#render :partial =&gt; 'activity_detail'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_detail_page_old-source -->
          
        </div>

        

        
      </div><!-- activity_detail_page_old-method -->

    
      <div id="method-i-activity_email_link" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_email_link</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activity_email_link-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2672</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_email_link</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_email_link-source -->
          
        </div>

        

        
      </div><!-- activity_email_link-method -->

    
      <div id="method-i-activitydetail_new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activitydetail_new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>~ def activity_detail_if</p>
          

          
          <div class="method-source-code" id="activitydetail_new-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2385</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">activitydetail_new</span>
    <span class="ruby-comment">#~ @act_id = params[:act_view]</span>
    <span class="ruby-ivar">@before_login_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
     <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]
            <span class="ruby-ivar">@act_id</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]
            <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@act_id</span>)
    <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@act_id</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">'-'</span>)[<span class="ruby-value">0</span>]
            <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@act_id</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#~ @activity = Activity.find(params[:det])</span>
    <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]
    <span class="ruby-comment">#~ @country_code = Country.where(&quot;country_id = ?&quot;,1)</span>
    <span class="ruby-ivar">@form_present</span> = <span class="ruby-constant">ActivityForm</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? and active_status=?&quot;</span>,<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-keyword">true</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:form_id</span>).<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@mode</span><span class="ruby-operator">==</span><span class="ruby-string">'provider'</span>
      <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;expiration_date &gt;= ?&quot;</span>,<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#To store views count in activity count table</span>
    <span class="ruby-constant">ActivityCount</span>.<span class="ruby-identifier">updateViewCount</span>(<span class="ruby-ivar">@act_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_id</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    
    <span class="ruby-ivar">@set_color</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:set_color</span>]
    <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:click</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;clicked&quot;</span>
      <span class="ruby-identifier">ip_address</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ip</span>
      <span class="ruby-identifier">user_add</span> = <span class="ruby-string">&quot;anonymous&quot;</span>
      <span class="ruby-identifier">user_add</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{@act_id} and device_id='#{ip_address}' and click_date='#{Date.today}' and user_type='#{user_add}'&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@click_count</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">no_of_clicks</span>
        <span class="ruby-identifier">count</span> = <span class="ruby-ivar">@click_count</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
        <span class="ruby-ivar">@update</span> = <span class="ruby-ivar">@click</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:no_of_attempts</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>,<span class="ruby-value">:user_type</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">user_add</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">sdate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
        <span class="ruby-identifier">edate</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
        <span class="ruby-ivar">@mon</span> = <span class="ruby-constant">MonthlyBudget</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{@activity.user_id} and bid_start_date='#{sdate}' and bid_end_date='#{edate}'&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-comment">#@mon = MonthlyBudget.find_by_user_id(@activity.user_id)</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-comment">#update balance amount to monthly budget table</span>
          <span class="ruby-ivar">@monthly</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;monthly_budget&quot;</span>]
          <span class="ruby-ivar">@attempt</span> = <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;attempt_amount&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@mon</span>[<span class="ruby-string">&quot;bid_amount&quot;</span>].<span class="ruby-identifier">to_i</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:attempt_amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@attempt</span>)
          <span class="ruby-keyword">end</span>
          <span class="ruby-comment">#if click amount reached to  monthly amount send notification to provider</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@monthly</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@attempt</span>.<span class="ruby-identifier">to_i</span>
              <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
                <span class="ruby-comment">#UserMailer.delay(queue: &quot;Monthly Budget&quot;, priority: 2, run_at: 10.seconds.from_now).monthly_budget_provider(@user)</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-ivar">@add_click</span> = <span class="ruby-constant">ActivityClick</span>.<span class="ruby-identifier">new</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-ivar">@act_id</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">device_id</span> = <span class="ruby-identifier">ip_address</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_attempts</span> =  <span class="ruby-value">1</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_amount</span> = <span class="ruby-ivar">@mon</span>.<span class="ruby-identifier">bid_amount</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">no_of_clicks</span> = <span class="ruby-value">1</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_type</span> = <span class="ruby-identifier">user_add</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">click_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>
          <span class="ruby-ivar">@add_click</span>.<span class="ruby-identifier">save</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-ivar">@event_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:list_details</span>]
    <span class="ruby-ivar">@provider_mode</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_mode</span>]
    <span class="ruby-ivar">@free_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:getinfo</span>]
    <span class="ruby-ivar">@contact_pro</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_provider</span>]
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'activitydetail_new'</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- activitydetail_new-source -->
          
        </div>

        

        
      </div><!-- activitydetail_new-method -->

    
      <div id="method-i-activitydetailpage_jax" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activitydetailpage_jax</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>New <a href="Activity.html">Activity</a> Page PJAX by sindhu</p>
          

          
          <div class="method-source-code" id="activitydetailpage_jax-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2465</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activitydetailpage_jax</span>
   <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@act_id</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:det</span>]
 <span class="ruby-comment">#  @act_name = params[:act_name]</span>
   <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;ACTIVITY_ID=?&quot;</span>,<span class="ruby-ivar">@act_id</span>).<span class="ruby-identifier">last</span>
   <span class="ruby-ivar">@act_id</span>=<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
   <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]
   <span class="ruby-ivar">@mode</span> = <span class="ruby-string">'parent'</span>
   <span class="ruby-ivar">@form_present</span> = <span class="ruby-constant">ActivityForm</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? and active_status=?&quot;</span>,<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-keyword">true</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:form_id</span>).<span class="ruby-identifier">present?</span>  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
   <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@mode</span><span class="ruby-operator">==</span><span class="ruby-string">'provider'</span>
     <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
   <span class="ruby-keyword">else</span>
     <span class="ruby-ivar">@act_schedules</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;expiration_date &gt;= ?&quot;</span>,<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>)
   <span class="ruby-keyword">end</span>
   <span class="ruby-ivar">@activity_usr</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
       <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_usr</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_usr</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">business_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_usr</span>.<span class="ruby-identifier">user_type</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;P&quot;</span>
         <span class="ruby-ivar">@usr_name</span> = <span class="ruby-ivar">@activity_usr</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">business_name</span>
       <span class="ruby-keyword">else</span>
         <span class="ruby-ivar">@usr_name</span> = <span class="ruby-ivar">@activity_usr</span>.<span class="ruby-identifier">user_name</span>
       <span class="ruby-keyword">end</span>
   
   <span class="ruby-comment">#To store views count in activity count table</span>
   <span class="ruby-constant">ActivityCount</span>.<span class="ruby-identifier">updateViewCount</span>(<span class="ruby-ivar">@act_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_id</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
   <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
   <span class="ruby-ivar">@event_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:list_details</span>]
   <span class="ruby-ivar">@provider_mode</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_mode</span>]
   <span class="ruby-ivar">@free_page</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:getinfo</span>]
   <span class="ruby-ivar">@contact_pro</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:contact_provider</span>]
       <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
               <span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
       <span class="ruby-keyword">end</span>
 <span class="ruby-keyword">end</span></pre>
          </div><!-- activitydetailpage_jax-source -->
          
        </div>

        

        
      </div><!-- activitydetailpage_jax-method -->

    
      <div id="method-i-contact_provider_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_provider_info</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>contact provider informatino page get method</p>
          

          
          <div class="method-source-code" id="contact_provider_info-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_provider_info</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-ivar">@cont_message</span>=<span class="ruby-string">&quot;I found your activity in Famtivity. I would like a little more information about the pricing structure before I proceed. Please get in touch with me.&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_provider_info-source -->
          
        </div>

        

        
      </div><!-- contact_provider_info-method -->

    
      <div id="method-i-contact_provider_success" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_provider_success</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>contact provider post success function calling</p>
          

          
          <div class="method-source-code" id="contact_provider_success-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3251</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_provider_success</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@send_to</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_to</span>]
  <span class="ruby-ivar">@activity_user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment"># add from to user</span>
  <span class="ruby-ivar">@from_user</span>=<span class="ruby-identifier">current_user</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity_user</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Contact Info&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">provider_contact_price</span>(<span class="ruby-ivar">@from_user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@activity_user</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-ivar">@send_to</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
    <span class="ruby-comment">#@result = UserMailer.get_information_mail(@from_user,@activity,@edit_activity_provider_mail,params[:message],@send_to,params[:subject]).deliver if !user.nil? &amp;&amp; user.user_flag==TRUE</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Contact Info&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">provider_contact_price</span>(<span class="ruby-ivar">@from_user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@activity_user</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-ivar">@send_to</span>)
    <span class="ruby-comment">#@result = UserMailer.get_information_mail(@from_user,@activity,@get_current_url,params[:message],@send_to,params[:subject]).deliver</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_provider_success-source -->
          
        </div>

        

        
      </div><!-- contact_provider_success-method -->

    
      <div id="method-i-create_discount_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_discount_type</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_discount_type-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_discount_type</span>
  <span class="ruby-ivar">@provid_disc_types</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} or user_id is null&quot;</span>)
  <span class="ruby-ivar">@chose_disc</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:cu_value]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;shared/discount_type&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_discount_type-source -->
          
        </div>

        

        
      </div><!-- create_discount_type-method -->

    
      <div id="method-i-create_first_discount_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_first_discount_type</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_first_discount_type-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 75</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_first_discount_type</span>
  <span class="ruby-ivar">@provid_disc_types</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} or user_id is null&quot;</span>)
  <span class="ruby-ivar">@provid_disc_types</span> = <span class="ruby-ivar">@provid_disc_types</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">provider_discount_type_id</span><span class="ruby-operator">==</span><span class="ruby-value">3</span>} <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;net&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;net_&quot;</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;shared/create_first_discount_type&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_first_discount_type-source -->
          
        </div>

        

        
      </div><!-- create_first_discount_type-method -->

    
      <div id="method-i-create_thank" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_thank</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_thank-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2536</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_thank</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- create_thank-source -->
          
        </div>

        

        
      </div><!-- create_thank-method -->

    
      <div id="method-i-delete_discount" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_discount</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>before deleting the discount</p>
          

          
          <div class="method-source-code" id="delete_discount-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_discount</span>
  <span class="ruby-ivar">@page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-ivar">@dicount</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@to_delete</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
  <span class="ruby-ivar">@list</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mul</span>]
  <span class="ruby-ivar">@del_act</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:del_action</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_discount-source -->
          
        </div>

        

        
      </div><!-- delete_discount-method -->

    
      <div id="method-i-delete_provider_discount_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_provider_discount_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="delete_provider_discount_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 188</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_provider_discount_fee</span>
  <span class="ruby-identifier">up_disc_provider_fee</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_discount_code_type_id=#{params[:fee_type_id]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">up_disc_provider_fee</span>.<span class="ruby-identifier">destroy</span>() <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">up_disc_provider_fee</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@pro_discount_fees</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_provider_discount_fee-source -->
          
        </div>

        

        
      </div><!-- delete_provider_discount_fee-method -->

    
      <div id="method-i-delete_provider_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_provider_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="delete_provider_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_provider_fee</span>
  <span class="ruby-identifier">up_provider_fee</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_fee_type_id=#{params[:fee_type_id]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">up_provider_fee</span>.<span class="ruby-identifier">destroy</span>() <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">up_provider_fee</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_provider_fee-source -->
          
        </div>

        

        
      </div><!-- delete_provider_fee-method -->

    
      <div id="method-i-discount_destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">discount_destroy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="discount_destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">discount_destroy</span>
  <span class="ruby-identifier">dis_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&amp;\w+;/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">parameterize</span>
  <span class="ruby-identifier">all_id</span>=<span class="ruby-identifier">dis_id</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">'-'</span>);
  <span class="ruby-identifier">all_id</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">al</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">pro_fees</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">al</span>)
    <span class="ruby-identifier">act_price</span> = <span class="ruby-constant">ActivityDiscountPrice</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;provider_discount_type_id=#{al}&quot;</span>)
    <span class="ruby-identifier">act_price</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">price</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">price</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">pro_fees</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-ivar">@pro_fees</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- discount_destroy-source -->
          
        </div>

        

        
      </div><!-- discount_destroy-method -->

    
      <div id="method-i-edit_acitivity_thank" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_acitivity_thank</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_acitivity_thank-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2541</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_acitivity_thank</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_acitivity_thank-source -->
          
        </div>

        

        
      </div><!-- edit_acitivity_thank-method -->

    
      <div id="method-i-edit_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2500</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_activity</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-comment">#@cities = [&quot;Chicago&quot;,&quot;Dallas&quot;,&quot;Detroit&quot;,&quot;Houston&quot;,&quot;Las Vegas&quot;,&quot;Los Angeles&quot;,&quot;New York&quot;,&quot;Philadelphia&quot;,&quot;San Antonio&quot;,&quot;San Francisco&quot;,&quot;San Jose&quot;,&quot;Seattle&quot;,&quot;Walnut Creek&quot;]</span>
  <span class="ruby-ivar">@cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;city_name Asc&quot;</span>).<span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
  <span class="ruby-ivar">@act_repeat</span> =  <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">schedule_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_activity-source -->
          
        </div>

        

        
      </div><!-- edit_activity-method -->

    
      <div id="method-i-edit_activity_parent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_activity_parent</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_activity_parent-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2528</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_activity_parent</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-comment">#@cities = [&quot;Chicago&quot;,&quot;Dallas&quot;,&quot;Detroit&quot;,&quot;Houston&quot;,&quot;Las Vegas&quot;,&quot;Los Angeles&quot;,&quot;New York&quot;,&quot;Philadelphia&quot;,&quot;San Antonio&quot;,&quot;San Francisco&quot;,&quot;San Jose&quot;,&quot;Seattle&quot;,&quot;Walnut Creek&quot;]</span>
  <span class="ruby-ivar">@cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;city_name Asc&quot;</span>).<span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
  <span class="ruby-ivar">@act_repeat</span> =  <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">schedule_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_activity_parent-source -->
          
        </div>

        

        
      </div><!-- edit_activity_parent-method -->

    
      <div id="method-i-edit_discount_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_discount_type</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_discount_type-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_discount_type</span>
  <span class="ruby-ivar">@chose_disc</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_discount_type_id=#{params[:cu_value]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_discount_type-source -->
          
        </div>

        

        
      </div><!-- edit_discount_type-method -->

    
      <div id="method-i-edit_provider_discount_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_provider_discount_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_provider_discount_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_provider_discount_fee</span>
  <span class="ruby-ivar">@edit_disc_fees</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_discount_code_type_id=#{params[:fee_type_id]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_provider_discount_fee-source -->
          
        </div>

        

        
      </div><!-- edit_provider_discount_fee-method -->

    
      <div id="method-i-edit_provider_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_provider_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_provider_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_provider_fee</span>
  <span class="ruby-ivar">@edit_fees</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_fee_type_id=#{params[:fee_type_id]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_provider_fee-source -->
          
        </div>

        

        
      </div><!-- edit_provider_fee-method -->

    
      <div id="method-i-embed_popup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">embed_popup</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>provider embedded activity</p>
          

          
          <div class="method-source-code" id="embed_popup-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2639</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">embed_popup</span>
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-ivar">@embed_user</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:pu</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:pu</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pu</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-ivar">@embed_act_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-comment">#~ get_total_feature_list(arr)</span>
  <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:pu</span>])
  <span class="ruby-identifier">featured</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">featured</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">featured</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span><span class="ruby-value">8</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>] = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:feature_page</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-comment">#~ get_total_feature_list(arr)</span>
    <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:pu</span>])
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT trim(category) as category&quot;</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;lower(category)!=?&quot;</span>,<span class="ruby-string">'default'</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- embed_popup-source -->
          
        </div>

        

        
      </div><!-- embed_popup-method -->

    
      <div id="method-i-embedded_link" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">embedded_link</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="embedded_link-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2619</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">embedded_link</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-ivar">@act_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]
  <span class="ruby-ivar">@img_path</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">avatar</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
  <span class="ruby-ivar">@act_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- embedded_link-source -->
          
        </div>

        

        
      </div><!-- embedded_link-method -->

    
      <div id="method-i-find_us_on_famtivity_popup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_us_on_famtivity_popup</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>find_us_on_famtivity</p>
          

          
          <div class="method-source-code" id="find_us_on_famtivity_popup-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2634</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_us_on_famtivity_popup</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- find_us_on_famtivity_popup-source -->
          
        </div>

        

        
      </div><!-- find_us_on_famtivity_popup-method -->

    
      <div id="method-i-get_total_feature_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_total_feature_list</span><span
            class="method-args">(arr,user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="get_total_feature_list-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2659</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_total_feature_list</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">user_id</span>)
  <span class="ruby-comment">#featured = Activity.where(&quot;lower(active_status)='active' and featured_flag =true and cleaned=true and lower(created_by)='provider'&quot;).order(&quot;activity_id DESC&quot;).uniq</span>
  <span class="ruby-comment">#featured =Activity.find_by_sql(&quot;select act.* from activities act left join users u on act.user_id=u.user_id where lower(u.user_plan)='sell' and lower(active_status)='active' and cleaned=true and lower(created_by)='provider' order by activity_id desc&quot;)</span>
  <span class="ruby-comment">#~ featured = Activity.find_by_sql(&quot;select * from activities where user_id=#{user_id} and cleaned=true and lower(active_status)='active' and lower(created_by)='provider' order by activity_id desc limit 200&quot;) if !user_id.nil? &amp;&amp; user_id.present?</span>
  <span class="ruby-identifier">featured</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:user</span>,<span class="ruby-value">:activity_schedule</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activities.user_id=#{user_id} and lower(active_status)='active' and cleaned=true and lower(created_by)='provider' and expiration_date &gt;= '#{Date.today}'&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activity_id DESC&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">featured</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-comment">#~ Activity.schedule_feature_list(session[:date],event,arr) if !event.nil?</span>
    <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:discount_eligible=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">discount_eligible</span>, <span class="ruby-value">:schedule</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>, <span class="ruby-value">:activity=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>, <span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:leader=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">leader</span>, <span class="ruby-value">:skill_level=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">skill_level</span>, <span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">schedule_mode</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:min_age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:slug=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">slug</span>}
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">featured</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">featured</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">arr</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_total_feature_list-source -->
          
        </div>

        

        
      </div><!-- get_total_feature_list-method -->

    
      <div id="method-i-googleCalAdd" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">googleCalAdd</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Google cal datas</p>
          

          
          <div class="method-source-code" id="googleCalAdd-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3573</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">googleCalAdd</span>
  <span class="ruby-identifier">rsult</span> = <span class="ruby-string">''</span>
  <span class="ruby-identifier">activity_sched</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:sched_id</span>])
  <span class="ruby-identifier">test</span> = <span class="ruby-identifier">googleCalData</span>(<span class="ruby-identifier">activity_sched</span>) <span class="ruby-comment">#From ActivityDetail helper</span>
  <span class="ruby-identifier">t_zone</span> = <span class="ruby-identifier">time_zone_location</span> <span class="ruby-comment">#From ActivityDetail helper</span>
  <span class="ruby-identifier">rsult</span> = <span class="ruby-identifier">rsult</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{test[0]}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;@#{test[1]}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;@#{test[2]}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;@#{test[3]}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;@#{test[4]}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;@#{test[5]}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;@#{test[6]}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;@#{t_zone}&quot;</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{rsult}&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{test[7]}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- googleCalAdd-source -->
          
        </div>

        

        
      </div><!-- googleCalAdd-method -->

    
      <div id="method-i-link_clicked" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">link_clicked</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>method for link clicked in activity details page by rajkumar</p>
          

          
          <div class="method-source-code" id="link_clicked-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3271</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">link_clicked</span>
  <span class="ruby-ivar">@tdate</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
  <span class="ruby-ivar">@sdat</span> = <span class="ruby-ivar">@tdate</span>.<span class="ruby-identifier">at_beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@edat</span> = <span class="ruby-ivar">@tdate</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@usr_clk</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and activity_id = ? and start_date = ? and end_date = ?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>],<span class="ruby-node">&quot;#{@sdat}&quot;</span>,<span class="ruby-node">&quot;#{@edat}&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@usr_clk</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#insert the data</span>
    <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:pemail</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pemail</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pemail</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'email'</span>
      <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">email_count</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">website_count</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">start_date</span> = <span class="ruby-ivar">@sdat</span>
    <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">end_date</span> = <span class="ruby-ivar">@edat</span>
    <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-ivar">@status</span> = <span class="ruby-string">&quot;inserted&quot;</span>
  <span class="ruby-keyword">else</span> <span class="ruby-comment">#update the data while clicking</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@usr_clk</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:pemail</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pemail</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:pemail</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'email'</span>
        <span class="ruby-ivar">@ecount</span>=<span class="ruby-string">&quot;&quot;</span> <span class="ruby-comment">#email count updated</span>
        <span class="ruby-ivar">@ecount</span> = <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">email_count</span> <span class="ruby-comment">#increment the click count values</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ecount</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@ecount</span> = <span class="ruby-ivar">@ecount</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@ecount</span> = <span class="ruby-value">1</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:email_count=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@ecount</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
        <span class="ruby-ivar">@status</span> = <span class="ruby-string">&quot;updated&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#website_count link updated</span>
        <span class="ruby-ivar">@wcount</span>=<span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@wcount</span> = <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">website_count</span> <span class="ruby-comment">#increment the click count values</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@wcount</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@wcount</span> = <span class="ruby-ivar">@wcount</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@wcount</span> = <span class="ruby-value">1</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:website_count=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@wcount</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
        <span class="ruby-ivar">@status</span> = <span class="ruby-string">&quot;updated&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@status</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- link_clicked-source -->
          
        </div>

        

        
      </div><!-- link_clicked-method -->

    
      <div id="method-i-msg_to_provider_curator" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">msg_to_provider_curator</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>send message to provider card</p>
          

          
          <div class="method-source-code" id="msg_to_provider_curator-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3539</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">msg_to_provider_curator</span>
  <span class="ruby-ivar">@pro_usr</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter your Email&quot;</span>
   
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
    <span class="ruby-comment">#Stored the send message track in activity track table start</span>
    <span class="ruby-ivar">@clk_track</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">store_providercard_withuser</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-ivar">@date</span>,<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@pro_usr</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">message_to_provider_curator</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>])
  <span class="ruby-keyword">else</span> <span class="ruby-comment">#if current user not present</span>
    <span class="ruby-comment">#Stored the send message track in activity track table end</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to provider card user before login&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">beforeln_msg_to_cardprovider</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>],<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>])
    <span class="ruby-ivar">@clk_track</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">store_providercard_withuser</span>(<span class="ruby-string">''</span>,<span class="ruby-ivar">@date</span>,<span class="ruby-ivar">@email</span>,<span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@pro_usr</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment">#current user end</span>
      
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-comment">#~ format.js{render :text =&gt; &quot;$('.success_send_msg').css('display', 'block').fadeOut(2000);$('#send_msg').val('');&quot;}</span>
     <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;$('html, body').animate({ scrollTop: 0 });
                                      $('#send_msg').val('');
                                   $('.flash-message').html('Message has been sent successfully!');
                                      var win=$(window).width();
                                      var con=$('.flash_content').width();
                                      var leftvalue=((win/2)-(con/2))
                                      $('.flash_content').css('left',leftvalue+'px');
                                      $('.flash_content').css('top','67px');
                                      $('.flash_content').fadeIn().delay(5000).fadeOut();
    &quot;</span>}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- msg_to_provider_curator-source -->
          
        </div>

        

        
      </div><!-- msg_to_provider_curator-method -->

    
      <div id="method-i-parent_acitivity_thank" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parent_acitivity_thank</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="parent_acitivity_thank-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2545</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parent_acitivity_thank</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- parent_acitivity_thank-source -->
          
        </div>

        

        
      </div><!-- parent_acitivity_thank-method -->

    
      <div id="method-i-parent_activity_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parent_activity_update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="parent_activity_update-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3045</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parent_activity_update</span>
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">3</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">to_f</span>)<span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_1</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 1&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span>
  <span class="ruby-ivar">@activity_old</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">clone</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">city_se</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;city_name='#{params[:city]}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">latitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">latitude</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">longitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">longitude</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity_old</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_mode</span>]
    <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]])
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;Any Time&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Time&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:any_where</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck_1</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck_1</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>]
            <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_total</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_total</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1_1]} #{params[:schedule_stime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1_1]} #{params[:schedule_etime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Schedule&quot;</span>,<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],
            <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Schedule&quot;</span>)
        <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>],
          <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>],
          <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date1_1</span>],<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month1_1</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days_1</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal_1</span>])

      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Schedule&quot;</span>)
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1_1]} #{params[:schedule_stime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1_1]} #{params[:schedule_etime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Schedule&quot;</span>,<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2_1</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2_1</span>])
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Any Time&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1_1]} #{params[:schedule_stime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1_1]} #{params[:schedule_etime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck_1</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck_1</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>]
              <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]
          <span class="ruby-keyword">end</span>


          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Schedule&quot;</span>
          <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Schedule&quot;</span>,<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],
            <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
          <span class="ruby-ivar">@activity_repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_every</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_never</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>]
            <span class="ruby-identifier">end_on_date</span> =<span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;0&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">end_on_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date1_1</span>]
            <span class="ruby-keyword">end</span>
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">end_occurences</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_on</span>= <span class="ruby-identifier">end_on_date</span>
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">starts_on</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_on</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days_1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeats</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal_1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeated_by_month</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:month1_1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>],
              <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>],
              <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_on_date1_1</span>],<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month1_1</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days_1</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal_1</span>])
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Whole Day&quot;</span>)

          <span class="ruby-ivar">@activity_sc</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">schedule_id</span>])
          <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Whole Day&quot;</span>,<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2_1</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2_1</span>])
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Time&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:any_where</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>


  
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
  
  <span class="ruby-comment">#sending a  mail while editing the activity page to participant</span>
  <span class="ruby-comment"># if params[:attendees] == &quot;1&quot;</span>
  <span class="ruby-ivar">@participant</span>=<span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id =? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-comment">#@result = UserMailer.edit_activity_mail(user,@activity_profile_apf,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Edit Parent Activity to Participants&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_parent_participant_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
    <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment">#do end participant</span>
  <span class="ruby-comment">#end</span>
  <span class="ruby-comment">#sending a mail while editing the activity by the parent</span>
  <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Parent Edit Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_activity_parent_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
    <span class="ruby-comment">#@result = UserMailer.edit_activity_provider_mail(user,@activity_profile_apf,@get_current_url,attend_email,params[:subject]).deliver</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">redirect_to</span> <span class="ruby-value">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;parent_acitivity_thank&quot;</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- parent_activity_update-source -->
          
        </div>

        

        
      </div><!-- parent_activity_update-method -->

    
      <div id="method-i-preview_embed_popup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">preview_embed_popup</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="preview_embed_popup-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2655</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">preview_embed_popup</span>
  <span class="ruby-identifier">embed_popup</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- preview_embed_popup-source -->
          
        </div>

        

        
      </div><!-- preview_embed_popup-method -->

    
      <div id="method-i-provider_activity_discount" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_activity_discount</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_activity_discount-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_activity_discount</span>
  <span class="ruby-identifier">pro_fees</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-identifier">pro_fees</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_activity_discount-source -->
          
        </div>

        

        
      </div><!-- provider_activity_discount-method -->

    
      <div id="method-i-provider_activity_success" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_activity_success</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_activity_success-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_activity_success</span>
  <span class="ruby-ivar">@before_login_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@send_to</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_to</span>]
  <span class="ruby-ivar">@activity_user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment"># add from to user</span>
  <span class="ruby-ivar">@from_user</span>=<span class="ruby-identifier">current_user</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity_user</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Get Info&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">get_information_mail</span>(<span class="ruby-ivar">@from_user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@activity_user</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-ivar">@send_to</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
    <span class="ruby-comment">#@result = UserMailer.get_information_mail(@from_user,@activity,@edit_activity_provider_mail,params[:message],@send_to,params[:subject]).deliver if !user.nil? &amp;&amp; user.user_flag==TRUE</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Get Info&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">get_information_mail</span>(<span class="ruby-ivar">@from_user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@activity_user</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-ivar">@send_to</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
    <span class="ruby-comment">#@result = UserMailer.get_information_mail(@from_user,@activity,@get_current_url,params[:message],@send_to,params[:subject]).deliver</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_activity_success-source -->
          
        </div>

        

        
      </div><!-- provider_activity_success-method -->

    
      <div id="method-i-provider_detail_iframe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_detail_iframe</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_detail_iframe-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3368</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_detail_iframe</span>
  <span class="ruby-ivar">@mode_act</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]
  <span class="ruby-ivar">@user_profile</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id = #{params[:det]}&quot;</span>).<span class="ruby-identifier">last</span> 
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/#{@user_profile.city.gsub(' ','-').downcase if !@user_profile.nil? &amp;&amp; !@user_profile.city.nil?}-ca/#{@user_profile.slug}&quot;</span>, <span class="ruby-value">:status=</span><span class="ruby-operator">&gt;</span> <span class="ruby-value">301</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_detail_iframe-source -->
          
        </div>

        

        
      </div><!-- provider_detail_iframe-method -->

    
      <div id="method-i-provider_discount_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_discount_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_discount_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_discount_fee</span>
  <span class="ruby-ivar">@provider_discount_fee</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">code_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_name</span>]
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">discount_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_code</span>]
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">coupon_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_price</span>]
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">start_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_start</span>]
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">end_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_end</span>]
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:note</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:note</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Notes here&quot;</span>
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
  <span class="ruby-ivar">@provider_discount_fee</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-ivar">@pro_discount_fees</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_discount_fee-source -->
          
        </div>

        

        
      </div><!-- provider_discount_fee-method -->

    
      <div id="method-i-provider_discount_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_discount_type</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_discount_type-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 11</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_discount_type</span>
  <span class="ruby-ivar">@provider_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@provider_type</span>.<span class="ruby-identifier">discount_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_name</span>]
  <span class="ruby-ivar">@provider_type</span>.<span class="ruby-identifier">valid_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_valid_date</span>]
  <span class="ruby-ivar">@provider_type</span>.<span class="ruby-identifier">quantity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_quantity</span>]
  <span class="ruby-ivar">@provider_type</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:note</span>]
  <span class="ruby-ivar">@provider_type</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
  <span class="ruby-ivar">@provider_type</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_discount_type-source -->
          
        </div>

        

        
      </div><!-- provider_discount_type-method -->

    
      <div id="method-i-provider_edit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_edit</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_edit-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 214</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_edit</span>
  <span class="ruby-ivar">@save_copy</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:s_copy</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:s_copy</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@set_color</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:color_val</span>]
  <span class="ruby-ivar">@edited_page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:edited_page</span>]
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">contact_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:con_provider</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> 
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Ext&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone_extension</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>] 
      <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone_extension</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discountElligble</span>]<span class="ruby-operator">==</span><span class="ruby-string">'on'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'Eg: 3'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span>=<span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span>=<span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">no_participants</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">leader</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">website</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">email</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">address_2</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:last_action</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:pro_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:cat_zc</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat_zc</span>]
  <span class="ruby-identifier">leader</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Leader Name&quot;</span>
  <span class="ruby-identifier">website</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter URL&quot;</span>
  <span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>]  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Email&quot;</span>
  <span class="ruby-identifier">phone</span> = <span class="ruby-node">&quot;#{params[:phone_1]}-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{params[:phone_2]}-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{params[:phone_3]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_1</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select Gender--&quot;</span>
  <span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select--&quot;</span>
  <span class="ruby-identifier">no_participants</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Specify Number&quot;</span>
  <span class="ruby-identifier">address_2</span>  =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">tags_txt</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;keyword-tag&quot;</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;keyword-tag&quot;</span>]
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:tags_txt</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;keyword-tag&quot;</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;keyword-tag&quot;</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">leader</span> = <span class="ruby-identifier">leader</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">website</span> = <span class="ruby-identifier">website</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">email</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">phone</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">phone</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;xxx-xxx-xxxx&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone</span> = <span class="ruby-identifier">phone</span> 
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:class_link</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:class_link</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
     <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">camps</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:class_link</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;1&quot;</span>
     <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">camps</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:special_link</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:special_link</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
     <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">special_needs</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:special_link</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;1&quot;</span>
     <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">special_needs</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">skill_level</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">no_participants</span> = <span class="ruby-identifier">no_participants</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">address_2</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:notes</span>]
  
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">empty?</span> 
      <span class="ruby-identifier">min_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">min_age_range</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>].<span class="ruby-identifier">empty?</span> 
      <span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">min_age_range</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">empty?</span> 
      <span class="ruby-identifier">max_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">to_f</span>)<span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">max_age_range</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>].<span class="ruby-identifier">empty?</span> 
      <span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>] 
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">max_age_range</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@age_range</span> = <span class="ruby-ivar">@activity_profile_apf</span>
  <span class="ruby-ivar">@age_range</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">min_age_range</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">''</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">min_age_range</span>
  <span class="ruby-ivar">@age_range</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">max_age_range</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">''</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">max_age_range</span>
  <span class="ruby-ivar">@age_range</span>.<span class="ruby-identifier">save</span>
      
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:url_pasted</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttp:\/\//</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttps:\/\//</span>]
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>] = <span class="ruby-node">&quot;http://#{params[:provider_url]}&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">purchase_url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">purchase_url</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#    @user = User.find(cookies[:uid_usr])</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">5</span>
  <span class="ruby-ivar">@activity_old</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">clone</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
    <span class="ruby-identifier">schedule_mo</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">schedule_mo</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity_old</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">schedule_mo</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-comment">#@del_pre = ActivityRepeat.find_by_activity_schedule_id(@activity_profile_apf.activity_schedule.last.schedule_id)</span>
      <span class="ruby-comment">#@activity_sc = ActivityRepeat.delete_all([&quot;activity_schedule_id = ? &quot;,  @activity_profile_apf.activity_schedule.last.schedule_id])</span>
      <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>]])
      <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>]])
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
        <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
              <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Yearly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-comment">#ex_date = Date.parse(params[:&quot;date_1_#{s}&quot;]) + (params[:&quot;repeatNumWeekVal_#{s}&quot;].to_i * params[:&quot;after_occ_#{s}&quot;].to_i).days</span>
                <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
          <span class="ruby-keyword">end</span>

          <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
              <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
              <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>])
                            <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-keyword">end</span>
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>])
                        <span class="ruby-keyword">else</span>
                          <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:app_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
        <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
        <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],
              <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
        <span class="ruby-ivar">@whole_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@whole_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wd</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
              <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@schedule</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>])
                            <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-keyword">end</span>
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>])
                        <span class="ruby-keyword">else</span>
                          <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Where&quot;</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
        <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">nil?</span>

        <span class="ruby-ivar">@schedule_tot</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:save_id]}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:schedule_id</span>)
        <span class="ruby-ivar">@del_schedule</span> = []
     
        <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule_tot</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>)
              <span class="ruby-ivar">@del_schedule</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span>
              <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>])
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">else</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Yearly&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                    <span class="ruby-keyword">end</span>

                    <span class="ruby-comment">#ex_date = Date.parse(params[:&quot;date_1_#{s}&quot;]) + (params[:&quot;repeatNumWeekVal_#{s}&quot;].to_i * params[:&quot;after_occ_#{s}&quot;].to_i).days</span>
                    <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                    <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
              <span class="ruby-keyword">end</span>
              <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>])
              <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
                <span class="ruby-ivar">@activity_repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_every</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_never</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">end_occurences</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_on</span>= <span class="ruby-identifier">end_on</span>
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">starts_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_on</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeats</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeated_by_month</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">else</span>
                  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
                    <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
                    <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-ivar">@activity_sc</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>])
              <span class="ruby-keyword">end</span>

              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
                <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                        <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                        <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                        <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                        <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                          <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                          <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                                <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                                <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                                <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                                  <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>])
                                <span class="ruby-keyword">else</span>
                                  <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                                <span class="ruby-keyword">end</span>
                                <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                                <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                                <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                                  <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                              <span class="ruby-keyword">end</span>
                            <span class="ruby-keyword">end</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                    <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                      <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                      <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">save</span>
                    <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>])
                            <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-keyword">end</span>
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
                <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yearly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-comment">#ex_date = Date.parse(params[:&quot;date_1_#{s}&quot;]) + (params[:&quot;repeatNumWeekVal_#{s}&quot;].to_i * params[:&quot;after_occ_#{s}&quot;].to_i).days</span>
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
            <span class="ruby-keyword">end</span>

            <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
              <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
                <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
                <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
              <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                      <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                        <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                              <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>])
                              <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-keyword">end</span>
                              <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                              <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                              <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                                <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                            <span class="ruby-keyword">end</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
              <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                  <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                          <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>])
                          <span class="ruby-keyword">else</span>
                            <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-keyword">end</span>
                          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                          <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                            <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span> <span class="ruby-comment">#date_spilt end</span>

        <span class="ruby-identifier">to_delet</span> =  <span class="ruby-ivar">@schedule_tot</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@del_schedule</span>

        <span class="ruby-identifier">to_delet</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;schedule_id = ? &quot;</span>, <span class="ruby-identifier">d</span>])
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>



      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
          <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:app_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
        <span class="ruby-ivar">@schedule_tot</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:save_id]}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:schedule_id</span>)
        <span class="ruby-ivar">@del_schedule</span> =[]
        <span class="ruby-ivar">@whole_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@whole_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wd</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule_tot</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">to_i</span>)
              <span class="ruby-ivar">@del_schedule</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span>
              <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>])
              <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>])
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
                  <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
                  <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-ivar">@whole_create</span> = <span class="ruby-keyword">true</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@whole_create</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@whole_create</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
                <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@schedule</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
      

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>])
                            <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-keyword">end</span>
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>])
                        <span class="ruby-keyword">else</span>
                          <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-keyword">end</span>
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">to_delet</span> =  <span class="ruby-ivar">@schedule_tot</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@del_schedule</span>

        <span class="ruby-identifier">to_delet</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;schedule_id = ? &quot;</span>, <span class="ruby-identifier">d</span>])
        <span class="ruby-keyword">end</span>

      
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">raj</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-ivar">@day_v</span> = []
        <span class="ruby-ivar">@day_id</span> = []
        <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
        <span class="ruby-identifier">raj</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">t</span> =  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
          <span class="ruby-ivar">@day_v</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">business_hours</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
        <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">s</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">not_value</span> = <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">s</span>)
              <span class="ruby-identifier">t</span> = <span class="ruby-identifier">raj</span>[<span class="ruby-identifier">not_value</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
              <span class="ruby-identifier">act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
              <span class="ruby-identifier">act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">not_value</span> = <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">s</span>)
              <span class="ruby-identifier">t</span> = <span class="ruby-identifier">raj</span>[<span class="ruby-identifier">not_value</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
              <span class="ruby-identifier">act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
              <span class="ruby-comment">#              act_schedule = ActivitySchedule.find(raj[not_value])</span>
              <span class="ruby-identifier">act_schedule</span>.<span class="ruby-identifier">destroy</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
        <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Any Where&quot;</span>, <span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@update_any_time</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
      <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
        <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
        <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
        <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
        <span class="ruby-identifier">sh_activity</span>=<span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? AND schedule_mode!=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>],<span class="ruby-string">&quot;Schedule&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">present?</span>
           <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">schedule_id</span> )
        <span class="ruby-keyword">else</span>
           <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>])
              <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
              <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
              <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
      <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
      <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
      <span class="ruby-comment">#store activity schedule id for get price detail in expired activity flow</span>
      <span class="ruby-identifier">sh_activity</span>=<span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? AND schedule_mode!=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>],<span class="ruby-string">&quot;Schedule&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">present?</span>
         <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">schedule_id</span> )
      <span class="ruby-keyword">else</span>
         <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#end</span>
      <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>])
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>



  <span class="ruby-comment">#@activity_price_del = ActivityPrice.delete_all([&quot;activity_id = ? &quot;,  @activity_profile_apf.activity_id])</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:other_fee_open</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_fee</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_other_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_open</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_discount_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_otherdiscount_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:other_fee_open</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_fee</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_other_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_open</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_discount_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_otherdiscount_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">3</span>
    <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
    <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:address_1</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:zip_code</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:latitude</span>] =<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:longitude</span>] =<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] = <span class="ruby-string">&quot;Any Where&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">city_se</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;city_name='#{params[:activity][:city]}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">latitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">latitude</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">longitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">longitude</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
      
  <span class="ruby-identifier">chk_update</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">chk_update</span>
          <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;activity_schedules_for#{@activity_profile_apf.activity_id}&quot;</span>,<span class="ruby-keyword">nil</span>)
          <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;provider_activity_for#{current_user.user_id}&quot;</span>,<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">end</span>

 
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;provider_edit_activity_thank&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_edit-source -->
          
        </div>

        

        
      </div><!-- provider_edit-method -->

    
      <div id="method-i-provider_edit_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_edit_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_edit_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2508</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_edit_activity</span>
  <span class="ruby-ivar">@save_copy</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:s_copy</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:s_copy</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@edited_from</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:edit_from</span>]
  <span class="ruby-ivar">@color_val</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:set_color</span>]
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-comment">#@cities = [&quot;Chicago&quot;,&quot;Dallas&quot;,&quot;Detroit&quot;,&quot;Houston&quot;,&quot;Las Vegas&quot;,&quot;Los Angeles&quot;,&quot;New York&quot;,&quot;Philadelphia&quot;,&quot;San Antonio&quot;,&quot;San Francisco&quot;,&quot;San Jose&quot;,&quot;Seattle&quot;,&quot;Walnut Creek&quot;]</span>
  <span class="ruby-ivar">@page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-ivar">@cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;city_name Asc&quot;</span>).<span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_schedule</span>
  <span class="ruby-ivar">@act_repeat</span> =  <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">schedule_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-ivar">@pro_discount_fees</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-ivar">@pro_sel_fees</span> = <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:activity_id]} and user_id=#{current_user.user_id}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:fee_type_id</span>)
  <span class="ruby-ivar">@pro_sel_discount_fees</span> = <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:activity_id]} and user_id=#{current_user.user_id}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:discount_code_id</span>)
  <span class="ruby-ivar">@provid_disc_types</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} or user_id is null&quot;</span>)
  <span class="ruby-ivar">@tags_text</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@previous_tags</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">activity</span><span class="ruby-operator">|</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
  <span class="ruby-comment">#~ @country_code = Country.where(&quot;country_id = ?&quot;,1)</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_edit_activity-source -->
          
        </div>

        

        
      </div><!-- provider_edit_activity-method -->

    
      <div id="method-i-provider_edit_new_changes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_edit_new_changes</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_edit_new_changes-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 1198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_edit_new_changes</span>
  <span class="ruby-ivar">@save_copy</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:s_copy</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:s_copy</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@set_color</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:color_val</span>]
  <span class="ruby-ivar">@edited_page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:edited_page</span>]
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">contact_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:con_provider</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discountElligble</span>]<span class="ruby-operator">==</span><span class="ruby-string">'on'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'Eg: 3'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span>=<span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span>=<span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">no_participants</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">leader</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">website</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">email</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">address_2</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:last_action</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:pro_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:cat_zc</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat_zc</span>]
  <span class="ruby-identifier">leader</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Leader Name&quot;</span>
  <span class="ruby-identifier">website</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter URL&quot;</span>
  <span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>]  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Email&quot;</span>
  <span class="ruby-identifier">phone</span> = <span class="ruby-node">&quot;#{params[:phone_1]}-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{params[:phone_2]}-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{params[:phone_3]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_1</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select Gender--&quot;</span>
  <span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select--&quot;</span>
  <span class="ruby-identifier">no_participants</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Specify Number&quot;</span>
  <span class="ruby-identifier">address_2</span>  =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">leader</span> = <span class="ruby-identifier">leader</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">website</span> = <span class="ruby-identifier">website</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">email</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">skill_level</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">no_participants</span> = <span class="ruby-identifier">no_participants</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">address_2</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:notes</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">to_f</span>)<span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
      
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:url_pasted</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttp:\/\//</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttps:\/\//</span>]
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>] = <span class="ruby-node">&quot;http://#{params[:provider_url]}&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">purchase_url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">purchase_url</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#    @user = User.find(cookies[:uid_usr])</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">5</span>
  <span class="ruby-ivar">@activity_old</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">clone</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
    <span class="ruby-identifier">schedule_mo</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">schedule_mo</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity_old</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">schedule_mo</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-comment">#@del_pre = ActivityRepeat.find_by_activity_schedule_id(@activity_profile_apf.activity_schedule.last.schedule_id)</span>
      <span class="ruby-comment">#@activity_sc = ActivityRepeat.delete_all([&quot;activity_schedule_id = ? &quot;,  @activity_profile_apf.activity_schedule.last.schedule_id])</span>
      <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>]])
      <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>]])
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
        <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
              <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Yearly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-comment">#ex_date = Date.parse(params[:&quot;date_1_#{s}&quot;]) + (params[:&quot;repeatNumWeekVal_#{s}&quot;].to_i * params[:&quot;after_occ_#{s}&quot;].to_i).days</span>
                <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
          <span class="ruby-keyword">end</span>

          <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
              <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
              <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]

                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]

                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:app_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
        <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
        <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],
              <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
        <span class="ruby-ivar">@whole_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@whole_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wd</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
              <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@schedule</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Where&quot;</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
        <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">nil?</span>

        <span class="ruby-ivar">@schedule_tot</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:save_id]}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:schedule_id</span>)
        <span class="ruby-ivar">@del_schedule</span> = []
     
        <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule_tot</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>)
              <span class="ruby-ivar">@del_schedule</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span>
              <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_r_1_#{s}&quot;</span>])
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">else</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Yearly&quot;</span>
                      <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                    <span class="ruby-keyword">end</span>

                    <span class="ruby-comment">#ex_date = Date.parse(params[:&quot;date_1_#{s}&quot;]) + (params[:&quot;repeatNumWeekVal_#{s}&quot;].to_i * params[:&quot;after_occ_#{s}&quot;].to_i).days</span>
                    <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                    <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
              <span class="ruby-keyword">end</span>
              <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>])
              <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
                <span class="ruby-ivar">@activity_repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_every</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_never</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">end_occurences</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_on</span>= <span class="ruby-identifier">end_on</span>
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">starts_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_on</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeats</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeated_by_month</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>]
                  <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">else</span>
                  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
                    <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
                    <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-ivar">@activity_sc</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>])
              <span class="ruby-keyword">end</span>

              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
                <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                        <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                        <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                        <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                        <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                          <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                          <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                                <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                                <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                                <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                                <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]
                                <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                                <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                                  <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                              <span class="ruby-keyword">end</span>
                            <span class="ruby-keyword">end</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                    <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                      <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                      <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">save</span>
                    <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
                <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yearly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-comment">#ex_date = Date.parse(params[:&quot;date_1_#{s}&quot;]) + (params[:&quot;repeatNumWeekVal_#{s}&quot;].to_i * params[:&quot;after_occ_#{s}&quot;].to_i).days</span>
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
            <span class="ruby-keyword">end</span>

            <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
              <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
                <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
                <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
              <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                      <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                        <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                              <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                              <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                                <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                            <span class="ruby-keyword">end</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
              <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                  <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                          <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                          <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                            <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span> <span class="ruby-comment">#date_spilt end</span>

        <span class="ruby-identifier">to_delet</span> =  <span class="ruby-ivar">@schedule_tot</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@del_schedule</span>

        <span class="ruby-identifier">to_delet</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;schedule_id = ? &quot;</span>, <span class="ruby-identifier">d</span>])
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>



      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
          <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:app_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
        <span class="ruby-ivar">@schedule_tot</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id=#{params[:save_id]}&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:schedule_id</span>)
        <span class="ruby-ivar">@del_schedule</span> =[]
        <span class="ruby-ivar">@whole_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@whole_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wd</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule_tot</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">to_i</span>)
              <span class="ruby-ivar">@del_schedule</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span>
              <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_whr_1_#{wd}&quot;</span>])
              <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>])
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
                  <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
                  <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-ivar">@whole_create</span> = <span class="ruby-keyword">true</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@whole_create</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@whole_create</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
                <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@schedule</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
      

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">to_delet</span> =  <span class="ruby-ivar">@schedule_tot</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@del_schedule</span>

        <span class="ruby-identifier">to_delet</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;schedule_id = ? &quot;</span>, <span class="ruby-identifier">d</span>])
        <span class="ruby-keyword">end</span>

      
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
        <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">raj</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-ivar">@day_v</span> = []
        <span class="ruby-ivar">@day_id</span> = []
        <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
        <span class="ruby-identifier">raj</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">t</span> =  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
          <span class="ruby-ivar">@day_v</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">business_hours</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
        <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">s</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">not_value</span> = <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">s</span>)
              <span class="ruby-identifier">t</span> = <span class="ruby-identifier">raj</span>[<span class="ruby-identifier">not_value</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
              <span class="ruby-identifier">act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
              <span class="ruby-identifier">act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">not_value</span> = <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">s</span>)
              <span class="ruby-identifier">t</span> = <span class="ruby-identifier">raj</span>[<span class="ruby-identifier">not_value</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
              <span class="ruby-identifier">act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
              <span class="ruby-comment">#              act_schedule = ActivitySchedule.find(raj[not_value])</span>
              <span class="ruby-identifier">act_schedule</span>.<span class="ruby-identifier">destroy</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@update_any_time</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
        <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Any Where&quot;</span>, <span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@update_any_time</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
      <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
        <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
        <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
        <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
        <span class="ruby-identifier">sh_activity</span>=<span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? AND schedule_mode!=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>],<span class="ruby-string">&quot;Schedule&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">schedule_id</span>  )

        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
        <span class="ruby-keyword">end</span>
        
        <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
              <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
      <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
      <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
      <span class="ruby-identifier">sh_activity</span>=<span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? AND schedule_mode!=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>],<span class="ruby-string">&quot;Schedule&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">schedule_id</span>  )
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
        <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#@activity_price = @activity_profile_apf.activity_price.create( :price=&gt;params[:price] )</span>
      <span class="ruby-comment">#end</span>
      <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>



  <span class="ruby-comment">#@activity_price_del = ActivityPrice.delete_all([&quot;activity_id = ? &quot;,  @activity_profile_apf.activity_id])</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:other_fee_open</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_fee</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_other_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_open</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_discount_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_otherdiscount_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:other_fee_open</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_fee</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_other_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_open</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_discount_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:rem_otherdiscount_org</span>],<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">3</span>
    <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
    <span class="ruby-constant">ProviderActivityFee</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
    <span class="ruby-constant">ProviderDiscountCode</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:address_1</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:zip_code</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] = <span class="ruby-string">&quot;Any Where&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
 
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;provider_edit_activity_thank&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_edit_new_changes-source -->
          
        </div>

        

        
      </div><!-- provider_edit_new_changes-method -->

    
      <div id="method-i-provider_edit_old" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_edit_old</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_edit_old-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2676</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_edit_old</span>
  <span class="ruby-ivar">@set_color</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:color_val</span>]
  <span class="ruby-ivar">@edited_page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:edited_page</span>]
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">contact_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:con_provider</span>]
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discountElligble</span>]<span class="ruby-operator">==</span><span class="ruby-string">'on'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'Eg: 3'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span>=<span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span>=<span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">no_participants</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">leader</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">website</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">email</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">address_2</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:last_action</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:pro_id</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat</span>]
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:cat_zc</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:cat_zc</span>]
  <span class="ruby-identifier">leader</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Leader Name&quot;</span>
  <span class="ruby-identifier">website</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter URL&quot;</span>
  <span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>]  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Email&quot;</span>
  <span class="ruby-identifier">phone</span> = <span class="ruby-node">&quot;#{params[:phone_1]}-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{params[:phone_2]}-&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{params[:phone_3]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_1</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select Gender--&quot;</span>
  <span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select--&quot;</span>
  <span class="ruby-identifier">no_participants</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Specify Number&quot;</span>
  <span class="ruby-identifier">address_2</span>  =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">leader</span> = <span class="ruby-identifier">leader</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">website</span> = <span class="ruby-identifier">website</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">email</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone</span> = <span class="ruby-identifier">phone</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">skill_level</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">no_participants</span> = <span class="ruby-identifier">no_participants</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">address_2</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:notes</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:age1</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:age2</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#    @user = User.find(cookies[:uid_usr])</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">5</span>
  <span class="ruby-ivar">@activity_old</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">clone</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity_old</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-ivar">@del_pre</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">schedule_id</span>)
      <span class="ruby-ivar">@activity_sc</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">schedule_id</span>])
      <span class="ruby-ivar">@activity_delete</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>]])
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
      <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_total</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_total</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1]} #{params[:schedule_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1]} #{params[:schedule_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
          <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal</span>],
            <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:r1</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ</span>],
            <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_on_date1</span>],<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month1</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal</span>])
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
      <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:appointment_stime_1]} #{params[:appointment_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:appointment_etime_1]} #{params[:appointment_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datebill_1</span>],
        <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
      <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
      <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_1</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_stime_1]} #{params[:whole_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_etime_1]} #{params[:whole_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestartwhole_alt_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_2</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_stime_1]} #{params[:whole_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_etime_1]} #{params[:camps_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestcamps_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:dateencamps_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1]} #{params[:schedule_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1]} #{params[:schedule_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
          <span class="ruby-ivar">@activity_repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_every</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_never</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:r1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">end_occurences</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">ends_on</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">starts_on</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeat_on</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeats</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">repeated_by_month</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:month1</span>]
            <span class="ruby-ivar">@activity_repeat</span>.<span class="ruby-identifier">save</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal</span>],
              <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:r1</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ</span>],
              <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_on_date1</span>],<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month1</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal</span>])
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@activity_sc</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_schedule_id = ? &quot;</span>,  <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>])
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
        <span class="ruby-comment">#        Time.parse(&quot;9:03 pm&quot;).strftime(&quot;%H:%M:%S&quot;)</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:appointment_stime_1]} #{params[:appointment_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:appointment_etime_1]} #{params[:appointment_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datebill_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>])
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_1</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_stime_1]} #{params[:whole_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_etime_1]} #{params[:whole_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestartwhole_alt_1</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_2</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_stime_1]} #{params[:camps_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_etime_1]} #{params[:camps_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestcamps_1</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:dateencamps_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_1</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_stime_1]} #{params[:whole_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_etime_1]} #{params[:whole_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestartwhole_alt_1</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_2</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_stime_1]} #{params[:whole_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_etime_1]} #{params[:camps_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestcamps_1</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:dateencamps_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>

      <span class="ruby-identifier">raj</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_id_value</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
      <span class="ruby-ivar">@day_v</span> = []
      <span class="ruby-ivar">@day_id</span> = []
      <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
      <span class="ruby-identifier">raj</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">t</span> =  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
        <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
        <span class="ruby-ivar">@day_v</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">business_hours</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>

        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">s</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">not_value</span> = <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">s</span>)
            <span class="ruby-identifier">t</span> = <span class="ruby-identifier">raj</span>[<span class="ruby-identifier">not_value</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
            <span class="ruby-identifier">act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
            <span class="ruby-identifier">act_schedule</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">not_value</span> = <span class="ruby-ivar">@day_v</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">s</span>)
            <span class="ruby-identifier">t</span> = <span class="ruby-identifier">raj</span>[<span class="ruby-identifier">not_value</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
            <span class="ruby-identifier">act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">t</span>)
            <span class="ruby-comment">#              act_schedule = ActivitySchedule.find(raj[not_value])</span>
            <span class="ruby-identifier">act_schedule</span>.<span class="ruby-identifier">destroy</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@activity_price_del</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">delete_all</span>([<span class="ruby-string">&quot;activity_id = ? &quot;</span>,  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>]
    <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
    <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
      
      <span class="ruby-identifier">sh_activity</span>=<span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? AND schedule_mode!=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>],<span class="ruby-string">&quot;Schedule&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">schedule_id</span> )
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
        <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Early Bird Discount&quot;</span>
        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Session Discount&quot;</span>
        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_type_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_sess_net_#{t}_#{c}&quot;</span>]
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Participant Discount&quot;</span>
        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_type_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_part_net_#{t}_#{c}&quot;</span>]
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
        <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
    
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>]
    <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
    <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_1_#{c}&quot;</span>]
      <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_1_#{c}&quot;</span>]
      <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_1_#{c}&quot;</span>]
      <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_1_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_1_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
      <span class="ruby-identifier">sh_activity</span>=<span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? AND schedule_mode!=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>],<span class="ruby-string">&quot;Schedule&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">sh_activity</span>.<span class="ruby-identifier">schedule_id</span> )
        <span class="ruby-keyword">else</span>
         <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
        <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
      <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Early Bird Discount&quot;</span>
          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Session Discount&quot;</span>
          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_type_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_sess_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Participant Discount&quot;</span>
          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_type_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_part_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">3</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#sending a  mail while editing the activity page</span>
  <span class="ruby-comment">#f params[:attendees] == &quot;1&quot;</span>
  <span class="ruby-comment">#~ @participant = Participant.find(:all,:conditions=&gt;[&quot;activity_id = ? &quot;, @activity_profile_apf.activity_id])</span>
  <span class="ruby-comment"># @participant = ActivityAttendDetail.find(:all,:conditions=&gt;[&quot;activity_id = ? &quot;, @activity_profile_apf.activity_id])</span>
    
  <span class="ruby-comment"># @get_current_url = request.env['HTTP_HOST']</span>
  <span class="ruby-comment"># to get the all participant details from participant table.</span>
  <span class="ruby-comment">#@participant.each do |r|</span>
  <span class="ruby-comment">#  user=User.find_by_user_id(r.user_id)</span>
  <span class="ruby-comment"># attend_email=user.email_address</span>
  <span class="ruby-comment"># if attend_email !=&quot;&quot; &amp;&amp; !attend_email.nil? &amp;&amp; !attend_email.blank? &amp;&amp; user.user_flag==TRUE</span>
  <span class="ruby-comment">#@result = UserMailer.edit_activity_mail(user,@activity_profile_apf,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
  <span class="ruby-comment"># end  if user.present? &amp;&amp; !user.nil?</span>
  <span class="ruby-comment">#end</span>
  <span class="ruby-comment">#end</span>

  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
  
  <span class="ruby-comment">#setting notification detail sending a mail to the provider</span>
  <span class="ruby-ivar">@provider_notifications_activity</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='2' and p.user_id='#{@activity_profile_apf.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notifications_activity</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notifications_activity</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notifications_activity</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@participant</span>=<span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id =? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">uniq</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-comment">#@result = UserMailer.edit_activity_mail(user,@activity_profile_apf,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Edit Provider Activity to Participants&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_provider_participant_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
      <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#do end participant</span>
  <span class="ruby-keyword">else</span> <span class="ruby-comment">#first if the user not present in setting tables.</span>
    <span class="ruby-ivar">@participant</span>=<span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id =? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">uniq</span>
    <span class="ruby-comment"># to get the all participant details from participant table.</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Edit Provider Activity to Participants&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_provider_participant_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
        <span class="ruby-comment">#@result = UserMailer.edit_activity_mail(user,@activity_profile_apf,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
      <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#do end participant</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment">#if loop end for participant</span>
  <span class="ruby-ivar">@provider_notification_default</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='5' and p.user_id='#{@activity_profile_apf.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notification_default</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#sending a mail while editing the activity by the provider</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>
    <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-comment">#@result = UserMailer.edit_activity_provider_mail(user,@activity_profile_apf,@get_current_url,attend_email,params[:subject]).deliver</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Edit Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_activity_provider_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>,<span class="ruby-ivar">@plan</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#sending a mail while editing the activity by the provider</span>
    <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Edit Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_activity_provider_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>,<span class="ruby-ivar">@plan</span>)
      <span class="ruby-comment">#@result = UserMailer.edit_activity_provider_mail(user,@activity_profile_apf,@get_current_url,attend_email,params[:subject]).deliver</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment">#if loop end for provider mail</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;provider_edit_activity_thank&quot;</span>
  <span class="ruby-comment">#redirect_to :action =&gt; &quot;edit_acitivity_thank&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_edit_old-source -->
          
        </div>

        

        
      </div><!-- provider_edit_old-method -->

    
      <div id="method-i-provider_embedded_link" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_embedded_link</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>provider embedded activity</p>
          

          
          <div class="method-source-code" id="provider_embedded_link-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2627</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_embedded_link</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities where user_id=#{current_user.user_id} and cleaned=true and lower(active_status)='active' and lower(created_by)='provider' order by activity_id desc limit 200&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@act_id</span>=<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#~ @img_path = @activity.avatar.url(:thumb)</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_embedded_link-source -->
          
        </div>

        

        
      </div><!-- provider_embedded_link-method -->

    
      <div id="method-i-provider_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_fee</span>
  <span class="ruby-ivar">@provider_fee</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@provider_fee</span>.<span class="ruby-identifier">fee_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_name</span>]
  <span class="ruby-ivar">@provider_fee</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_price</span>]
  <span class="ruby-ivar">@provider_fee</span>.<span class="ruby-identifier">fee_mandatory</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_mandatory</span>]
  <span class="ruby-ivar">@provider_fee</span>.<span class="ruby-identifier">quantity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_quantity</span>]
  <span class="ruby-ivar">@provider_fee</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:note</span>]
  <span class="ruby-ivar">@provider_fee</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
  <span class="ruby-ivar">@provider_fee</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_fee-source -->
          
        </div>

        

        
      </div><!-- provider_fee-method -->

    
      <div id="method-i-provider_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_info</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_info-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3374</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_info</span>
  <span class="ruby-comment">#~ @user_profile = UserProfile.find_by_business_name(params[:business_name]) if params[:business_name]</span>
  <span class="ruby-ivar">@bname</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:business_name</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:business_name</span>]
  <span class="ruby-ivar">@user_profile</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;slug = ?&quot;</span>, <span class="ruby-node">&quot;#{@bname}&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@bname</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ?&quot;</span>,<span class="ruby-node">&quot;#{@user_profile.user_id}&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_profile</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_profile</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_info-source -->
          
        </div>

        

        
      </div><!-- provider_info-method -->

    
      <div id="method-i-provider_information" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_information</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>provider info form page</p>
          

          
          <div class="method-source-code" id="provider_information-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3238</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_information</span>
  <span class="ruby-ivar">@before_login_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-ivar">@mge</span>=<span class="ruby-string">&quot;I found your activity in Famtivity. I would like a little more information about it before I proceed. Please get in touch with me.&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_information-source -->
          
        </div>

        

        
      </div><!-- provider_information-method -->

    
      <div id="method-i-schedule_price" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">schedule_price</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="schedule_price-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2551</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">schedule_price</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- schedule_price-source -->
          
        </div>

        

        
      </div><!-- schedule_price-method -->

    
      <div id="method-i-send_edit_mail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_edit_mail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="send_edit_mail-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2067</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_edit_mail</span>

  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:act_id</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:atten_dies</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-comment">#setting notification detail sending a mail to the provider</span>
    <span class="ruby-ivar">@provider_notifications_activity</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='2' and p.user_id='#{@activity_profile_apf.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notifications_activity</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notifications_activity</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notifications_activity</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@participant</span>=<span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id =? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">uniq</span>
      <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
      <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-comment">#@result = UserMailer.edit_activity_mail(user,@activity_profile_apf,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
          <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Edit Provider Activity to Participants&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_provider_participant_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
        <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#do end participant</span>
    <span class="ruby-keyword">else</span> <span class="ruby-comment">#first if the user not present in setting tables.</span>
      <span class="ruby-ivar">@participant</span>=<span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id =? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">uniq</span>
      <span class="ruby-comment"># to get the all participant details from participant table.</span>
      <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
      <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Edit Provider Activity to Participants&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_provider_participant_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
        <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#do end participant</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#if loop end for participant</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:just_me</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@provider_notification_default</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='5' and p.user_id='#{@activity_profile_apf.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notification_default</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#sending a mail while editing the activity by the provider</span>
      <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
      <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Edit Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_activity_provider_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>,<span class="ruby-ivar">@plan</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#sending a mail while editing the activity by the provider</span>
      <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
      <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Edit Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_activity_provider_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>,<span class="ruby-ivar">@plan</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#if loop end for provider mail</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:represen_tative</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@school_rep</span> = <span class="ruby-constant">SchoolRepresentative</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id = #{params[:act_id]}&quot;</span>)
    <span class="ruby-ivar">@school_rep</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">s</span>.<span class="ruby-identifier">representative_id</span>)
      <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
      <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Edit Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">edit_activity_provider_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>,<span class="ruby-ivar">@plan</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    
  <span class="ruby-keyword">end</span>



  <span class="ruby-identifier">exist_result</span> = <span class="ruby-string">&quot;success&quot;</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exist_result</span>.<span class="ruby-identifier">to_json</span>

 
<span class="ruby-keyword">end</span></pre>
          </div><!-- send_edit_mail-source -->
          
        </div>

        

        
      </div><!-- send_edit_mail-method -->

    
      <div id="method-i-sendmsgtoprver" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sendmsgtoprver</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>send a mail to provider</p>
          

          
          <div class="method-source-code" id="sendmsgtoprver-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3382</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sendmsgtoprver</span>
  <span class="ruby-ivar">@pro_usr</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]) <span class="ruby-comment">#to get the activity information</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
    <span class="ruby-comment">#Provider lead started</span>
    <span class="ruby-ivar">@date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
    <span class="ruby-ivar">@usr_clk</span> = <span class="ruby-constant">ProviderLead</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and customer_id = ? and activity_id = ? and inserted_date = ?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>],<span class="ruby-node">&quot;#{@date}&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#insert the data in provider leads table</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">created_by</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">created_by</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Provider&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;curator&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">manage_plan</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">manage_plan</span>.<span class="ruby-identifier">present?</span> <span class="ruby-comment">#only count for market provider not the new manage plan user</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">created_by</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">created_by</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Provider&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;curator&quot;</span><span class="ruby-comment">#only count for market provider</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@payment_detail</span> = <span class="ruby-constant">UserTransaction</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@usr_clk</span> = <span class="ruby-constant">ProviderLead</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#insert the data</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-ivar">@date</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">customer_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-node">&quot;#{$pro_leads}&quot;</span> <span class="ruby-comment">#get the values from app controller</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">user_plan</span> = <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">credit_card</span> = <span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">credit_card</span> = <span class="ruby-string">&quot;no&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">save</span>

        <span class="ruby-comment">#authorize information started</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@payment_profile</span> = <span class="ruby-constant">CIMGATEWAY</span>.<span class="ruby-identifier">get_customer_payment_profile</span>(<span class="ruby-value">:customer_profile_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_profile_id</span>,<span class="ruby-value">:customer_payment_profile_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_payment_profile_id</span>)
          <span class="ruby-identifier">transaction</span> =
            {<span class="ruby-value">:transaction</span> =<span class="ruby-operator">&gt;</span> {
              <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:auth_capture</span>,
              <span class="ruby-value">:amount</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{$pro_leads}&quot;</span>, <span class="ruby-comment">#0.99cents</span>
              <span class="ruby-value">:customer_profile_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_profile_id</span>,
              <span class="ruby-value">:customer_payment_profile_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_payment_profile_id</span>
            }
          }
          <span class="ruby-comment">#create the transaction for the user</span>
          <span class="ruby-identifier">response</span> = <span class="ruby-constant">CIMGATEWAY</span>.<span class="ruby-identifier">create_customer_profile_transaction</span>(<span class="ruby-identifier">transaction</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">success?</span>
            <span class="ruby-comment">#~stored the transaction success information in leads table</span>
            <span class="ruby-ivar">@lead</span> = <span class="ruby-constant">LeadTransaction</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#insert the transaction information in lead table</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">lead_id</span> = <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">lead_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">payment_status</span> = <span class="ruby-string">&quot;success&quot;</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">transaction_id</span> = <span class="ruby-node">&quot;#{response.authorization}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">authorization</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">payment_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">customer_payment_profile_id</span> = <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_payment_profile_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_payment_profile_id</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">customer_profile_id</span> =  <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_profile_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_profile_id</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">payment_message</span> =  <span class="ruby-node">&quot;#{response.message}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">message</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-node">&quot;#{$pro_leads}&quot;</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-comment">#send a mail to provider about the transaction</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;free&quot;</span> <span class="ruby-comment">#send a mail to provider</span>
              <span class="ruby-comment">#~ @result = UserMailer.trans_msgtoprovider(@user,@pro_usr,@activity,@get_current_url,params[:send_msg]).deliver</span>
              <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to market provider for transaction&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">trans_msgtoprovider</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>])
            <span class="ruby-keyword">else</span>
              <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to sell through provider&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">trans_msgto_sellpro</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#~ raise StandardError, response.message</span>
            <span class="ruby-comment">#~stored the transaction failure information in leads table</span>
            <span class="ruby-ivar">@lead</span> = <span class="ruby-constant">LeadTransaction</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#insert the transaction information in lead table</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">lead_id</span> = <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">lead_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">payment_status</span> = <span class="ruby-string">&quot;failure&quot;</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">transaction_id</span> = <span class="ruby-node">&quot;#{response.authorization}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">authorization</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">payment_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">customer_payment_profile_id</span> = <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_payment_profile_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_payment_profile_id</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">customer_profile_id</span> = <span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_profile_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@payment_detail</span>.<span class="ruby-identifier">customer_profile_id</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">payment_message</span> = <span class="ruby-node">&quot;#{response.message}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">response</span>.<span class="ruby-identifier">message</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-node">&quot;#{$pro_leads}&quot;</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-ivar">@lead</span>.<span class="ruby-identifier">save</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;free&quot;</span> <span class="ruby-comment">#send a mail to provider</span>
              <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to fam&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">incorrect_mailto_pro</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
              <span class="ruby-ivar">@result1</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to pro&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">incorrect_mailto_fam</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to fam for sell&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">incorrect_mailto_pro_forsell</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
              <span class="ruby-ivar">@result1</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to pro for sell&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">incorrect_mailto_fam_forsell</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span> <span class="ruby-comment">#auth response end</span>
        <span class="ruby-keyword">else</span> <span class="ruby-comment">#if the user didn't have any credit card details send a mail to provider and support team</span>
          <span class="ruby-comment">#~ @result = UserMailer.nocrdcrt_det_to_fam(@user,@pro_usr,@activity,@get_current_url).deliver</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_plan</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;free&quot;</span> <span class="ruby-comment">#send a mail to provider</span>
            <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to famtivity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">nocrdcrt_det_to_fam</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
            <span class="ruby-ivar">@result1</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to provider&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">nocrdcrt_det_to_pro</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to famtivity for sell&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">nocrdcrt_det_to_fam_forsell</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
            <span class="ruby-ivar">@result1</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to provider for sell&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">nocrdcrt_det_to_pro_forsell</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span> <span class="ruby-comment">#payment details loop end</span>
        <span class="ruby-comment">#authorize information end</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#if end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#only count for provider end</span>
              
    <span class="ruby-comment">#Stored the send message track in activity track table start</span>
    <span class="ruby-ivar">@clk_track</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#insert the data</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">activity_name</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">parent_user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">from_email</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">to_email</span> = <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">message_type</span> = <span class="ruby-string">&quot;activity&quot;</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-comment">#Stored the send message track in activity track table end</span>

    <span class="ruby-comment">#activity click count end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-comment">#~ @result = UserMailer.message_to_provider(@user,@pro_usr,@activity,@get_current_url,params[:send_msg]).deliver</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to owner of activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">message_to_provider</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to famtivity support&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">message_to_provider</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span> <span class="ruby-comment">#current user not present send a mail to provider</span>
    <span class="ruby-comment">#Stored the send message track in activity track table start</span>
    <span class="ruby-ivar">@clk_track</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#insert the data</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">activity_name</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">from_email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter your Email&quot;</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">to_email</span> = <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">message</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">message_type</span> = <span class="ruby-string">&quot;activity&quot;</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-ivar">@clk_track</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-comment">#Stored the send message track in activity track table end</span>
    <span class="ruby-comment">#~ @result = UserMailer.beforeln_msg_toprovider(params[:provider_email],@pro_usr,@activity,@get_current_url,params[:send_msg]).deliver</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message to pro before login&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">beforeln_msg_toprovider</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_email</span>],<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>])
  <span class="ruby-keyword">end</span> <span class="ruby-comment">#current user ending</span>
  <span class="ruby-comment">#~ render :text=&gt;@status</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;$('html, body').animate({ scrollTop: 0 });
                                      $('#send_msg').val('');
                                   $('.flash-message').html('Message has been sent successfully!');
                                      var win=$(window).width();
                                      var con=$('.flash_content').width();
                                      var leftvalue=((win/2)-(con/2))
                                      $('.flash_content').css('left',leftvalue+'px');
                                      $('.flash_content').css('top','67px');
                                      $('.flash_content').fadeIn().delay(5000).fadeOut();
    &quot;</span>}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sendmsgtoprver-source -->
          
        </div>

        

        
      </div><!-- sendmsgtoprver-method -->

    
      <div id="method-i-sendmsgtoprver_old" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sendmsgtoprver_old</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>send a mail to provider</p>
          

          
          <div class="method-source-code" id="sendmsgtoprver_old-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 3321</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sendmsgtoprver_old</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
    <span class="ruby-ivar">@pro_usr</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-comment">#activity click count start</span>
    <span class="ruby-ivar">@tdate</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
    <span class="ruby-ivar">@sdat</span> = <span class="ruby-ivar">@tdate</span>.<span class="ruby-identifier">at_beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
    <span class="ruby-ivar">@edat</span> = <span class="ruby-ivar">@tdate</span>.<span class="ruby-identifier">end_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
    <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]) <span class="ruby-comment">#to get the activity information</span>
    <span class="ruby-ivar">@usr_clk</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id = ? and activity_id = ? and start_date = ? and end_date = ?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>],<span class="ruby-node">&quot;#{@sdat}&quot;</span>,<span class="ruby-node">&quot;#{@edat}&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#insert the message count in activity track table</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">created_by</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">created_by</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Provider&quot;</span> <span class="ruby-comment">#only count for provider</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@usr_clk</span> = <span class="ruby-constant">ActivityTrack</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment">#insert the data</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">message_count</span> = <span class="ruby-value">1</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">start_date</span> = <span class="ruby-ivar">@sdat</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">end_date</span> = <span class="ruby-ivar">@edat</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-keyword">else</span>  <span class="ruby-comment">#upate the message count in activity track table</span>
        <span class="ruby-ivar">@mcount</span>=<span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@mcount</span> = <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">message_count</span> <span class="ruby-comment">#increment the click count values</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@mcount</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@mcount</span> = <span class="ruby-ivar">@mcount</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@mcount</span> = <span class="ruby-value">1</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@usr_clk</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:message_count=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@mcount</span>, <span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#if end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#only count for provider end</span>
            
    <span class="ruby-comment">#activity click count end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@pro_usr</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-comment">#~ @result = UserMailer.message_to_provider(@user,@pro_usr,@activity,@get_current_url,params[:send_msg]).deliver</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Send message&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">message_to_provider</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@pro_usr</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:send_msg</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#~ render :text=&gt;@status</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;$('.success_send_msg').css('display', 'block').fadeOut(2000);$('#send_msg').val('');&quot;</span>}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- sendmsgtoprver_old-source -->
          
        </div>

        

        
      </div><!-- sendmsgtoprver_old-method -->

    
      <div id="method-i-share_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">share_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="share_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2560</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">share_activity</span>
  <span class="ruby-ivar">@before_login_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@action</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  <span class="ruby-ivar">@user_email</span> = <span class="ruby-constant">ContactUser</span>.<span class="ruby-identifier">find_all_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:contact_email</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- share_activity-source -->
          
        </div>

        

        
      </div><!-- share_activity-method -->

    
      <div id="method-i-share_activity_favthank" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">share_activity_favthank</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="share_activity_favthank-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2615</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">share_activity_favthank</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- share_activity_favthank-source -->
          
        </div>

        

        
      </div><!-- share_activity_favthank-method -->

    
      <div id="method-i-share_activity_success" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">share_activity_success</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="share_activity_success-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2569</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">share_activity_success</span>
  <span class="ruby-ivar">@action</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]
  <span class="ruby-ivar">@subject</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>]
  <span class="ruby-ivar">@activity</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]
  <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mode</span>]

  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
  
  <span class="ruby-comment">#To store the share count</span>
  <span class="ruby-constant">ActivityCount</span>.<span class="ruby-identifier">updateShareCount</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])

  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-identifier">t</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\r\n&quot;</span>, <span class="ruby-string">&quot;&lt;br&gt;&quot;</span>)
  <span class="ruby-identifier">send</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:send_to</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
  <span class="ruby-identifier">send</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">s</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">s</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">s</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Shared Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">share_activity_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">t</span>,<span class="ruby-identifier">s</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-ivar">@mode</span>)
          <span class="ruby-comment">#@result = UserMailer.share_activity_mail(@user,@activity,@get_current_url,params[:message],s,params[:subject]).deliver</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Shared Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">share_activity_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">t</span>,<span class="ruby-identifier">s</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-ivar">@mode</span>)
        <span class="ruby-comment">#@result = UserMailer.share_activity_mail(@user,@activity,@get_current_url,params[:message],s,params[:subject]).deliver</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@old_user_id</span> = <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@share</span>=<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">activity_shared</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:message=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">t</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:shared_to=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">s</span>,<span class="ruby-value">:subject=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-value">:inserted_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-ivar">@share</span>.<span class="ruby-identifier">share_id</span> = <span class="ruby-ivar">@old_user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_user_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@share</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- share_activity_success-source -->
          
        </div>

        

        
      </div><!-- share_activity_success-method -->

    
      <div id="method-i-share_activity_thank" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">share_activity_thank</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="share_activity_thank-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2611</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">share_activity_thank</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- share_activity_thank-source -->
          
        </div>

        

        
      </div><!-- share_activity_thank-method -->

    
      <div id="method-i-ticket" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ticket</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="ticket-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 2556</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ticket</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- ticket-source -->
          
        </div>

        

        
      </div><!-- ticket-method -->

    
      <div id="method-i-update_discount_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_discount_type</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_discount_type-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 43</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_discount_type</span>
  <span class="ruby-ivar">@chose_disc</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_discount_type_id=#{params[:cu_value]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@chose_disc</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@chose_disc</span>.<span class="ruby-identifier">discount_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_name</span>]
    <span class="ruby-ivar">@chose_disc</span>.<span class="ruby-identifier">valid_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_valid_date</span>]
    <span class="ruby-ivar">@chose_disc</span>.<span class="ruby-identifier">quantity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_quantity</span>]
    <span class="ruby-ivar">@chose_disc</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:note</span>]
    <span class="ruby-ivar">@chose_disc</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@chose_disc</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">act_price</span> = <span class="ruby-constant">ActivityDiscountPrice</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;provider_discount_type_id=#{@chose_disc.provider_discount_type_id}&quot;</span>)
    <span class="ruby-identifier">act_price</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">price</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">price</span>.<span class="ruby-identifier">discount_type</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_name</span>]
      <span class="ruby-identifier">price</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">pro_fees</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-identifier">pro_fees</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_discount_type-source -->
          
        </div>

        

        
      </div><!-- update_discount_type-method -->

    
      <div id="method-i-update_provider_discount_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_provider_discount_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_provider_discount_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 170</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_provider_discount_fee</span>
  <span class="ruby-ivar">@up_disc_provider_fee</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_discount_code_type_id=#{params[:fee_type_id]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">code_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_name</span>]
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">discount_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_code</span>]
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">coupon_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:disc_price</span>]
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">start_date</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_start</span>])
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">end_date</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_end</span>])
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:note</span>]
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@up_disc_provider_fee</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@pro_discount_fees</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_provider_discount_fee-source -->
          
        </div>

        

        
      </div><!-- update_provider_discount_fee-method -->

    
      <div id="method-i-update_provider_fee" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_provider_fee</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_provider_fee-source">
            <pre><span class="ruby-comment"># File app/controllers/activity_detail_controller.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_provider_fee</span>
  <span class="ruby-ivar">@up_provider_fee</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and provider_fee_type_id=#{params[:fee_type_id]}&quot;</span>).<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">fee_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_name</span>]
    <span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_price</span>]
    <span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">fee_mandatory</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_mandatory</span>]
    <span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">quantity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:fee_quantity</span>]
    <span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:note</span>]
    <span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
    <span class="ruby-ivar">@up_provider_fee</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_provider_fee-source -->
          
        </div>

        

        
      </div><!-- update_provider_fee-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

