<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

<title>class ActivitiesController - Rails Application Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>app/controllers/activities_controller.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="ApplicationController.html">ApplicationController</a>
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">ActionView::Helpers::TextHelper</span>
  
  
  
    <li><a class="include" href="ActivitiesHelper.html">ActivitiesHelper</a>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-i-act_date">#act_date</a>
    
    <li><a href="#method-i-activities_index">#activities_index</a>
    
    <li><a href="#method-i-activity_count_newsletter">#activity_count_newsletter</a>
    
    <li><a href="#method-i-activity_count_newsletter_api">#activity_count_newsletter_api</a>
    
    <li><a href="#method-i-activity_create">#activity_create</a>
    
    <li><a href="#method-i-activity_create_index">#activity_create_index</a>
    
    <li><a href="#method-i-activity_create_index_new">#activity_create_index_new</a>
    
    <li><a href="#method-i-activity_parent">#activity_parent</a>
    
    <li><a href="#method-i-activity_save_copy">#activity_save_copy</a>
    
    <li><a href="#method-i-activity_tags">#activity_tags</a>
    
    <li><a href="#method-i-activity_update">#activity_update</a>
    
    <li><a href="#method-i-add_participant">#add_participant</a>
    
    <li><a href="#method-i-advance_search_hold">#advance_search_hold</a>
    
    <li><a href="#method-i-advanced_search">#advanced_search</a>
    
    <li><a href="#method-i-advanced_search_changed">#advanced_search_changed</a>
    
    <li><a href="#method-i-advanced_search_new">#advanced_search_new</a>
    
    <li><a href="#method-i-advancesearch_repeat">#advancesearch_repeat</a>
    
    <li><a href="#method-i-basic_search_count">#basic_search_count</a>
    
    <li><a href="#method-i-build_activity_network_popup">#build_activity_network_popup</a>
    
    <li><a href="#method-i-change_password">#change_password</a>
    
    <li><a href="#method-i-contact_import">#contact_import</a>
    
    <li><a href="#method-i-create_activity">#create_activity</a>
    
    <li><a href="#method-i-data_entry">#data_entry</a>
    
    <li><a href="#method-i-delete_activity">#delete_activity</a>
    
    <li><a href="#method-i-destroy">#destroy</a>
    
    <li><a href="#method-i-edit_update_sub_category">#edit_update_sub_category</a>
    
    <li><a href="#method-i-event_index">#event_index</a>
    
    <li><a href="#method-i-event_index_update">#event_index_update</a>
    
    <li><a href="#method-i-every_mon_wed_fri">#every_mon_wed_fri</a>
    
    <li><a href="#method-i-every_mon_wed_fri_never">#every_mon_wed_fri_never</a>
    
    <li><a href="#method-i-every_tue_thu">#every_tue_thu</a>
    
    <li><a href="#method-i-every_tue_thu_never">#every_tue_thu_never</a>
    
    <li><a href="#method-i-every_week_mon_to_fri">#every_week_mon_to_fri</a>
    
    <li><a href="#method-i-every_week_mon_to_fri_never">#every_week_mon_to_fri_never</a>
    
    <li><a href="#method-i-file_download_checkout">#file_download_checkout</a>
    
    <li><a href="#method-i-index">#index</a>
    
    <li><a href="#method-i-invite_provider">#invite_provider</a>
    
    <li><a href="#method-i-landing_search">#landing_search</a>
    
    <li><a href="#method-i-mailtofollowuser_create">#mailtofollowuser_create</a>
    
    <li><a href="#method-i-message_preview_attachment">#message_preview_attachment</a>
    
    <li><a href="#method-i-multi_download">#multi_download</a>
    
    <li><a href="#method-i-new_success_page">#new_success_page</a>
    
    <li><a href="#method-i-provider_activites">#provider_activites</a>
    
    <li><a href="#method-i-provider_activites_old">#provider_activites_old</a>
    
    <li><a href="#method-i-provider_advance_search">#provider_advance_search</a>
    
    <li><a href="#method-i-provider_basic_search">#provider_basic_search</a>
    
    <li><a href="#method-i-provider_create">#provider_create</a>
    
    <li><a href="#method-i-provider_create_new_changes">#provider_create_new_changes</a>
    
    <li><a href="#method-i-provider_create_test">#provider_create_test</a>
    
    <li><a href="#method-i-provider_web_count">#provider_web_count</a>
    
    <li><a href="#method-i-repeat_daily_view">#repeat_daily_view</a>
    
    <li><a href="#method-i-repeat_monthly_date">#repeat_monthly_date</a>
    
    <li><a href="#method-i-repeat_monthly_date_never">#repeat_monthly_date_never</a>
    
    <li><a href="#method-i-repeat_monthly_day">#repeat_monthly_day</a>
    
    <li><a href="#method-i-repeat_monthly_day_never">#repeat_monthly_day_never</a>
    
    <li><a href="#method-i-repeat_monthly_view">#repeat_monthly_view</a>
    
    <li><a href="#method-i-repeat_schedule">#repeat_schedule</a>
    
    <li><a href="#method-i-repeat_schedule_end">#repeat_schedule_end</a>
    
    <li><a href="#method-i-repeat_schedule_occurance">#repeat_schedule_occurance</a>
    
    <li><a href="#method-i-repeat_weekly">#repeat_weekly</a>
    
    <li><a href="#method-i-repeat_weekly_never">#repeat_weekly_never</a>
    
    <li><a href="#method-i-repeat_weekly_view">#repeat_weekly_view</a>
    
    <li><a href="#method-i-repeat_yearly_view">#repeat_yearly_view</a>
    
    <li><a href="#method-i-save_favorites">#save_favorites</a>
    
    <li><a href="#method-i-schedule_destroy">#schedule_destroy</a>
    
    <li><a href="#method-i-schedule_price_detail">#schedule_price_detail</a>
    
    <li><a href="#method-i-schedule_repeat_append">#schedule_repeat_append</a>
    
    <li><a href="#method-i-search">#search</a>
    
    <li><a href="#method-i-search_activity_all_repeat">#search_activity_all_repeat</a>
    
    <li><a href="#method-i-search_advance_curator">#search_advance_curator</a>
    
    <li><a href="#method-i-search_by_keyword">#search_by_keyword</a>
    
    <li><a href="#method-i-search_curator">#search_curator</a>
    
    <li><a href="#method-i-search_daily_view">#search_daily_view</a>
    
    <li><a href="#method-i-search_event_index">#search_event_index</a>
    
    <li><a href="#method-i-search_index">#search_index</a>
    
    <li><a href="#method-i-search_monthly_view">#search_monthly_view</a>
    
    <li><a href="#method-i-search_weekly_view">#search_weekly_view</a>
    
    <li><a href="#method-i-search_yearly_view">#search_yearly_view</a>
    
    <li><a href="#method-i-show">#show</a>
    
    <li><a href="#method-i-special_activity_all">#special_activity_all</a>
    
    <li><a href="#method-i-test_repeat">#test_repeat</a>
    
    <li><a href="#method-i-update_active_status">#update_active_status</a>
    
    <li><a href="#method-i-update_index">#update_index</a>
    
    <li><a href="#method-i-update_password">#update_password</a>
    
    <li><a href="#method-i-update_shared">#update_shared</a>
    
    <li><a href="#method-i-update_sub_category">#update_sub_category</a>
    
    <li><a href="#method-i-user_activity_status">#user_activity_status</a>
    
    <li><a href="#method-i-user_setting">#user_setting</a>
    
    <li><a href="#method-i-week_of_month_for_date">#week_of_month_for_date</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./doc/README_FOR_APP.html">README_FOR_APP</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./ActivitiesController.html">ActivitiesController</a>
  
    <li><a href="./ActivitiesHelper.html">ActivitiesHelper</a>
  
    <li><a href="./Activity.html">Activity</a>
  
    <li><a href="./ActivityAttendDetail.html">ActivityAttendDetail</a>
  
    <li><a href="./ActivityAttendDetailsController.html">ActivityAttendDetailsController</a>
  
    <li><a href="./ActivityAttendDetailsHelper.html">ActivityAttendDetailsHelper</a>
  
    <li><a href="./ActivityBid.html">ActivityBid</a>
  
    <li><a href="./ActivityBidsController.html">ActivityBidsController</a>
  
    <li><a href="./ActivityBidsHelper.html">ActivityBidsHelper</a>
  
    <li><a href="./ActivityCategoriesController.html">ActivityCategoriesController</a>
  
    <li><a href="./ActivityCategoriesHelper.html">ActivityCategoriesHelper</a>
  
    <li><a href="./ActivityCategory.html">ActivityCategory</a>
  
    <li><a href="./ActivityClick.html">ActivityClick</a>
  
    <li><a href="./ActivityComment.html">ActivityComment</a>
  
    <li><a href="./ActivityCommentsController.html">ActivityCommentsController</a>
  
    <li><a href="./ActivityCommentsHelper.html">ActivityCommentsHelper</a>
  
    <li><a href="./ActivityCount.html">ActivityCount</a>
  
    <li><a href="./ActivityDetailController.html">ActivityDetailController</a>
  
    <li><a href="./ActivityDetailHelper.html">ActivityDetailHelper</a>
  
    <li><a href="./ActivityDiscountPrice.html">ActivityDiscountPrice</a>
  
    <li><a href="./ActivityFavorite.html">ActivityFavorite</a>
  
    <li><a href="./ActivityFavoritesController.html">ActivityFavoritesController</a>
  
    <li><a href="./ActivityFavoritesHelper.html">ActivityFavoritesHelper</a>
  
    <li><a href="./ActivityForm.html">ActivityForm</a>
  
    <li><a href="./ActivityNetworkController.html">ActivityNetworkController</a>
  
    <li><a href="./ActivityNetworkHelper.html">ActivityNetworkHelper</a>
  
    <li><a href="./ActivityNetworkPermission.html">ActivityNetworkPermission</a>
  
    <li><a href="./ActivityPrice.html">ActivityPrice</a>
  
    <li><a href="./ActivityPricesController.html">ActivityPricesController</a>
  
    <li><a href="./ActivityPricesHelper.html">ActivityPricesHelper</a>
  
    <li><a href="./ActivityRating.html">ActivityRating</a>
  
    <li><a href="./ActivityRatingsController.html">ActivityRatingsController</a>
  
    <li><a href="./ActivityRatingsHelper.html">ActivityRatingsHelper</a>
  
    <li><a href="./ActivityRepeat.html">ActivityRepeat</a>
  
    <li><a href="./ActivityRepeatsController.html">ActivityRepeatsController</a>
  
    <li><a href="./ActivityRepeatsHelper.html">ActivityRepeatsHelper</a>
  
    <li><a href="./ActivityRow.html">ActivityRow</a>
  
    <li><a href="./ActivityRowsController.html">ActivityRowsController</a>
  
    <li><a href="./ActivityRowsHelper.html">ActivityRowsHelper</a>
  
    <li><a href="./ActivitySchedule.html">ActivitySchedule</a>
  
    <li><a href="./ActivitySchedulesController.html">ActivitySchedulesController</a>
  
    <li><a href="./ActivitySchedulesHelper.html">ActivitySchedulesHelper</a>
  
    <li><a href="./ActivitySetting.html">ActivitySetting</a>
  
    <li><a href="./ActivitySettingsDetail.html">ActivitySettingsDetail</a>
  
    <li><a href="./ActivitySettingsType.html">ActivitySettingsType</a>
  
    <li><a href="./ActivityShared.html">ActivityShared</a>
  
    <li><a href="./ActivitySharedsController.html">ActivitySharedsController</a>
  
    <li><a href="./ActivitySharedsHelper.html">ActivitySharedsHelper</a>
  
    <li><a href="./ActivitySubcategoriesController.html">ActivitySubcategoriesController</a>
  
    <li><a href="./ActivitySubcategoriesHelper.html">ActivitySubcategoriesHelper</a>
  
    <li><a href="./ActivitySubcategory.html">ActivitySubcategory</a>
  
    <li><a href="./ActivityTotalCount.html">ActivityTotalCount</a>
  
    <li><a href="./ActivityTrack.html">ActivityTrack</a>
  
    <li><a href="./AdminController.html">AdminController</a>
  
    <li><a href="./AdminDiscountCode.html">AdminDiscountCode</a>
  
    <li><a href="./AdminDiscountCodesController.html">AdminDiscountCodesController</a>
  
    <li><a href="./AdminDiscountCodesHelper.html">AdminDiscountCodesHelper</a>
  
    <li><a href="./AdminHelper.html">AdminHelper</a>
  
    <li><a href="./AgeRangeColorsController.html">AgeRangeColorsController</a>
  
    <li><a href="./AgeRangeColorsHelper.html">AgeRangeColorsHelper</a>
  
    <li><a href="./AgerangeColor.html">AgerangeColor</a>
  
    <li><a href="./AgerangeColorsController.html">AgerangeColorsController</a>
  
    <li><a href="./AgerangeColorsHelper.html">AgerangeColorsHelper</a>
  
    <li><a href="./ApplicationController.html">ApplicationController</a>
  
    <li><a href="./ApplicationHelper.html">ApplicationHelper</a>
  
    <li><a href="./Authentication.html">Authentication</a>
  
    <li><a href="./AuthenticationsController.html">AuthenticationsController</a>
  
    <li><a href="./BlockUser.html">BlockUser</a>
  
    <li><a href="./CheckoutController.html">CheckoutController</a>
  
    <li><a href="./City.html">City</a>
  
    <li><a href="./CityGroup.html">CityGroup</a>
  
    <li><a href="./ContactGroup.html">ContactGroup</a>
  
    <li><a href="./ContactGroupsController.html">ContactGroupsController</a>
  
    <li><a href="./ContactGroupsHelper.html">ContactGroupsHelper</a>
  
    <li><a href="./ContactUser.html">ContactUser</a>
  
    <li><a href="./ContactUserGroup.html">ContactUserGroup</a>
  
    <li><a href="./ContactUsersController.html">ContactUsersController</a>
  
    <li><a href="./ContactUsersHelper.html">ContactUsersHelper</a>
  
    <li><a href="./Country.html">Country</a>
  
    <li><a href="./DefaultFilter.html">DefaultFilter</a>
  
    <li><a href="./DefaultFiltersController.html">DefaultFiltersController</a>
  
    <li><a href="./DefaultFiltersHelper.html">DefaultFiltersHelper</a>
  
    <li><a href="./DeletedSchedule.html">DeletedSchedule</a>
  
    <li><a href="./DetailPageIdentityHelper.html">DetailPageIdentityHelper</a>
  
    <li><a href="./DetailsPageController.html">DetailsPageController</a>
  
    <li><a href="./DetailsPageHelper.html">DetailsPageHelper</a>
  
    <li><a href="./DiscountDollarsController.html">DiscountDollarsController</a>
  
    <li><a href="./DiscountDollarsHelper.html">DiscountDollarsHelper</a>
  
    <li><a href="./EmbedController.html">EmbedController</a>
  
    <li><a href="./ErrorsController.html">ErrorsController</a>
  
    <li><a href="./FamFeeDetail.html">FamFeeDetail</a>
  
    <li><a href="./FamNetwork.html">FamNetwork</a>
  
    <li><a href="./FamNetworkGroup.html">FamNetworkGroup</a>
  
    <li><a href="./FamNetworkGroupsController.html">FamNetworkGroupsController</a>
  
    <li><a href="./FamNetworkGroupsHelper.html">FamNetworkGroupsHelper</a>
  
    <li><a href="./FamNetworkPost.html">FamNetworkPost</a>
  
    <li><a href="./FamNetworkPostsController.html">FamNetworkPostsController</a>
  
    <li><a href="./FamNetworkPostsHelper.html">FamNetworkPostsHelper</a>
  
    <li><a href="./FamNetworkRow.html">FamNetworkRow</a>
  
    <li><a href="./FamNetworksController.html">FamNetworksController</a>
  
    <li><a href="./FamNetworksHelper.html">FamNetworksHelper</a>
  
    <li><a href="./FamPost.html">FamPost</a>
  
    <li><a href="./FamPostsController.html">FamPostsController</a>
  
    <li><a href="./FamPostsHelper.html">FamPostsHelper</a>
  
    <li><a href="./FampassDetail.html">FampassDetail</a>
  
    <li><a href="./FamtivityNetworkMailer.html">FamtivityNetworkMailer</a>
  
    <li><a href="./FeaturedAuditLog.html">FeaturedAuditLog</a>
  
    <li><a href="./FeaturedAuditLogsController.html">FeaturedAuditLogsController</a>
  
    <li><a href="./FeaturedAuditLogsHelper.html">FeaturedAuditLogsHelper</a>
  
    <li><a href="./FollowingUser.html">FollowingUser</a>
  
    <li><a href="./Form.html">Form</a>
  
    <li><a href="./FormQuestion.html">FormQuestion</a>
  
    <li><a href="./FormResult.html">FormResult</a>
  
    <li><a href="./FormResultAnswer.html">FormResultAnswer</a>
  
    <li><a href="./FormsController.html">FormsController</a>
  
    <li><a href="./FormsHelper.html">FormsHelper</a>
  
    <li><a href="./GeneralTag.html">GeneralTag</a>
  
    <li><a href="./GuestDetail.html">GuestDetail</a>
  
    <li><a href="./HomeController.html">HomeController</a>
  
    <li><a href="./HomeHelper.html">HomeHelper</a>
  
    <li><a href="./InviteAttendees.html">InviteAttendees</a>
  
    <li><a href="./InvitesHelper.html">InvitesHelper</a>
  
    <li><a href="./InvitorList.html">InvitorList</a>
  
    <li><a href="./InvitorListHelper.html">InvitorListHelper</a>
  
    <li><a href="./LandingController.html">LandingController</a>
  
    <li><a href="./LandingHelper.html">LandingHelper</a>
  
    <li><a href="./LeadTransaction.html">LeadTransaction</a>
  
    <li><a href="./LoginController.html">LoginController</a>
  
    <li><a href="./LogoutController.html">LogoutController</a>
  
    <li><a href="./Manager.html">Manager</a>
  
    <li><a href="./Message.html">Message</a>
  
    <li><a href="./MessageFile.html">MessageFile</a>
  
    <li><a href="./MessageMailer.html">MessageMailer</a>
  
    <li><a href="./MessageThread.html">MessageThread</a>
  
    <li><a href="./MessageThreadViewer.html">MessageThreadViewer</a>
  
    <li><a href="./MessagesController.html">MessagesController</a>
  
    <li><a href="./MessagesHelper.html">MessagesHelper</a>
  
    <li><a href="./MonthlyBudget.html">MonthlyBudget</a>
  
    <li><a href="./MonthlyBudgetsController.html">MonthlyBudgetsController</a>
  
    <li><a href="./MonthlyBudgetsHelper.html">MonthlyBudgetsHelper</a>
  
    <li><a href="./NewsletterMailer.html">NewsletterMailer</a>
  
    <li><a href="./NewslettersController.html">NewslettersController</a>
  
    <li><a href="./NotificationDetail.html">NotificationDetail</a>
  
    <li><a href="./ParentNotification.html">ParentNotification</a>
  
    <li><a href="./ParentNotificationDetail.html">ParentNotificationDetail</a>
  
    <li><a href="./ParentSetting.html">ParentSetting</a>
  
    <li><a href="./ParentSettingDetail.html">ParentSettingDetail</a>
  
    <li><a href="./ParentSettingsController.html">ParentSettingsController</a>
  
    <li><a href="./Participant.html">Participant</a>
  
    <li><a href="./ParticipantsController.html">ParticipantsController</a>
  
    <li><a href="./ParticipantsHelper.html">ParticipantsHelper</a>
  
    <li><a href="./PaymentDetail.html">PaymentDetail</a>
  
    <li><a href="./PaymentDetailsController.html">PaymentDetailsController</a>
  
    <li><a href="./PaymentDetailsHelper.html">PaymentDetailsHelper</a>
  
    <li><a href="./PoliciesController.html">PoliciesController</a>
  
    <li><a href="./PoliciesHelper.html">PoliciesHelper</a>
  
    <li><a href="./Policy.html">Policy</a>
  
    <li><a href="./PolicyFile.html">PolicyFile</a>
  
    <li><a href="./PolicyType.html">PolicyType</a>
  
    <li><a href="./ProviderActivityFee.html">ProviderActivityFee</a>
  
    <li><a href="./ProviderActivityFeeType.html">ProviderActivityFeeType</a>
  
    <li><a href="./ProviderCount.html">ProviderCount</a>
  
    <li><a href="./ProviderDiscountCode.html">ProviderDiscountCode</a>
  
    <li><a href="./ProviderDiscountCodeType.html">ProviderDiscountCodeType</a>
  
    <li><a href="./ProviderDiscountType.html">ProviderDiscountType</a>
  
    <li><a href="./ProviderLead.html">ProviderLead</a>
  
    <li><a href="./ProviderListController.html">ProviderListController</a>
  
    <li><a href="./ProviderNotification.html">ProviderNotification</a>
  
    <li><a href="./ProviderNotificationDetail.html">ProviderNotificationDetail</a>
  
    <li><a href="./ProviderSetting.html">ProviderSetting</a>
  
    <li><a href="./ProviderSettingDetail.html">ProviderSettingDetail</a>
  
    <li><a href="./ProviderSettingsController.html">ProviderSettingsController</a>
  
    <li><a href="./ProviderSettingsHelper.html">ProviderSettingsHelper</a>
  
    <li><a href="./ProviderTransaction.html">ProviderTransaction</a>
  
    <li><a href="./ProviderTransactionLog.html">ProviderTransactionLog</a>
  
    <li><a href="./ProviderWebsiteTrack.html">ProviderWebsiteTrack</a>
  
    <li><a href="./Question.html">Question</a>
  
    <li><a href="./QuestionType.html">QuestionType</a>
  
    <li><a href="./QuestionValue.html">QuestionValue</a>
  
    <li><a href="./QuickLinksController.html">QuickLinksController</a>
  
    <li><a href="./QuickLinksHelper.html">QuickLinksHelper</a>
  
    <li><a href="./SchoolRepresentative.html">SchoolRepresentative</a>
  
    <li><a href="./SchoolRepresentativesController.html">SchoolRepresentativesController</a>
  
    <li><a href="./SearchController.html">SearchController</a>
  
    <li><a href="./SearchHelper.html">SearchHelper</a>
  
    <li><a href="./SendSMS.html">SendSMS</a>
  
    <li><a href="./Setting.html">Setting</a>
  
    <li><a href="./SettingsController.html">SettingsController</a>
  
    <li><a href="./SettingsHelper.html">SettingsHelper</a>
  
    <li><a href="./SmsStatus.html">SmsStatus</a>
  
    <li><a href="./SocialType.html">SocialType</a>
  
    <li><a href="./SponsorShip.html">SponsorShip</a>
  
    <li><a href="./SponsorShipsController.html">SponsorShipsController</a>
  
    <li><a href="./SponsorShipsHelper.html">SponsorShipsHelper</a>
  
    <li><a href="./State.html">State</a>
  
    <li><a href="./StaticController.html">StaticController</a>
  
    <li><a href="./Support.html">Support</a>
  
    <li><a href="./SupportsController.html">SupportsController</a>
  
    <li><a href="./SupportsHelper.html">SupportsHelper</a>
  
    <li><a href="./Ticket.html">Ticket</a>
  
    <li><a href="./TicketsController.html">TicketsController</a>
  
    <li><a href="./TicketsHelper.html">TicketsHelper</a>
  
    <li><a href="./TransactionDetail.html">TransactionDetail</a>
  
    <li><a href="./User.html">User</a>
  
    <li><a href="./UserBankDetail.html">UserBankDetail</a>
  
    <li><a href="./UserCalender.html">UserCalender</a>
  
    <li><a href="./UserCard.html">UserCard</a>
  
    <li><a href="./UserChild.html">UserChild</a>
  
    <li><a href="./UserChildrenController.html">UserChildrenController</a>
  
    <li><a href="./UserCredit.html">UserCredit</a>
  
    <li><a href="./UserDeactivateLog.html">UserDeactivateLog</a>
  
    <li><a href="./UserDebit.html">UserDebit</a>
  
    <li><a href="./UserDeletedAccount.html">UserDeletedAccount</a>
  
    <li><a href="./UserEmailChangeLog.html">UserEmailChangeLog</a>
  
    <li><a href="./UserMailer.html">UserMailer</a>
  
    <li><a href="./UserNotification.html">UserNotification</a>
  
    <li><a href="./UserProfile.html">UserProfile</a>
  
    <li><a href="./UserProfilesController.html">UserProfilesController</a>
  
    <li><a href="./UserProfilesHelper.html">UserProfilesHelper</a>
  
    <li><a href="./UserRow.html">UserRow</a>
  
    <li><a href="./UserSettingsHelper.html">UserSettingsHelper</a>
  
    <li><a href="./UserTransaction.html">UserTransaction</a>
  
    <li><a href="./UserTransactionsController.html">UserTransactionsController</a>
  
    <li><a href="./UserTransactionsHelper.html">UserTransactionsHelper</a>
  
    <li><a href="./UsersController.html">UsersController</a>
  
    <li><a href="./UsersHelper.html">UsersHelper</a>
  
    <li><a href="./WeekendActivity.html">WeekendActivity</a>
  
    <li><a href="./WeekendMailer.html">WeekendMailer</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ActivitiesController</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-act_date" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">act_date</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>to get activities detail by date wise used by amar to collect the data
entering</p>
          

          
          <div class="method-source-code" id="act_date-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1472</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">act_date</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- act_date-source -->
          
        </div>

        

        
      </div><!-- act_date-method -->

    
      <div id="method-i-activities_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activities_index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activities_index-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1509</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activities_index</span>
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- activities_index-source -->
          
        </div>

        

        
      </div><!-- activities_index-method -->

    
      <div id="method-i-activity_count_newsletter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_count_newsletter</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>activitu count newsletter</p>
          

          
          <div class="method-source-code" id="activity_count_newsletter-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5983</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_count_newsletter</span>
  <span class="ruby-ivar">@act_result</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">NewsletterMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider activity count&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">user_activity_count</span>(<span class="ruby-ivar">@user</span>)
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;result&quot;</span>] = <span class="ruby-string">&quot;Success&quot;</span>
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;message&quot;</span>] = <span class="ruby-string">&quot;Mail has been send successfully&quot;</span>
      <span class="ruby-identifier">response</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@act_result</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;result&quot;</span>] = <span class="ruby-string">&quot;Failure&quot;</span>
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;message&quot;</span>] = <span class="ruby-string">&quot;Invalid user&quot;</span>
      <span class="ruby-identifier">response</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@act_result</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;result&quot;</span>] = <span class="ruby-string">&quot;Failure&quot;</span>
    <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;message&quot;</span>] = <span class="ruby-string">&quot;Failure&quot;</span>
    <span class="ruby-identifier">response</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@act_result</span>.<span class="ruby-identifier">to_json</span>
              
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_count_newsletter-source -->
          
        </div>

        

        
      </div><!-- activity_count_newsletter-method -->

    
      <div id="method-i-activity_count_newsletter_api" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_count_newsletter_api</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>active , inactive, expire view ount, share count activity list</p>
          

          
          <div class="method-source-code" id="activity_count_newsletter_api-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5853</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_count_newsletter_api</span>
  <span class="ruby-ivar">@act_result</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email_address</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-ivar">@active_listings_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">active_activities_list</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@active_listings_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@active_listings_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@active_listings</span> = <span class="ruby-ivar">@active_listings_list</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@active_listings</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@discount_dollar_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">discount_dollar_activities</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@discount_dollar_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@discount_dollar_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@discount_dollar</span> = <span class="ruby-ivar">@discount_dollar_list</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@discount_dollar</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@inactive_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">inactive_activities</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@inactive_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@inactive_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@inactive</span> = <span class="ruby-ivar">@inactive_list</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@inactive</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@expired_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">expired_activities</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@expired_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@expired_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@expired</span> = <span class="ruby-ivar">@expired_list</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@expired</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment">#view : 500. 3% increase from last week</span>
      <span class="ruby-identifier">p_str</span> = <span class="ruby-string">''</span>
      <span class="ruby-ivar">@cal</span> = <span class="ruby-value">0</span>
      <span class="ruby-ivar">@current_week</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">total_view_list</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-ivar">@last_week</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">total_view_list_lastweek</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@current_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@current_week</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@current_week</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@current_week</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@current_wk_val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">view_count</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@current_wk_val</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@last_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@last_week</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@last_week</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@last_week</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
          <span class="ruby-ivar">@last_wk_val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">view_count</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@last_wk_val</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
                      
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@current_wk_val</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@last_wk_val</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
        <span class="ruby-ivar">@cal</span> = (<span class="ruby-ivar">@current_wk_val</span>.<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">-</span> (<span class="ruby-ivar">@last_wk_val</span>.<span class="ruby-identifier">to_f</span>)
        <span class="ruby-ivar">@percentage</span> = ((<span class="ruby-ivar">@current_wk_val</span>.<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">-</span> (<span class="ruby-ivar">@last_wk_val</span>.<span class="ruby-identifier">to_f</span>))<span class="ruby-operator">/</span><span class="ruby-value">100</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@cal</span> = <span class="ruby-value">0</span>
        <span class="ruby-ivar">@percentage</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cal</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@cal</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">p_str</span> = <span class="ruby-node">&quot;#{@current_wk_val}. #{@percentage} increase from last week&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cal</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">p_str</span> = <span class="ruby-node">&quot;#{@current_wk_val}. 0 from last week&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">p_str</span> = <span class="ruby-node">&quot;#{@current_wk_val}. #{@percentage} decrease from last week&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@view_percentage</span> = <span class="ruby-identifier">p_str</span>
      <span class="ruby-ivar">@top_view_activity</span> = <span class="ruby-string">''</span>
      <span class="ruby-ivar">@top_view_activity_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">top_view_activities</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@top_view_activity_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@top_view_activity_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@top_view_activity_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">activity</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">activity</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@top_view_activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
            <span class="ruby-ivar">@top_view_activity</span> = <span class="ruby-node">&quot;#{@top_view_activity},#{act.activity_name.capitalize}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@top_view_activity</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">capitalize</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@top_view_activity</span> = <span class="ruby-string">&quot;No activities&quot;</span>
      <span class="ruby-keyword">end</span>
                      
      <span class="ruby-ivar">@top_activity_share</span> = <span class="ruby-string">''</span>
      <span class="ruby-ivar">@top_activity_share_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">top_share_activities</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@top_activity_share_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@top_activity_share_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@top_activity_share_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">activity</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_activity_id</span>(<span class="ruby-identifier">activity</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">activity</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@top_activity_share</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
            <span class="ruby-ivar">@top_activity_share</span> = <span class="ruby-node">&quot;#{@top_activity_share},#{act.activity_name.capitalize}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@top_activity_share</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">capitalize</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act</span>.<span class="ruby-identifier">activity_name</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@top_activity_share</span> = <span class="ruby-string">&quot;No activities&quot;</span>
      <span class="ruby-keyword">end</span>
                      
      <span class="ruby-ivar">@leads_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">lead_user_list</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@leads_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@leads_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@leads</span> = <span class="ruby-ivar">@leads_list</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@leads</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@registration_list</span> =<span class="ruby-constant">Activity</span>.<span class="ruby-identifier">provider_invitee_list</span>(<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_id</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@registration_list</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@registration_list</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@registration</span> = <span class="ruby-ivar">@registration_list</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@registration</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">arr</span> = []
      <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;active_listing&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@active_listings</span>,<span class="ruby-string">&quot;discount_dollar&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@discount_dollar</span> ,<span class="ruby-string">&quot;inactive_activity&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@inactive</span>,<span class="ruby-string">&quot;expired_Activity&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@expired</span>, <span class="ruby-string">&quot;view&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@view_percentage</span>, <span class="ruby-string">&quot;top_activity&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@top_view_activity</span>, <span class="ruby-string">&quot;top_share_activity&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@top_activity_share</span>,<span class="ruby-string">&quot;leads&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@leads</span>,<span class="ruby-string">&quot;registration&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@registration</span>}
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;result&quot;</span>] = <span class="ruby-string">&quot;Success&quot;</span>
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;message&quot;</span>] = <span class="ruby-string">&quot;Successfully get the details&quot;</span>
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;data&quot;</span>] = <span class="ruby-identifier">arr</span>
      <span class="ruby-identifier">response</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@act_result</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;result&quot;</span>] = <span class="ruby-string">&quot;Failure&quot;</span>
      <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;message&quot;</span>] = <span class="ruby-string">&quot;Invalid user&quot;</span>
      <span class="ruby-identifier">response</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@act_result</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;result&quot;</span>] = <span class="ruby-string">&quot;Failure&quot;</span>
    <span class="ruby-ivar">@act_result</span>[<span class="ruby-string">&quot;message&quot;</span>] = <span class="ruby-string">&quot;Failure&quot;</span>
    <span class="ruby-identifier">response</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JSON</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@act_result</span>.<span class="ruby-identifier">to_json</span>
              
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_count_newsletter_api-source -->
          
        </div>

        

        
      </div><!-- activity_count_newsletter_api-method -->

    
      <div id="method-i-activity_create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>called when creating activity for parent</p>
          

          
          <div class="method-source-code" id="activity_create-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5097</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_create</span>
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>

  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>

  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Email&quot;</span>
  <span class="ruby-comment">#~ @activity_profile_apf.no_participants = params[:no_participants] if params[:no_participants] != &quot;Specify Number&quot;</span>
  
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_1</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 1&quot;</span>
 
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">created_by</span> = <span class="ruby-string">&quot;Parent&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]
      
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">city_se</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;city_name='#{params[:city]}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">latitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">latitude</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">longitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">longitude</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">to_f</span>)<span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#@activity_profile_apf.filter_id = 4 if params[:activity_type] == &quot;U&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;Any Time&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:any_address</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;0&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
   
  <span class="ruby-ivar">@result_in</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>

  <span class="ruby-identifier">success</span> = <span class="ruby-ivar">@activity_profile_apf</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;Any Time&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Time&quot;</span>)
      <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Time&quot;</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>,<span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>,<span class="ruby-value">:no_of_participant</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck_1</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck_1</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>]
            <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>

              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_1&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_1&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_1&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yearly&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
              <span class="ruby-keyword">end</span>
              <span class="ruby-comment">#ex_date = Date.parse(params[:date_1_1]) + (params[:repeatNumWeekVal_1].to_i * params[:after_occ_1].to_i).days</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>]
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment">#@date_split = params[:date_total].split(',') if !params[:date_total].nil?</span>
        <span class="ruby-comment"># @date_split.each do |s|</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1_1]} #{params[:schedule_stime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1_1]} #{params[:schedule_etime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Schedule&quot;</span>,<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],<span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>,
          <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>,<span class="ruby-value">:no_of_participant</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>])
        <span class="ruby-comment">#end</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Schedule&quot;</span>)
        <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal_1</span>],
          <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:r1_1</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ_1</span>],
          <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date_1</span>],<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month1_1</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days_1</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal_1</span>])

      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Whole Day&quot;</span>)
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1_1]} #{params[:schedule_stime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1_1]} #{params[:schedule_etime_2_1]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Whole Day&quot;</span>,<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1_1</span>],<span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>,
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2_1</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2_1</span>],<span class="ruby-value">:no_of_participant</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>])
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#send a mail while creating activity</span>
  <span class="ruby-ivar">@notify_setting_net</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id where pn.notify_action='1' and p.user_id='#{current_user.user_id}' and p.notify_flag=true&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@notify_setting_net</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_net</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_net</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@parent_network</span> = <span class="ruby-constant">ActivityShared</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct user_id,shared_to from activity_shareds where shared_to='#{current_user.email_address}' and user_id!='#{current_user.user_id}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@parent_network</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">net_user</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@net_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">net_user</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">net_user</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@net_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@net_user</span>.<span class="ruby-identifier">user_flag</span> <span class="ruby-operator">==</span> <span class="ruby-constant">TRUE</span>
        <span class="ruby-identifier">user_email_id</span> =  <span class="ruby-ivar">@net_user</span>.<span class="ruby-identifier">email_address</span>
        <span class="ruby-comment">#@result = UserMailer.following_user_mail(@net_user,current_user,@activity_profile_apf,@get_current_url,params[:message],user_email_id,params[:subject]).deliver</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_mail</span>(<span class="ruby-ivar">@net_user</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">user_email_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@parent_network</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#When someone I'm following creates a new activity</span>
  <span class="ruby-ivar">@notify_setting_info</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id where pn.notify_action='2' and p.user_id=#{current_user.user_id} and p.notify_flag=true&quot;</span>)
  <span class="ruby-comment">#    if !@notify_setting_info.nil? &amp;&amp; @notify_setting_info!='' &amp;&amp; @notify_setting_info.present?</span>
  <span class="ruby-identifier">mailtofollowuser_create</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-string">&quot;create&quot;</span>)
  <span class="ruby-comment">#    end</span>
  <span class="ruby-comment">#parent activity mail purpose</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-identifier">current_user</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
    <span class="ruby-identifier">user_email_id</span>=<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Parent Create Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">parent_create_activity_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-identifier">user_email_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-ivar">@plan</span>,<span class="ruby-ivar">@get_current_url</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;parent_create_thank&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_create-source -->
          
        </div>

        

        
      </div><!-- activity_create-method -->

    
      <div id="method-i-activity_create_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_create_index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activity_create_index-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5021</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_create_index</span>
  <span class="ruby-comment"># @cities = [&quot;Chicago&quot;,&quot;Dallas&quot;,&quot;Detroit&quot;,&quot;Houston&quot;,&quot;Las Vegas&quot;,&quot;Los Angeles&quot;,&quot;New York&quot;,&quot;Philadelphia&quot;,&quot;San Antonio&quot;,&quot;San Francisco&quot;,&quot;San Jose&quot;,&quot;Seattle&quot;,&quot;Walnut Creek&quot;]</span>
  <span class="ruby-ivar">@cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;city_name Asc&quot;</span>).<span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_create_index-source -->
          
        </div>

        

        
      </div><!-- activity_create_index-method -->

    
      <div id="method-i-activity_create_index_new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_create_index_new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="activity_create_index_new-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1513</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_create_index_new</span>
  <span class="ruby-comment">#@cities = [&quot;Chicago&quot;,&quot;Dallas&quot;,&quot;Detroit&quot;,&quot;Houston&quot;,&quot;Las Vegas&quot;,&quot;Los Angeles&quot;,&quot;New York&quot;,&quot;Philadelphia&quot;,&quot;San Antonio&quot;,&quot;San Francisco&quot;,&quot;San Jose&quot;,&quot;Seattle&quot;,&quot;Walnut Creek&quot;]</span>
  <span class="ruby-ivar">@cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;city_name Asc&quot;</span>).<span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
  <span class="ruby-ivar">@pro_fees</span> = <span class="ruby-constant">ProviderActivityFeeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-ivar">@pro_discount_fees</span> = <span class="ruby-constant">ProviderDiscountCodeType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-ivar">@previous_tags</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">activity</span><span class="ruby-operator">|</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
  <span class="ruby-comment">#~ @country_code = Country.where(&quot;country_id = ?&quot;,1)</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_create_index_new-source -->
          
        </div>

        

        
      </div><!-- activity_create_index_new-method -->

    
      <div id="method-i-activity_parent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_parent</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>create new activity for parent</p>
          

          
          <div class="method-source-code" id="activity_parent-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5016</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_parent</span>
  <span class="ruby-comment">#@cities = [&quot;Chicago&quot;,&quot;Dallas&quot;,&quot;Detroit&quot;,&quot;Houston&quot;,&quot;Las Vegas&quot;,&quot;Los Angeles&quot;,&quot;New York&quot;,&quot;Philadelphia&quot;,&quot;San Antonio&quot;,&quot;San Francisco&quot;,&quot;San Jose&quot;,&quot;Seattle&quot;,&quot;Walnut Creek&quot;]</span>
  <span class="ruby-ivar">@cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;city_name Asc&quot;</span>).<span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_parent-source -->
          
        </div>

        

        
      </div><!-- activity_parent-method -->

    
      <div id="method-i-activity_save_copy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_save_copy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>activity save copy option</p>
          

          
          <div class="method-source-code" id="activity_save_copy-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_save_copy</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-ivar">@par_actid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>] <span class="ruby-comment">#dont remove this</span>
    <span class="ruby-identifier">old_act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>])
    <span class="ruby-identifier">newact</span> = <span class="ruby-identifier">old_act</span>.<span class="ruby-identifier">create_duplicate</span>(<span class="ruby-identifier">old_act</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select a.* from activities a left join school_representatives s on a.activity_id=s.activity_id where (user_id=#{current_user.user_id} or vendor_id=#{current_user.user_id} or representative_id=#{current_user.user_id}) and cleaned=true and lower(active_status)!='delete' and lower(active_status)!='city' and lower(created_by)='provider' order by a.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#old form save start</span>
    <span class="ruby-ivar">@old_form</span>=<span class="ruby-identifier">old_act</span>.<span class="ruby-identifier">activity_forms</span>
    <span class="ruby-ivar">@old_form</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">frm</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@activity_form</span> = <span class="ruby-constant">ActivityForm</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-identifier">newact</span>.<span class="ruby-identifier">activity_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">newact</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">form_id</span> = <span class="ruby-identifier">frm</span>.<span class="ruby-identifier">form_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">frm</span>.<span class="ruby-identifier">form_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">newact</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">newact</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">created_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">policy_file_id</span> = <span class="ruby-identifier">frm</span>.<span class="ruby-identifier">policy_file_id</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">frm</span>.<span class="ruby-identifier">policy_file_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_form</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#old form save end</span>
    <span class="ruby-identifier">act</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@auto_comp</span>=<span class="ruby-identifier">act</span>
    <span class="ruby-ivar">@activities</span> = []
    <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] = (<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
      <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-comment">#profile image changes</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
      <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
      <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_save_copy-source -->
          
        </div>

        

        
      </div><!-- activity_save_copy-method -->

    
      <div id="method-i-activity_tags" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_tags</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Autocomplete data populate</p>
          

          
          <div class="method-source-code" id="activity_tags-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1523</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_tags</span>
  <span class="ruby-ivar">@previous_tags</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:created_by</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Provider&quot;</span>, <span class="ruby-value">:cleaned</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:user_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">activity</span><span class="ruby-operator">|</span> <span class="ruby-identifier">activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">tags_txt</span>.<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
  <span class="ruby-ivar">@default_tags</span> = <span class="ruby-constant">GeneralTag</span>.<span class="ruby-identifier">all</span>
  <span class="ruby-ivar">@arr</span> = []
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:term</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:term</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:term</span>]
  <span class="ruby-operator">!</span><span class="ruby-ivar">@previous_tags</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@previous_tags</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:term</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tag</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:term</span>].<span class="ruby-identifier">downcase</span>).<span class="ruby-identifier">blank?</span>)
      <span class="ruby-ivar">@arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;id&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-string">&quot;label&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag</span>,<span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-operator">!</span><span class="ruby-ivar">@default_tags</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@default_tags</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:term</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tag</span>.<span class="ruby-identifier">tag_name</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:term</span>].<span class="ruby-identifier">downcase</span>).<span class="ruby-identifier">blank?</span>)
      <span class="ruby-ivar">@arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;id&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">tag_id</span>,<span class="ruby-string">&quot;label&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">tag_name</span>,<span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">tag_name</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:json</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@arr</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_tags-source -->
          
        </div>

        

        
      </div><!-- activity_tags-method -->

    
      <div id="method-i-activity_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activity_update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>provider page ajax call update</p>
          

          
          <div class="method-source-code" id="activity_update-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3628</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">activity_update</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_providertype_zip_code_update</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">json</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:json</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@activities</span>}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- activity_update-source -->
          
        </div>

        

        
      </div><!-- activity_update-method -->

    
      <div id="method-i-add_participant" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_participant</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="add_participant-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5037</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_participant</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@activity_sched</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_schedule_id</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_schedule_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_schedule_id</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@uid</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@attend_policy</span> = <span class="ruby-constant">Policy</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@uid</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@uid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@uid</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@uid</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@discount_dollar_tot_amt</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">discount_total_amount</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@discount_dollar</span> = <span class="ruby-ivar">@discount_dollar_tot_amt</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">-</span> <span class="ruby-ivar">@discount_dollar_tot_amt</span>[<span class="ruby-value">1</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@discount_dollar_tot_amt</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@discount_dollar_tot_amt</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@dd_eligible</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">discount_eligible</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@before_login_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@total_paticipant</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_paticipant</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:total_paticipant</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_paticipant</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@can_attend</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:can_attend</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:can_attend</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:can_attend</span>].<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_participant-source -->
          
        </div>

        

        
      </div><!-- add_participant-method -->

    
      <div id="method-i-advance_search_hold" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">advance_search_hold</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>advance search in parent view</p>
          

          
          <div class="method-source-code" id="advance_search_hold-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 4278</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">advance_search_hold</span>
  <span class="ruby-comment">#get the main search page url here</span>
  <span class="ruby-ivar">@search_page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-ivar">@sdate</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>].<span class="ruby-identifier">nil?</span>
        
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-identifier">date_range</span> = <span class="ruby-string">''</span>
  <span class="ruby-identifier">selected_date</span> = <span class="ruby-string">'no'</span>
  <span class="ruby-ivar">@condition_all</span> = <span class="ruby-string">''</span>
 
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_mile</span>]
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>]
  <span class="ruby-ivar">@basictext</span> = <span class="ruby-string">''</span>
  
  <span class="ruby-ivar">@keyword</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@parent_keyword</span> = <span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;'&quot;</span>,<span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@basictext</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; (lower(user_profiles.business_name) like '%#{@parent_keyword}%' or lower(activities.activity_name) like '%#{@parent_keyword}%' or lower(activities.category) like '%#{@parent_keyword}%' or lower(activities.sub_category) like '%#{@parent_keyword}%' or lower(activities.description) like '%#{@parent_keyword}%' or lower(activities.city) like '%#{@parent_keyword}%') &quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span>
  
  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-identifier">day_of_the_week</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">day_of_the_week</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-ivar">@activity_type</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@activity_type</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@category</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@zipcode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]
  <span class="ruby-ivar">@city</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
  <span class="ruby-ivar">@gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>

  <span class="ruby-comment">#create the array for age_range values</span>
  <span class="ruby-identifier">age_range</span> = []
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@condition1</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition2</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition3</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition4</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition5</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition6</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition7</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@i</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@c</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@z</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@ct</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@p</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@ag</span> = <span class="ruby-value">0</span>

  <span class="ruby-comment">#if !@activity_type.include?('all')</span>
  <span class="ruby-comment"># @activity_type.each do |val|</span>
  <span class="ruby-comment">#  if @i == 0</span>
  <span class="ruby-comment">#    @condition1.concat(&quot;lower(activities.schedule_mode)  = '#{val.downcase.strip}'&quot;)  if val != 0 and val != nil and val != &quot;&quot; and val.downcase!='all'</span>
  <span class="ruby-comment">#  else</span>
  <span class="ruby-comment">#    @condition1.concat(&quot; or lower(activities.schedule_mode)  = '#{val.downcase.strip}'&quot;)  if val != 0 and val != nil and val != &quot;&quot; and val.downcase!='all'</span>
  <span class="ruby-comment">#  end</span>
  <span class="ruby-comment">#  @i = @i +1</span>
  <span class="ruby-comment">#end if !@activity_type.nil?</span>
  <span class="ruby-comment">#end</span>
  
  <span class="ruby-comment">#while clicking the camps displayed the activities oct-9-13</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:acamps</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:acamps</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:acamps</span>]
    <span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;lower(activities.schedule_mode) = '#{params[:acamps].downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:acamps</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:acamps</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:acamps</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;lower(activities.sub_category) = '#{val.downcase.strip}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or lower(activities.sub_category) = '#{val.downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
   
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@category</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
 
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session</span>[<span class="ruby-string">'near_cities'</span>].<span class="ruby-identifier">nil?</span>)
    <span class="ruby-ivar">@cond_nearby_cities</span> = <span class="ruby-node">&quot;activities.city in #{session['near_cities']} and&quot;</span>
  <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>].<span class="ruby-identifier">present?</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span>
      <span class="ruby-ivar">@condition3</span> = (<span class="ruby-node">&quot;lower(activities.zip_code) = '#{params[:z_c].downcase.strip}'&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
      <span class="ruby-ivar">@condition4</span> = (<span class="ruby-node">&quot;lower(activities.city) = '#{params[:city_1].downcase.strip}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@cond_nearby_cities</span> = <span class="ruby-node">&quot;activities.city like '%#{session[:city]}%' and&quot;</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;g_all&quot;</span>
    <span class="ruby-ivar">@condition5</span>=(<span class="ruby-node">&quot;lower(activities.gender) = '#{params[:gender].downcase}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;g_all&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;free&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;free&quot;</span>
      <span class="ruby-ivar">@condition6</span>=(<span class="ruby-string">&quot;activities.price_type = '3'&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;paid&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;paid&quot;</span>
      <span class="ruby-ivar">@condition6</span>=(<span class="ruby-string">&quot;activities.price_type='1' or activities.price_type='2'&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'a_all'</span>)
    <span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ag</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;a_all&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'adults'</span>
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;(lower(activities.min_age_range) = '#{val.downcase}' or lower(activities.max_age_range)= '#{val.downcase}')&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#split age range</span>
            <span class="ruby-identifier">str_a</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>)
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;(lower(activities.min_age_range) = '#{str_a[0]}' or lower(activities.max_age_range) &lt;= '#{str_a[1]}')&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;a_all&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'adults'</span>
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or (lower(activities.min_age_range) = '#{val.downcase}' or lower(activities.max_age_range) = '#{val.downcase}')&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#split age range</span>
            <span class="ruby-identifier">str_a</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>)
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or (lower(activities.min_age_range) = '#{str_a[0]}' or lower(activities.max_age_range) &lt;= '#{str_a[1]}')&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@ag</span>= <span class="ruby-ivar">@ag</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@basictext})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@basictext</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@basictext</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition1})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition1</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition2})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition2</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition3})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition3</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition3</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition4})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition4</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition4</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition5})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition5</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition5</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition6})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition6</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition6</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition7})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition7</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
     
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;next 7 days&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">7</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;next 20 days&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">20</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;today&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;d_all&quot;</span>
        <span class="ruby-identifier">date_range</span> = <span class="ruby-string">&quot;all&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">selected_date</span> = <span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-identifier">date_range</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@ss</span> = []
  <span class="ruby-ivar">@day_arr</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
    <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;mon&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:monday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'monday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;tue&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:tuesday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'tuesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;wed&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:wednesday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'wednesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;thu&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:thursday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'thursday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;fri&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:friday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'friday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sat&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:saturday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'saturday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sun&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:sunday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'sunday'</span>)
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">arr</span> =[]
  <span class="ruby-ivar">@spcl_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">date_range!</span>=<span class="ruby-string">''</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;all&quot;</span>
      <span class="ruby-comment">#if day of week is have value</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
          
        <span class="ruby-comment">#if special selected</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_prices p on activities.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id where #{@cond_nearby_cities} cleaned=true and lower(active_status)='active' and activities.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@spcl_date}') or (lower(d.discount_type)!='early bird discount') #{@condition_all} order by activities.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@spcl_date</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">else</span> <span class="ruby-comment">#other selected data</span>
          <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} lower(activities.active_status)='active' and activities.cleaned = true #{@condition_all}&quot;</span>)
        <span class="ruby-keyword">end</span>
 
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">search_activity_all_repeat</span>(<span class="ruby-identifier">actv</span>,<span class="ruby-ivar">@ss</span>,<span class="ruby-ivar">@day_arr</span>,<span class="ruby-identifier">arr</span>)
          <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#if special selected</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_prices p on activities.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id where #{@cond_nearby_cities} cleaned=true and lower(active_status)='active' and activities.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@spcl_date}') or (lower(d.discount_type)!='early bird discount') #{@condition_all} order by activities.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@spcl_date</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">else</span> <span class="ruby-comment">#other selected data</span>
          <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} lower(activities.active_status)='active' and activities.cleaned = true #{@condition_all}&quot;</span>)
        <span class="ruby-keyword">end</span>
  
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#choose particular date. activity</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">selected_date</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-identifier">sdate</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sdate</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sdate</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-comment">#if day of week is have value</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>).<span class="ruby-identifier">downcase</span>)
                    
              <span class="ruby-comment">#if special selected</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_prices p on activities.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} cleaned=true and lower(active_status)='active' and (activity_schedules.start_date &lt;='#{date}') and activities.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@spcl_date}') or (lower(d.discount_type)!='early bird discount') #{@condition_all} order by activities.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@spcl_date</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-keyword">else</span>  <span class="ruby-comment">#other selected data</span>
                <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
              <span class="ruby-keyword">end</span>
      
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
                <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
              <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
                  
            <span class="ruby-comment">#if special selected</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_prices p on activities.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} cleaned=true and lower(active_status)='active' and (activity_schedules.start_date &lt;='#{date}') and activities.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@spcl_date}') or (lower(d.discount_type)!='early bird discount') #{@condition_all} order by activities.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@spcl_date</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-keyword">else</span> <span class="ruby-comment">#other selected data</span>
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
            <span class="ruby-keyword">end</span>
        
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
              <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#next selected date available activities</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:repeat</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_range</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-comment">#if day of week is have value</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>).<span class="ruby-identifier">downcase</span>)
                    
              <span class="ruby-comment">#if special selected</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_prices p on activities.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} cleaned=true and lower(active_status)='active' and (activity_schedules.start_date &lt;='#{date}') and activities.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@spcl_date}') or (lower(d.discount_type)!='early bird discount') #{@condition_all} order by activities.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@spcl_date</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-keyword">else</span> <span class="ruby-comment">#other selected data</span>
                <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
              <span class="ruby-keyword">end</span>
      
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
                <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
              <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
                  
            <span class="ruby-comment">#if special selected</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aspecials</span>].<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_prices p on activities.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} cleaned=true and lower(active_status)='active' and (activity_schedules.start_date &lt;='#{date}') and activities.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@spcl_date}') or (lower(d.discount_type)!='early bird discount') #{@condition_all} order by activities.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@spcl_date</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where #{@cond_nearby_cities} lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
            <span class="ruby-keyword">end</span>

            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
              <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#date each loop end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>  <span class="ruby-comment">#date range loop end</span>
    
  <span class="ruby-identifier">arr</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@arr</span>=<span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}

  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]<span class="ruby-operator">==</span><span class="ruby-string">''</span> <span class="ruby-operator">||</span>  (<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'all'</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))))
    <span class="ruby-identifier">arr_act</span> = []
  
    <span class="ruby-identifier">acti_ids</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ar</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ar</span>[<span class="ruby-value">:id</span>]}
    <span class="ruby-ivar">@act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id in (?)&quot;</span>,<span class="ruby-identifier">acti_ids</span>)
    <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">schedule_feature_list</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">event</span>,<span class="ruby-identifier">arr_act</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-ivar">@arr</span> = <span class="ruby-identifier">arr_act</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:id</span>]}
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@advance_count</span> = <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">present?</span>
  
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">12</span>)
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
  <span class="ruby-ivar">@checck</span>  = []
  <span class="ruby-ivar">@provider_activites_check</span> =[]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
    <span class="ruby-ivar">@provider_activites_check</span> =[]
    <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-comment">#~ format.html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- advance_search_hold-source -->
          
        </div>

        

        
      </div><!-- advance_search_hold-method -->

    
      <div id="method-i-advanced_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">advanced_search</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="advanced_search-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">advanced_search</span>
  <span class="ruby-ivar">@advanced_search</span> = <span class="ruby-string">&quot;d_r=d_all&quot;</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-node">&quot;/search_event_index?#{@advanced_search}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- advanced_search-source -->
          
        </div>

        

        
      </div><!-- advanced_search-method -->

    
      <div id="method-i-advanced_search_changed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">advanced_search_changed</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>advanced search in parent view</p>
          

          
          <div class="method-source-code" id="advanced_search_changed-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2222</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">advanced_search_changed</span>
  <span class="ruby-comment">#get the main search page url here</span>
  <span class="ruby-ivar">@search_page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-ivar">@sdate</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>].<span class="ruby-identifier">nil?</span>
        
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-identifier">date_range</span> = <span class="ruby-string">''</span>
  <span class="ruby-identifier">selected_date</span> = <span class="ruby-string">'no'</span>
  <span class="ruby-ivar">@condition_all</span> = <span class="ruby-string">''</span>
 
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_mile</span>]
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>]
  <span class="ruby-ivar">@basictext</span> = <span class="ruby-string">''</span>
  
  <span class="ruby-ivar">@keyword</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@parent_keyword</span> = <span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;'&quot;</span>,<span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@basictext</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; (lower(user_profiles.business_name) like '%#{@parent_keyword}%' or lower(activities.activity_name) like '%#{@parent_keyword}%' or lower(activities.category) like '%#{@parent_keyword}%' or lower(activities.sub_category) like '%#{@parent_keyword}%' or lower(activities.description) like '%#{@parent_keyword}%' or lower(activities.city) like '%#{@parent_keyword}%') &quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span>
  
  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-identifier">day_of_the_week</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">day_of_the_week</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-ivar">@activity_type</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@activity_type</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@category</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@zipcode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]
  <span class="ruby-ivar">@city</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
  <span class="ruby-ivar">@gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>

  <span class="ruby-comment">#create the array for age_range values</span>
  <span class="ruby-identifier">age_range</span> = []
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@condition1</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition2</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition3</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition4</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition5</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition6</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition7</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@i</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@c</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@z</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@ct</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@p</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@ag</span> = <span class="ruby-value">0</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_type</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'all'</span>)
    <span class="ruby-ivar">@activity_type</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;lower(activities.schedule_mode)  = '#{val.downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase!</span>=<span class="ruby-string">'all'</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or lower(activities.schedule_mode)  = '#{val.downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase!</span>=<span class="ruby-string">'all'</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@i</span> = <span class="ruby-ivar">@i</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_type</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;lower(activities.sub_category) = '#{val.downcase.strip}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or lower(activities.sub_category) = '#{val.downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
   
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@category</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span>
    <span class="ruby-ivar">@condition3</span> = (<span class="ruby-node">&quot;lower(activities.zip_code) = '#{params[:z_c].downcase.strip}'&quot;</span>)
  <span class="ruby-keyword">end</span>
      
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
    <span class="ruby-ivar">@condition4</span> = (<span class="ruby-node">&quot;lower(activities.city) = '#{params[:city_1].downcase.strip}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;g_all&quot;</span>
    <span class="ruby-ivar">@condition5</span>=(<span class="ruby-node">&quot;lower(activities.gender) = '#{params[:gender].downcase}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;g_all&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;free&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;free&quot;</span>
      <span class="ruby-ivar">@condition6</span>=(<span class="ruby-string">&quot;activities.price_type = '3'&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;paid&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;paid&quot;</span>
      <span class="ruby-ivar">@condition6</span>=(<span class="ruby-string">&quot;activities.price_type='1' or activities.price_type='2'&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'a_all'</span>)
    <span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ag</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;a_all&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'adults'</span>
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;(lower(activities.min_age_range) = '#{val.downcase}' or lower(activities.max_age_range)= '#{val.downcase}')&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#split age range</span>
            <span class="ruby-identifier">str_a</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>)
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;(lower(activities.min_age_range) = '#{str_a[0]}' or lower(activities.max_age_range) &lt;= '#{str_a[1]}')&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;a_all&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'adults'</span>
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or (lower(activities.min_age_range) = '#{val.downcase}' or lower(activities.max_age_range) = '#{val.downcase}')&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#split age range</span>
            <span class="ruby-identifier">str_a</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>)
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or (lower(activities.min_age_range) = '#{str_a[0]}' or lower(activities.max_age_range) &lt;= '#{str_a[1]}')&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@ag</span>= <span class="ruby-ivar">@ag</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@basictext})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@basictext</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@basictext</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition1})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition1</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition2})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition2</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition3})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition3</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition3</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition4})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition4</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition4</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition5})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition5</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition5</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition6})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition6</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition6</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition7})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition7</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
     
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;next 7 days&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">7</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;next 20 days&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">20</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;today&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;d_all&quot;</span>
        <span class="ruby-identifier">date_range</span> = <span class="ruby-string">&quot;all&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">selected_date</span> = <span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-identifier">date_range</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@ss</span> = []
  <span class="ruby-ivar">@day_arr</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
    <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;mon&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:monday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'monday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;tue&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:tuesday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'tuesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;wed&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:wednesday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'wednesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;thu&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:thursday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'thursday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;fri&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:friday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'friday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sat&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:saturday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'saturday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sun&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:sunday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'sunday'</span>)
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">arr</span> =[]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">date_range!</span>=<span class="ruby-string">''</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;all&quot;</span>
      <span class="ruby-comment">#if day of week is have value</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
        <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where lower(activities.active_status)='active' and activities.cleaned = true #{@condition_all}&quot;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">search_activity_all_repeat</span>(<span class="ruby-identifier">actv</span>,<span class="ruby-ivar">@ss</span>,<span class="ruby-ivar">@day_arr</span>,<span class="ruby-identifier">arr</span>)
          <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where lower(activities.active_status)='active' and activities.cleaned = true #{@condition_all}&quot;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:activity_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#choose particular date. activity</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">selected_date</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-identifier">sdate</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sdate</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sdate</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-comment">#if day of week is have value</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>).<span class="ruby-identifier">downcase</span>)
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
                <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
              <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
              <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#next selected date available activities</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:repeat</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_range</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-comment">#if day of week is have value</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>).<span class="ruby-identifier">downcase</span>)
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
                <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
              <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct activities.* from activities left join user_profiles on activities.user_id=user_profiles.user_id left join activity_schedules on activities.activity_id = activity_schedules.activity_id where lower(activities.active_status)='active' and activities.cleaned = true And (activity_schedules.start_date &lt;='#{date}') #{@condition_all}&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
              <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#date each loop end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>  <span class="ruby-comment">#date range loop end</span>
    
  <span class="ruby-identifier">arr</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@arr</span>=<span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:activity_id</span>]}
  <span class="ruby-ivar">@advance_count</span> = <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">present?</span>
  
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">12</span>)
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
   
  <span class="ruby-ivar">@checck</span>  = []
  <span class="ruby-ivar">@provider_activites_check</span> =[]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
    <span class="ruby-ivar">@provider_activites_check</span> =[]
    <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-comment">#~ format.html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- advanced_search_changed-source -->
          
        </div>

        

        
      </div><!-- advanced_search_changed-method -->

    
      <div id="method-i-advanced_search_new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">advanced_search_new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="advanced_search_new-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">advanced_search_new</span>
  <span class="ruby-comment">#get the params from the event_index page.</span>
  
  <span class="ruby-identifier">activity_subcategory</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#~ ref  @pf1=FastImage.size(&quot;http://54.243.133.232:3002/system/profiles/7/thumb/business1_20130223-4128-1t69efx.jpg&quot;)</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]
    <span class="ruby-ivar">@z</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@z</span>=<span class="ruby-string">&quot;Enter Zip Code&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-identifier">activity_type</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity_type</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-identifier">day_of_the_week</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">day_of_the_week</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#create the array for age_range values</span>
  <span class="ruby-identifier">age_range</span> = []
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#push the price all field in age range array</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_all</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_all</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_all</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_all</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:p_all</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>

  <span class="ruby-comment">#if there are no search text it will not display the results.</span>
  <span class="ruby-identifier">act_featured</span> = []
  <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-identifier">act_featured</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
  
  <span class="ruby-comment">#~ #display the activities based on the current date</span>
  <span class="ruby-comment">#~ if params[:d_r]==&quot;today&quot; &amp;&amp; params[:d_r]!=&quot;&quot; &amp;&amp; params[:d_r]!=nil</span>
  <span class="ruby-comment">#~ @date=Time.now</span>
  <span class="ruby-comment">#~ @d=@date.strftime(&quot;%Y-%m-%d&quot;)</span>
  <span class="ruby-comment">#~ act_free = Activity.order(&quot;activity_name asc&quot;).select(&quot;activities.*, activity_schedules.*&quot;).joins(:activity_schedule).where(&quot;start_date = '#{@d}'&quot;).uniq</span>
  <span class="ruby-comment">#~ end</span>
  
  <span class="ruby-comment">#~ #display the list of results based on the params while clicked the check box</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">activity_type!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">activity_type!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">activity_type</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">activity_type</span>
    <span class="ruby-ivar">@schedule_mode</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity_type</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'all'</span>)
      <span class="ruby-identifier">r</span> = <span class="ruby-value">1</span>
      <span class="ruby-identifier">activity_type</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
          <span class="ruby-ivar">@schedule_mode</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and lower(schedule_mode)  = '#{s.downcase.strip}'&quot;</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@schedule_mode</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;or lower(schedule_mode)  = '#{s.downcase.strip}'&quot;</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">r</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>
      }
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#include ending</span>
  <span class="ruby-keyword">end</span>

  
  <span class="ruby-comment">#when we click the age range it will display the result.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">age_range!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">age_range!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">age_range</span>
    <span class="ruby-ivar">@age_range</span>= <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'a_all'</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'p_all'</span>)
      <span class="ruby-identifier">s</span>= <span class="ruby-value">1</span>
      <span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">age</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
          <span class="ruby-ivar">@age_range</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and lower(age_range) = '#{age.downcase.strip}'&quot;</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-ivar">@age_range</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;or lower(age_range)  = '#{age.downcase.strip}'&quot;</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">s</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment">#age range end</span>
    
  <span class="ruby-comment">#display the values based on the free activities</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;free&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@a_free</span>= <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@a_free</span> = (<span class="ruby-string">&quot;and filter_id ='3'&quot;</span>)
  <span class="ruby-keyword">end</span>
       
  <span class="ruby-comment">#display the results based on the paid and free results</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;paid&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;free&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@a_paid</span>= <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@a_paid</span> = (<span class="ruby-string">&quot;or price &gt; 0&quot;</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;paid&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@a_paid</span>= <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@a_paid</span> = (<span class="ruby-string">&quot;and price &gt; 0&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#display the results when the user enter the text in text box</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:q</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:q</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:q</span>]
    <span class="ruby-ivar">@search</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@search</span> = (<span class="ruby-node">&quot;and lower(activity_name) = '%#{params[:q].downcase.strip}%'&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#display the zipcode details based on the user text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span>
    <span class="ruby-ivar">@zipcode</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@zipcode</span> = (<span class="ruby-node">&quot;and lower(zip_code) = '#{params[:z_c].downcase.strip}'&quot;</span>)
  <span class="ruby-keyword">end</span>
      
  <span class="ruby-comment">#display the data based on the city selection</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
    <span class="ruby-ivar">@s_cty</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@s_cty</span> = (<span class="ruby-node">&quot;and lower(city) = '#{params[:city_1].downcase.strip}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#when we click the activity subcategory it will display the result.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">activity_subcategory!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">activity_subcategory!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">activity_subcategory</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity_subcategory</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">activity_subcategory</span>
    <span class="ruby-ivar">@sub_category</span>= <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">c</span>= <span class="ruby-value">1</span>
    <span class="ruby-identifier">activity_subcategory</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sub</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
        <span class="ruby-ivar">@sub_category</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and lower(sub_category) = '#{sub.downcase.strip}'&quot;</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@sub_category</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;or lower(sub_category)  = '#{sub.downcase.strip}'&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">c</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>
    }
  <span class="ruby-keyword">end</span> <span class="ruby-comment">#activity subcategory end</span>

  <span class="ruby-comment">#get the results based on the query</span>
  
  <span class="ruby-comment">#~ if @schedule_mode.present? || @age_range.present? || @a_free.present? || @a_paid.present? || @zipcode.present? || @s_cty.present? || @sub_category.present?</span>
  <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities where lower(active_status) = 'active'
      #{@schedule_mode} #{@age_range} #{@a_free} #{@a_paid} #{@search} #{@zipcode} #{@s_cty} #{@sub_category} order by activities.activity_id desc&quot;</span>) 
  <span class="ruby-comment">#~ end</span>
  <span class="ruby-identifier">act_free</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">36</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">act_provider</span> =  []
    <span class="ruby-ivar">@activity_share_provider</span> = <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)

    <span class="ruby-identifier">act_saved_fav</span> = []
    <span class="ruby-ivar">@activity_saved_favorites</span> = <span class="ruby-identifier">act_saved_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
    <span class="ruby-comment">#~ add_to_activity_row(params[:activity_row],params[:remove_row])</span>
    <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
    <span class="ruby-comment">#~ @provider_activites = ActivityRow.find(:all,:conditions=&gt;[&quot;user_id = ? &quot;, cookies[:uid_usr]],:select =&gt; &quot;DISTINCT lower(trim(row_type))as row_type&quot;).collect {|r| r.row_type if !r.row_type.nil?}@provider_activites = ActivityRow.find(:all,:conditions=&gt;[&quot;user_id = ? &quot;, cookies[:uid_usr]],:select =&gt; &quot;DISTINCT lower(trim(row_type))as row_type&quot;).collect {|r| r.row_type if !r.row_type.nil?}</span>
    <span class="ruby-ivar">@provider_activites</span> = []
    <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
    <span class="ruby-ivar">@provider_activites_check</span> =[]
    <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- advanced_search_new-source -->
          
        </div>

        

        
      </div><!-- advanced_search_new-method -->

    
      <div id="method-i-advancesearch_repeat" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">advancesearch_repeat</span><span
            class="method-args">(c_date,actv,arr)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>get activity count and insert into temp table</p>
          

          
          <div class="method-source-code" id="advancesearch_repeat-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2902</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">c_date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
  <span class="ruby-ivar">@c_date1</span> = <span class="ruby-identifier">c_date</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#if schedule, repeat yes</span>
    <span class="ruby-ivar">@repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_schedule_id=?&quot;</span>,<span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;schedule_id&quot;</span>]).<span class="ruby-identifier">last</span>
       
    <span class="ruby-ivar">@c_date</span> =<span class="ruby-ivar">@c_date1</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
    <span class="ruby-ivar">@c_day</span> = <span class="ruby-ivar">@c_date1</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%a&quot;</span>)
                           
    <span class="ruby-ivar">@schedule_start</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@repeat</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-comment">#start daily</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Daily&quot;</span>
        <span class="ruby-identifier">repeat_daily_view</span>(<span class="ruby-ivar">@c_date</span>,<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@c_day</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Weekly&quot;</span>
        <span class="ruby-identifier">repeat_weekly_view</span>(<span class="ruby-ivar">@c_date</span>,<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@c_day</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Every week (Monday to Friday)&quot;</span>
        <span class="ruby-identifier">repeat_weekly_view</span>(<span class="ruby-ivar">@c_date</span>,<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@c_day</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Every Monday,Wednesday and Friday&quot;</span>
        <span class="ruby-identifier">repeat_weekly_view</span>(<span class="ruby-ivar">@c_date</span>,<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@c_day</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Every Tuesday and Thursday&quot;</span>
        <span class="ruby-identifier">repeat_weekly_view</span>(<span class="ruby-ivar">@c_date</span>,<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@c_day</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Monthly&quot;</span>
        <span class="ruby-identifier">repeat_monthly_view</span>(<span class="ruby-ivar">@c_date</span>,<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@c_day</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Yearly&quot;</span>
        <span class="ruby-identifier">repeat_yearly_view</span>(<span class="ruby-ivar">@c_date</span>,<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@c_day</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#without repeat start camps/workshop</span>
      <span class="ruby-comment">#if start and end date is exist</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;end_date&quot;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;end_date&quot;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>)
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#start date is exist and end date is nil</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;end_date&quot;</span>].<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id =#{actv.activity_id} and  start_date='#{@c_date}'&quot;</span>).<span class="ruby-identifier">last</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">s_day</span> = <span class="ruby-ivar">@c_date1</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%a&quot;</span>)
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id =#{actv.activity_id} and  business_hours='#{s_day.downcase}'&quot;</span>).<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>,<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#inner without repeat end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment"># repeat check loop end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#activity dont have schedule eg by appointment</span>
    <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>,<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
  <span class="ruby-keyword">end</span>  <span class="ruby-comment">#schedule loop end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- advancesearch_repeat-source -->
          
        </div>

        

        
      </div><!-- advancesearch_repeat-method -->

    
      <div id="method-i-basic_search_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">basic_search_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>get the count for basic search</p>
          

          
          <div class="method-source-code" id="basic_search_count-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1481</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">basic_search_count</span>
  <span class="ruby-ivar">@search</span> = <span class="ruby-constant">Sunspot</span>.<span class="ruby-identifier">search</span>(<span class="ruby-constant">Activity</span>,<span class="ruby-constant">User</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">keywords</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>] <span class="ruby-keyword">do</span>
      <span class="ruby-comment">#query_phrase_slop 1</span>
      <span class="ruby-identifier">minimum_match</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">fields</span>(<span class="ruby-value">:city=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>,<span class="ruby-value">:user_profile_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:cleaned</span>,<span class="ruby-keyword">true</span>
    <span class="ruby-identifier">with</span>(<span class="ruby-value">:active_status</span>, <span class="ruby-string">&quot;Active&quot;</span>)
    <span class="ruby-identifier">order_by</span> <span class="ruby-value">:score</span>, <span class="ruby-value">:desc</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:show_card</span>,<span class="ruby-keyword">true</span>
      
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@search</span>.<span class="ruby-identifier">total</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- basic_search_count-source -->
          
        </div>

        

        
      </div><!-- basic_search_count-method -->

    
      <div id="method-i-build_activity_network_popup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_activity_network_popup</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>~ respond_to do |format| ~ format.js ~ end ~ end</p>
          

          
          <div class="method-source-code" id="build_activity_network_popup-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_activity_network_popup</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- build_activity_network_popup-source -->
          
        </div>

        

        
      </div><!-- build_activity_network_popup-method -->

    
      <div id="method-i-change_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">change_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="change_password-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5312</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">change_password</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">current_user</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- change_password-source -->
          
        </div>

        

        
      </div><!-- change_password-method -->

    
      <div id="method-i-contact_import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">contact_import</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="contact_import-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5814</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">contact_import</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- contact_import-source -->
          
        </div>

        

        
      </div><!-- contact_import-method -->

    
      <div id="method-i-create_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>create new activity page for provider</p>
          

          
          <div class="method-source-code" id="create_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5092</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_activity</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- create_activity-source -->
          
        </div>

        

        
      </div><!-- create_activity-method -->

    
      <div id="method-i-data_entry" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">data_entry</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="data_entry-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3396</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">data_entry</span>
  <span class="ruby-comment">#cookies[:search_city] = &quot;Walnut Creek&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">city_se</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;city_name='#{cookies[:search_city]}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">latitude</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">longitude</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#a_coord = Geocoder.coordinates(&quot;#{city.titlecase}&quot;)</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">re_times</span> = <span class="ruby-value">5</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">location</span> = <span class="ruby-constant">Geocoder</span>.<span class="ruby-identifier">search</span>(<span class="ruby-node">&quot;#{request.ip}&quot;</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">latitude</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">longitude</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">city</span>
      <span class="ruby-keyword">if</span> ((<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0.0</span>) <span class="ruby-operator">||</span>(<span class="ruby-identifier">location</span>.<span class="ruby-identifier">country</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;India&quot;</span>))
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-value">37.9100783</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-value">-122.0651819</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">re_times</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">re_times</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
        <span class="ruby-keyword">retry</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-value">37.9100783</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-value">-122.0651819</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#    if params[:set_p].nil?</span>
  <span class="ruby-comment">#      params[:set_p] = &quot;1&quot;</span>
  <span class="ruby-comment">#    end</span>

  <span class="ruby-comment">#a_coord = Geocoder.coordinates(&quot;#{}&quot;)</span>
  <span class="ruby-ivar">@events</span> = []
  <span class="ruby-identifier">search_curator</span>(<span class="ruby-string">&quot;1&quot;</span>)
  <span class="ruby-comment">#    if (@search.total &lt;=30) || (@events.length &lt; 30 &amp;&amp; params[:set_p] == &quot;1&quot;)</span>
  <span class="ruby-comment">#      params[:page] =1</span>
  <span class="ruby-comment">#      params[:set_p] = &quot;2&quot;</span>
  <span class="ruby-comment">#      search_curator(&quot;2&quot;)</span>
  <span class="ruby-comment">#    end</span>
  
  <span class="ruby-identifier">total_pgae</span> = <span class="ruby-ivar">@search</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">total_pages</span>
  <span class="ruby-ivar">@events</span>.<span class="ruby-identifier">unshift</span>({<span class="ruby-value">:data</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;all&quot;</span>,<span class="ruby-value">:value=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{params[:query]}&quot;</span>,<span class="ruby-value">:act=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Show All&quot;</span>,<span class="ruby-value">:cur_set</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:set_p</span>],<span class="ruby-value">:cur_page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>, <span class="ruby-value">:total_p=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">total_pgae</span>,<span class="ruby-value">:w_plan_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;z&quot;</span>})
  <span class="ruby-comment"># plan =User.order(&quot;user_plan desc&quot;).find(:all,:conditions=&gt;[&quot;user_id = ?&quot;, cookies[:uid_usr]]).map(&amp;:user_plan)</span>
  <span class="ruby-comment">#  @search.results.map {  |record| user = UserProfile.find_by_user_id(record.user_id);; events &lt;&lt; {:city=&gt; record.city, :user_id=&gt;record.user_id,:provider_name=&gt; user.business_name,  :activity_name=&gt; record.activity_name, :data=&gt; record.activity_id, :value=&gt; &quot;#{record.activity_name} &quot; + &quot;#{record.city}&quot;  +&quot; #{user.business_name}&quot; } }</span>

  <span class="ruby-comment">#    @search.results.map { |record|</span>
  <span class="ruby-comment">#      user = UserProfile.where(&quot;user_id = #{record.user_id}&quot;).last</span>
  <span class="ruby-comment">#      events &lt;&lt; {:category=&gt;record.category,:sub_category=&gt;record.sub_category,:city=&gt; record.city,:w_activity_name=&gt; record.activity_name,:w_provider_name=&gt;user.business_name,:w_city=&gt;record.city,:user_id=&gt;record.user_id,:provider_name=&gt;truncate(user.business_name, :length =&gt;25),:pass_value=&gt;params[:query],:activity_name=&gt;truncate(record.activity_name, :length =&gt;25), :data=&gt; record.activity_id, :value=&gt; &quot;#{record.activity_name} &quot;  + &quot; #{user.business_name} &quot;+ &quot; #{record.city}&quot;  } if !user.business_name.nil? if !user.nil?</span>
  <span class="ruby-comment">#    }</span>
 
  <span class="ruby-comment">#events = events.sort_by { |k| k[:w_plan_name] }.reverse</span>
  

  <span class="ruby-ivar">@activities</span>  = {
    <span class="ruby-identifier">query</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Unit&quot;</span>,
    <span class="ruby-identifier">suggestions</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@events</span> }
  <span class="ruby-identifier">render</span> <span class="ruby-value">:json</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@activities</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- data_entry-source -->
          
        </div>

        

        
      </div><!-- data_entry-method -->

    
      <div id="method-i-delete_activity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_activity</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>before deleting the activity</p>
          

          
          <div class="method-source-code" id="delete_activity-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3683</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_activity</span>
        
  <span class="ruby-ivar">@page</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]
  <span class="ruby-ivar">@to_delete</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
  <span class="ruby-ivar">@list</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mul</span>]
  <span class="ruby-ivar">@del_act</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:del_action</span>]
  <span class="ruby-comment">#render :layout =&gt; nil</span>
  <span class="ruby-comment">#@activity = Activity.find(@to_delete) if (@to_delete.present? &amp;&amp; !@to_delete.nil?)</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- delete_activity-source -->
          
        </div>

        

        
      </div><!-- delete_activity-method -->

    
      <div id="method-i-destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>delete the activities with the associated data</p>
          

          
          <div class="method-source-code" id="destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3748</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy</span>
  <span class="ruby-identifier">activity_details</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-ivar">@get_current_url</span> =  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@del_mode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:del_mode</span>]
  <span class="ruby-ivar">@del_mode_act</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:del_mode_act</span>]
  <span class="ruby-identifier">activity_details</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">act</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">activity</span>=<span class="ruby-identifier">act</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[^0-9A-Za-z]/</span>, <span class="ruby-string">''</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">activity!</span>=<span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@act</span>=<span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">activity</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@activity_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-comment">#update the activity record as delete status.</span>
      <span class="ruby-identifier">chk_del</span> = <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Delete&quot;</span>,<span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">chk_del</span>
              <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;activity_schedules_for#{@act.activity_id}&quot;</span>,<span class="ruby-keyword">nil</span>)
              <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;provider_activity_for#{@activity_user.user_id}&quot;</span>,<span class="ruby-keyword">nil</span>)
      <span class="ruby-keyword">end</span>
       
      <span class="ruby-comment">#setting notification for the users</span>
      <span class="ruby-ivar">@provider_notifications</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='1' and p.user_id='#{@act.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment"># if user present in setting tables</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notifications</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notifications</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notifications</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-comment">#~ #sending mail to the participant while delete the activity  ----dont remove this code----</span>
        <span class="ruby-ivar">@participant</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;user_id&quot;</span>)
        <span class="ruby-comment">#~ @participant = ActivityAttendDetail.find(:all,:conditions=&gt;[&quot;activity_id = ? &quot;, @act.activity_id])</span>
        <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">user_parent</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-identifier">email_parent</span>=<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">email_parent</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
            <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Cancel Activity to participant&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">cancel_activity_mail_to_parent</span>(<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_name</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">email_parent</span>,<span class="ruby-ivar">@activity_user</span>)
            <span class="ruby-comment">#@result = UserMailer.cancel_activity_mail_to_parent(user_parent.user_name,@act,@get_current_url,params[:message],email_parent,params[:subject]).deliver</span>
          <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">else</span> <span class="ruby-comment">#first if the user not present in setting tables.</span>
        <span class="ruby-comment">#~ #sending mail to the participant while delete the activity  ----dont remove this code----</span>
        <span class="ruby-comment">#~ @participant = ActivityAttendDetail.find(:all,:conditions=&gt;[&quot;activity_id = ? &quot;, @act.activity_id])</span>
        <span class="ruby-ivar">@participant</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;user_id&quot;</span>)
        <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">user_parent</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-identifier">email_parent</span>=<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">email_parent</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
            <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Cancel Activity to participant&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">cancel_activity_mail_to_parent</span>(<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_name</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">email_parent</span>,<span class="ruby-ivar">@activity_user</span>)
            <span class="ruby-comment">#@result = UserMailer.cancel_activity_mail_to_parent(user_parent.user_name,@act,@get_current_url,params[:message],email_parent,params[:subject]).deliver</span>
          <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#first if end</span>
                
      <span class="ruby-comment">#setting notification for the users</span>
      <span class="ruby-ivar">@provider_notification_default</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='6' and p.user_id='#{@act.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#user present in setting notify me when the record is removed</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notification_default</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-comment">#sending mail while delete the activity by the provider.</span>
        <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">user_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Delete Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">delete_activity_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
          <span class="ruby-comment">#@result = UserMailer.delete_activity_mail(user_name,@act,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
        <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#user not present in setting table</span>
        <span class="ruby-comment">#sending mail while delete the activity by the provider.</span>
        <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">user_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Delete Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">delete_activity_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
          <span class="ruby-comment">#@result = UserMailer.delete_activity_mail(user_name,@act,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
        <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#provider notification if end</span>
      
      <span class="ruby-comment"># for deleting the record from the activity table ----dont remove this code----</span>

      <span class="ruby-comment">#~ @schedule=ActivitySchedule.find_by_activity_id(@act) if !@act.nil?</span>
      <span class="ruby-comment">#~ @repeat = ActivityRepeat.find_by_activity_schedule_id(@schedule.schedule_id)if !@schedule.nil?</span>
      <span class="ruby-comment">#~ @repeat.destroy if !@repeat.nil?</span>
      <span class="ruby-comment">#~ @schedule.destroy if !@schedule.nil?</span>
      <span class="ruby-comment">#~ @fav = ActivityFavorite.destroy_all(:activity_id =&gt; @act) if !@act.nil?</span>
      <span class="ruby-comment">#~ @share = ActivityShared.find_by_activity_id(@act) if !@act.nil?</span>
      <span class="ruby-comment">#~ @share.destroy if !@share.nil?</span>
      <span class="ruby-comment">#~ Activity.find(activity).destroy if !activity.nil?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#if method</span>

  } <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity_details</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">activity_details!</span>=<span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:last_action</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:last_action</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:last_action</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">present?</span>

  <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_providertype_zip_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;provider_edit_activity&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;delete_activity&quot;</span>)
    <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] = (<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
      <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#if (!params[:del_action].empty? &amp;&amp; (params[:del_action]=='index' || params[:del_action]=='admin_list' || params[:del_action]=='thumb_index' ))</span>
  <span class="ruby-comment">#  render :text =&gt; 'true'</span>
  <span class="ruby-comment">#else</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- destroy-source -->
          
        </div>

        

        
      </div><!-- destroy-method -->

    
      <div id="method-i-edit_update_sub_category" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">edit_update_sub_category</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="edit_update_sub_category-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5031</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">edit_update_sub_category</span>
  <span class="ruby-identifier">category</span> = <span class="ruby-constant">ActivityCategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]).<span class="ruby-identifier">last</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">blank?</span>
  <span class="ruby-ivar">@sub_category</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">category</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:subcateg_name</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">category</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;sub_category&quot;</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:states</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sub_category</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- edit_update_sub_category-source -->
          
        </div>

        

        
      </div><!-- edit_update_sub_category-method -->

    
      <div id="method-i-event_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">event_index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>parent index page</p>
          

          
          <div class="method-source-code" id="event_index-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3878</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">event_index</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;San Francisco&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#variable for array</span>
  <span class="ruby-comment">#@act_event_index = Activity.order(&quot;activity_id desc&quot;).find(:all)</span>
  
  <span class="ruby-comment">#@activity_featured = Activity.find_by_sql(&quot;select * from activities where activity_id in (select activity_id from activity_bids where lower(bid_status) = 'active' order by bid_amount asc) and lower(active_status)='active' or (featured_flag = true and lower(active_status)='active') order by featured_flag asc limit 100&quot;)</span>
  <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-string">&quot;select * from activities INNER JOIN activity_schedules ON activity_schedules.activity_id = activities.activity_id where activities.activity_id in (select activity_id from activity_bids where lower(bid_status) = 'active' order by bid_amount asc) and lower(active_status)='active' or (featured_flag = true and lower(active_status)='active') order by featured_flag asc limit 60&quot;</span>).<span class="ruby-identifier">uniq</span>
 
  <span class="ruby-identifier">events</span> = []
  <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activities_repeat</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-value">3</span>)
  <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">schedule_repeat_append</span>(<span class="ruby-identifier">event</span>,<span class="ruby-identifier">events</span>,<span class="ruby-string">&quot;created&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">events</span>
  <span class="ruby-identifier">act_provider</span> =  <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_shared_activities</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>)
  <span class="ruby-ivar">@activity_share_provider</span> = <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)

  <span class="ruby-identifier">act_saved_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_favorites</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_saved_favorites</span> = <span class="ruby-identifier">act_saved_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
  <span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
  <span class="ruby-ivar">@provider_activites</span> =  <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;Distinct(activities.category)&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activities.category Asc&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;left join activities on lower(activities.sub_category)=lower(activity_rows.row_type)&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_rows.user_id = ?&quot;</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;activities.category&quot;</span>)
  <span class="ruby-ivar">@follow_parent_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{user_id} and user_type='U'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
  <span class="ruby-ivar">@follow_provider_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{user_id} and user_type='P'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
  <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>,<span class="ruby-identifier">user_id</span>],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
  <span class="ruby-ivar">@provider_activites_check</span> =[]
  <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span> }
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- event_index-source -->
          
        </div>

        

        
      </div><!-- event_index-method -->

    
      <div id="method-i-event_index_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">event_index_update</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>called when using options in event index page</p>
          

          
          <div class="method-source-code" id="event_index_update-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 4953</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">event_index_update</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#@activity_featured = Activity.find_by_sql(&quot;select * from activities where activity_id in (select activity_id from activity_bids where lower(bid_status) = 'active' order by bid_amount asc) and lower(active_status)='active' or (featured_flag = true and lower(active_status)='active') order by featured_flag asc limit 100&quot;)</span>
  
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@follow_parent_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id=7 and user_type='U'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
  <span class="ruby-ivar">@follow_provider_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id=7 and user_type='P'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
  <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-string">&quot;select * from activities INNER JOIN activity_schedules ON activity_schedules.activity_id = activities.activity_id where activities.activity_id in (select activity_id from activity_bids where lower(bid_status) = 'active' order by bid_amount asc) and lower(active_status)='active' or (featured_flag = true and lower(active_status)='active') order by featured_flag asc limit 60&quot;</span>).<span class="ruby-identifier">uniq</span>
 
      
  <span class="ruby-comment">#    act_featured = Activity.get_activities_repeat(session[:city],params[:zip_code],session[:date],1)</span>
  <span class="ruby-identifier">events</span> = []
  <span class="ruby-comment">#    act_featured.each do |event|</span>
  <span class="ruby-comment">#      @schedule = ActivitySchedule.where(&quot;activity_id = ?&quot;,event.activity_id).last</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment">#      schedule_repeat_append(event,events,&quot;created&quot;) if !@schedule.nil?</span>
  <span class="ruby-comment">#    end</span>
  <span class="ruby-comment">#    events_free=[]</span>
  <span class="ruby-comment">#    @activity_featured = events</span>
  <span class="ruby-comment">#    @activity_featured = act_featured.paginate(:page =&gt; params[:page], :per_page =&gt;400)</span>
  <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_activities_repeat</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-value">3</span>)
  <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">schedule_repeat_append</span>(<span class="ruby-identifier">event</span>,<span class="ruby-identifier">events</span>,<span class="ruby-string">&quot;created&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">events</span>

  <span class="ruby-identifier">act_provider</span> =  <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_shared_activities</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>)
  <span class="ruby-ivar">@activity_share_provider</span> = <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)

  <span class="ruby-identifier">act_saved_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_favorites</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_saved_favorites</span> = <span class="ruby-identifier">act_saved_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
  <span class="ruby-identifier">add_to_activity_row</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_row</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:remove_row</span>])
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
  <span class="ruby-comment">#@provider_activites = ActivityRow.find(:all,:conditions=&gt;[&quot;user_id = ? &quot;, cookies[:uid_usr]],:select =&gt; &quot;DISTINCT lower(trim(row_type))as row_type&quot;).collect {|r| r.row_type if !r.row_type.nil?}</span>
  <span class="ruby-comment">#    @provider_activites = ActivityRow.find_by_sql(&quot;select Distinct(act.category) from activities as act,activity_rows as row where act.sub_category = row.row_type and row.user_id = 27 order by act.category Asc&quot;).collect {|r| r.category if !r.category.nil?}</span>
  <span class="ruby-ivar">@provider_activites</span> =  <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;Distinct(activities.category)&quot;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activities.category Asc&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-string">&quot;left join activities on lower(activities.sub_category)=lower(activity_rows.row_type)&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_rows.user_id = ?&quot;</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;activities.category&quot;</span>)
 
  <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
  <span class="ruby-ivar">@provider_activites_check</span> =[]
  <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- event_index_update-source -->
          
        </div>

        

        
      </div><!-- event_index_update-method -->

    
      <div id="method-i-every_mon_wed_fri" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_mon_wed_fri</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_mon_wed_fri-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5714</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_mon_wed_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">1</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_mon_wed_fri-source -->
          
        </div>

        

        
      </div><!-- every_mon_wed_fri-method -->

    
      <div id="method-i-every_mon_wed_fri_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_mon_wed_fri_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_mon_wed_fri_never-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5698</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_mon_wed_fri_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">1</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>

      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_mon_wed_fri_never-source -->
          
        </div>

        

        
      </div><!-- every_mon_wed_fri_never-method -->

    
      <div id="method-i-every_tue_thu" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_tue_thu</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_tue_thu-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5746</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_tue_thu</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">2</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_tue_thu-source -->
          
        </div>

        

        
      </div><!-- every_tue_thu-method -->

    
      <div id="method-i-every_tue_thu_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_tue_thu_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_tue_thu_never-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5731</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_tue_thu_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span><span class="ruby-value">2</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#         events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_tue_thu_never-source -->
          
        </div>

        

        
      </div><!-- every_tue_thu_never-method -->

    
      <div id="method-i-every_week_mon_to_fri" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_week_mon_to_fri</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_week_mon_to_fri-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5681</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_week_mon_to_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">6</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_week_mon_to_fri-source -->
          
        </div>

        

        
      </div><!-- every_week_mon_to_fri-method -->

    
      <div id="method-i-every_week_mon_to_fri_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">every_week_mon_to_fri_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="every_week_mon_to_fri_never-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5664</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">every_week_mon_to_fri_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)


  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">wday</span> <span class="ruby-operator">!=</span><span class="ruby-value">6</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#        events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- every_week_mon_to_fri_never-source -->
          
        </div>

        

        
      </div><!-- every_week_mon_to_fri_never-method -->

    
      <div id="method-i-file_download_checkout" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_download_checkout</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="file_download_checkout-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5051</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_download_checkout</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">p_file</span> = <span class="ruby-constant">PolicyFile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;policy_file_id=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]).<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;#{p_file.pdf.path(:original)}&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">p_file</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">path</span>)
      <span class="ruby-identifier">send_file</span> <span class="ruby-identifier">path</span>, <span class="ruby-value">:x_sendfile=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>,  <span class="ruby-value">:disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;attachment&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/add_participant&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- file_download_checkout-source -->
          
        </div>

        

        
      </div><!-- file_download_checkout-method -->

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Provider index page</p>
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3523</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>

  <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value">:friend_mode</span>
  <span class="ruby-comment"># Added for listing activities based on provider</span>
  <span class="ruby-comment">#~ @activity= Activity.find_by_sql(&quot;select * from activities where user_id=#{current_user.user_id} and cleaned=true and lower(active_status)='active' and lower(created_by)='provider' order by activity_id desc limit 200&quot;) if !current_user.nil? &amp;&amp; current_user.present?</span>
  <span class="ruby-comment">#~ @act_id = @activity.map(&amp;:activity_id)</span>
  <span class="ruby-ivar">@follow_provider_user</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{current_user.user_id} and user_type='U'&quot;</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:row_user_id</span>)
      
  <span class="ruby-ivar">@mgr_acpted</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mgr_acpted</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:mgr_acpted</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@macid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:macid</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:macid</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#displayed submenu for manager users</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_type</span>).<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;u&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_id</span>].<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities where activity_id in(select activity_id from activity_network_permissions where provider_user_id = #{params[:provider_id]} and manager_user_id = #{current_user.user_id} and lower(accept_status) = 'accepted')&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
              
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)

  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_type</span>).<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;p&quot;</span>
    <span class="ruby-comment">#displayed the data based on assigned manager list</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_id</span>].<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">act_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities where activity_id in(select activity_id from activity_network_permissions where provider_user_id = #{params[:provider_id]} and manager_user_id = #{current_user.user_id} and lower(accept_status) = 'accepted')&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">act</span> = <span class="ruby-identifier">act_list</span>.<span class="ruby-identifier">sort_by</span>(&amp;<span class="ruby-value">:modified_date</span>).<span class="ruby-identifier">reverse</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">act_list</span>
      <span class="ruby-comment">#~ act = Activity.find_by_sql(&quot;select * from activity_network_permissions an left join activities a on an.activity_id = a.activity_id where an.provider_user_id = #{params[:provider_id]} and an.manager_user_id = #{current_user.user_id}&quot;) if !params[:provider_id].nil? &amp;&amp; !current_user.nil?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#displayed the data based on active_status</span>
      <span class="ruby-identifier">act_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select a.* from activities a left join school_representatives s on a.activity_id=s.activity_id where (user_id=#{current_user.user_id} or vendor_id=#{current_user.user_id} or representative_id=#{current_user.user_id}) and cleaned=true and lower(active_status)!='delete' and lower(active_status)!='city' and lower(created_by)='provider' order by a.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">act</span> = <span class="ruby-identifier">act_list</span>.<span class="ruby-identifier">sort_by</span>(&amp;<span class="ruby-value">:modified_date</span>).<span class="ruby-identifier">reverse</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">act_list</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;provider_edit_activity&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;delete_activity&quot;</span>)
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">act</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@auto_comp</span>=<span class="ruby-identifier">act</span>
  <span class="ruby-ivar">@activities</span> = []
  <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">==</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] = (<span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
    <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:last_action</span>]=<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>]=<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
      

<span class="ruby-keyword">end</span></pre>
          </div><!-- index-source -->
          
        </div>

        

        
      </div><!-- index-method -->

    
      <div id="method-i-invite_provider" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invite_provider</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="invite_provider-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5304</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invite_provider</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- invite_provider-source -->
          
        </div>

        

        
      </div><!-- invite_provider-method -->

    
      <div id="method-i-landing_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">landing_search</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="landing_search-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3928</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">landing_search</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>]

  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  

  <span class="ruby-comment">#if there are no search text it will not display the results.</span>
  <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">search_parent</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>])
  <span class="ruby-identifier">act_free</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">36</span>)
  <span class="ruby-comment">#~ if !current_user.nil?</span>
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
  <span class="ruby-comment">#~ @checck = ActivityRow.find(:all,:conditions=&gt;[&quot;user_id = ? &quot;, cookies[:uid_usr]],:select =&gt; &quot;row_type&quot;)</span>
  <span class="ruby-ivar">@checck</span> = []
  <span class="ruby-ivar">@provider_activites_check</span> =[]
  <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#~ end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
        
<span class="ruby-keyword">end</span></pre>
          </div><!-- landing_search-source -->
          
        </div>

        

        
      </div><!-- landing_search-method -->

    
      <div id="method-i-mailtofollowuser_create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mailtofollowuser_create</span><span
            class="method-args">(userid,activity,flag)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="mailtofollowuser_create-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mailtofollowuser_create</span>(<span class="ruby-identifier">userid</span>,<span class="ruby-identifier">activity</span>,<span class="ruby-identifier">flag</span>)
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-identifier">activity</span>
  <span class="ruby-comment">#    @follow = UserRow.where(&quot;row_user_id=#{userid} and lower(user_type)='u'&quot;).uniq</span>
  <span class="ruby-comment">#    @follow_user = User.find_by_user_id(userid)</span>
  <span class="ruby-comment">#    @get_current_url = &quot;http://#{request.env['HTTP_HOST']}&quot;</span>
  <span class="ruby-comment">#    if !@follow.nil? &amp;&amp; @follow!='' &amp;&amp; @follow.present?</span>
  <span class="ruby-comment">#      @follow.each do |fval|</span>
  <span class="ruby-comment">#        @user_mail = User.find_by_user_id(fval.user_id) if !fval.nil?</span>
  <span class="ruby-comment">#        if !@user_mail.nil? &amp;&amp; @user_mail!='' &amp;&amp; @user_mail.present?</span>
  <span class="ruby-comment">#          if @user_mail.user_flag== true</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment">#               #@result = UserMailer.following_user_create_mail(@user_mail ,@follow_user,@activity_profile_apf,@get_current_url,params[:message],@user_mail.email_address,params[:subject]).deliver</span>
  <span class="ruby-comment">#          end</span>
  <span class="ruby-comment">#        end</span>
  <span class="ruby-comment">#      end</span>
  <span class="ruby-comment">#    end</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-node">&quot;http://#{request.env['HTTP_HOST']}&quot;</span>
  <span class="ruby-ivar">@created_setting</span> = <span class="ruby-constant">ParentSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_setting_details s left join parent_settings p on s.parent_setting_id=p.parent_setting_id  where s.setting_action='created' and p.user_id=#{userid}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#setting_option 1, show to famtiivty everyone</span>
    <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set_val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{userid} and lower(user_type)='u'&quot;</span>)
        <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">userid</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
            <span class="ruby-comment">#check notification</span>
            <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                  <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User Create&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_create_mail</span>(<span class="ruby-ivar">@user_mail</span> ,<span class="ruby-ivar">@follow_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment"># setting_option 2, famtivity contact user only</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-ivar">@con_user</span> = <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;contact_user&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{userid} and lower(user_type)='u'&quot;</span>)
        <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">userid</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_user</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
              <span class="ruby-comment">#check notification</span>
              <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User Create&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_create_mail</span>(<span class="ruby-ivar">@user_mail</span> ,<span class="ruby-ivar">@follow_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment"># setting_option 3, just me activity only show to that person only</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
        <span class="ruby-comment">#if just me, dont send mail to oathers and me</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>   <span class="ruby-comment">#each loop end</span>
  <span class="ruby-keyword">end</span>    <span class="ruby-comment">#setting loop</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- mailtofollowuser_create-source -->
          
        </div>

        

        
      </div><!-- mailtofollowuser_create-method -->

    
      <div id="method-i-message_preview_attachment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">message_preview_attachment</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>New approval GUi Goes here.Please add your new action and code below.</p>
          

          
          <div class="method-source-code" id="message_preview_attachment-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 16</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">message_preview_attachment</span>
  <span class="ruby-ivar">@thread</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:mthreads</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mthreads</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:mthreads</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
<span class="ruby-keyword">end</span></pre>
          </div><!-- message_preview_attachment-source -->
          
        </div>

        

        
      </div><!-- message_preview_attachment-method -->

    
      <div id="method-i-multi_download" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">multi_download</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="multi_download-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5065</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">multi_download</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:val</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">file_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:val</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
    <span class="ruby-identifier">attachments</span> = []
    <span class="ruby-identifier">file_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">file_id</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p_file</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">policy_file</span> = <span class="ruby-constant">PolicyFile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;policy_file_id=?&quot;</span>,<span class="ruby-identifier">p_file</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-identifier">attachments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">policy_file</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">dir_name</span> = <span class="ruby-node">&quot;#{Rails.root}/public/system/zips&quot;</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">dir_name</span>)
      <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-node">&quot;#{Rails.root}/public/system/zips&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">zip_file_path</span> = <span class="ruby-node">&quot;#{Rails.root}/public/system/zips/activity_#{params[:id]}_policy_#{current_user.user_id}.zip&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">zip_file_path</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">zip_file_path</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">Zip</span><span class="ruby-operator">::</span><span class="ruby-constant">ZipFile</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">zip_file_path</span>, <span class="ruby-constant">Zip</span><span class="ruby-operator">::</span><span class="ruby-constant">ZipFile</span><span class="ruby-operator">::</span><span class="ruby-constant">CREATE</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">zipfile</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attachment</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">zipfile</span>.<span class="ruby-identifier">add</span>( <span class="ruby-identifier">attachment</span>.<span class="ruby-identifier">pdf_file_name</span>, <span class="ruby-identifier">attachment</span>.<span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">path</span>(<span class="ruby-value">:original</span>))
      <span class="ruby-keyword">end</span>
    }
    <span class="ruby-identifier">send_file</span> <span class="ruby-identifier">zip_file_path</span>, <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'application/zip'</span>, <span class="ruby-value">:disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'attachment'</span>, <span class="ruby-value">:filename</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;activity_#{params[:id]}_policy_#{current_user.user_id}.zip&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- multi_download-source -->
          
        </div>

        

        
      </div><!-- multi_download-method -->

    
      <div id="method-i-new_success_page" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_success_page</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>success message for create and edit activity</p>
          

          
          <div class="method-source-code" id="new_success_page-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1542</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_success_page</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;user_add&quot;</span>
    <span class="ruby-ivar">@msg</span>=<span class="ruby-string">&quot;user_add&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;user_edit&quot;</span>
    <span class="ruby-ivar">@msg</span>=<span class="ruby-string">&quot;user_edit&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;edit&quot;</span>
    <span class="ruby-ivar">@attend_rep</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id = #{params[:act_id]}&quot;</span>)
    <span class="ruby-ivar">@school_rep</span> = <span class="ruby-constant">SchoolRepresentative</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id = #{params[:act_id]}&quot;</span>)
    <span class="ruby-ivar">@manager</span> = <span class="ruby-constant">ActivityNetworkPermission</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id = #{params[:act_id]}&quot;</span>)
    <span class="ruby-ivar">@msg</span>=<span class="ruby-string">&quot;edit&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;save_copy&quot;</span>
    <span class="ruby-ivar">@msg</span>=<span class="ruby-string">&quot;save_copy&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@msg</span>=<span class="ruby-string">&quot;You have successfully created your activity!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new_success_page-source -->
          
        </div>

        

        
      </div><!-- new_success_page-method -->

    
      <div id="method-i-provider_activites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_activites</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Provider index page</p>
          

          
          <div class="method-source-code" id="provider_activites-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3588</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_activites</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_type</span>).<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;u&quot;</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-string">&quot;/&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-comment">#~ act_free = Activity.find_by_sql(&quot;select * from activities where user_id=#{current_user.user_id} and cleaned=true and lower(active_status)='active' and lower(created_by)='provider' order by activity_id desc limit 200&quot;) if !current_user.nil? &amp;&amp; current_user.present?</span>
  <span class="ruby-identifier">act_free_list</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities where user_id=#{current_user.user_id} and cleaned=true and lower(active_status)!='delete' and lower(active_status)!='city' and lower(created_by)='provider' order by activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">act_free_list</span>.<span class="ruby-identifier">sort_by</span>(&amp;<span class="ruby-value">:modified_date</span>).<span class="ruby-identifier">reverse</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">act_free_list</span>

  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:page</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">act_free</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activities</span> = []
  <span class="ruby-comment">#~ Taking per page as 60 to match the list of cards for different size monitors</span>
  <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">60</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_activites-source -->
          
        </div>

        

        
      </div><!-- provider_activites-method -->

    
      <div id="method-i-provider_activites_old" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_activites_old</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>provider gallery view</p>
          

          
          <div class="method-source-code" id="provider_activites_old-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3643</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_activites_old</span>
        
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">add_to_activity_row</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_row</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:remove_row</span>])
  <span class="ruby-ivar">@activity_featured</span> = []
  <span class="ruby-identifier">act_featured</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_provider_activities</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-value">1</span>,<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-identifier">act_featured</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
  <span class="ruby-ivar">@activity_share_provider</span> = []
  <span class="ruby-identifier">act_provider</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_shared_activities</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>],<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>)
  <span class="ruby-ivar">@activity_share_provider</span> = <span class="ruby-identifier">act_provider</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
  <span class="ruby-comment">#~ act_free = Activity.get_provider_activities(session[:city],&quot;&quot;,session[:date],3,cookies[:uid_usr])</span>
  <span class="ruby-comment">#~ @activity_free = act_free.paginate(:page =&gt; params[:page], :per_page =&gt;400)</span>
  <span class="ruby-ivar">@activity_free</span> = []
  <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_provider_activities_free</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
  <span class="ruby-ivar">@activity_saved_favorites</span> = []
  <span class="ruby-identifier">act_saved_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_favorites</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_saved_favorites</span> = <span class="ruby-identifier">act_saved_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
  <span class="ruby-ivar">@activity_created_activities</span> = []
  <span class="ruby-identifier">act_created_fav</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">get_saved_created_activities</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:zip_code</span>],<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>],<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_created_activities</span> = <span class="ruby-identifier">act_created_fav</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">400</span>)
   
  <span class="ruby-ivar">@provider_activites</span> = []
  <span class="ruby-ivar">@provider_activites</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT category&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_activites_old-source -->
          
        </div>

        

        
      </div><!-- provider_activites_old-method -->

    
      <div id="method-i-provider_advance_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_advance_search</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>advance seach for provider page</p>
          

          
          <div class="method-source-code" id="provider_advance_search-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1910</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_advance_search</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_user_id</span>]
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#~ ref  @pf1=FastImage.size(&quot;http://54.243.133.232:3002/system/profiles/7/thumb/business1_20130223-4128-1t69efx.jpg&quot;)</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
       
  <span class="ruby-identifier">arr</span> = []
  <span class="ruby-identifier">date_range</span> = <span class="ruby-string">''</span>
  <span class="ruby-identifier">selected_date</span> = <span class="ruby-string">'no'</span>
  <span class="ruby-ivar">@condition_all</span> = <span class="ruby-string">''</span>
 
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_mile</span>]
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>]
 
  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-identifier">day_of_the_week</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">day_of_the_week</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;day_of_week_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-comment">#storing the selected values in array for activity type</span>
  <span class="ruby-ivar">@activity_type</span>=[]
  (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@activity_type</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-node">&quot;sch_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@category</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@zipcode</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]
  <span class="ruby-ivar">@city</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
  <span class="ruby-ivar">@gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>

  <span class="ruby-comment">#create the array for age_range values</span>
  <span class="ruby-identifier">age_range</span> = []
  
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_all</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r10</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r1</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r13</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r4</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r15</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">age_range</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:a_r7</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@condition1</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition2</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition3</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition4</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition5</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition6</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition7</span>=<span class="ruby-string">''</span>
  <span class="ruby-ivar">@i</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@c</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@z</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@ct</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@p</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@ag</span> = <span class="ruby-value">0</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_type</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'all'</span>)
    <span class="ruby-ivar">@activity_type</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@i</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;lower(activities.schedule_mode)  = '#{val.downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase!</span>=<span class="ruby-string">'all'</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or lower(activities.schedule_mode)  = '#{val.downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase!</span>=<span class="ruby-string">'all'</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@i</span> = <span class="ruby-ivar">@i</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_type</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;lower(sub_category) = '#{val.downcase.strip}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or lower(sub_category) = '#{val.downcase.strip}'&quot;</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">val</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
   
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@category</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@category</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:z_c</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter Zip Code&quot;</span>
    <span class="ruby-ivar">@condition3</span> = (<span class="ruby-node">&quot;lower(zip_code) = '#{params[:z_c].downcase.strip}'&quot;</span>)
  <span class="ruby-keyword">end</span>
      
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
    <span class="ruby-ivar">@condition4</span> = (<span class="ruby-node">&quot;lower(city) = '#{params[:city_1].downcase.strip}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_1</span>]
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;g_all&quot;</span>
    <span class="ruby-ivar">@condition5</span>=(<span class="ruby-node">&quot;lower(gender) = '#{params[:gender].downcase}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;g_all&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;free&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;free&quot;</span>
      <span class="ruby-ivar">@condition6</span>=(<span class="ruby-string">&quot;price_type = '3'&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;paid&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-keyword">if</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;paid&quot;</span>
      <span class="ruby-ivar">@condition6</span>=(<span class="ruby-string">&quot;price_type='1' or price_type='2'&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#~ if !age_range.include?('a_all')</span>
  <span class="ruby-comment">#~ age_range.each do |val|</span>
  <span class="ruby-comment">#~ if @ag == 0</span>
  <span class="ruby-comment">#~ @condition7.concat(&quot;lower(age_range) = '#{val.downcase}'&quot;) if val != 0 and val != nil and val !='' and val.downcase != &quot;a_all&quot;</span>
  <span class="ruby-comment">#~ else</span>
  <span class="ruby-comment">#~ @condition7.concat(&quot; or lower(age_range) = '#{val.downcase}'&quot;) if val != 0 and val != nil and val !='' and val.downcase != &quot;a_all&quot;</span>
  <span class="ruby-comment">#~ end</span>
  <span class="ruby-comment">#~ @ag= @ag +1</span>
  <span class="ruby-comment">#~ end if !age_range.nil?</span>
  <span class="ruby-comment">#~ end</span>
  
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">'a_all'</span>)
    <span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ag</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;a_all&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'adults'</span>
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;(lower(min_age_range) = '#{val.downcase}' or lower(max_age_range)= '#{val.downcase}')&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#split age range</span>
            <span class="ruby-identifier">str_a</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>)
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot;(lower(min_age_range) = '#{str_a[0]}' or lower(max_age_range) &lt;= '#{str_a[1]}')&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;a_all&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'adults'</span>
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or (lower(min_age_range) = '#{val.downcase}' or lower(max_age_range) = '#{val.downcase}')&quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-comment">#split age range</span>
            <span class="ruby-identifier">str_a</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>)
            <span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; or (lower(min_age_range) = '#{str_a[0]}' or lower(max_age_range) &lt;= '#{str_a[1]}')&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@ag</span>= <span class="ruby-ivar">@ag</span> <span class="ruby-operator">+</span><span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>

 
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition1})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition1</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition1</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition2})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition2</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition2</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition3})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition3</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition3</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition4})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition4</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition4</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition5})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition5</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition5</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition6})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition6</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition6</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@condition_all</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-node">&quot; and (#{@condition7})&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@condition7</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@condition7</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
     
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;next 7 days&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">7</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;next 20 days&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">20</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;today&quot;</span>
      <span class="ruby-identifier">date_range</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:d_r</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;d_all&quot;</span>
        <span class="ruby-identifier">date_range</span> = <span class="ruby-string">&quot;all&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">selected_date</span> = <span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-identifier">date_range</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@ss</span> = []
  <span class="ruby-ivar">@day_arr</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
    <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;mon&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:monday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'monday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;tue&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:tuesday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'tuesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;wed&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:wednesday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'wednesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;thu&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:thursday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'thursday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;fri&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:friday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'friday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sat&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:saturday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'saturday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sun&quot;</span>
        <span class="ruby-ivar">@day_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:sunday</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'sunday'</span>)
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">arr</span> =[]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">date_range</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">date_range!</span>=<span class="ruby-string">''</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">date_range</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;all&quot;</span>
      <span class="ruby-comment">#if day of week is have value</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
        <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activity_id desc&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;activities.*&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:activity_schedule</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(active_status)='active' and user_id='#{params[:search_user_id]}' #{@condition_all}&quot;</span>).<span class="ruby-identifier">uniq</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">search_activity_all_repeat</span>(<span class="ruby-identifier">actv</span>,<span class="ruby-ivar">@ss</span>,<span class="ruby-ivar">@day_arr</span>,<span class="ruby-identifier">arr</span>)
          <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activity_id desc&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;activities.*&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:activity_schedule</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(active_status)='active' and user_id='#{params[:search_user_id]}' #{@condition_all}&quot;</span>).<span class="ruby-identifier">uniq</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:activity_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#choose particular date. activity</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">selected_date</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yes&quot;</span>
        <span class="ruby-identifier">sdate</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:datepicker_ad</span>]).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sdate</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sdate</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-comment">#if day of week is have value</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>).<span class="ruby-identifier">downcase</span>)
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activity_id desc&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;activities.*&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:activity_schedule</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(active_status)='active' and user_id='#{params[:search_user_id]}' And (start_date &lt;='#{date}') #{@condition_all}&quot;</span>).<span class="ruby-identifier">uniq</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
                <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
              <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activity_id desc&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;activities.*&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:activity_schedule</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(active_status)='active' and user_id='#{params[:search_user_id]}' And (start_date &lt;='#{date}') #{@condition_all}&quot;</span>).<span class="ruby-identifier">uniq</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
              <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#next selected date available activities</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:repeat</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_range</span>)
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-comment">#if day of week is have value</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week!</span>=<span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">day_of_the_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">day_of_the_week</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>).<span class="ruby-identifier">downcase</span>)
              <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activity_id desc&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;activities.*&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:activity_schedule</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(active_status)='active' and user_id='#{params[:search_user_id]}' And (start_date &lt;='#{date}') #{@condition_all}&quot;</span>).<span class="ruby-identifier">uniq</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                  <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
                <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
              <span class="ruby-keyword">end</span>    <span class="ruby-comment">#activity exist loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-ivar">@activity</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;activity_id desc&quot;</span>).<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;activities.*&quot;</span>).<span class="ruby-identifier">joins</span>(<span class="ruby-value">:activity_schedule</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(active_status)='active' and user_id='#{params[:search_user_id]}' And (start_date &lt;='#{date}') #{@condition_all}&quot;</span>).<span class="ruby-identifier">uniq</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">actv</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">advancesearch_repeat</span>(<span class="ruby-identifier">date</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>)
              <span class="ruby-keyword">end</span>     <span class="ruby-comment">#each loop end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>    <span class="ruby-comment">#date each loop end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>  <span class="ruby-comment">#date range loop end</span>
 
  <span class="ruby-identifier">arr</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@arr</span>=<span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">:activity_id</span>]}
  <span class="ruby-ivar">@activities</span> = <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
    <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
    <span class="ruby-ivar">@provider_activites_check</span> =[]
    <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-comment">#~ format.html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_advance_search-source -->
          
        </div>

        

        
      </div><!-- provider_advance_search-method -->

    
      <div id="method-i-provider_basic_search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_basic_search</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>provider thumb page search by rajkumar</p>
          

          
          <div class="method-source-code" id="provider_basic_search-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1889</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_basic_search</span>
  <span class="ruby-ivar">@keyword</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:search_text</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_text</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_text</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-ivar">@parent_keyword</span> = <span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;'&quot;</span>,<span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-comment">#normal search with ajax call</span>
  <span class="ruby-ivar">@search_provider</span> =<span class="ruby-string">&quot;search_provider&quot;</span>
  <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">search_data</span>(<span class="ruby-ivar">@parent_keyword</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>])

  <span class="ruby-comment">#pagination for activities</span>
  <span class="ruby-identifier">act</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">60</span>)
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_basic_search-source -->
          
        </div>

        

        
      </div><!-- provider_basic_search-method -->

    
      <div id="method-i-provider_create" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_create</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_create-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 313</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_create</span>
    <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">tags_txt</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;keyword-tag&quot;</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&quot;keyword-tag&quot;</span>]
    <span class="ruby-comment">#~ @activity_profile_apf.country_code = params[:country_codeval] if params[:country_codeval] &amp;&amp; params[:country_codeval]!=&quot;&quot;</span>
    <span class="ruby-comment">#~ @activity_profile_apf.country_id = params[:country_idval] if params[:country_idval] &amp;&amp; params[:country_idval]!=&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone_extension</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_4</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Ext&quot;</span>
    
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:avatar</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:avatar</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:avatar</span>]
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@act_dup</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>])
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-ivar">@act_dup</span>.<span class="ruby-identifier">avatar</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:class_link</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:class_link</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">camps</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:special_link</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:special_link</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">special_needs</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:url_pasted</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttp:\/\//</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttps:\/\//</span>]
        <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>] = <span class="ruby-node">&quot;http://#{params[:provider_url]}&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">purchase_url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:redactor_content</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select Gender--&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discountElligble</span>]<span class="ruby-operator">==</span><span class="ruby-string">'on'</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'Eg: 3'</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#setting page default my activity as active or inactive</span>
    <span class="ruby-ivar">@provider_setting_default</span>=<span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where  p.user_id='#{current_user.user_id}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_setting_default</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">provider_default</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;default&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;4&quot;</span>
          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;default&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;5&quot;</span>
          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Inactive&quot;</span>
        <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-comment">#do end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">contact_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:con_provider</span>]
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">leader</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Leader Name&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">website</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter URL&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Email&quot;</span>
    <span class="ruby-ivar">@mobile_value</span> = <span class="ruby-node">&quot;#{params[:phone_1]}-&quot;</span> <span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone_2]}-&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone_3]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_1</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@mobile_value</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;111-111-1111&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@mobile_value</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;xxx-xxx-xxxx&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone</span> = <span class="ruby-ivar">@mobile_value</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#@activity_profile_apf.phone = &quot;#{params[:phone_1]}-&quot; + &quot;#{params[:phone_2]}-&quot; + &quot;#{params[:phone_2]}&quot; if !params[:phone_1].nil?</span>
    <span class="ruby-comment">#    @activity_profile_apf.no_participants = params[:no_participants] if params[:no_participants] != &quot;Specify Number&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'--Select--'</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">to_f</span>)<span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>]
    <span class="ruby-comment">#@activity_profile_apf.age_range = params[:age_range] if params[:age_range]!=&quot;--Select Age Range--&quot;</span>
    <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">5</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-comment">#price_type ==&gt;1-pric, 2-net price,3-free,4-contact provider</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>]
      <span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
      <span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">3</span>
      <span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
      <span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:address_1</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] = <span class="ruby-string">&quot;Any Where&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:notes</span>]
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">approve_kid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:payment</span>]
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">created_by</span> = <span class="ruby-string">&quot;Provider&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">city_se</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;city_name='#{params[:activity][:city]}'&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">latitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">latitude</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">longitude</span>  = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">longitude</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@result_in</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-identifier">success</span> = <span class="ruby-ivar">@activity_profile_apf</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
          <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
                <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Yearly&quot;</span>
                    <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                  <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
            <span class="ruby-keyword">end</span>

            <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
              <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
                <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
                <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
              <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                      <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                        <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                              <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>])
                              <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-keyword">end</span>
                              <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                              <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                              <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                                <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                            <span class="ruby-keyword">end</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                      <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                      <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
              <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                  <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                          <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>])
                          <span class="ruby-keyword">else</span>
                            <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-keyword">end</span>
                          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                          <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                            <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
          <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:app_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
              <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
              <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
              <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
              <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
              <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
              <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
                    <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
                    <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>])
                    <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-keyword">end</span>
                    <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                    <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
                    <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                      <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
            <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
            <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
            <span class="ruby-comment">#end</span>
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>])
                  <span class="ruby-keyword">else</span>
                    <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                  <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                    <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
          <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
          <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
              <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_val&quot;</span>]
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],
                <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
              <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
              <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
              <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
              <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
              <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
              <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
                    <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
                    <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>])
                    <span class="ruby-keyword">else</span>
                      <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-keyword">end</span>
                    <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                    <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]
                    <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
                    <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                      <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
            <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
            <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
            <span class="ruby-comment">#end</span>
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>])
                  <span class="ruby-keyword">else</span>
                    <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                  <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
                  <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                    <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">end</span>



        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
          <span class="ruby-ivar">@whole_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">nil?</span>
          <span class="ruby-ivar">@whole_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wd</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
                <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-ivar">@schedule</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
                <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
            <span class="ruby-keyword">end</span>

            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
              <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{in_div}&quot;</span>]
                      <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                      <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                        <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                              <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                              <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>])
                              <span class="ruby-keyword">else</span>
                                <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                              <span class="ruby-keyword">end</span>
                              <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                              <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                              <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                                <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                            <span class="ruby-keyword">end</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                      <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                      <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
              <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                  <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                    <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                    <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>                   
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                        <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                          <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                            <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>])
                          <span class="ruby-keyword">else</span>
                            <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-keyword">end</span>
                          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span> 
                          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                          <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                            <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>



      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Where&quot;</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
          <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
            <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                    <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>])
                  <span class="ruby-keyword">else</span>
                    <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                  <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
                  <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                    <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
          <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
          <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
          <span class="ruby-comment">#end</span>
          <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                  <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>])
                <span class="ruby-keyword">else</span>
                  <span class="ruby-identifier">discount_valid_or</span> = <span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">discount_currency</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">discount_currency</span> = <span class="ruby-string">&quot;$&quot;</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">discount_valid_or</span>
                <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                  <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
      <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>
      <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;provider_create_thank&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:other_fee_open</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_fee</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_open</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">add_to_provider_discount_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@created_setting</span> = <span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where s.setting_action='created' and p.user_id=#{current_user.user_id}&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-comment">#setting_option 1, show to famtiivty everyone</span>
      <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set_val</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{current_user.user_id} and lower(user_type)='p'&quot;</span>)
          <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
              <span class="ruby-comment">#check notification</span>
              <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                    <span class="ruby-ivar">@net_user_email</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>
                    <span class="ruby-ivar">@net_user_name</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">user_name</span>
                    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
                    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_mail_provider</span>(<span class="ruby-ivar">@net_user_email</span>,<span class="ruby-ivar">@net_user_name</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-comment"># setting_option 2, famtivity contact user only</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
          <span class="ruby-ivar">@con_user</span> = <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;contact_user&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
          <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{current_user.user_id} and lower(user_type)='p'&quot;</span>)
          <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_user</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
                <span class="ruby-comment">#check notification</span>
                <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
                  <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                      <span class="ruby-ivar">@net_user_email</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>
                      <span class="ruby-ivar">@net_user_name</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">user_name</span>
                      <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
                      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_mail_provider</span>(<span class="ruby-ivar">@net_user_email</span>,<span class="ruby-ivar">@net_user_name</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>


<span class="ruby-keyword">if</span> <span class="ruby-ivar">@result_in</span>
            <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;activity_schedules_for#{@activity_profile_apf.activity_id}&quot;</span>,<span class="ruby-keyword">nil</span>)
            <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;provider_activity_for#{current_user.user_id}&quot;</span>,<span class="ruby-keyword">nil</span>)
<span class="ruby-keyword">end</span>


    <span class="ruby-comment">#notify me when an activity is created for setting page</span>
    <span class="ruby-ivar">@provider_notify_create</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='3' and p.user_id='#{@activity_profile_apf.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notify_create</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_create</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_create</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-comment">#sending a nofification while created the activity by the provider</span>
      <span class="ruby-ivar">@user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">user_email_id</span>=<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Create Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">provider_create_activity_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-identifier">user_email_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-ivar">@plan</span>,<span class="ruby-ivar">@get_current_url</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span></pre>
          </div><!-- provider_create-source -->
          
        </div>

        

        
      </div><!-- provider_create-method -->

    
      <div id="method-i-provider_create_new_changes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_create_new_changes</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>old Famtivity Code Please add new code above.</p>
          

          
          <div class="method-source-code" id="provider_create_new_changes-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 934</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_create_new_changes</span>
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:avatar</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:avatar</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:avatar</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@act_dup</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>])
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-ivar">@act_dup</span>.<span class="ruby-identifier">avatar</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:url_pasted</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttp:\/\//</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>][<span class="ruby-regexp">/\Ahttps:\/\//</span>]
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>] = <span class="ruby-node">&quot;http://#{params[:provider_url]}&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">purchase_url</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_url</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select Gender--&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discountElligble</span>]<span class="ruby-operator">==</span><span class="ruby-string">'on'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'Eg: 3'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#setting page default my activity as active or inactive</span>
  <span class="ruby-ivar">@provider_setting_default</span>=<span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where  p.user_id='#{current_user.user_id}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_setting_default</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">provider_default</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;default&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;4&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;default&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;5&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Inactive&quot;</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-comment">#do end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">contact_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:con_provider</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">leader</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Leader Name&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">website</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter URL&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Email&quot;</span>
  <span class="ruby-ivar">@mobile_value</span> = <span class="ruby-node">&quot;#{params[:phone_1]}-&quot;</span> <span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone_2]}-&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone_3]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_1</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@mobile_value</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;111-111-1111&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@mobile_value</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;xxx-xxx-xxxx&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone</span> = <span class="ruby-ivar">@mobile_value</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#@activity_profile_apf.phone = &quot;#{params[:phone_1]}-&quot; + &quot;#{params[:phone_2]}-&quot; + &quot;#{params[:phone_2]}&quot; if !params[:phone_1].nil?</span>
  <span class="ruby-comment">#    @activity_profile_apf.no_participants = params[:no_participants] if params[:no_participants] != &quot;Specify Number&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'--Select--'</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">to_f</span>) <span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:min_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">'month'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = ((<span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">to_f</span>)<span class="ruby-operator">/</span> <span class="ruby-value">12</span>).<span class="ruby-identifier">round</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:month_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:max_type</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">'year'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:year_age2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>]
  <span class="ruby-comment">#@activity_profile_apf.age_range = params[:age_range] if params[:age_range]!=&quot;--Select Age Range--&quot;</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">5</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-comment">#price_type ==&gt;1-pric, 2-net price,3-free,4-contact provider</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>]
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">3</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
    <span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_1</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">zip_code</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">city</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:address_1</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] = <span class="ruby-string">&quot;Any Where&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-string">&quot;Any Where&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:notes</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">approve_kid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:payment</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">created_by</span> = <span class="ruby-string">&quot;Provider&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]

  <span class="ruby-ivar">@result_in</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">success</span> = <span class="ruby-ivar">@activity_profile_apf</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
        <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_stime_1_#{s}&quot;]} #{params[:&quot;schedule_stime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_stime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;schedule_etime_1_#{s}&quot;]} #{params[:&quot;schedule_etime_2_#{s}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_1_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;schedule_etime_2_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
              <span class="ruby-identifier">ex_date</span> = <span class="ruby-string">&quot;2100-12-31&quot;</span>
              <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Yearly&quot;</span>
                  <span class="ruby-identifier">ex_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]) <span class="ruby-operator">+</span> (<span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> * <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>].<span class="ruby-identifier">to_i</span> ).<span class="ruby-identifier">years</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-identifier">end_on</span> = <span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
                <span class="ruby-identifier">end_on</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_alt_on_date_#{s}&quot;</span>]
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">ex_date</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ex_date</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">ex_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>]
          <span class="ruby-keyword">end</span>

          <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_2_#{s}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;participant_#{s}&quot;</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">ex_date</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatCheck_#{s}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
            <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatNumWeekVal_#{s}&quot;</span>],
              <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;r1_#{s}&quot;</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;after_occ_#{s}&quot;</span>],
              <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_on</span>,<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;date_1_#{s}&quot;</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;month1_#{s}&quot;</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeat_no_of_days_#{s}&quot;</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;repeatWeekVal_#{s}&quot;</span>])
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ads_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:app_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
          <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
            <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
                  <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                    <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
          <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
          <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>  )
          <span class="ruby-comment">#end</span>
          <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                  <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
        <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
        <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
            <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_val&quot;</span>]
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],
              <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:anytime_participants</span>],<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
          <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
            <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
            <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]
                  <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
                  <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                    <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
          <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
          <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
          <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
          <span class="ruby-comment">#end</span>
          <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]

                <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                  <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">end</span>



      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
        <span class="ruby-ivar">@whole_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_day_tabs</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@whole_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">wd</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_1_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_stime_1_#{wd}&quot;]} #{params[:&quot;whole_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;whole_etime_1_#{wd}&quot;]} #{params[:&quot;whole_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;whole_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],
              <span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestartwhole_alt_1_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;single_day_participants_1_#{wd}&quot;</span>])
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;wday_2_#{wd}&quot;</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_stime_1_#{wd}&quot;]} #{params[:&quot;camps_stime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_stime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;camps_etime_1_#{wd}&quot;]} #{params[:&quot;camps_etime_2_#{wd}&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_1_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;camps_etime_2_#{wd}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-ivar">@schedule</span> =  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;datestcamps_1_#{wd}&quot;</span>],
              <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;dateencamps_2_#{wd}&quot;</span>],<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:no_of_participant=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;mul_day_participants_1_#{wd}&quot;</span>])
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">total_outer_div</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_outer_div</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
            <span class="ruby-identifier">total_outer_div</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out_div</span><span class="ruby-operator">|</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_ad_sc_#{out_div}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">inner_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;inner_div_count_#{out_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">inner_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">in_div</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{in_div}&quot;</span>]
                    <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_#{in_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
                    <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span>,<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">nil?</span>
                      <span class="ruby-identifier">early_div_count</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;early_div_count_#{in_div}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                      <span class="ruby-identifier">early_div_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ea_div</span><span class="ruby-operator">|</span>
                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                          <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{ea_div}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                            <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{ea_div}&quot;</span>]
                            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{ea_div}&quot;</span>]
                            <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                              <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                          <span class="ruby-keyword">end</span>
                        <span class="ruby-keyword">end</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;advance_notes_#{out_div}&quot;</span>]
                    <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
            <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:total_div_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
            <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">pr_a</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;_&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;chosen_sc_#{t}&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">wd</span>
                <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;price_#{t}&quot;</span>],<span class="ruby-value">:activity_schedule_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span> )
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Notes:&quot;</span>
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;net_notes_#{t}&quot;</span>]
                  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">save</span>
                <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">nil?</span>
                  <span class="ruby-identifier">early_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;last_in_discount_id_#{pr_a[0]}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
                  <span class="ruby-identifier">early_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>                   
                    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
                      <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{w}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
                      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{w}&quot;</span>]
                        <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{w}&quot;</span>]
                        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
                      <span class="ruby-keyword">end</span>
                    <span class="ruby-keyword">end</span>
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>



    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:addres_anywhere_id</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;2&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Any Where&quot;</span>,<span class="ruby-value">:price_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">price_type</span>,<span class="ruby-value">:expiration_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;2100-12-31&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count_anys</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
        <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_anytime_price_#{c}_#{c}&quot;</span>]
          <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_fst_#{c}_#{c}&quot;</span>]
          <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_#{c}_#{c}&quot;</span>]
          <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_anytime_sec_#{c}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
          <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
          <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
          <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
              <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]
                <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
                <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                  <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
        <span class="ruby-comment">#if multi_discount.count &gt; 0</span>
        <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
        <span class="ruby-comment">#end</span>
        <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">discount_type</span> = <span class="ruby-constant">ProviderDiscountType</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;(user_id=#{current_user.user_id} or user_id is null) and provider_discount_type_id=#{params[:&quot;ad_discount_type_net_#{t}_#{c}&quot;]}&quot;</span>).<span class="ruby-identifier">last</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">discount_type_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]
              <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
              <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>.<span class="ruby-identifier">discount_name</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
                <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>,<span class="ruby-value">:provider_discount_type_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;provider_create_thank&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:other_fee_open</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">add_to_provider_fee</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:add_other_org</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_code_open</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">add_to_provider_discount_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>],<span class="ruby-string">&quot;&quot;</span>,<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:add_otherdiscount_org</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@created_setting</span> = <span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where s.setting_action='created' and p.user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#setting_option 1, show to famtiivty everyone</span>
    <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set_val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{current_user.user_id} and lower(user_type)='p'&quot;</span>)
        <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
            <span class="ruby-comment">#check notification</span>
            <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                  <span class="ruby-ivar">@net_user_email</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>
                  <span class="ruby-ivar">@net_user_name</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">user_name</span>
                  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
                  <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_mail_provider</span>(<span class="ruby-ivar">@net_user_email</span>,<span class="ruby-ivar">@net_user_name</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># setting_option 2, famtivity contact user only</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-ivar">@con_user</span> = <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;contact_user&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{current_user.user_id} and lower(user_type)='p'&quot;</span>)
        <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_user</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
              <span class="ruby-comment">#check notification</span>
              <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                    <span class="ruby-ivar">@net_user_email</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>
                    <span class="ruby-ivar">@net_user_name</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">user_name</span>
                    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
                    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_mail_provider</span>(<span class="ruby-ivar">@net_user_email</span>,<span class="ruby-ivar">@net_user_name</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#notify me when an activity is created for setting page</span>
  <span class="ruby-ivar">@provider_notify_create</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='3' and p.user_id='#{@activity_profile_apf.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notify_create</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_create</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_create</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-comment">#sending a nofification while created the activity by the provider</span>
    <span class="ruby-ivar">@user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">user_email_id</span>=<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Create Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">provider_create_activity_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-identifier">user_email_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-ivar">@plan</span>,<span class="ruby-ivar">@get_current_url</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_create_new_changes-source -->
          
        </div>

        

        
      </div><!-- provider_create_new_changes-method -->

    
      <div id="method-i-provider_create_test" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_create_test</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="provider_create_test-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1561</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_create_test</span>
  <span class="ruby-ivar">@activity_profile_apf</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">inserted_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:photo</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@act_dup</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:save_id</span>])
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">avatar</span> = <span class="ruby-ivar">@act_dup</span>.<span class="ruby-identifier">avatar</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:description</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Description should not exceed 500 characters&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">gender</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;--Select Gender--&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discountElligble</span>]<span class="ruby-operator">==</span><span class="ruby-string">'on'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_eligible</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddligprice</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'Eg: 3'</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ddselect</span>].<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#setting page default my activity as active or inactive</span>
  <span class="ruby-ivar">@provider_setting_default</span>=<span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where  p.user_id='#{current_user.user_id}'&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_setting_default</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">provider_default</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;default&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;4&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;default&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;5&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Inactive&quot;</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_action</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">provider_default</span>.<span class="ruby-identifier">setting_option</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_setting_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-comment">#do end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">active_status</span> = <span class="ruby-string">&quot;Active&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">contact_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:con_provider</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">leader</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:leader</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Leader Name&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">website</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:website</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter URL&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:email</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Enter Email&quot;</span>
  <span class="ruby-ivar">@mobile_value</span> = <span class="ruby-node">&quot;#{params[:phone_1]}-&quot;</span> <span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone_2]}-&quot;</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;#{params[:phone_3]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:phone_1</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@mobile_value</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;xxx-xxx-xxxx&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">phone</span> = <span class="ruby-ivar">@mobile_value</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#@activity_profile_apf.phone = &quot;#{params[:phone_1]}-&quot; + &quot;#{params[:phone_2]}-&quot; + &quot;#{params[:phone_2]}&quot; if !params[:phone_1].nil?</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">no_participants</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:no_participants</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Specify Number&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">address_2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:address_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Address Line 2&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">skill_level</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:skill_level</span>]<span class="ruby-operator">!=</span><span class="ruby-string">'--Select--'</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">min_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:age1</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">max_age_range</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:age2</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:state</span>]
  <span class="ruby-comment">#@activity_profile_apf.age_range = params[:age_range] if params[:age_range]!=&quot;--Select Age Range--&quot;</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>])
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">5</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-comment">#price_type ==&gt;1-pric, 2-net price,3-free,4-contact provider</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">2</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_3</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">3</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">filter_id</span> = <span class="ruby-value">3</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-value">4</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:notes</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">approve_kid</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:payment</span>]
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">created_by</span> = <span class="ruby-string">&quot;Provider&quot;</span>
  <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span> = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]
  <span class="ruby-ivar">@result_in</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">success</span> = <span class="ruby-ivar">@activity_profile_apf</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">success</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
      <span class="ruby-ivar">@date_split</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:date_total</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_total</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@date_split</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_stime_1]} #{params[:schedule_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:schedule_etime_1]} #{params[:schedule_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:schedule_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@schedule</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">activity_repeat</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:repeat_every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatNumWeekVal</span>],
        <span class="ruby-value">:ends_never=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:r1</span>],<span class="ruby-value">:end_occurences=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:after_occ</span>],
        <span class="ruby-value">:ends_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_alt_on_date1</span>],<span class="ruby-value">:starts_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:date_1</span>],<span class="ruby-value">:repeated_by_month=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:month1</span>],<span class="ruby-value">:repeat_on=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeat_no_of_days</span>],<span class="ruby-value">:repeats=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatWeekVal</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:repeatCheck</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;yes&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;By Appointment&quot;</span>
      <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:appointment_stime_1]} #{params[:appointment_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_stime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:appointment_etime_1]} #{params[:appointment_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:appointment_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datebill_1</span>],
        <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
      <span class="ruby-identifier">re</span> = [<span class="ruby-string">'mon'</span>,<span class="ruby-string">'tue'</span>,<span class="ruby-string">'wed'</span>,<span class="ruby-string">'thu'</span>,<span class="ruby-string">'fri'</span>,<span class="ruby-string">'sat'</span>,<span class="ruby-string">'sun'</span>].<span class="ruby-identifier">to_a</span>
      <span class="ruby-identifier">re</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_closed_#{s}&quot;</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;0&quot;</span>
          <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_val&quot;</span>]
          <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_s#{s}_1&quot;]} #{params[:&quot;anytime_s#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_s#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:&quot;anytime_e#{s}_1&quot;]} #{params[:&quot;anytime_e#{s}_2&quot;]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_1&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;anytime_e#{s}_2&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,
            <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>,<span class="ruby-value">:business_hours=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s}&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Whole Day&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_1</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_stime_1]} #{params[:whole_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_stime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:whole_etime_1]} #{params[:whole_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:whole_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestartwhole_alt_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:wday_2</span>] <span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-identifier">st_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_stime_1]} #{params[:camps_stime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_stime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">en_time</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-node">&quot;#{params[:camps_etime_1]} #{params[:camps_etime_2]}&quot;</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%H:%M:%S&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps_etime_2</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestcamps_1</span>],
          <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:dateencamps_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">st_time</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">en_time</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Day&quot;</span>
      <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_schedule</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:schedule_mode=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity</span>][<span class="ruby-value">:schedule_mode</span>],<span class="ruby-value">:start_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:datestcamps_1</span>],
        <span class="ruby-value">:end_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:dateencamps_2</span>],<span class="ruby-value">:start_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>,<span class="ruby-value">:end_time=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_2</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">price_count</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:advance_price_count</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>)
      <span class="ruby-identifier">price_count</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">net_price</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_price_1_#{c}&quot;</span>]
        <span class="ruby-identifier">no_class</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_fst_1_#{c}&quot;</span>]
        <span class="ruby-identifier">payment_period</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_1_#{c}&quot;</span>]
        <span class="ruby-identifier">no_hours</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_1_#{c}&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_payment_box_sec_1_#{c}&quot;</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;Eg: 3&quot;</span>
        <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">net_price</span>,<span class="ruby-value">:payment_period=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">payment_period</span>,<span class="ruby-value">:no_of_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_class</span>,<span class="ruby-value">:no_of_hour</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">no_hours</span> )
        <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_#{t}_#{c}&quot;</span>]
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Early Bird Discount&quot;</span>
            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_#{t}_#{c}&quot;</span>]
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Session Discount&quot;</span>
            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_type_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_sess_#{t}_#{c}&quot;</span>]
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Participant Discount&quot;</span>
            <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_type_#{t}_#{c}&quot;</span>]
            <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
            <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_part_#{t}_#{c}&quot;</span>]
          <span class="ruby-keyword">end</span>
          <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
            <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
        <span class="ruby-keyword">end</span>
    
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">c</span>=<span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">multi_discount</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;multiple_discount_count_net_#{c}_#{c}&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
      <span class="ruby-ivar">@ss</span> = <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@activity_price</span> = <span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">activity_price</span>.<span class="ruby-identifier">create</span>( <span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price</span>] )
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">multi_discount</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">discount_type</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_type_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Early Bird Discount&quot;</span>
          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_net_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_price_type_net_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_valid_date_alt_net_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_subs_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Session Discount&quot;</span>
          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_net_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_sess_price_type_net_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_sess_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">discount_type</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Multiple Participant Discount&quot;</span>
          <span class="ruby-identifier">discount_price</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_net_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_currency</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_discount_part_price_type_net_#{t}_#{c}&quot;</span>]
          <span class="ruby-identifier">discount_validity</span> = <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">discount_number</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:&quot;ad_no_part_net_#{t}_#{c}&quot;</span>]
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@activity_price</span>.<span class="ruby-identifier">activity_discount_price</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:discount_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_type</span>,<span class="ruby-value">:discount_price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_price</span>,<span class="ruby-value">:discount_currency_type=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_currency</span>,
          <span class="ruby-value">:discount_valid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">discount_validity</span>,<span class="ruby-value">:discount_number</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">discount_number</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">discount_price!</span>=<span class="ruby-string">''</span>
      <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
    <span class="ruby-ivar">@plan</span> = <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_plan</span>
    <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;provider_create_thank&quot;</span>
    <span class="ruby-comment">#session[:date] = Time.now.strftime(&quot;%Y-%m-%d&quot;) if session[:date].nil?</span>
    <span class="ruby-comment">#@act_type =params[:act_type]</span>
    <span class="ruby-comment">#if !@act_type.nil? &amp;&amp; @act_type.present? &amp;&amp; @act_type==&quot;provider_activites&quot;</span>
    <span class="ruby-comment">#    act_free = Activity.find_by_sql(&quot;select * from activities where user_id=#{current_user.user_id} and cleaned=true and lower(active_status)='active' and lower(created_by)='provider' order by activity_id desc limit 200&quot;) if !current_user.nil? &amp;&amp; current_user.present?</span>
    <span class="ruby-comment">#    @activities = act_free.paginate(:page =&gt; params[:page], :per_page =&gt;60)</span>
    <span class="ruby-comment">#else</span>
    <span class="ruby-comment">#    act = Activity.order(&quot;activity_id desc&quot;).find(:all,:conditions=&gt;[&quot;created_by = ? and user_id = ? and lower(active_status) != ? and cleaned = true &quot;,&quot;Provider&quot;,cookies[:uid_usr], &quot;delete&quot;])</span>
    <span class="ruby-comment">#    @activities = act.paginate(:page =&gt; params[:page], :per_page =&gt;10)</span>
    <span class="ruby-comment">#end</span>
    <span class="ruby-comment">#respond_to do |format|</span>
    <span class="ruby-comment">#    format.js</span>
    <span class="ruby-comment">#end</span>
    <span class="ruby-comment">#  if (current_user.user_plan == &quot;sponsor&quot; ||current_user.user_plan == &quot;sell&quot;) &amp;&amp; @activity_profile_apf.created_by==&quot;Provider&quot;</span>
    <span class="ruby-comment">#    render :partial =&gt; &quot;create_act_bid_thank&quot;</span>
    <span class="ruby-comment">#  else</span>
    <span class="ruby-comment">#    render :partial =&gt; &quot;provider_create_thank&quot;</span>
    <span class="ruby-comment">#  end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#send a mail while parent following me while creating activity</span>
  <span class="ruby-comment">#    @provider_setting_notify=ProviderSettingDetail.find_by_sql(&quot;select * from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where  p.user_id=#{current_user.user_id}&quot;) if !current_user.nil?</span>
  <span class="ruby-comment">#    @provider_setting_notify.each do |provider_notify|</span>
  <span class="ruby-comment">#      #&lt;!--provider setting option is Every one--&gt;</span>
  <span class="ruby-comment">#                   if provider_notify.setting_action==&quot;created&quot; &amp;&amp; provider_notify.setting_option==&quot;1&quot;</span>
  <span class="ruby-comment">#        @act_row_provider_page = &quot;created&quot;</span>
  <span class="ruby-comment">#                   elsif provider_notify.setting_action==&quot;created&quot; &amp;&amp; provider_notify.setting_option==&quot;3&quot;</span>
  <span class="ruby-comment">#                           if provider_notify.setting_action==&quot;created&quot; &amp;&amp; provider_notify.setting_option==&quot;3&quot;</span>
  <span class="ruby-comment">#                                   if current_user.user_id.to_i==provider_notify.user_id.to_i</span>
  <span class="ruby-comment">#            @act_row_provider_page = &quot;created&quot;</span>
  <span class="ruby-comment">#            @justme=&quot;justme&quot;</span>
  <span class="ruby-comment">#                                   end</span>
  <span class="ruby-comment">#                           end</span>
  <span class="ruby-comment">#                   elsif provider_notify.setting_action==&quot;created&quot; &amp;&amp; provider_notify.setting_option==&quot;2&quot;</span>
  <span class="ruby-comment">#                           if provider_notify.setting_action==&quot;created&quot; &amp;&amp; provider_notify.setting_option==&quot;2&quot; &amp;&amp; !provider_notify.contact_user.nil?</span>
  <span class="ruby-comment">#          @famtivity_contact=provider_notify.contact_user.split(',')</span>
  <span class="ruby-comment">#          @act_row_provider_page = &quot;created&quot;</span>
  <span class="ruby-comment">#          @contact=&quot;contact&quot;</span>
  <span class="ruby-comment">#                           end#&lt;!--if provider notify end--&gt;</span>
  <span class="ruby-comment">#      end#&lt;!--setting condition if end--&gt;</span>
  <span class="ruby-comment">#    end #do end</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment">#    if !@famtivity_contact.nil? &amp;&amp; @famtivity_contact.present?</span>
  <span class="ruby-comment">#      @famtivity_contact.each do |fval|</span>
  <span class="ruby-comment">#        @user_mail = User.find_by_user_id(fval) if !fval.nil?</span>
  <span class="ruby-comment">#        @net_user_email = @user_mail.email_address</span>
  <span class="ruby-comment">#        @net_user_name = @user_mail.user_name</span>
  <span class="ruby-comment">#        @get_current_url = request.env['HTTP_HOST']</span>
  <span class="ruby-comment">#        @notify_setting_fo = ParentNotificationDetail.find_by_sql(&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval} and p.notify_flag=true&quot;)</span>
  <span class="ruby-comment">#        if !@notify_setting_fo.nil? &amp;&amp; @notify_setting_fo!='' &amp;&amp; @notify_setting_fo.present?</span>
  <span class="ruby-comment">#          if !@user_mail.nil? &amp;&amp; @user_mail!='' &amp;&amp; @user_mail.present?</span>
  <span class="ruby-comment">#            if @user_mail.user_flag== true</span>
  <span class="ruby-comment">#              @result = UserMailer.delay(queue: &quot;Following User&quot;, priority: 2, run_at: 10.seconds.from_now).following_user_mail_provider(@net_user_email,@net_user_name,current_user,@activity_profile_apf,@get_current_url,params[:message],params[:subject])</span>
  <span class="ruby-comment">#              #@result = UserMailer.following_user_create_mail(@user_mail ,@follow_user,@activity_profile_apf,@get_current_url,params[:message],@user_mail.email_address,params[:subject]).deliver</span>
  <span class="ruby-comment">#            end</span>
  <span class="ruby-comment">#          end</span>
  <span class="ruby-comment">#        end</span>
  <span class="ruby-comment">#      end</span>
  <span class="ruby-comment">#    end</span>
  <span class="ruby-ivar">@created_setting</span> = <span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id  where s.setting_action='created' and p.user_id=#{current_user.user_id}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#setting_option 1, show to famtiivty everyone</span>
    <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set_val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{current_user.user_id} and lower(user_type)='p'&quot;</span>)
        <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
            <span class="ruby-comment">#check notification</span>
            <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
              <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                  <span class="ruby-ivar">@net_user_email</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>
                  <span class="ruby-ivar">@net_user_name</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">user_name</span>
                  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
                  <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_mail_provider</span>(<span class="ruby-ivar">@net_user_email</span>,<span class="ruby-ivar">@net_user_name</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
  
      <span class="ruby-comment"># setting_option 2, famtivity contact user only</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
        <span class="ruby-ivar">@con_user</span> = <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;contact_user&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-ivar">@follow</span> = <span class="ruby-constant">UserRow</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;distinct user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;row_user_id=#{current_user.user_id} and lower(user_type)='p'&quot;</span>)
        <span class="ruby-ivar">@follow_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-ivar">@follow</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fval</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_user</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
              <span class="ruby-comment">#check notification</span>
              <span class="ruby-ivar">@notify_setting_fo</span> = <span class="ruby-constant">ParentNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@notify_setting_fo</span>.<span class="ruby-identifier">present?</span>
                <span class="ruby-ivar">@user_mail</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">fval</span>[<span class="ruby-string">&quot;user_id&quot;</span>])
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">present?</span>
                  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_mail</span>[<span class="ruby-string">&quot;user_flag&quot;</span>]<span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
                    <span class="ruby-ivar">@net_user_email</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">email_address</span>
                    <span class="ruby-ivar">@net_user_name</span> = <span class="ruby-ivar">@user_mail</span>.<span class="ruby-identifier">user_name</span>
                    <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
                    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Following User&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">following_user_mail_provider</span>(<span class="ruby-ivar">@net_user_email</span>,<span class="ruby-ivar">@net_user_name</span>,<span class="ruby-identifier">current_user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#parent follow users</span>
  <span class="ruby-comment">#@follow_provider_user = UserRow.where(&quot;user_id=#{current_user.user_id} and user_type='U'&quot;).map(&amp;:row_user_id)</span>
  <span class="ruby-comment">#    @follow_provider_user = UserRow.select(&quot;distinct user_id&quot;).where(&quot;row_user_id=#{current_user.user_id} and lower(user_type)='p'&quot;)</span>
  <span class="ruby-comment">#    if !@act_row_provider_page.nil? &amp;&amp; @justme!=&quot;justme&quot; &amp;&amp; @contact!=&quot;contact&quot;</span>
  <span class="ruby-comment">#      if !@follow_provider_user.nil? &amp;&amp; @follow_provider_user!='' &amp;&amp; @follow_provider_user.present?</span>
  <span class="ruby-comment">#        @follow_provider_user.each do |fval|</span>
  <span class="ruby-comment">#          @user_mail = User.find_by_user_id(fval[&quot;user_id&quot;]) if !fval.nil?</span>
  <span class="ruby-comment">#          @net_user_email = @user_mail.email_address</span>
  <span class="ruby-comment">#          @net_user_name = @user_mail.user_name</span>
  <span class="ruby-comment">#          @get_current_url = request.env['HTTP_HOST']</span>
  <span class="ruby-comment">#          @notify_setting_fo = ParentNotificationDetail.find_by_sql(&quot;select p.* from parent_notification_details pn left join parent_notifications p on pn.parent_notify_id=p.parent_notify_id  where pn.notify_action='2' and lower(pn.notify_status)='active'and p.user_id=#{fval[&quot;user_id&quot;]} and p.notify_flag=true&quot;)</span>
  <span class="ruby-comment">#          if !@notify_setting_fo.nil? &amp;&amp; @notify_setting_fo!='' &amp;&amp; @notify_setting_fo.present?</span>
  <span class="ruby-comment">#            if !@user_mail.nil? &amp;&amp; @user_mail!='' &amp;&amp; @user_mail.present?</span>
  <span class="ruby-comment">#              if @user_mail.user_flag== true</span>
  <span class="ruby-comment">#                @result = UserMailer.delay(queue: &quot;Following User&quot;, priority: 2, run_at: 10.seconds.from_now).following_user_mail_provider(@net_user_email,@net_user_name,current_user,@activity_profile_apf,@get_current_url,params[:message],params[:subject])</span>
  <span class="ruby-comment">#                #@result = UserMailer.following_user_create_mail(@user_mail ,@follow_user,@activity_profile_apf,@get_current_url,params[:message],@user_mail.email_address,params[:subject]).deliver</span>
  <span class="ruby-comment">#              end</span>
  <span class="ruby-comment">#            end</span>
  <span class="ruby-comment">#          end</span>
  <span class="ruby-comment">#        end</span>
  <span class="ruby-comment">#      end</span>
  <span class="ruby-comment">#    end</span>

  <span class="ruby-comment">#notify me when an activity is created for setting page</span>
  <span class="ruby-ivar">@provider_notify_create</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='3' and p.user_id='#{@activity_profile_apf.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notify_create</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_create</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_create</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-comment">#sending a nofification while created the activity by the provider</span>
    <span class="ruby-ivar">@user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_profile_apf</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">user_email_id</span>=<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
    <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Provider Create Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">provider_create_activity_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity_profile_apf</span>,<span class="ruby-identifier">user_email_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>],<span class="ruby-ivar">@plan</span>,<span class="ruby-ivar">@get_current_url</span>)
    <span class="ruby-comment"># @result = UserMailer.provider_create_activity_mail(@user,@activity_profile_apf,user_email_id,params[:subject]).deliver</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_create_test-source -->
          
        </div>

        

        
      </div><!-- provider_create_test-method -->

    
      <div id="method-i-provider_web_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provider_web_count</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>provider, activity website count</p>
          

          
          <div class="method-source-code" id="provider_web_count-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provider_web_count</span>
  <span class="ruby-ivar">@web_count</span> = <span class="ruby-constant">ProviderWebsiteTrack</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;user_id=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]).<span class="ruby-identifier">last</span>
  <span class="ruby-ivar">@date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@old_date</span>=<span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">modified_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">modified_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@old_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@date</span><span class="ruby-operator">==</span><span class="ruby-ivar">@old_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;activity&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">activity_website_count</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">activity_website_count</span>=<span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">activity_website_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">activity_website_count</span>=<span class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">inserted_date</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">modified_date</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">provider_website_count</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">provider_website_count</span>=<span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">provider_website_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">provider_website_count</span>=<span class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">inserted_date</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">modified_date</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-ivar">@web_count</span>.<span class="ruby-identifier">save</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">webcount</span>=<span class="ruby-constant">ProviderWebsiteTrack</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;activity&quot;</span>
      <span class="ruby-identifier">webcount</span>.<span class="ruby-identifier">activity_website_count</span>=<span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">webcount</span>.<span class="ruby-identifier">provider_website_count</span>=<span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">webcount</span>.<span class="ruby-identifier">user_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">webcount</span>.<span class="ruby-identifier">inserted_date</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-identifier">webcount</span>.<span class="ruby-identifier">modified_date</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-identifier">webcount</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- provider_web_count-source -->
          
        </div>

        

        
      </div><!-- provider_web_count-method -->

    
      <div id="method-i-repeat_daily_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_daily_view</span><span
            class="method-args">(c_date,repeat,schedule,actv,arr,c_day)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>view page repeat functionality</p>
          

          
          <div class="method-source-code" id="repeat_daily_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2965</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_daily_view</span>(<span class="ruby-identifier">c_date</span>,<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">c_day</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-identifier">c_date</span>
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-identifier">schedule</span>
  <span class="ruby-comment">#if daily and ends never true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">s_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
        <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>,<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if Daily and ends on exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>,<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if Daily and end occurences exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">e_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">e_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>,<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_daily_view-source -->
          
        </div>

        

        
      </div><!-- repeat_daily_view-method -->

    
      <div id="method-i-repeat_monthly_date" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_date</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="repeat_monthly_date-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5646</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_date</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_date</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w_date</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_date-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_date-method -->

    
      <div id="method-i-repeat_monthly_date_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_date_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date,running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_monthly_date_never-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5629</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_date_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>,<span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_date</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">w_date</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_date_never-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_date_never-method -->

    
      <div id="method-i-repeat_monthly_day" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_day</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_monthly_day-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5592</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_day</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_day</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">se</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:&quot;#{w_day.downcase}&quot;</span> , <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_day-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_day-method -->

    
      <div id="method-i-repeat_monthly_day_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_day_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date,running_date,se,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_monthly_day_never-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5612</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_day_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>,<span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">w_day</span> = <span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">running_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">se</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:&quot;#{w_day.downcase}&quot;</span> , <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_day_never-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_day_never-method -->

    
      <div id="method-i-repeat_monthly_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_monthly_view</span><span
            class="method-args">(c_date,repeat,schedule,actv,arr,c_day)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>repeat monthly</p>
          

          
          <div class="method-source-code" id="repeat_monthly_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3083</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_monthly_view</span>(<span class="ruby-identifier">c_date</span>,<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">c_day</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-identifier">c_date</span>
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-identifier">schedule</span>
  <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
  <span class="ruby-identifier">s</span> = <span class="ruby-identifier">week_of_month_for_date</span>(<span class="ruby-identifier">s_date</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:first</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">2</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:second</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">3</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:third</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">&gt;=</span><span class="ruby-value">4</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:last</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">s_date</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>)
      <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span><span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">s_day</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%a&quot;</span>)
      <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{se}&quot;</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s_day.downcase}&quot;</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span><span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
        
    <span class="ruby-comment"># # #if Daily and ends on exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">s_date1</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date1</span>.<span class="ruby-identifier">to_i</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span><span class="ruby-ivar">@c_date</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">s_day</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%a&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{se}&quot;</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s_day.downcase}&quot;</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span><span class="ruby-ivar">@c_date</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># #if monthly and end occurences exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">e_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">e_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">s_date1</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date1</span>.<span class="ruby-identifier">to_i</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span><span class="ruby-ivar">@c_date</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">s_day</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%a&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{se}&quot;</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{s_day.downcase}&quot;</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span><span class="ruby-ivar">@c_date</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_monthly_view-source -->
          
        </div>

        

        
      </div><!-- repeat_monthly_view-method -->

    
      <div id="method-i-repeat_schedule" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_schedule</span><span
            class="method-args">(event, events, js_end_date, js_start_date,running_date,type,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_schedule-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5791</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_schedule</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>,<span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">type</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">days</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'daily'</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">years</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'yearly'</span>

    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rep</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span>  <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_schedule-source -->
          
        </div>

        

        
      </div><!-- repeat_schedule-method -->

    
      <div id="method-i-repeat_schedule_end" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_schedule_end</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,type,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_schedule_end-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5773</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">type</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">##          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">days</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'daily'</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">years</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'yearly'</span>

    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rep</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_schedule_end-source -->
          
        </div>

        

        
      </div><!-- repeat_schedule_end-method -->

    
      <div id="method-i-repeat_schedule_occurance" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_schedule_occurance</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,type,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_schedule_occurance-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5757</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_schedule_occurance</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">type</span>,<span class="ruby-identifier">info</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">days</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'daily'</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">years</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">'yearly'</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rep</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_schedule_occurance-source -->
          
        </div>

        

        
      </div><!-- repeat_schedule_occurance-method -->

    
      <div id="method-i-repeat_weekly" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_weekly</span><span
            class="method-args">(event, events, js_end_date, js_start_date, occ, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="repeat_weekly-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5547</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_weekly</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">date_un</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">js_end_date</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_un</span>,<span class="ruby-value">:interval=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_un</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">running_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">occ</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)

          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
          <span class="ruby-comment">#            events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_weekly-source -->
          
        </div>

        

        
      </div><!-- repeat_weekly-method -->

    
      <div id="method-i-repeat_weekly_never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_weekly_never</span><span
            class="method-args">(event, events, js_end_date, js_start_date, running_date,info)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>TODO Comment</p>
          

          
          <div class="method-source-code" id="repeat_weekly_never-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5571</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_weekly_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
  <span class="ruby-identifier">date_js</span> = <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">js_end_date</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">!=</span><span class="ruby-value">0</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_js</span>,<span class="ruby-value">:interval=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ss</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">running_date</span>,<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">date_js</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">js_end_date</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">running_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">js_start_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">running_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">running_date</span>)
        <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        <span class="ruby-comment">#          events &lt;&lt; {:id =&gt; event.activity_id, :title =&gt; event.activity_name, :description =&gt; event.description, :start =&gt; &quot;#{repeat_start_date}&quot;, :end =&gt; &quot;#{repeat_end_date}&quot;, :allDay =&gt;0, :recurring =&gt; true}</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">running_date</span> = <span class="ruby-identifier">running_date</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">days</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">running_date</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_weekly_never-source -->
          
        </div>

        

        
      </div><!-- repeat_weekly_never-method -->

    
      <div id="method-i-repeat_weekly_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_weekly_view</span><span
            class="method-args">(c_date,repeat,schedule,actv,arr,c_day)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="repeat_weekly_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3004</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_weekly_view</span>(<span class="ruby-identifier">c_date</span>,<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">c_day</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-identifier">c_date</span>
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-identifier">schedule</span>
  <span class="ruby-ivar">@wek</span> =[]
  <span class="ruby-ivar">@ss</span> =[]
  <span class="ruby-identifier">s_date</span>=<span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
  
  <span class="ruby-identifier">repeat_o</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_on</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">repeat_o</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">repeat_o!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">repeat_o</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-identifier">repeat_o</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
    <span class="ruby-identifier">rep</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;mon&quot;</span>
        <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">1</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:monday</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;tue&quot;</span>
        <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">2</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:tuesday</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;wed&quot;</span>
        <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">3</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:wednesday</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;thu&quot;</span>
        <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">4</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:thursday</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;fri&quot;</span>
        <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">5</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:friday</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sat&quot;</span>
        <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">6</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:saturday</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sun&quot;</span>
        <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">0</span>)
        <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:sunday</span>)
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#if weekly and ends never true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@ss</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-comment"># p r</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>,<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if weekly and ends on exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">end_date</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@ss</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if weekly and end occurences exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">end_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">present?</span>
          <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@ss</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">end_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>,<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  
  
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_weekly_view-source -->
          
        </div>

        

        
      </div><!-- repeat_weekly_view-method -->

    
      <div id="method-i-repeat_yearly_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">repeat_yearly_view</span><span
            class="method-args">(c_date,repeat,schedule,actv,arr,c_day)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>repeat yearly</p>
          

          
          <div class="method-source-code" id="repeat_yearly_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3154</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">repeat_yearly_view</span>(<span class="ruby-identifier">c_date</span>,<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">c_day</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-identifier">c_date</span>
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-identifier">schedule</span>
  <span class="ruby-comment">#if daily and ends never true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">s_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:year</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%m&quot;</span>).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>).<span class="ruby-identifier">to_i</span>], <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
        <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  
    <span class="ruby-comment">#if Daily and ends on exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:year</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%m&quot;</span>).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>).<span class="ruby-identifier">to_i</span>],<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if Daily and end occurences exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">e_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">years</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">e_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:year</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%m&quot;</span>).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>).<span class="ruby-identifier">to_i</span>],<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@c_date</span>)
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  
  
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- repeat_yearly_view-source -->
          
        </div>

        

        
      </div><!-- repeat_yearly_view-method -->

    
      <div id="method-i-save_favorites" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_favorites</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="save_favorites-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3390</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_favorites</span>
  <span class="ruby-ivar">@activity_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>]
  <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>]
  <span class="ruby-ivar">@before_login_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:before_login_value</span>].<span class="ruby-identifier">present?</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- save_favorites-source -->
          
        </div>

        

        
      </div><!-- save_favorites-method -->

    
      <div id="method-i-schedule_destroy" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">schedule_destroy</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>delete function for multiple shedule activity</p>
          

          
          <div class="method-source-code" id="schedule_destroy-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">schedule_destroy</span>
  <span class="ruby-ivar">@schedule_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:sch_id</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">','</span>)
  <span class="ruby-comment">#activity delete start</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:act_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act_id</span>].<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:act_id</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;not_empty&quot;</span>
    <span class="ruby-identifier">activity</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&amp;\w+;/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">parameterize</span>
    <span class="ruby-ivar">@act</span>=<span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">activity</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@activity_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#update the activity record as delete status.</span>
    <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Delete&quot;</span>,<span class="ruby-value">:modified_date=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
    <span class="ruby-comment">#setting notification for the users</span>
    <span class="ruby-ivar">@provider_notifications</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='1' and p.user_id='#{@act.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment"># if user present in setting tables</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notifications</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notifications</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notifications</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#~ #sending mail to the participant while delete the activity  ----dont remove this code----</span>
      <span class="ruby-ivar">@participant</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;user_id&quot;</span>)
      <span class="ruby-comment">#~ @participant = ActivityAttendDetail.find(:all,:conditions=&gt;[&quot;activity_id = ? &quot;, @act.activity_id])</span>
      <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">user_parent</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-identifier">email_parent</span>=<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">email_parent</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Cancel Activity to participant&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">cancel_activity_mail_to_parent</span>(<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_name</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">email_parent</span>,<span class="ruby-ivar">@activity_user</span>)
          <span class="ruby-comment">#@result = UserMailer.cancel_activity_mail_to_parent(user_parent.user_name,@act,@get_current_url,params[:message],email_parent,params[:subject]).deliver</span>
        <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">else</span> <span class="ruby-comment">#first if the user not present in setting tables.</span>
      <span class="ruby-comment">#~ #sending mail to the participant while delete the activity  ----dont remove this code----</span>
      <span class="ruby-comment">#~ @participant = ActivityAttendDetail.find(:all,:conditions=&gt;[&quot;activity_id = ? &quot;, @act.activity_id])</span>
      <span class="ruby-ivar">@participant</span> = <span class="ruby-constant">ActivityAttendDetail</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;user_id&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id=? and lower(payment_status)=?&quot;</span>,<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">activity_id</span>,<span class="ruby-string">'paid'</span>).<span class="ruby-identifier">group</span>(<span class="ruby-string">&quot;user_id&quot;</span>)
      <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">user_parent</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">user_id</span>)
        <span class="ruby-identifier">email_parent</span>=<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">email_parent</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">email_parent</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
          <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Cancel Activity to participant&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">cancel_activity_mail_to_parent</span>(<span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">user_name</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">email_parent</span>,<span class="ruby-ivar">@activity_user</span>)
          <span class="ruby-comment">#@result = UserMailer.cancel_activity_mail_to_parent(user_parent.user_name,@act,@get_current_url,params[:message],email_parent,params[:subject]).deliver</span>
        <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user_parent</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@participant</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#first if end</span>
    
    <span class="ruby-comment">#setting notification for the users</span>
    <span class="ruby-ivar">@provider_notification_default</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='6' and p.user_id='#{@act.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#user present in setting notify me when the record is removed</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notification_default</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notification_default</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#sending mail while delete the activity by the provider.</span>
      <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">user_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Delete Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">delete_activity_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
        <span class="ruby-comment">#@result = UserMailer.delete_activity_mail(user_name,@act,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
      <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#user not present in setting table</span>
      <span class="ruby-comment">#sending mail while delete the activity by the provider.</span>
      <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">user_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Delete Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">delete_activity_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
        <span class="ruby-comment">#@result = UserMailer.delete_activity_mail(user_name,@act,@get_current_url,params[:message],attend_email,params[:subject]).deliver</span>
      <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@schedule_value</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">schedule</span><span class="ruby-operator">|</span> <span class="ruby-comment">#activity_shedule delete start</span>
      <span class="ruby-ivar">@act_schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">schedule</span>)
      <span class="ruby-ivar">@act_price</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">find_by_activity_schedule_id</span>(<span class="ruby-identifier">schedule</span>)
      <span class="ruby-identifier">activity</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&amp;\w+;/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">parameterize</span>
      <span class="ruby-ivar">@act</span>=<span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">activity</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-ivar">@delete</span>=<span class="ruby-constant">DeletedSchedule</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">schedule_id</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_id</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">activity_id</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">activity_id</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">schedule_mode</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">schedule_mode</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">start_date</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">start_date</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">end_date</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">end_date</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">start_time</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">start_time</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">end_time</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">end_time</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">repeat</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">repeat</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">business_hours</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">business_hours</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">modified_date</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">modified_date</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">no_of_participant</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">no_of_participant</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">expiration_date</span>= <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">expiration_date</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">price_type</span> = <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">price_type</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">price_type</span><span class="ruby-operator">==</span><span class="ruby-string">'3'</span>
        <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">price</span>=<span class="ruby-string">&quot;Free&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">price_type</span><span class="ruby-operator">==</span><span class="ruby-string">'4'</span>
        <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">price</span>=<span class="ruby-string">&quot;Contact Provider&quot;</span>
      <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">price</span>.<span class="ruby-identifier">present?</span>
        <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">price</span>=<span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">price</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">price</span>=<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">price</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">price</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@delete</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-ivar">@act_schedule</span>.<span class="ruby-identifier">destroy</span>
      <span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">destroy</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act_price</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#activity_shedule delete end</span>
    <span class="ruby-ivar">@schedulle_cnt</span>=<span class="ruby-ivar">@schedule_value</span>.<span class="ruby-identifier">count</span>
    <span class="ruby-comment">#sending mail while delete the activity by the multiple schedule.</span>
    <span class="ruby-identifier">activity</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:activity_id</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&amp;\w+;/</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">parameterize</span>
    <span class="ruby-ivar">@act</span>=<span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">activity</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">activity</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@activity_user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@act</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@act</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@act</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">attend_email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">user_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_name</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">attend_email</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">attend_email</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedulle_cnt</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>  <span class="ruby-comment">#activity or more schedule delete mail</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Delete Activity&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">delete_activity_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@schedulle_cnt</span> <span class="ruby-operator">==</span><span class="ruby-value">1</span> <span class="ruby-comment">#single schedule delete</span>
        <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Delete Activity Schedule&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">delete_activity_schedule_mail</span>(<span class="ruby-identifier">user</span>,<span class="ruby-ivar">@act</span>,<span class="ruby-ivar">@delete</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">attend_email</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>  <span class="ruby-comment">#activity delete end</span>
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- schedule_destroy-source -->
          
        </div>

        

        
      </div><!-- schedule_destroy-method -->

    
      <div id="method-i-schedule_price_detail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">schedule_price_detail</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="schedule_price_detail-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1476</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">schedule_price_detail</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- schedule_price_detail-source -->
          
        </div>

        

        
      </div><!-- schedule_price_detail-method -->

    
      <div id="method-i-schedule_repeat_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">schedule_repeat_append</span><span
            class="method-args">(event,events,type_icon)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="schedule_repeat_append-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5330</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">schedule_repeat_append</span>(<span class="ruby-identifier">event</span>,<span class="ruby-identifier">events</span>,<span class="ruby-identifier">type_icon</span>)
  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Schedule&quot;</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.start_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">end_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.end_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_schedule_id =?&quot;</span>,<span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">info</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">js_start_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>])
    <span class="ruby-identifier">js_end_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>])
    <span class="ruby-ivar">@type_icon</span> = <span class="ruby-identifier">type_icon</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Daily&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">repeat_schedule</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'daily'</span>,<span class="ruby-identifier">info</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'daily'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">repeat_schedule_occurance</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'daily'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yearly&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">repeat_schedule</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'yearly'</span>,<span class="ruby-identifier">info</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'yearly'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">repeat_schedule_end</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-string">'yearly'</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Weekly&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-ivar">@wek</span> =[]
        <span class="ruby-ivar">@ss</span> =[]
        <span class="ruby-identifier">rep</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_on</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
        <span class="ruby-identifier">rep</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Mon&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">1</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:monday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Tue&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">2</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:tuesday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Wed&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">3</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:wednesday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Thu&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">4</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:thursday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Fri&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">5</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:friday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Sat&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">6</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:saturday</span>)
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Sun&quot;</span>
            <span class="ruby-ivar">@wek</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">0</span>)
            <span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value">:sunday</span>)
          <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">repeat_weekly_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">repeat_weekly</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">repeat_weekly</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ss</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Monthly&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">s</span> = <span class="ruby-identifier">week_of_month_for_date</span>(<span class="ruby-identifier">running_date</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:first</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">2</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:second</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">3</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:third</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">&gt;=</span><span class="ruby-value">4</span>
            <span class="ruby-identifier">se</span> = <span class="ruby-value">:last</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
            <span class="ruby-identifier">repeat_monthly_day_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
              <span class="ruby-identifier">repeat_monthly_day</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
              <span class="ruby-identifier">repeat_monthly_day</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
            <span class="ruby-identifier">repeat_monthly_date_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
              <span class="ruby-identifier">repeat_monthly_date</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
              <span class="ruby-identifier">repeat_monthly_date</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">se</span>,<span class="ruby-identifier">info</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Every week (Monday to Friday)&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">every_week_mon_to_fri_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">every_week_mon_to_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">every_week_mon_to_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Every Monday,Wednesday and Friday&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">every_mon_wed_fri_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">every_mon_wed_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">every_mon_wed_fri</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Every Tuesday and Thursday&quot;</span>
        <span class="ruby-identifier">running_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">every_tue_thu_never</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>
            <span class="ruby-identifier">every_tue_thu</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">occ</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-value">7</span>).<span class="ruby-identifier">days</span>
            <span class="ruby-identifier">every_tue_thu</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">events</span>, <span class="ruby-identifier">js_end_date</span>, <span class="ruby-identifier">js_start_date</span>, <span class="ruby-identifier">occ</span>, <span class="ruby-identifier">running_date</span>,<span class="ruby-identifier">info</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">start_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.start_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">end_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.end_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">p_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date.strftime(&quot;%a %m/%d/%Y&quot;)} #{@schedule.start_time.strftime('%I:%M%p')} &amp; #{@schedule.end_time.strftime('%I:%M%p')}&quot;</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{start_date}&quot;</span>, <span class="ruby-value">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{end_date}&quot;</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Camps/Workshop&quot;</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-node">&quot;#{@schedule.start_date} #{@schedule.start_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_time</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">end_date</span> = <span class="ruby-node">&quot;#{@schedule.end_date} #{@schedule.end_time.strftime('%H:%M:00')}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_time</span>.<span class="ruby-identifier">nil?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span><span class="ruby-operator">==</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">end_date</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{start_date}&quot;</span>, <span class="ruby-value">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{end_date}&quot;</span>}
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:start</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{start_date}&quot;</span>, <span class="ruby-value">:end</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{end_date}&quot;</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">schedule_mode</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Any Time&quot;</span>
    <span class="ruby-identifier">any_time</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>)

    <span class="ruby-identifier">any_time</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;mon&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:monday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>

          } }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;tue&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:tuesday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>       <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;wed&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:wednesday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>       <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}
        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;thu&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:thursday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}

        }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;fri&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">:friday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span> <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}  }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sat&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:saturday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span>  <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}   }
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sun&quot;</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:week</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:sunday</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'start'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>),<span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">'end'</span>].<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>))
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">date</span><span class="ruby-operator">|</span> <span class="ruby-identifier">events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">event</span>.<span class="ruby-identifier">user_id</span>}   }
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">business_hours!</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>


  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@schedule</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- schedule_repeat_append-source -->
          
        </div>

        

        
      </div><!-- schedule_repeat_append-method -->

    
      <div id="method-i-search" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>~ #Search results page while clicking the age range link in landing page</p>
          

          
          <div class="method-source-code" id="search-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 4871</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  
  <span class="ruby-comment">#removed the single quotes</span>
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-comment">#profile image changes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@profile_data</span>=<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_profile</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@aa</span>=<span class="ruby-string">'$image_global_path'</span><span class="ruby-operator">+</span><span class="ruby-ivar">@profile_data</span>.<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">url</span>(<span class="ruby-value">:thumb</span>)
    <span class="ruby-ivar">@profile_ig</span>=<span class="ruby-constant">FastImage</span>.<span class="ruby-identifier">size</span>(<span class="ruby-ivar">@aa</span>)
    <span class="ruby-ivar">@p_f</span> = <span class="ruby-ivar">@aa</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@profile_ig</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@profile_ig</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#split the values</span>
  <span class="ruby-identifier">str_a</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:arange</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;-&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:arange</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:arange</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-comment">#age range 0-3 or 4-7</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:arange</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:arange</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:arange</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@arange</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:arange</span>]
    <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities act where act.cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and (lower(act.min_age_range)='#{str_a[0]}' or lower(act.max_age_range) ='#{str_a[1]}') limit 100&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">str_a</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">str_a!</span>=<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
      
  <span class="ruby-comment">#age range 8 and above</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:age</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:age</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:age</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@age</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:age</span>]
    <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities act where act.cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and (lower(act.min_age_range)='#{params[:age].downcase.strip}' or lower(act.max_age_range) &gt;='#{params[:age].downcase.strip}') limit 100&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment">#schedule type camps</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@camps</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]
    <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from activities act where act.cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and lower(act.schedule_mode)='#{params[:camps].downcase.strip}' limit 100&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">act_free</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">60</span>)
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT lower(trim(category))as category&quot;</span>)
  
  <span class="ruby-ivar">@checck</span> = []
  <span class="ruby-ivar">@provider_activites_check</span> =[]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@checck</span> = <span class="ruby-constant">ActivityRow</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;user_id = ? &quot;</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:uid_usr</span>]],<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;row_type&quot;</span>)
    <span class="ruby-ivar">@provider_activites_check</span> =[]
    <span class="ruby-ivar">@checck</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-ivar">@provider_activites_check</span><span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">row_type</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@blog_value</span> = []
  <span class="ruby-identifier">url</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-string">&quot;http://blog.famtivity.com/?feed=rss2&quot;</span>)
  <span class="ruby-identifier">req</span> = <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTP</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">host</span>, <span class="ruby-identifier">url</span>.<span class="ruby-identifier">port</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">req</span>.<span class="ruby-identifier">request_head</span>(<span class="ruby-identifier">url</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;404&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;500&quot;</span>
      <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-identifier">open</span>(<span class="ruby-identifier">url</span>))
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">doc</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">present?</span>
        (<span class="ruby-identifier">doc</span><span class="ruby-operator">/</span><span class="ruby-string">'item'</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">title</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'title'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">desc</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'description'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">link</span> = (<span class="ruby-identifier">node</span><span class="ruby-operator">/</span><span class="ruby-string">'link'</span>).<span class="ruby-identifier">inner_html</span>
          <span class="ruby-identifier">img_srcs</span> = <span class="ruby-identifier">desc</span>[<span class="ruby-regexp">/img.*?src=&quot;(.*?)&quot;/</span>,<span class="ruby-value">1</span>]
          <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">desc</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">title</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/&lt;\/?[^&gt;]*&gt;/</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">dec</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-node">&quot;Continue reading &amp;#8594;&quot;</span>,<span class="ruby-string">&quot;&quot;</span>)
          <span class="ruby-ivar">@blog_value</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-string">&quot;title&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">html_safe</span>, <span class="ruby-string">&quot;description&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">dec</span>.<span class="ruby-identifier">html_safe</span>,<span class="ruby-string">&quot;img&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">img_srcs</span>,<span class="ruby-string">&quot;link&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">link</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exc</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Message for the log file #{exc.message}&quot;</span>)
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:notice</span>] = <span class="ruby-string">&quot;Store error message&quot;</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search-source -->
          
        </div>

        

        
      </div><!-- search-method -->

    
      <div id="method-i-search_activity_all_repeat" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_activity_all_repeat</span><span
            class="method-args">(actv,ss,day_arr,arr)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>if select date range is all and day of the week is selected call this</p>
          

          
          <div class="method-source-code" id="search_activity_all_repeat-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2526</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_activity_all_repeat</span>(<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">ss</span>,<span class="ruby-identifier">day_arr</span>,<span class="ruby-identifier">arr</span>)
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#if schedule, repeat yes</span>
    <span class="ruby-ivar">@repeat</span> = <span class="ruby-constant">ActivityRepeat</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_schedule_id=?&quot;</span>,<span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;schedule_id&quot;</span>]).<span class="ruby-identifier">last</span>
    <span class="ruby-ivar">@schedule_start</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@repeat</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-comment">#start daily</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Daily&quot;</span>
        <span class="ruby-identifier">search_daily_view</span>(<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ss</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Weekly&quot;</span>
        <span class="ruby-identifier">search_weekly_view</span>(<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ss</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Every week (Monday to Friday)&quot;</span>
        <span class="ruby-identifier">search_weekly_view</span>(<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ss</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Every Monday,Wednesday and Friday&quot;</span>
        <span class="ruby-identifier">search_weekly_view</span>(<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ss</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;Every Tuesday and Thursday&quot;</span>
        <span class="ruby-identifier">search_weekly_view</span>(<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ss</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Monthly&quot;</span>
        <span class="ruby-identifier">search_monthly_view</span>(<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ss</span>,<span class="ruby-identifier">day_arr</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeats</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Yearly&quot;</span>
        <span class="ruby-identifier">search_yearly_view</span>(<span class="ruby-ivar">@repeat</span>,<span class="ruby-ivar">@schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">ss</span>,<span class="ruby-identifier">day_arr</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment">#without repeat start camps/workshop</span>
      <span class="ruby-comment">#if start and end date is exist</span>
      <span class="ruby-ivar">@c_date</span> = (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;end_date&quot;</span>].<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;end_date&quot;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
          <span class="ruby-identifier">sch_sdate</span> = <span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
          <span class="ruby-identifier">sch_edate</span> = <span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;end_date&quot;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
          <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sch_sdate</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sch_edate</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
          <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
            <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
                <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
                <span class="ruby-keyword">break</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-comment">#start date is exist and end date is nil</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;end_date&quot;</span>].<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
            <span class="ruby-identifier">sch_date</span>=<span class="ruby-ivar">@schedule</span>[<span class="ruby-string">&quot;start_date&quot;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
            <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sch_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">sch_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
            <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
              <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
                  <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
                  <span class="ruby-keyword">break</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
              <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s_dayval</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">day_</span> = <span class="ruby-identifier">s_dayval</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>]
          <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;activity_id =#{actv.activity_id} and  business_hours='#{day_.downcase}'&quot;</span>).<span class="ruby-identifier">last</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">present?</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment">#inner without repeat end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment"># repeat check loop end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment">#activity dont have schedule eg by appointment</span>
    <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
  <span class="ruby-keyword">end</span>  <span class="ruby-comment">#schedule loop end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_activity_all_repeat-source -->
          
        </div>

        

        
      </div><!-- search_activity_all_repeat-method -->

    
      <div id="method-i-search_advance_curator" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_advance_curator</span><span
            class="method-args">(second_set)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_advance_curator-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 4120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_advance_curator</span>(<span class="ruby-identifier">second_set</span>)

  <span class="ruby-identifier">categories</span> =[]
  <span class="ruby-identifier">categories</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category_1</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category_1</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_sub_category_1</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">day_of_week</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:age_rangera</span>].<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>).<span class="ruby-identifier">reject</span>(&amp;<span class="ruby-value">:empty?</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:age_rangera</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:age_rangera</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">price_value</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_value</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:price_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:price_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_search_ra</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:p_all</span>]<span class="ruby-operator">!=</span> <span class="ruby-string">&quot;p_all&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:a_f</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;free&quot;</span>
      <span class="ruby-identifier">free</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:paid</span>]<span class="ruby-operator">==</span> <span class="ruby-string">&quot;paid&quot;</span>
      <span class="ruby-identifier">paid</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">age_range</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aa_all</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;a_all&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aa_r1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;0-3&quot;</span>
      <span class="ruby-identifier">age_range</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">3</span>).<span class="ruby-identifier">to_a</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aa_r4</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;4-7&quot;</span>
      <span class="ruby-identifier">age_range</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-value">4</span><span class="ruby-operator">..</span><span class="ruby-value">7</span>).<span class="ruby-identifier">to_a</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:aa_r8</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;8-15&quot;</span>
      <span class="ruby-identifier">age_range</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-value">8</span><span class="ruby-operator">..</span><span class="ruby-value">99</span>).<span class="ruby-identifier">to_a</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camp_range_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;camp&quot;</span>
    <span class="ruby-identifier">camp</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">special</span> = []
  <span class="ruby-identifier">special</span> = <span class="ruby-ivar">@special</span>
  <span class="ruby-identifier">start_date</span> =<span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">age_range_flat</span> = <span class="ruby-identifier">age_range</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-identifier">end_date</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
  <span class="ruby-identifier">start_date</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:start_dates</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:start_dates</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:start_dates</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">end_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_dates</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:end_dates</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_dates</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-ivar">@search</span> = <span class="ruby-constant">Sunspot</span>.<span class="ruby-identifier">search</span>(<span class="ruby-constant">Activity</span>,<span class="ruby-constant">User</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">fulltext</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>] <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">query_phrase_slop</span> <span class="ruby-value">1</span>
      <span class="ruby-comment"># minimum_match 1</span>
      <span class="ruby-identifier">phrase_fields</span> <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>,<span class="ruby-value">:user_profile_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">9</span>,<span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>
      <span class="ruby-identifier">fields</span>(<span class="ruby-value">:city=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value">:user_profile_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value">:tags_txt=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">categories</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">categories</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">with</span>(<span class="ruby-value">:sub_category_lower</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">downcase</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">order_by_geodist</span>(<span class="ruby-value">:location</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>], <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;provider&quot;</span>
    <span class="ruby-comment">#        if (cookies[:latitude].present? &amp;&amp; cookies[:longitude].present?)</span>
    <span class="ruby-comment">#          with(:location).in_radius(cookies[:latitude], cookies[:longitude], 5, :bbox =&gt; false)</span>
    <span class="ruby-comment">#        end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">free</span>
      <span class="ruby-identifier">with</span>(<span class="ruby-value">:price_type</span>,<span class="ruby-value">3</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#calls on camp&amp;works shop search</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">camp</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">without</span>(<span class="ruby-value">:schedule_mode</span>,<span class="ruby-string">'Schedule'</span>)
      <span class="ruby-identifier">without</span>(<span class="ruby-value">:schedule_mode</span>,<span class="ruby-string">'Any Time'</span>)
      <span class="ruby-identifier">without</span>(<span class="ruby-value">:schedule_mode</span>,<span class="ruby-string">'By Appointment'</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#calls on when</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">paid</span>
      <span class="ruby-identifier">without</span>(<span class="ruby-value">:price_type</span>,<span class="ruby-value">3</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">special</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">special</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">with</span>(<span class="ruby-value">:activity_id</span>, <span class="ruby-identifier">s</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:start_dates</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:start_dates</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:end_dates</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_dates</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">all_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">with</span>(<span class="ruby-value">:start_date</span>).<span class="ruby-identifier">greater_than_or_equal_to</span> <span class="ruby-identifier">start_date</span>
        <span class="ruby-identifier">with</span>(<span class="ruby-value">:expiration_date</span>).<span class="ruby-identifier">less_than_or_equal_to</span> <span class="ruby-identifier">end_date</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:start_dates</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:start_dates</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">with</span> <span class="ruby-value">:start_date</span>, <span class="ruby-identifier">start_date</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:end_dates</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:end_dates</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">with</span> <span class="ruby-value">:expiration_date</span>, <span class="ruby-identifier">end_date</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">with</span> <span class="ruby-value">:expiration_date</span>, <span class="ruby-keyword">nil</span>
        <span class="ruby-identifier">all_of</span> <span class="ruby-keyword">do</span>
          <span class="ruby-identifier">with</span>(<span class="ruby-value">:expiration_date</span>).<span class="ruby-identifier">greater_than_or_equal_to</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">day_of_week</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">with</span>(<span class="ruby-value">:repeat_on</span>,<span class="ruby-string">'Daily'</span>)
        <span class="ruby-identifier">day_of_week</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">with</span>(<span class="ruby-value">:repeat_on</span>,<span class="ruby-identifier">d</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">age_range_flat</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-comment"># with(:max_age_range,'Adults')</span>
      <span class="ruby-comment">#with(:min_age_range,'Adults')</span>
      <span class="ruby-identifier">with</span>(<span class="ruby-value">:max_age_range</span>).<span class="ruby-identifier">any_of</span>(<span class="ruby-identifier">age_range_flat</span>)
      <span class="ruby-identifier">with</span>(<span class="ruby-value">:min_age_range</span>).<span class="ruby-identifier">any_of</span>(<span class="ruby-identifier">age_range_flat</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#check provider activities in search</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;provider&quot;</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">with</span>(<span class="ruby-value">:created_by</span>, <span class="ruby-string">&quot;Provider&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">order_by</span> <span class="ruby-value">:recent_date</span>,<span class="ruby-value">:desc</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#      if second_set == &quot;1&quot;</span>
    <span class="ruby-comment">#        with :user_plan,&quot;sell&quot;</span>
    <span class="ruby-comment">#      end</span>
    <span class="ruby-comment">#      if second_set == &quot;2&quot;</span>
    <span class="ruby-comment">#        without :user_plan,&quot;sell&quot;</span>
    <span class="ruby-comment">#      end</span>
   

    <span class="ruby-comment">#  facet(:user_id)</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:city_lower</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:city_name</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:zip_code</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value_name</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value_name</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter city (or) Zip code&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value_name</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value_name</span>].<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/^[0-9]+$/</span>).<span class="ruby-identifier">blank?</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:gender</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>] <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:gender</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;g_all&quot;</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:user_id</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;provider&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:show_card</span>,<span class="ruby-keyword">true</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:cleaned</span>,<span class="ruby-keyword">true</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:active_status</span>, <span class="ruby-string">&quot;Active&quot;</span>
    <span class="ruby-identifier">paginate</span> <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>, <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">25</span>
  
    <span class="ruby-identifier">order_by</span> <span class="ruby-value">:user_plan</span>,<span class="ruby-value">:desc</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;provider&quot;</span>
    <span class="ruby-comment">#order_by :score, :desc</span>
    <span class="ruby-comment">#order_by :activity_name, :asc</span>
  <span class="ruby-keyword">end</span>




<span class="ruby-keyword">end</span></pre>
          </div><!-- search_advance_curator-source -->
          
        </div>

        

        
      </div><!-- search_advance_curator-method -->

    
      <div id="method-i-search_by_keyword" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_by_keyword</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>search using keyword</p>
          

          
          <div class="method-source-code" id="search_by_keyword-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 4647</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_by_keyword</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-string">'near_cities'</span>] = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@keyword</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">'?ws=1'</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'['</span>,<span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">']'</span>,<span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">'&quot;'</span>,<span class="ruby-string">''</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;Search 20,000 + Local Activities &amp; Counting...&quot;</span>
  <span class="ruby-ivar">@keyword</span> = <span class="ruby-string">''</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Search 20,000   Local Activities &amp; Counting...&quot;</span>
  <span class="ruby-ivar">@search_city</span> = (<span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] <span class="ruby-operator">:</span> <span class="ruby-string">&quot;Walnut Creek&quot;</span>)
  <span class="ruby-ivar">@search_city_details</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;city_name=?&quot;</span>,<span class="ruby-ivar">@search_city</span>.<span class="ruby-identifier">titlecase</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@search_city_details</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@search_city_details</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;lower(city_name)=?&quot;</span>,<span class="ruby-string">&quot;walnut creek&quot;</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">a_coord</span>=[]
  <span class="ruby-identifier">a_coord</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@search_city_details</span>.<span class="ruby-identifier">latitude</span>
  <span class="ruby-identifier">a_coord</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@search_city_details</span>.<span class="ruby-identifier">longitude</span>
  <span class="ruby-identifier">nearby_cities</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">near</span>(<span class="ruby-identifier">a_coord</span>, <span class="ruby-value">15</span>, <span class="ruby-value">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:distance</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:city_name</span>)
  <span class="ruby-identifier">nearby_cities</span> = <span class="ruby-identifier">nearby_cities</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;(&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;)&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\&quot;&quot;</span>,<span class="ruby-string">&quot;'&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">nearby_cities</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">nearby_cities!</span>=<span class="ruby-string">''</span>
    <span class="ruby-identifier">search_city</span> = <span class="ruby-node">&quot;(act.city in #{nearby_cities} or act.city = '')&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">search_city</span> = <span class="ruby-node">&quot;(act.city like '%#{@search_city}%' or act.city = '')&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:test_city</span>] = <span class="ruby-identifier">search_city</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:cat_zc</span>]=<span class="ruby-string">&quot;date&quot;</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#removed the single quotes</span>
  <span class="ruby-ivar">@parent_keyword</span> = <span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;'&quot;</span>,<span class="ruby-string">&quot;&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@keyword</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-comment">#split the values and age range with search text</span>
  <span class="ruby-ivar">@sp_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_dollor</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_dollor</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_dollor</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@last_value</span>=<span class="ruby-string">&quot;discount_dollor&quot;</span>
    <span class="ruby-comment">#~ if @parent_keyword &amp;&amp; params[:discount_dollor] &amp;&amp; !params[:discount_dollor].nil? &amp;&amp; @parent_keyword!=&quot;Search 20,000   Local Activities &amp; Counting...&quot;</span>
    <span class="ruby-comment">#~ act_free_dd = Activity.find_by_sql(&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and (act.price_type ='1' or act.price_type ='2') and cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and (act.discount_eligible IS NOT NULL) and (lower(act.activity_name) like '%#{@parent_keyword}%' or lower(act.category) like '%#{@parent_keyword}%' or lower(act.sub_category) like '%#{@parent_keyword}%' or lower(act.description) like '%#{@parent_keyword}%' or lower(act.city) like '%#{@parent_keyword}%' and cleaned=true and lower(act.active_status)='active') order by act.activity_id desc&quot;) if params[:discount_dollor]!=nil &amp;&amp; params[:discount_dollor]!='' &amp;&amp; !@parent_keyword.nil?</span>
    <span class="ruby-comment">#~ sorted_arr = ((!act_free_dd.group_by(&amp;:city)[@search_city].nil?) ? act_free_dd.group_by(&amp;:city)[@search_city] : []) #Group by city</span>
    <span class="ruby-comment">#~ other_sorted_arr = !act_free_dd.blank? &amp;&amp; !sorted_arr.blank? ? act_free_dd-sorted_arr : [] #To get activity apart from selected city</span>
                      <span class="ruby-comment">#~ if (!sorted_arr.nil? &amp;&amp; sorted_arr.length &gt; 0 ) &amp;&amp; (!other_sorted_arr.nil? &amp;&amp; other_sorted_arr.length &gt; 0 )</span>
    <span class="ruby-comment">#~ act_free = sorted_arr + other_sorted_arr</span>
                      <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#~ act_free = act_free_dd</span>
                      <span class="ruby-comment">#~ end</span>
                      <span class="ruby-comment">#~ search_city_result = act_free</span>
    <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#only for discount_dollor</span>
    <span class="ruby-identifier">act_free_dd</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and cleaned=true and lower(act.active_status)='active' and (act.price_type ='1' or act.price_type ='2') and act_sch.expiration_date &gt;= '#{Date.today}' and lower(act.created_by)='provider' and (act.discount_eligible IS NOT NULL) order by act.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_dollor</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:discount_dollor</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-identifier">sorted_arr</span> = ((<span class="ruby-operator">!</span><span class="ruby-identifier">act_free_dd</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_dd</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>] <span class="ruby-operator">:</span> []) <span class="ruby-comment">#Group by city</span>
    <span class="ruby-identifier">other_sorted_arr</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">act_free_dd</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_dd</span><span class="ruby-operator">-</span><span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">:</span> [] <span class="ruby-comment">#To get activity apart from selected city</span>
                      <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> ) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">other_sorted_arr</span>    
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">act_free_dd</span>
                      <span class="ruby-keyword">end</span>
                      <span class="ruby-identifier">search_city_result</span> = <span class="ruby-identifier">act_free</span>
    <span class="ruby-comment">#~ end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@camps</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]
    <span class="ruby-ivar">@last_value</span>=<span class="ruby-string">&quot;camps&quot;</span>
    <span class="ruby-comment">#~ if @parent_keyword &amp;&amp; params[:camps] &amp;&amp; !params[:camps].nil? &amp;&amp; @parent_keyword!=&quot;Search 20,000   Local Activities &amp; Counting...&quot;</span>
    <span class="ruby-comment">#~ act_free_camp = Activity.find_by_sql(&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and act.cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and (lower(act.schedule_mode)='#{params[:camps].downcase.strip}' or ((act.sub_category)='Camps')or ((act.camps)=true)) and (lower(act.activity_name) like '%#{@parent_keyword}%' or lower(act.category) like '%#{@parent_keyword}%' or lower(act.sub_category) like '%#{@parent_keyword}%' or lower(act.description) like '%#{@parent_keyword}%' or lower(act.city) like '%#{@parent_keyword}%' and cleaned=true and lower(act.active_status)='active') order by act.activity_id desc&quot;) if params[:camps]!=nil &amp;&amp; params[:camps]!='' &amp;&amp; !@parent_keyword.nil?</span>
    <span class="ruby-comment">#~ sorted_arr = ((!act_free_camp.group_by(&amp;:city)[@search_city].nil?) ? act_free_camp.group_by(&amp;:city)[@search_city] : []) #Group by city</span>
    <span class="ruby-comment">#~ other_sorted_arr = !act_free_camp.blank? &amp;&amp; !sorted_arr.blank? ? act_free_camp-sorted_arr : [] #To get activity apart from selected city</span>
                      <span class="ruby-comment">#~ if (!sorted_arr.nil? &amp;&amp; sorted_arr.length &gt; 0 ) &amp;&amp; (!other_sorted_arr.nil? &amp;&amp; other_sorted_arr.length &gt; 0 )</span>
    <span class="ruby-comment">#~ act_free = sorted_arr + other_sorted_arr</span>
                      <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#~ act_free = act_free_camp</span>
                      <span class="ruby-comment">#~ end</span>
                      <span class="ruby-comment">#~ search_city_result = act_free</span>
    <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#only for camps</span>
    <span class="ruby-identifier">act_free_camp</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and act.cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and (lower(act.schedule_mode)='#{params[:camps].downcase.strip}' or ((act.sub_category)='Camps')or ((act.camps)=true)) order by act.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camps</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-identifier">sorted_arr</span> = ((<span class="ruby-operator">!</span><span class="ruby-identifier">act_free_camp</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_camp</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>] <span class="ruby-operator">:</span> []) <span class="ruby-comment">#Group by city</span>
    <span class="ruby-identifier">other_sorted_arr</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">act_free_camp</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_camp</span><span class="ruby-operator">-</span><span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">:</span> [] <span class="ruby-comment">#To get activity apart from selected city</span>
                      <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> ) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">other_sorted_arr</span>    
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">act_free_camp</span>
                      <span class="ruby-keyword">end</span>
                      <span class="ruby-identifier">search_city_result</span> = <span class="ruby-identifier">act_free</span>
    <span class="ruby-comment">#~ end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@f_specials</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>]
    <span class="ruby-ivar">@last_value</span>=<span class="ruby-string">&quot;specials&quot;</span>
    <span class="ruby-comment">#~ if @parent_keyword &amp;&amp; params[:specials] &amp;&amp; !params[:specials].nil? &amp;&amp; @parent_keyword!=&quot;Search 20,000   Local Activities &amp; Counting...&quot;</span>
    <span class="ruby-comment">#~ @act_free=[]</span>
    <span class="ruby-comment">#~ @all_act=[]</span>
    <span class="ruby-comment">#~ act_free_spl =  Activity.find_by_sql(&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id left join activity_prices p on act.activity_id=p.activity_id left join activity_discount_prices d</span>
    <span class="ruby-comment">#~ on d.activity_price_id=p.activity_price_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}'  and cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and (((act.price_type='1') or (act.price_type='2')) and</span>
    <span class="ruby-comment">#~ ((date(d.discount_valid) &gt;= '#{Date.today}') or (d.discount_valid is null and d.discount_price is not null)) and (lower(act.activity_name) like '%#{@parent_keyword}%' or lower(act.category) like '%#{@parent_keyword}%' or lower(act.sub_category) like '%#{@parent_keyword}%' or lower(act.description)</span>
    <span class="ruby-comment">#~ like '%#{@parent_keyword}%' or lower(act.city) like '%#{@parent_keyword}%')) order by act.activity_id desc&quot;)</span>
    <span class="ruby-comment">#~ sorted_arr = ((!act_free_spl.group_by(&amp;:city)[@search_city].nil?) ? act_free_spl.group_by(&amp;:city)[@search_city] : []) #Group by city</span>
    <span class="ruby-comment">#~ other_sorted_arr = !act_free_spl.blank? &amp;&amp; !sorted_arr.blank? ? act_free_spl-sorted_arr : [] #To get activity apart from selected city</span>
                      <span class="ruby-comment">#~ if (!sorted_arr.nil? &amp;&amp; sorted_arr.length &gt; 0 ) &amp;&amp; (!other_sorted_arr.nil? &amp;&amp; other_sorted_arr.length &gt; 0 )</span>
    <span class="ruby-comment">#~ act_free = sorted_arr + other_sorted_arr</span>
                      <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#~ act_free = act_free_spl</span>
                      <span class="ruby-comment">#~ end</span>
                      <span class="ruby-comment">#~ search_city_result = act_free</span>
    <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#only for specials</span>
    <span class="ruby-ivar">@act_free</span>=[]
    <span class="ruby-ivar">@all_act</span>=[]
    <span class="ruby-identifier">act_free_spl</span> =  <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id left join activity_prices p on act.activity_id=p.activity_id left join activity_discount_prices d
                              on d.activity_price_id=p.activity_price_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and (((act.price_type='1') or (act.price_type='2')) and 
                              ((date(d.discount_valid) &gt;= '#{Date.today}') or (d.discount_valid is null and d.discount_price is not null))) order by act.activity_id desc&quot;</span>)
    <span class="ruby-identifier">sorted_arr</span> = ((<span class="ruby-operator">!</span><span class="ruby-identifier">act_free_spl</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_spl</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>] <span class="ruby-operator">:</span> []) <span class="ruby-comment">#Group by city</span>
    <span class="ruby-identifier">other_sorted_arr</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">act_free_spl</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_spl</span><span class="ruby-operator">-</span><span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">:</span> [] <span class="ruby-comment">#To get activity apart from selected city</span>
                      <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> ) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">other_sorted_arr</span>    
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">act_free_spl</span>
                      <span class="ruby-keyword">end</span>
                      <span class="ruby-identifier">search_city_result</span> = <span class="ruby-identifier">act_free</span>
    <span class="ruby-comment">#~ end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@f_specials</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>]
    <span class="ruby-ivar">@last_value</span>=<span class="ruby-string">&quot;free&quot;</span>
    <span class="ruby-comment">#~ if @parent_keyword &amp;&amp; params[:free] &amp;&amp; !params[:free].nil? &amp;&amp; @parent_keyword!=&quot;Search 20,000   Local Activities &amp; Counting...&quot;</span>
    <span class="ruby-comment">#~ act_quick_free = Activity.find_by_sql(&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and act.price_type='3' and (lower(act.activity_name) like '%#{@parent_keyword}%' or lower(act.category) like '%#{@parent_keyword}%' or lower(act.sub_category) like '%#{@parent_keyword}%' or lower(act.description) like '%#{@parent_keyword}%' or lower(act.city) like '%#{@parent_keyword}%' and cleaned=true and lower(act.active_status)='active') order by act.activity_id desc&quot;) if params[:free]!=nil &amp;&amp; params[:free]!='' &amp;&amp; !@parent_keyword.nil?</span>
    <span class="ruby-comment">#~ sorted_arr = ((!act_quick_free.group_by(&amp;:city)[@search_city].nil?) ? act_quick_free.group_by(&amp;:city)[@search_city] : []) #Group by city</span>
    <span class="ruby-comment">#~ other_sorted_arr = !act_quick_free.blank? || !sorted_arr.blank? ? act_quick_free-sorted_arr : [] #To get activity apart from selected city</span>
                      <span class="ruby-comment">#~ if (!sorted_arr.nil? &amp;&amp; sorted_arr.length &gt; 0 ) &amp;&amp; (!other_sorted_arr.nil? &amp;&amp; other_sorted_arr.length &gt; 0 )</span>
    <span class="ruby-comment">#~ act_free = sorted_arr + other_sorted_arr</span>
                      <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#~ act_free = act_quick_free</span>
                      <span class="ruby-comment">#~ end</span>
                      <span class="ruby-comment">#~ search_city_result = act_free</span>
    <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#only for free</span>
    <span class="ruby-identifier">act_quick_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and act.price_type='3' order by act.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-identifier">sorted_arr</span> = ((<span class="ruby-operator">!</span><span class="ruby-identifier">act_quick_free</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">act_quick_free</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>] <span class="ruby-operator">:</span> []) <span class="ruby-comment">#Group by city</span>
    <span class="ruby-identifier">other_sorted_arr</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">act_quick_free</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">act_quick_free</span><span class="ruby-operator">-</span><span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">:</span> [] <span class="ruby-comment">#To get activity apart from selected city</span>
                      <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> ) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">other_sorted_arr</span>    
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">act_quick_free</span>
                      <span class="ruby-keyword">end</span>
                      <span class="ruby-identifier">search_city_result</span> = <span class="ruby-identifier">act_free</span>
    <span class="ruby-comment">#~ end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specialneeds</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specialneeds</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:specialneeds</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@camps</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:specialneeds</span>]
    <span class="ruby-ivar">@last_value</span>=<span class="ruby-string">&quot;specialneeds&quot;</span>
    <span class="ruby-comment">#~ if @parent_keyword &amp;&amp; params[:specialneeds] &amp;&amp; !params[:specialneeds].nil? &amp;&amp; @parent_keyword!=&quot;Search 20,000   Local Activities &amp; Counting...&quot;</span>
    <span class="ruby-comment">#~ act_free_camp = Activity.find_by_sql(&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and act.cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and ((lower(act.sub_category)='special needs')or((act.special_needs)=true)) and (lower(act.activity_name) like '%#{@parent_keyword}%' or lower(act.category) like '%#{@parent_keyword}%' or lower(act.sub_category) like '%#{@parent_keyword}%' or lower(act.description) like '%#{@parent_keyword}%' or lower(act.city) like '%#{@parent_keyword}%' and cleaned=true and lower(act.active_status)='active') order by act.activity_id desc&quot;) if params[:specialneeds]!=nil &amp;&amp; params[:specialneeds]!='' &amp;&amp; !@parent_keyword.nil?</span>
    <span class="ruby-comment">#~ sorted_arr = ((!act_free_camp.group_by(&amp;:city)[@search_city].nil?) ? act_free_camp.group_by(&amp;:city)[@search_city] : []) #Group by city</span>
    <span class="ruby-comment">#~ other_sorted_arr = !act_free_camp.blank? &amp;&amp; !sorted_arr.blank? ? act_free_camp-sorted_arr : [] #To get activity apart from selected city</span>
                      <span class="ruby-comment">#~ if (!sorted_arr.nil? &amp;&amp; sorted_arr.length &gt; 0 ) &amp;&amp; (!other_sorted_arr.nil? &amp;&amp; other_sorted_arr.length &gt; 0 )</span>
    <span class="ruby-comment">#~ act_free = sorted_arr + other_sorted_arr</span>
                      <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#~ act_free = act_free_camp</span>
                      <span class="ruby-comment">#~ end</span>
                      <span class="ruby-comment">#~ search_city_result = act_free</span>
    <span class="ruby-comment">#~ else</span>
    <span class="ruby-comment">#only for specialneeds</span>
    <span class="ruby-identifier">act_free_camp</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and act_sch.expiration_date &gt;= '#{Date.today}' and act.cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and ((lower(act.sub_category)='special needs')or((act.special_needs)=true)) order by act.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specialneeds</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specialneeds</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span>
    <span class="ruby-identifier">sorted_arr</span> = ((<span class="ruby-operator">!</span><span class="ruby-identifier">act_free_camp</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_camp</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>] <span class="ruby-operator">:</span> []) <span class="ruby-comment">#Group by city</span>
    <span class="ruby-identifier">other_sorted_arr</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">act_free_camp</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free_camp</span><span class="ruby-operator">-</span><span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">:</span> [] <span class="ruby-comment">#To get activity apart from selected city</span>
                      <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> ) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">other_sorted_arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> )
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">other_sorted_arr</span>                    
                      <span class="ruby-keyword">else</span>
                              <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">act_free_camp</span>
                      <span class="ruby-keyword">end</span>
                      <span class="ruby-identifier">search_city_result</span> = <span class="ruby-identifier">act_free</span>
    <span class="ruby-comment">#~ end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:week</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:week</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:week</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@last_value</span>=<span class="ruby-string">&quot;weekend&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">$week_act_free</span>=<span class="ruby-string">''</span>
      <span class="ruby-identifier">arr</span> = []
      <span class="ruby-ivar">@arr</span>= []
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:free</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@parent_keyword</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;Search 20,000   Local Activities &amp; Counting...&quot;</span>
        <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">weekend_activities</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@parent_keyword</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">weekend_activities</span>(<span class="ruby-identifier">arr</span>,<span class="ruby-ivar">@parent_keyword</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-ivar">@arr</span> = <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">uniq</span>
        <span class="ruby-ivar">@bb</span>=<span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;[&quot;</span>,<span class="ruby-string">&quot;(&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;]&quot;</span>,<span class="ruby-string">&quot;)&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@arr</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_schedules act_sch on act.activity_id=act_sch.activity_id where #{search_city} and cleaned=true and lower(act.active_status)='active' and lower(act.created_by)='provider' and act.activity_id in #{@bb} order by act.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@bb</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@bb</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">sorted_arr</span> = ((<span class="ruby-operator">!</span><span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>].<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">group_by</span>(&amp;<span class="ruby-value">:city</span>)[<span class="ruby-ivar">@search_city</span>] <span class="ruby-operator">:</span> []) <span class="ruby-comment">#Group by city</span>
        <span class="ruby-identifier">other_sorted_arr</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sorted_arr</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">act_free</span><span class="ruby-operator">-</span><span class="ruby-identifier">sorted_arr</span> <span class="ruby-operator">:</span> [] <span class="ruby-comment">#To get activity apart from selected city</span>
        <span class="ruby-identifier">$week_act_free</span> = <span class="ruby-identifier">act_free</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
        <span class="ruby-identifier">act_free</span> = <span class="ruby-identifier">$week_act_free</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$week_act_free</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">$week_act_free</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@search_tu</span> = <span class="ruby-string">&quot;yes&quot;</span>
  <span class="ruby-ivar">@search_count</span> = <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@activity_free</span> = <span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">12</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">act_free</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@tpage</span> = <span class="ruby-ivar">@activity_free</span>.<span class="ruby-identifier">total_pages</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_free</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_free</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@cpage</span> = <span class="ruby-ivar">@activity_free</span>.<span class="ruby-identifier">current_page</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_free</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@activity_free</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT trim(category) as category&quot;</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;lower(category)!=?&quot;</span>,<span class="ruby-string">'default'</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
          <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>{<span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
            <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
          <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
            <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
          <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- search_by_keyword-source -->
          
        </div>

        

        
      </div><!-- search_by_keyword-method -->

    
      <div id="method-i-search_curator" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_curator</span><span
            class="method-args">(second_set)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_curator-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3461</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_curator</span>(<span class="ruby-identifier">second_set</span>)

  <span class="ruby-ivar">@search</span> = <span class="ruby-constant">Sunspot</span>.<span class="ruby-identifier">search</span>(<span class="ruby-constant">Activity</span>,<span class="ruby-constant">User</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">fulltext</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>] <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">query_phrase_slop</span> <span class="ruby-value">1</span>
      <span class="ruby-comment"># minimum_match 1</span>
      <span class="ruby-identifier">phrase_fields</span> <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>,<span class="ruby-value">:user_profile_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">9</span>,<span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>
      <span class="ruby-identifier">fields</span>(<span class="ruby-value">:city=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value">:user_profile_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value">:tags_txt=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">order_by_geodist</span>(<span class="ruby-value">:location</span>, <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>], <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>])
    <span class="ruby-comment">#with(:location).near(37,-122,:boost =&gt; 2, :precision =&gt; 6)</span>

    <span class="ruby-comment">#with(:location).in_radius(37, -122, 100, :bbox =&gt; true)</span>
    <span class="ruby-comment"># with(:location).in_radius(cookies[:latitude], cookies[:longitude], 500)</span>

    <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">with</span> <span class="ruby-value">:expiration_date</span>, <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">all_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-comment">#          #with(:start_date).greater_than_or_equal_to Date.today</span>
        <span class="ruby-identifier">with</span>(<span class="ruby-value">:expiration_date</span>).<span class="ruby-identifier">greater_than_or_equal_to</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#      if second_set == &quot;1&quot;</span>
    <span class="ruby-comment">#        with :user_plan,&quot;sell&quot;</span>
    <span class="ruby-comment">#      end</span>
    <span class="ruby-comment">#      if second_set == &quot;2&quot;</span>
    <span class="ruby-comment">#        without :user_plan,&quot;sell&quot;</span>
    <span class="ruby-comment">#      end</span>

    <span class="ruby-comment">#without :user_plan,&quot;free&quot;</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:show_card</span>,<span class="ruby-keyword">true</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:cleaned</span>,<span class="ruby-keyword">true</span>
    <span class="ruby-identifier">with</span> <span class="ruby-value">:active_status</span>, <span class="ruby-string">&quot;Active&quot;</span>
    <span class="ruby-identifier">paginate</span> <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>, <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">30</span>
    <span class="ruby-comment">#order_by :score, :desc</span>
    <span class="ruby-comment"># order_by_geodist(:location, cookies[:latitude], cookies[:longitude])</span>
    <span class="ruby-identifier">order_by</span> <span class="ruby-value">:user_plan</span>,<span class="ruby-value">:desc</span>
    <span class="ruby-comment"># adjust_solr_params { |p| p[:defType] = 'edismax' }</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@search</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">record</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">user_setting</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Activity</span>
      <span class="ruby-identifier">user</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id = #{record.user_id}&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-identifier">user_p</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id = #{record.user_id}&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@flag</span>
        <span class="ruby-ivar">@events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:w_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;activity&quot;</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:city=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">city</span>,<span class="ruby-value">:w_activity_name=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">activity_name</span>,<span class="ruby-value">:w_provider_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">business_name</span>,<span class="ruby-value">:w_city=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">city</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:provider_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">business_name</span>, <span class="ruby-value">:length</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">25</span>),<span class="ruby-value">:pass_value=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>],<span class="ruby-value">:activity_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:length</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">25</span>),<span class="ruby-value">:w_plan_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_p</span>.<span class="ruby-identifier">user_plan</span> , <span class="ruby-value">:data=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:value=</span><span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{record.activity_name} &quot;</span>  <span class="ruby-operator">+</span> <span class="ruby-node">&quot; #{user.business_name} &quot;</span><span class="ruby-operator">+</span> <span class="ruby-node">&quot; #{record.city}&quot;</span>,<span class="ruby-value">:w_slug</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">slug</span>, <span class="ruby-value">:up_slug</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">slug</span>} <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">slug</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">business_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">user</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id = #{record.user_id}&quot;</span>).<span class="ruby-identifier">last</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@flag</span>
        <span class="ruby-ivar">@events</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:w_class=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;user&quot;</span>,<span class="ruby-value">:w_provider_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">business_name</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">record</span>.<span class="ruby-identifier">user_id</span>,<span class="ruby-value">:provider_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">user</span>.<span class="ruby-identifier">business_name</span>, <span class="ruby-value">:length</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">25</span>),<span class="ruby-value">:w_plan_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">user_plan</span> , <span class="ruby-value">:pass_value=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:query</span>],<span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{user.city}&quot;</span>,<span class="ruby-value">:w_city=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{user.city}&quot;</span>, <span class="ruby-value">:data=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:value=</span><span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot; #{user.business_name}&quot;</span> } <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">business_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">user</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  }

<span class="ruby-keyword">end</span></pre>
          </div><!-- search_curator-source -->
          
        </div>

        

        
      </div><!-- search_curator-method -->

    
      <div id="method-i-search_daily_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_daily_view</span><span
            class="method-args">(repeat,schedule,actv,arr,days)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>search page daily repeat functionality</p>
          

          
          <div class="method-source-code" id="search_daily_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2615</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_daily_view</span>(<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">days</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-identifier">schedule</span>
  <span class="ruby-comment">#if daily and ends never true</span>
 
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">s_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
            <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
            <span class="ruby-keyword">break</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if Daily and ends on exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
              <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if Daily and end occurences exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">e_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">days</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">e_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
              <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  

  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_daily_view-source -->
          
        </div>

        

        
      </div><!-- search_daily_view-method -->

    
      <div id="method-i-search_event_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_event_index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="search_event_index-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3966</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_event_index</span>
  <span class="ruby-ivar">@fam_city</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:city_name</span>) 
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">city_se</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;city_name='#{cookies[:search_city]}'&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">latitude</span>
      <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-identifier">city_se</span>.<span class="ruby-identifier">longitude</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:zip_value</span>] <span class="ruby-operator">!=</span><span class="ruby-string">&quot;Enter city (or) Zip code&quot;</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>]<span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-identifier">re_times</span> = <span class="ruby-value">5</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">location</span> = <span class="ruby-constant">Geocoder</span>.<span class="ruby-identifier">search</span>(<span class="ruby-node">&quot;#{params[:zip_value]}&quot;</span>).<span class="ruby-identifier">first</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">latitude</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">longitude</span>
        <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-identifier">location</span>.<span class="ruby-identifier">city</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0.0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-value">37.9100783</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-value">-122.0651819</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">location</span>.<span class="ruby-identifier">city</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">location</span>.<span class="ruby-identifier">city!</span>=<span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">ci_se</span> = <span class="ruby-constant">City</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;lower(city_name) like '%#{cookies[:search_city].downcase}%'&quot;</span>).<span class="ruby-identifier">last</span>
          <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ci_se</span>.<span class="ruby-identifier">nil?</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-identifier">ci_se</span>.<span class="ruby-identifier">latitude</span>
            <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-identifier">ci_se</span>.<span class="ruby-identifier">longitude</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-identifier">re_times</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">re_times</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
          <span class="ruby-keyword">retry</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-value">37.9100783</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-value">-122.0651819</span>
          <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] <span class="ruby-operator">==</span> <span class="ruby-value">0.0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:latitude</span>] = <span class="ruby-value">37.9100783</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:longitude</span>] = <span class="ruby-value">-122.0651819</span>
    <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:search_city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span>
  <span class="ruby-keyword">end</span>


  <span class="ruby-identifier">special</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:camp_range_1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;specials&quot;</span>
    <span class="ruby-identifier">acc_special</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot; select distinct a.* from activities a
  left join activity_prices p on a.activity_id=p.activity_id
  right join activity_discount_prices d on d.activity_price_id=p.activity_price_id
  where cleaned=true and lower(active_status)='active' and
  (lower(d.discount_type)='early bird discount' and d.discount_valid &gt;= '#{Date.today}') or (lower(d.discount_type)!='early bird discount' )&quot;</span>)
    <span class="ruby-ivar">@special</span> = <span class="ruby-identifier">acc_special</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:activity_id</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@f_specials</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@parent_keyword</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_prices p on act.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id where #{search_city} and cleaned=true and lower(active_status)='active' and act.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@sp_date}') or (lower(d.discount_type)!='early bird discount') and (lower(act.activity_name) like '%#{@parent_keyword}%' or lower(act.category) like '%#{@parent_keyword}%' or lower(act.sub_category) like '%#{@parent_keyword}%' or lower(act.description) like '%#{@parent_keyword}%' or lower(act.city) like '%#{@parent_keyword}%') order by act.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:specials</span>]<span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@parent_keyword</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">act_free</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct act.* from activities act left join activity_prices p on act.activity_id=p.activity_id left join activity_discount_prices d on d.activity_price_id=p.activity_price_id where #{search_city} and cleaned=true and lower(active_status)='active' and act.price_type='1' and(lower(d.discount_type)='early bird discount' and date(d.discount_valid) &gt;= '#{@sp_date}') or (lower(d.discount_type)!='early bird discount') order by act.activity_id desc&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@sp_date</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

      
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_search_value</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_search_value</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-value">:ad_search_value</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:week</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-identifier">week</span> = []
    <span class="ruby-identifier">week</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">end_of_week</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">day</span>
    <span class="ruby-identifier">week</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">end_of_week</span>
    <span class="ruby-ivar">@search</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">search</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">keywords</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>] <span class="ruby-keyword">do</span>
        <span class="ruby-comment">#query_phrase_slop 1</span>
        <span class="ruby-identifier">minimum_match</span> <span class="ruby-value">1</span>
        <span class="ruby-identifier">phrase_fields</span> <span class="ruby-value">:user_profile_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">9</span>,<span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>
        <span class="ruby-identifier">fields</span>(<span class="ruby-value">:city=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>,<span class="ruby-value">:user_profile_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">any_of</span> <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">with</span>(<span class="ruby-value">:start_date</span>, <span class="ruby-keyword">nil</span>)
        <span class="ruby-identifier">all_of</span> <span class="ruby-keyword">do</span>
          <span class="ruby-identifier">week</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">with</span>(<span class="ruby-value">:start_date</span>, <span class="ruby-identifier">w</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">paginate</span> <span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1</span>, <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">25</span>
      <span class="ruby-identifier">with</span> <span class="ruby-value">:cleaned</span>,<span class="ruby-keyword">true</span>
      <span class="ruby-identifier">with</span> <span class="ruby-value">:active_status</span>, <span class="ruby-string">&quot;Active&quot;</span>
      <span class="ruby-identifier">order_by</span> <span class="ruby-value">:score</span>, <span class="ruby-value">:desc</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_set_p</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_set_p</span>] = <span class="ruby-string">&quot;1&quot;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@search_sell</span> = []
    <span class="ruby-comment">#      if params[:page].nil?</span>
    <span class="ruby-comment">#        search_advance_curator(&quot;0&quot;)</span>
    <span class="ruby-comment">#        @search_count = @search.total</span>
    <span class="ruby-comment">#        @search_cu = &quot;yes&quot;</span>
    <span class="ruby-comment">#      end</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment">#      search_advance_curator(params[:search_set_p])</span>
    <span class="ruby-comment">#      @activity_free = @search.results</span>
    <span class="ruby-comment">#      if (@search.total &lt;=25) || (@activity_free.length &lt; 25 &amp;&amp; params[:search_set_p] == &quot;1&quot;)</span>
    <span class="ruby-comment">#        params[:page] = 1</span>
    <span class="ruby-comment">#        params[:search_set_p] = &quot;2&quot;</span>
    <span class="ruby-identifier">search_advance_curator</span>(<span class="ruby-string">&quot;2&quot;</span>)
    <span class="ruby-ivar">@act_cur</span> = <span class="ruby-ivar">@search</span>.<span class="ruby-identifier">results</span>
    <span class="ruby-ivar">@activity_free</span> = <span class="ruby-ivar">@search</span>.<span class="ruby-identifier">results</span>
    <span class="ruby-ivar">@tpage</span> = <span class="ruby-ivar">@search</span>.<span class="ruby-identifier">results</span>.<span class="ruby-identifier">total_pages</span>
    <span class="ruby-comment">#      else</span>
    <span class="ruby-comment">#        @tpage = @activity_free.total_pages</span>
    <span class="ruby-comment">#      end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@search_tu</span> = <span class="ruby-string">&quot;yes&quot;</span>
  <span class="ruby-ivar">@search_count</span> = <span class="ruby-ivar">@search</span>.<span class="ruby-identifier">total</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;provider&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]<span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-ivar">@user_curated</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{params[:user_id]} and show_card=true&quot;</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-ivar">@user_profile_curated</span> = <span class="ruby-constant">UserProfile</span>.<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;user_id=#{params[:user_id]}&quot;</span>).<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_curated</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@keyword</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>]
  <span class="ruby-ivar">@accordion</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">&quot;category Asc&quot;</span>).<span class="ruby-identifier">find</span>(<span class="ruby-value">:all</span>,<span class="ruby-value">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;DISTINCT trim(category) as category&quot;</span>,<span class="ruby-value">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-string">&quot;lower(category)!=?&quot;</span>,<span class="ruby-string">'default'</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;city&quot;</span>
    <span class="ruby-ivar">@keyword</span> = <span class="ruby-node">&quot;#{params[:city_name]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;city&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@keyword</span> = <span class="ruby-node">&quot;#{params[:event_search].html_safe if !params[:event_search].nil? }&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;#{params[:city_name]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;city&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment">#@keyword =  params[:event_search] = &quot;#{params[:event_search].html_safe if !params[:event_search].nil?}&quot; + &quot; &quot; + &quot;#{params[:pro_name]}&quot; if params[:type] == &quot;provider&quot;</span>
  <span class="ruby-comment"># @keyword =  params[:event_search] = &quot;#{params[:city_name]}&quot; if params[:type] == &quot;city&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;provider&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@search_tu</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;yes&quot;</span>
    <span class="ruby-ivar">@keyword</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:event_search</span>] = <span class="ruby-node">&quot;#{params[:pro_name]}&quot;</span>
    <span class="ruby-ivar">@search_count</span> = <span class="ruby-ivar">@search_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user_curated</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">'X-PJAX'</span>]
          <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
            <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> {<span class="ruby-identifier">render</span> <span class="ruby-value">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>}
         <span class="ruby-keyword">end</span>  
      <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
                      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
                      <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>
              <span class="ruby-keyword">end</span>           
      <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- search_event_index-source -->
          
        </div>

        

        
      </div><!-- search_event_index-method -->

    
      <div id="method-i-search_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>ajax calling function while searching the text in activities/index page.</p>
          

          
          <div class="method-source-code" id="search_index-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3608</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_index</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:search_text</span>]
  <span class="ruby-ivar">@event</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:provider_page</span>]
  <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>]
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cookies</span>[<span class="ruby-value">:city_new_usr</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>] = <span class="ruby-string">&quot;Walnut Creek&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:city</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value">:date</span>].<span class="ruby-identifier">nil?</span>

  <span class="ruby-comment">#normal search with ajax call</span>
  <span class="ruby-ivar">@search_provider</span> =<span class="ruby-string">&quot;search_provider&quot;</span>
  <span class="ruby-identifier">act</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">search_data</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:search_text</span>],<span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>])

  <span class="ruby-comment">#pagination for activities</span>
  <span class="ruby-identifier">act</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">act</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-ivar">@activities</span> = <span class="ruby-identifier">act</span>.<span class="ruby-identifier">paginate</span>(<span class="ruby-value">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:page</span>], <span class="ruby-value">:per_page</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)

<span class="ruby-keyword">end</span></pre>
          </div><!-- search_index-source -->
          
        </div>

        

        
      </div><!-- search_index-method -->

    
      <div id="method-i-search_monthly_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_monthly_view</span><span
            class="method-args">(repeat,schedule,actv,arr,days,day_arr)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>search repeat monthly</p>
          

          
          <div class="method-source-code" id="search_monthly_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2719</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_monthly_view</span>(<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">days</span>,<span class="ruby-identifier">day_arr</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-identifier">schedule</span>
  <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
  <span class="ruby-identifier">s</span> = <span class="ruby-identifier">week_of_month_for_date</span>(<span class="ruby-identifier">s_date</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:first</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">2</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:second</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">==</span><span class="ruby-value">3</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:third</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span><span class="ruby-operator">&gt;=</span><span class="ruby-value">4</span>
    <span class="ruby-identifier">se</span> = <span class="ruby-value">:last</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
      <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">s_date</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>)
      <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
            <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
              <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">day_arr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">week_day</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{se}&quot;</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">week_day</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># # # #if monthly and ends on exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
        <span class="ruby-identifier">s_date1</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date1</span>.<span class="ruby-identifier">to_i</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
              <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
                <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
                <span class="ruby-keyword">break</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">day_arr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">week_day</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{se}&quot;</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">week_day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
          <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># # #if monthly and end occurences exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">e_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">months</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">e_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeated_by_month</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">s_date1</span> = <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>)
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date1</span>.<span class="ruby-identifier">to_i</span>,<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-ivar">@c_date</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
              <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
                <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
                <span class="ruby-keyword">break</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">day_arr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">week_day</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:month</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;#{se}&quot;</span>,  <span class="ruby-value">:weekday</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">week_day</span>, <span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
          <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
            <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
 
  <span class="ruby-keyword">end</span>
  
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_monthly_view-source -->
          
        </div>

        

        
      </div><!-- search_monthly_view-method -->

    
      <div id="method-i-search_weekly_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_weekly_view</span><span
            class="method-args">(repeat,schedule,actv,arr,days)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>search weekly</p>
          

          
          <div class="method-source-code" id="search_weekly_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2686</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_weekly_view</span>(<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">days</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-identifier">repeat_o</span> = <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_on</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">repeat_o</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">repeat_o!</span>=<span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">repeat_o</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-identifier">rep</span> = <span class="ruby-identifier">repeat_o</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
    <span class="ruby-ivar">@ss_arr</span> = []
    <span class="ruby-identifier">rep</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span><span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;mon&quot;</span>
        <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'monday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;tue&quot;</span>
        <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'tuesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;wed&quot;</span>
        <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'wednesday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;thu&quot;</span>
        <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'thursday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;fri&quot;</span>
        <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'friday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sat&quot;</span>
        <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'saturday'</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span><span class="ruby-string">&quot;sun&quot;</span>
        <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">'sunday'</span>)
      <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">s!</span>=<span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">days</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@ss_arr</span>.<span class="ruby-identifier">include?</span><span class="ruby-identifier">val</span>
      <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_weekly_view-source -->
          
        </div>

        

        
      </div><!-- search_weekly_view-method -->

    
      <div id="method-i-search_yearly_view" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">search_yearly_view</span><span
            class="method-args">(repeat,schedule,actv,arr,days,day_arr)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>search repeat yearly</p>
          

          
          <div class="method-source-code" id="search_yearly_view-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 2830</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">search_yearly_view</span>(<span class="ruby-identifier">repeat</span>,<span class="ruby-identifier">schedule</span>,<span class="ruby-identifier">actv</span>,<span class="ruby-identifier">arr</span>,<span class="ruby-identifier">days</span>,<span class="ruby-identifier">day_arr</span>)
  <span class="ruby-ivar">@c_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>)
  <span class="ruby-ivar">@repeat</span> = <span class="ruby-identifier">repeat</span>
  <span class="ruby-ivar">@schedule</span> = <span class="ruby-identifier">schedule</span>
  <span class="ruby-comment">#if yearly and ends never true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_never</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">s_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:year</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%m&quot;</span>).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>).<span class="ruby-identifier">to_i</span>], <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
            <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
            <span class="ruby-keyword">break</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if Daily and ends on exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:year</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%m&quot;</span>).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>).<span class="ruby-identifier">to_i</span>],<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">ends_on</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
              <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#if Daily and end occurences exists</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">d_flag</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">e_date</span> = <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span> * <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">end_occurences</span>.<span class="ruby-identifier">to_i</span>).<span class="ruby-identifier">years</span>
    <span class="ruby-identifier">s_date</span> =  <span class="ruby-ivar">@schedule</span>.<span class="ruby-identifier">start_date</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">e_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@c_date</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@c_date</span>
        <span class="ruby-identifier">r</span> = <span class="ruby-constant">Recurrence</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:every</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:year</span>, <span class="ruby-value">:on</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%m&quot;</span>).<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">s_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%d&quot;</span>).<span class="ruby-identifier">to_i</span>],<span class="ruby-value">:starts</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">s_date</span>, <span class="ruby-value">:until</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e_date</span>, <span class="ruby-value">:interval</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@repeat</span>.<span class="ruby-identifier">repeat_every</span>.<span class="ruby-identifier">to_i</span>)
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
          <span class="ruby-identifier">r</span>.<span class="ruby-identifier">events</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">mon_day</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%A&quot;</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">days</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">mon_day</span>.<span class="ruby-identifier">downcase</span>)
              <span class="ruby-identifier">d_flag</span>=<span class="ruby-keyword">true</span>
              <span class="ruby-keyword">break</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">d_flag</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>
          <span class="ruby-identifier">arr</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_id</span>, <span class="ruby-value">:min_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">min_age_range</span>, <span class="ruby-value">:max_age_range</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">max_age_range</span>, <span class="ruby-value">:city</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">city</span>, <span class="ruby-value">:price_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price_type</span>, <span class="ruby-value">:activity_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">activity_name</span>, <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">description</span>,<span class="ruby-value">:avatar=</span><span class="ruby-operator">&gt;</span> <span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar</span>,<span class="ruby-value">:avatar_file_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">avatar_file_name</span>,<span class="ruby-value">:category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">category</span>,<span class="ruby-value">:sub_category=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">sub_category</span>,<span class="ruby-value">:price=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">price</span>,<span class="ruby-value">:address_1=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_1</span>,<span class="ruby-value">:address_2=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">address_2</span>,<span class="ruby-value">:age_range=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">age_range</span>,<span class="ruby-value">:no_participants=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">no_participants</span>,<span class="ruby-value">:created_by=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">created_by</span>,<span class="ruby-value">:user_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">user_id</span>, <span class="ruby-value">:filter_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">filter_id</span>, <span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">actv</span>.<span class="ruby-identifier">active_status</span>}
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  
  
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- search_yearly_view-source -->
          
        </div>

        

        
      </div><!-- search_yearly_view-method -->

    
      <div id="method-i-show" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="show-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5308</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show</span>
  <span class="ruby-ivar">@activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- show-source -->
          
        </div>

        

        
      </div><!-- show-method -->

    
      <div id="method-i-special_activity_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">special_activity_all</span><span
            class="method-args">(special_activity,spcls_act)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="special_activity_all-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 4852</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">special_activity_all</span>(<span class="ruby-identifier">special_activity</span>,<span class="ruby-identifier">spcls_act</span>)
  <span class="ruby-identifier">spcls_act</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">share</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">share</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">share</span>.<span class="ruby-identifier">price_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">share</span>.<span class="ruby-identifier">price_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-ivar">@p_details</span>=<span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@p_details</span> = <span class="ruby-constant">ActivityPrice</span>.<span class="ruby-identifier">get_price_details</span>(<span class="ruby-identifier">share</span>.<span class="ruby-identifier">activity_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">share</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">share</span>.<span class="ruby-identifier">activity_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">share</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">share</span>.<span class="ruby-identifier">price_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">share</span>.<span class="ruby-identifier">price_type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@p_details</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@p_details</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@p_details</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;true&quot;</span>
        <span class="ruby-identifier">special_activity</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">share</span>.<span class="ruby-identifier">activity_id</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">spcls_act</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">spcls_act</span>.<span class="ruby-identifier">present?</span> <span class="ruby-comment">#do end</span>
              
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">special_activity</span>
                      
<span class="ruby-keyword">end</span></pre>
          </div><!-- special_activity_all-source -->
          
        </div>

        

        
      </div><!-- special_activity_all-method -->

    
      <div id="method-i-test_repeat" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test_repeat</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="test_repeat-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3858</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test_repeat</span>
  <span class="ruby-comment">#    @raj = Activity.select(&quot;activities.*&quot;).joins(:activity_schedule).where(&quot;start_date &lt;= '2012-12-28'&quot;).uniq</span>

  <span class="ruby-comment">#    @activities = Activity.find_by_sql(&quot;SELECT DISTINCT activities.*, activity_schedules.schedule_mode,activity_schedules.start_date,activity_schedules.end_date FROM activities INNER JOIN activity_schedules ON</span>
  <span class="ruby-comment">#                                  activity_schedules.activity_id = activities.activity_id WHERE lower(active_status)='active' And lower(city) = 'san francisco'</span>
  <span class="ruby-comment">#                                  and filter_id=5 And (start_date &lt;='2012-12-30') Or</span>
  <span class="ruby-comment">#                                  (lower(activities.schedule_mode)='any time' And filter_id=5 And lower(city) = 'san francisco') order by activity_id desc #&quot;).uniq</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-ivar">@activities</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-string">&quot;select * from activities where activity_id = 102 order by activity_id desc&quot;</span>).<span class="ruby-identifier">uniq</span>

  <span class="ruby-identifier">events</span> = []
  <span class="ruby-ivar">@activities</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">event</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@schedule</span> = <span class="ruby-constant">ActivitySchedule</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;activity_id = ?&quot;</span>,<span class="ruby-identifier">event</span>.<span class="ruby-identifier">activity_id</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-identifier">schedule_repeat_activity</span>(<span class="ruby-identifier">event</span>,<span class="ruby-identifier">events</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@activity</span> = <span class="ruby-identifier">events</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- test_repeat-source -->
          
        </div>

        

        
      </div><!-- test_repeat-method -->

    
      <div id="method-i-update_active_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_active_status</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>update the activity status while change the text</p>
          

          
          <div class="method-source-code" id="update_active_status-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 3694</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_active_status</span>
  <span class="ruby-ivar">@activity_data</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]
  <span class="ruby-ivar">@activity_status</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value">:status</span>]
  <span class="ruby-ivar">@school_present</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:school_r_present</span>]
  <span class="ruby-ivar">@school_id</span> =  <span class="ruby-identifier">params</span>[<span class="ruby-value">:school_r_id</span>]
  <span class="ruby-ivar">@get_current_url</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">'HTTP_HOST'</span>]
  <span class="ruby-ivar">@activity</span>=<span class="ruby-constant">Activity</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@activity_data</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity_data</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-ivar">@school_rep</span> = <span class="ruby-constant">SchoolRepresentative</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@school_id</span>) <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@school_present</span> <span class="ruby-operator">==</span> <span class="ruby-string">'true'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_id</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_id</span>.<span class="ruby-identifier">present?</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@activity_status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Active&quot;</span>
    <span class="ruby-ivar">@astatus</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Active&quot;</span>)
    
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@school_present</span><span class="ruby-operator">==</span><span class="ruby-string">'true'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_rep</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_rep</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">'accepted'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_rep</span>.<span class="ruby-identifier">vendor_id</span><span class="ruby-operator">==</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
      <span class="ruby-ivar">@set_update</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-ivar">@provider_notify_status</span> = <span class="ruby-constant">ProviderNotificationDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from provider_notification_details pn left join provider_notifications p on pn.provider_notify_id=p.provider_notify_id where pn.notify_action='4' and p.user_id='#{@activity.user_id}' and p.notify_flag=true&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#user present in setting table</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notify_status</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_status</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notify_status</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#sending a nofification while status changed</span>
      <span class="ruby-ivar">@user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">user_email_id</span>=<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-comment">#@result = UserMailer.activity_status_mail(@user,@activity,@get_current_url,params[:message],user_email_id,params[:subject]).deliver</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Activity Status&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">activity_status_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">user_email_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])

    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-ivar">@activity_status</span><span class="ruby-operator">==</span><span class="ruby-string">&quot;Inactive&quot;</span>
    <span class="ruby-ivar">@astatus</span> = <span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:active_status=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Inactive&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@school_present</span><span class="ruby-operator">==</span><span class="ruby-string">'true'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_rep</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_rep</span>.<span class="ruby-identifier">status</span>.<span class="ruby-identifier">downcase</span><span class="ruby-operator">==</span><span class="ruby-string">'accepted'</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@school_rep</span>.<span class="ruby-identifier">vendor_id</span><span class="ruby-operator">==</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>
      <span class="ruby-ivar">@school_rep</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">edit_p</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">delete_p</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
      <span class="ruby-ivar">@set_update</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@provider_notify_status</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@provider_notify_status</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@provider_notify_status</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-comment">#sending a nofification while status changed</span>
      <span class="ruby-ivar">@user</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_user_id</span>(<span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@activity</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">user_email_id</span>=<span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">email_address</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span>  <span class="ruby-operator">!</span><span class="ruby-ivar">@user</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">user_flag</span><span class="ruby-operator">==</span><span class="ruby-constant">TRUE</span>
      <span class="ruby-ivar">@result</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">delay</span>(<span class="ruby-identifier">queue</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Activity Status&quot;</span>, <span class="ruby-identifier">priority</span><span class="ruby-operator">:</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">run_at</span><span class="ruby-operator">:</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">from_now</span>).<span class="ruby-identifier">activity_status_mail</span>(<span class="ruby-ivar">@user</span>,<span class="ruby-ivar">@activity</span>,<span class="ruby-ivar">@get_current_url</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:message</span>],<span class="ruby-identifier">user_email_id</span>,<span class="ruby-identifier">params</span>[<span class="ruby-value">:subject</span>])
      <span class="ruby-comment">#@result = UserMailer.activity_status_mail(@user,@activity,@get_current_url,params[:message],user_email_id,params[:subject]).deliver</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment">#memcache resetting here</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@astatus</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@astatus</span><span class="ruby-operator">==</span><span class="ruby-keyword">true</span>
      <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;activity_schedules_for#{@activity.activity_id}&quot;</span>,<span class="ruby-keyword">nil</span>)
      <span class="ruby-identifier">$dc</span>.<span class="ruby-identifier">set</span>(<span class="ruby-node">&quot;provider_activity_for#{current_user.user_id}&quot;</span>,<span class="ruby-keyword">nil</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">present?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- update_active_status-source -->
          
        </div>

        

        
      </div><!-- update_active_status-method -->

    
      <div id="method-i-update_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_index</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_index-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1503</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_index</span>
  <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>)

  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;act_index&quot;</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:states</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@activity_featured</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_index-source -->
          
        </div>

        

        
      </div><!-- update_index-method -->

    
      <div id="method-i-update_password" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_password</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_password-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5316</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_password</span>
  <span class="ruby-ivar">@user_details</span> = <span class="ruby-identifier">current_user</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_pass</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:confirm_pass</span>]
    <span class="ruby-ivar">@password</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:new_pass</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user_details</span>.<span class="ruby-identifier">user_password</span> <span class="ruby-operator">!=</span>  <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-node">&quot;#{@password}&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@password</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@password</span> <span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@user_details</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-value">:user_password=</span><span class="ruby-operator">&gt;</span> <span class="ruby-constant">Base64</span>.<span class="ruby-identifier">encode64</span>(<span class="ruby-node">&quot;#{@password}&quot;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@password</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>{<span class="ruby-identifier">render</span> <span class="ruby-value">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;$('.success_update_info').css('display', 'block').fadeOut(5000);&quot;</span>}
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span><span class="ruby-comment">#if first</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_password-source -->
          
        </div>

        

        
      </div><!-- update_password-method -->

    
      <div id="method-i-update_shared" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_shared</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_shared-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 1497</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_shared</span>
  <span class="ruby-ivar">@activity_featured</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">all</span>(<span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span>)

  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;update_shared&quot;</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:states</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@activity_featured</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_shared-source -->
          
        </div>

        

        
      </div><!-- update_shared-method -->

    
      <div id="method-i-update_sub_category" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_sub_category</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="update_sub_category-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5026</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_sub_category</span>
  <span class="ruby-ivar">@sub_category</span> = <span class="ruby-constant">ActivitySubcategory</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:category_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]).<span class="ruby-identifier">order</span>(<span class="ruby-value">:subcateg_name</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">render</span> <span class="ruby-value">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;sub_category&quot;</span>, <span class="ruby-value">:locals</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value">:states</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sub_category</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- update_sub_category-source -->
          
        </div>

        

        
      </div><!-- update_sub_category-method -->

    
      <div id="method-i-user_activity_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_activity_status</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>displayed the count for the user’s activity</p>
          

          
          <div class="method-source-code" id="user_activity_status-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_activity_status</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_user</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-comment">#business logo click views</span>
    <span class="ruby-ivar">@track_logo</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">track_logo_view</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@track_logo</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@track_logo</span>.<span class="ruby-identifier">present?</span>
      <span class="ruby-ivar">@track_logo</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@track_logo</span>= <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
      
    <span class="ruby-comment">#Total views count for previous week</span>
    <span class="ruby-ivar">@last_week</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">total_view_list_lastweek</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@last_week</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@last_week</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@last_week</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@last_week</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@last_week</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
   
    <span class="ruby-comment">#Total views count list</span>
    <span class="ruby-ivar">@total_views</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">total_view_list</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@total_views</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@total_views</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@total_views</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@total_views</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@total_views</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-comment">#active activities</span>
    <span class="ruby-ivar">@active</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">active_activities_list</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@active</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@active</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@active</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@active_count</span> = <span class="ruby-ivar">@active</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@active_count</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#inactive activities</span>
    <span class="ruby-ivar">@inactive</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">inactive_activities</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@inactive</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@inactive</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@inactive</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@inactcount</span> = <span class="ruby-ivar">@inactive</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@inactcount</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#expired activities</span>
    <span class="ruby-ivar">@expired</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">expired_activities</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@expired</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@expired</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@expired</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@expired_count</span> = <span class="ruby-ivar">@expired</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@expired_count</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#discount dollar activities</span>
    <span class="ruby-ivar">@ddollar</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">discount_dollar_activities</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ddollar</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@ddollar</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@ddollar</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@ddollar_count</span> = <span class="ruby-ivar">@ddollar</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@ddollar_count</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#Lead user count</span>
    <span class="ruby-ivar">@leaduser</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">lead_user_list</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">email_address</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@leaduser</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@leaduser</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@leaduser</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@leaduser_count</span> = <span class="ruby-ivar">@leaduser</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@leaduser_count</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#Registration invitee user list for the provider</span>
    <span class="ruby-ivar">@reg_invite</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">provider_invitee_list</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@reg_invite</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@reg_invite</span>.<span class="ruby-identifier">present?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@reg_invite</span><span class="ruby-operator">!=</span><span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-ivar">@reg_invite_count</span> = <span class="ruby-ivar">@reg_invite</span>.<span class="ruby-identifier">length</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@reg_invite_count</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment">#Top view activities list</span>
    <span class="ruby-ivar">@top_view</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">top_view_activities</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)
    
    <span class="ruby-comment">#Top share activities list</span>
    <span class="ruby-ivar">@top_share</span> = <span class="ruby-constant">Activity</span>.<span class="ruby-identifier">top_share_activities</span>(<span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>)

    <span class="ruby-identifier">render</span> <span class="ruby-value">:layout=</span><span class="ruby-operator">&gt;</span><span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user_activity_status-source -->
          
        </div>

        

        
      </div><!-- user_activity_status-method -->

    
      <div id="method-i-user_setting" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_setting</span><span
            class="method-args">(user_id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>settings for provider</p>
          

          
          <div class="method-source-code" id="user_setting-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5820</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_setting</span>(<span class="ruby-identifier">user_id</span>)
  <span class="ruby-ivar">@flag</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@created_setting</span> = <span class="ruby-constant">ProviderSettingDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select p.* from provider_setting_details s left join provider_settings p on s.provider_setting_id=p.provider_setting_id where s.setting_action='created' and p.user_id=#{user_id}&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span><span class="ruby-operator">!=</span><span class="ruby-string">''</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">present?</span>
    <span class="ruby-comment">#setting_option 1, show to famtiivty everyone</span>
    <span class="ruby-ivar">@created_setting</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set_val</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;1&quot;</span>
        <span class="ruby-ivar">@flag</span>=<span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span>  <span class="ruby-identifier">current_user</span>
        <span class="ruby-comment"># setting_option 2, famtivity contact user only</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;2&quot;</span>
          <span class="ruby-ivar">@con_user</span> = <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;contact_user&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;,&quot;</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-ivar">@con_user</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;#{current_user.user_id.to_i}&quot;</span>)
            <span class="ruby-ivar">@flag</span>=<span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-comment"># setting_option 3, just me activity only show to that person only</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">set_val</span>[<span class="ruby-string">&quot;setting_option&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-string">&quot;3&quot;</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">user_id</span>.<span class="ruby-identifier">to_i</span>
            <span class="ruby-ivar">@flag</span>=<span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment">#each loop end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Default setting ,show to famtivity everyone</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@created_setting</span> <span class="ruby-operator">==</span> []
    <span class="ruby-ivar">@flag</span>=<span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- user_setting-source -->
          
        </div>

        

        
      </div><!-- user_setting-method -->

    
      <div id="method-i-week_of_month_for_date" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">week_of_month_for_date</span><span
            class="method-args">(date)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="week_of_month_for_date-source">
            <pre><span class="ruby-comment"># File app/controllers/activities_controller.rb, line 5806</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">week_of_month_for_date</span>(<span class="ruby-identifier">date</span>)
  <span class="ruby-identifier">my_date</span> = <span class="ruby-identifier">date</span>
  <span class="ruby-identifier">week_of_target_date</span> = <span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%U&quot;</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">week_of_beginning_of_month</span> = <span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%U&quot;</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">my_date</span>.<span class="ruby-identifier">beginning_of_month</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">week_of_target_date</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">week_of_beginning_of_month</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- week_of_month_for_date-source -->
          
        </div>

        

        
      </div><!-- week_of_month_for_date-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

